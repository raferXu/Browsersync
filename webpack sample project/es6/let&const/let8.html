<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>函数能不能在块级作用域之中声明？</title>
</head>
<body>
ES5 规定，函数只能在顶层作用域和函数作用域之中声明，不能在块级作用域声明。

// 情况一
if (true) {
  function f() {}
}

// 情况二
try {
  function f() {}
} catch(e) {
  // ...
}
上面两种函数声明，根据 ES5 的规定都是非法的。
但是，浏览器没有遵守这个规定，为了兼容以前的旧代码，还是支持在块级作用域之中声明函数，因此上面两种情况实际都能运行，不会报错。


ES6 引入了块级作用域，明确允许在块级作用域之中声明函数。

function f() { console.log('I am outside!'); }

(function () {
  function f() { console.log('I am inside!'); }
  if (false) {
  }
  f();
}());

S6 就完全不一样了，理论上会得到“I am outside!”。

因为块级作用域内声明的函数类似于let，对作用域之外没有影响。

为了减轻因此产生的不兼容问题，ES6在附录B里面规定，浏览器的实现可以不遵守上面的规定，有自己的行为方式。

<script>
  // 浏览器的 ES6 环境
  function f() { console.log('I am outside!'); }

  (function () {

    if (false) {
      // 重复声明一次函数f
      function f() { console.log('I am inside!'); }
    }

    f();

  }());
  // Uncaught TypeError: f is not a function
//  上面的代码在符合 ES6 的浏览器中，都会报错，因为实际运行的是下面的代码。

  // 浏览器的 ES6 环境
  function f() { console.log('I am outside!'); }
  (function () {
    var f = undefined;
    if (false) {
      function f() { console.log('I am inside!'); }
    }

    f();
  }());
  // Uncaught TypeError: f is not a function


//  应该避免在块级作用域内声明函数。如果确实需要，也应该写成函数表达式，而不是函数声明语句。
  // 函数声明语句
  {
    let a = 'secret';
    function f() {
      return a;
    }
  }

  // 函数表达式
  {
    let a = 'secret';
    let f = function () {
      return a;
    };
  }

//  ES6 的块级作用域允许声明函数的规则，只在使用大括号的情况下成立，如果没有使用大括号，就会报错。

  // 不报错
  'use strict';
  if (true) {
    function f() {}
  }

  // 报错
  'use strict';
  if (true)
    function f() {}



</script>
</body>
</html>