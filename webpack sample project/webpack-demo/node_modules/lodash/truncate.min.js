var baseToString=require("./_baseToString"),castSlice=require("./_castSlice"),hasUnicode=require("./_hasUnicode"),isObject=require("./isObject"),isRegExp=require("./isRegExp"),stringSize=require("./_stringSize"),stringToArray=require("./_stringToArray"),toInteger=require("./toInteger"),toString=require("./toString");var DEFAULT_TRUNC_LENGTH=30,DEFAULT_TRUNC_OMISSION="...";var reFlags=/\w*$/;function truncate(h,m){var b=DEFAULT_TRUNC_LENGTH,k=DEFAULT_TRUNC_OMISSION;if(isObject(m)){var f="separator" in m?m.separator:f;b="length" in m?toInteger(m.length):b;k="omission" in m?baseToString(m.omission):k}h=toString(h);var a=h.length;if(hasUnicode(h)){var j=stringToArray(h);a=j.length}if(b>=a){return h}var d=b-stringSize(k);if(d<1){return k}var l=j?castSlice(j,0,d).join(""):h.slice(0,d);if(f===undefined){return l+k}if(j){d+=(l.length-d)}if(isRegExp(f)){if(h.slice(d).search(f)){var e,g=l;if(!f.global){f=RegExp(f.source,toString(reFlags.exec(f))+"g")}f.lastIndex=0;while((e=f.exec(g))){var c=e.index}l=l.slice(0,c===undefined?d:c)}}else{if(h.indexOf(baseToString(f),d)!=d){var i=l.lastIndexOf(f);if(i>-1){l=l.slice(0,i)}}}return l+k}module.exports=truncate;