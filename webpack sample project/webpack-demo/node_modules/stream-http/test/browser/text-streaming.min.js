var Buffer=require("buffer").Buffer;var fs=require("fs");var test=require("tape");var UAParser=require("ua-parser-js");var http=require("../..");var browser=(new UAParser()).setUA(navigator.userAgent).getBrowser();var browserName=browser.name;var browserVersion=browser.major;var skipStreamingCheck=(browserName==="Opera"||(browserName==="IE"&&browserVersion<=9));var COPIES=1000;var MIN_PIECES=5;var referenceOnce=fs.readFileSync(__dirname+"/../server/static/basic.txt");var reference=new Buffer(referenceOnce.length*COPIES);for(var i=0;i<COPIES;i++){referenceOnce.copy(reference,referenceOnce.length*i)}test("text streaming",function(a){http.get({path:"/basic.txt?copies="+COPIES,mode:"prefer-streaming"},function(c){var b=[];c.on("end",function(){if(skipStreamingCheck){a.skip("streaming not available on IE <= 8")}else{a.ok(b.length>=MIN_PIECES,"received in multiple parts")}a.ok(reference.equals(Buffer.concat(b)),"contents match");a.end()});c.on("data",function(d){b.push(d)})})});