var Buffer=require("buffer").Buffer;var fs=require("fs");var test=require("tape");var UAParser=require("ua-parser-js");var http=require("../..");var browser=(new UAParser()).setUA(navigator.userAgent).getBrowser();var browserName=browser.name;var browserVersion=browser.major;var skipVerification=((browserName==="Opera"&&browserVersion<=11)||(browserName==="IE"&&browserVersion<=10)||(browserName==="Safari"&&browserVersion<=5)||(browserName==="WebKit"&&browserVersion<=534)||(browserName==="Android Browser"&&browserVersion<=4));var reference=fs.readFileSync(__dirname+"/../server/static/browserify.png");test("post binary",function(a){var b=http.request({path:"/echo",method:"POST"},function(d){var c=[];d.on("end",function(){if(skipVerification){a.skip("binary data not preserved on this browser")}else{a.ok(reference.equals(Buffer.concat(c)),"echoed contents match")}a.end()});d.on("data",function(e){c.push(e)})});b.write(reference);b.end()});