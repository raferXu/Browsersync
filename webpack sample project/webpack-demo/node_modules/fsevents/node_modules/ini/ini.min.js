exports.parse=exports.decode=decode;exports.stringify=exports.encode=encode;exports.safe=safe;exports.unsafe=unsafe;var eol=process.platform==="win32"?"\r\n":"\n";function encode(e,c){var b=[],a="";if(typeof c==="string"){c={section:c,whitespace:false}}else{c=c||{};c.whitespace=c.whitespace===true}var d=c.whitespace?" = ":"=";Object.keys(e).forEach(function(f,g,h){var i=e[f];if(i&&Array.isArray(i)){i.forEach(function(j){a+=safe(f+"[]")+d+safe(j)+"\n"})}else{if(i&&typeof i==="object"){b.push(f)}else{a+=safe(f)+d+safe(i)+eol}}});if(c.section&&a.length){a="["+safe(c.section)+"]"+eol+a}b.forEach(function(g,h,i){var f=dotSplit(g).join("\\.");var j=(c.section?c.section+".":"")+f;var l=encode(e[g],{section:j,whitespace:c.whitespace});if(a.length&&l.length){a+=eol}a+=l});return a}function dotSplit(a){return a.replace(/\1/g,"\u0002LITERAL\\1LITERAL\u0002").replace(/\\\./g,"\u0001").split(/\./).map(function(b){return b.replace(/\1/g,"\\.").replace(/\2LITERAL\\1LITERAL\2/g,"\u0001")})}function decode(g){var b={},f=b,e=null,d="START",c=/^\[([^\]]*)\]$|^([^=]+)(=(.*))?$/i,a=g.split(/[\r\n]+/g),e=null;a.forEach(function(h,j,l){if(!h||h.match(/^\s*[;#]/)){return}var i=h.match(c);if(!i){return}if(i[1]!==undefined){e=unsafe(i[1]);f=b[e]=b[e]||{};return}var k=unsafe(i[2]),m=i[3]?unsafe((i[4]||"")):true;switch(m){case"true":case"false":case"null":m=JSON.parse(m)}if(k.length>2&&k.slice(-2)==="[]"){k=k.substring(0,k.length-2);if(!f[k]){f[k]=[]}else{if(!Array.isArray(f[k])){f[k]=[f[k]]}}}if(Array.isArray(f[k])){f[k].push(m)}else{f[k]=m}});Object.keys(b).filter(function(j,m,n){if(!b[j]||typeof b[j]!=="object"||Array.isArray(b[j])){return false}var q=dotSplit(j),o=b,i=q.pop(),h=i.replace(/\\\./g,".");q.forEach(function(l,k,p){if(!o[l]||typeof o[l]!=="object"){o[l]={}}o=o[l]});if(o===b&&h===i){return false}o[h]=b[j];return true}).forEach(function(h,i,j){delete b[h]});return b}function isQuoted(a){return(a.charAt(0)==='"'&&a.slice(-1)==='"')||(a.charAt(0)==="'"&&a.slice(-1)==="'")}function safe(a){return(typeof a!=="string"||a.match(/[=\r\n]/)||a.match(/^\[/)||(a.length>1&&isQuoted(a))||a!==a.trim())?JSON.stringify(a):a.replace(/;/g,"\\;").replace(/#/g,"\\#")}function unsafe(g,d){g=(g||"").trim();if(isQuoted(g)){if(g.charAt(0)==="'"){g=g.substr(1,g.length-2)}try{g=JSON.parse(g)}catch(e){}}else{var b=false;var j="";for(var f=0,a=g.length;f<a;f++){var h=g.charAt(f);if(b){if("\\;#".indexOf(h)!==-1){j+=h}else{j+="\\"+h}b=false}else{if(";#".indexOf(h)!==-1){break}else{if(h==="\\"){b=true}else{j+=h}}}}if(b){j+="\\"}return j}return g};