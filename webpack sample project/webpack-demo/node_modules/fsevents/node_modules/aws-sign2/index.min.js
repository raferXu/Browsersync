/*!
 *  Copyright 2010 LearnBoost <dev@learnboost.com>
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
;var crypto=require("crypto"),parse=require("url").parse;var keys=["acl","location","logging","notification","partNumber","policy","requestPayment","torrent","uploadId","uploads","versionId","versioning","versions","website"];function authorization(a){return"AWS "+a.key+":"+sign(a)}module.exports=authorization;module.exports.authorization=authorization;function hmacSha1(a){return crypto.createHmac("sha1",a.secret).update(a.message).digest("base64")}module.exports.hmacSha1=hmacSha1;function sign(a){a.message=stringToSign(a);return hmacSha1(a)}module.exports.sign=sign;function signQuery(a){a.message=queryStringToSign(a);return hmacSha1(a)}module.exports.signQuery=signQuery;function stringToSign(a){var c=a.amazonHeaders||"";if(c){c+="\n"}var b=[a.verb,a.md5,a.contentType,a.date?a.date.toUTCString():"",c+a.resource];return b.join("\n")}module.exports.queryStringToSign=stringToSign;function queryStringToSign(a){return"GET\n\n\n"+a.date+"\n"+a.resource}module.exports.queryStringToSign=queryStringToSign;function canonicalizeHeaders(g){var c=[],b=Object.keys(g);for(var d=0,a=b.length;d<a;++d){var e=b[d],f=g[e],e=e.toLowerCase();if(0!==e.indexOf("x-amz")){continue}c.push(e+":"+f)}return c.sort().join("\n")}module.exports.canonicalizeHeaders=canonicalizeHeaders;function canonicalizeResource(c){var b=parse(c,true),d=b.pathname,a=[];Object.keys(b.query).forEach(function(e){if(!~keys.indexOf(e)){return}var f=""==b.query[e]?"":"="+encodeURIComponent(b.query[e]);a.push(e+f)});return d+(a.length?"?"+a.sort().join("&"):"")}module.exports.canonicalizeResource=canonicalizeResource;