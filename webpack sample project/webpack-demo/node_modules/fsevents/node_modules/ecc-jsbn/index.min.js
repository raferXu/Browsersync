var crypto=require("crypto");var BigInteger=require("jsbn").BigInteger;var ECPointFp=require("./lib/ec.js").ECPointFp;exports.ECCurves=require("./lib/sec.js");function unstupid(b,a){return(b.length>=a)?b:unstupid("0"+b,a)}exports.ECKey=function(d,h,g){var i;var f=d();var b=f.getN();var j=Math.floor(b.bitLength()/8);if(h){if(g){var d=f.getCurve();this.P=d.decodePointHex(h.toString("hex"))}else{if(h.length!=j){return false}i=new BigInteger(h.toString("hex"),16)}}else{var e=b.subtract(BigInteger.ONE);var a=new BigInteger(crypto.randomBytes(b.bitLength()));i=a.mod(e).add(BigInteger.ONE);this.P=f.getG().multiply(i)}if(this.P){this.PublicKey=new Buffer(f.getCurve().encodeCompressedPointHex(this.P),"hex")}if(i){this.PrivateKey=new Buffer(unstupid(i.toString(16),j*2),"hex");this.deriveSharedSecret=function(k){if(!k||!k.P){return false}var c=k.P.multiply(i);return new Buffer(unstupid(c.getX().toBigInteger().toString(16),j*2),"hex")}}};