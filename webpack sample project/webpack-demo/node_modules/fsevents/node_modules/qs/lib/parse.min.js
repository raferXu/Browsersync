"use strict";var utils=require("./utils");var has=Object.prototype.hasOwnProperty;var defaults={allowDots:false,allowPrototypes:false,arrayLimit:20,decoder:utils.decode,delimiter:"&",depth:5,parameterLimit:1000,plainObjects:false,strictNullHandling:false};var parseValues=function parseQueryStringValues(f,j){var d={};var c=f.split(j.delimiter,j.parameterLimit===Infinity?undefined:j.parameterLimit);for(var e=0;e<c.length;++e){var a=c[e];var g=a.indexOf("]=")===-1?a.indexOf("="):a.indexOf("]=")+1;var h,b;if(g===-1){h=j.decoder(a);b=j.strictNullHandling?null:""}else{h=j.decoder(a.slice(0,g));b=j.decoder(a.slice(g+1))}if(has.call(d,h)){d[h]=[].concat(d[h]).concat(b)}else{d[h]=b}}return d};var parseObject=function parseObjectRecursive(e,g,d){if(!e.length){return g}var a=e.shift();var f;if(a==="[]"){f=[];f=f.concat(parseObject(e,g,d))}else{f=d.plainObjects?Object.create(null):{};var c=a.charAt(0)==="["&&a.charAt(a.length-1)==="]"?a.slice(1,-1):a;var b=parseInt(c,10);if(!isNaN(b)&&a!==c&&String(b)===c&&b>=0&&(d.parseArrays&&b<=d.arrayLimit)){f=[];f[b]=parseObject(e,g,d)}else{f[c]=parseObject(e,g,d)}}return f};var parseKeys=function parseQueryStringKeys(a,c,k){if(!a){return}var g=k.allowDots?a.replace(/\.([^.[]+)/g,"[$1]"):a;var j=/(\[[^[\]]*])/;var b=/(\[[^[\]]*])/g;var e=j.exec(g);var f=e?g.slice(0,e.index):g;var h=[];if(f){if(!k.plainObjects&&has.call(Object.prototype,f)){if(!k.allowPrototypes){return}}h.push(f)}var d=0;while((e=b.exec(g))!==null&&d<k.depth){d+=1;if(!k.plainObjects&&has.call(Object.prototype,e[1].slice(1,-1))){if(!k.allowPrototypes){return}}h.push(e[1])}if(e){h.push("["+g.slice(e.index)+"]")}return parseObject(h,c,k)};module.exports=function(e,a){var j=a||{};if(j.decoder!==null&&j.decoder!==undefined&&typeof j.decoder!=="function"){throw new TypeError("Decoder has to be a function.")}j.delimiter=typeof j.delimiter==="string"||utils.isRegExp(j.delimiter)?j.delimiter:defaults.delimiter;j.depth=typeof j.depth==="number"?j.depth:defaults.depth;j.arrayLimit=typeof j.arrayLimit==="number"?j.arrayLimit:defaults.arrayLimit;j.parseArrays=j.parseArrays!==false;j.decoder=typeof j.decoder==="function"?j.decoder:defaults.decoder;j.allowDots=typeof j.allowDots==="boolean"?j.allowDots:defaults.allowDots;j.plainObjects=typeof j.plainObjects==="boolean"?j.plainObjects:defaults.plainObjects;j.allowPrototypes=typeof j.allowPrototypes==="boolean"?j.allowPrototypes:defaults.allowPrototypes;j.parameterLimit=typeof j.parameterLimit==="number"?j.parameterLimit:defaults.parameterLimit;j.strictNullHandling=typeof j.strictNullHandling==="boolean"?j.strictNullHandling:defaults.strictNullHandling;if(e===""||e===null||typeof e==="undefined"){return j.plainObjects?Object.create(null):{}}var f=typeof e==="string"?parseValues(e,j):e;var c=j.plainObjects?Object.create(null):{};var h=Object.keys(f);for(var d=0;d<h.length;++d){var g=h[d];var b=parseKeys(g,f[g],j);c=utils.merge(c,b,j)}return utils.compact(c)};