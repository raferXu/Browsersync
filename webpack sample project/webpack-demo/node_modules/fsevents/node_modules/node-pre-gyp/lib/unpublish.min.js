"use strict";module.exports=exports=unpublish;exports.usage="Unpublishes pre-built binary (requires aws-sdk)";var fs=require("fs");var log=require("npmlog");var versioning=require("./util/versioning.js");var s3_setup=require("./util/s3_setup.js");var url=require("url");var config=require("rc")("node_pre_gyp",{acl:"public-read"});function unpublish(c,d,h){var b=require("aws-sdk");var i=JSON.parse(fs.readFileSync("./package.json"));var a=versioning.evaluate(i,c.opts);s3_setup.detect(a.hosted_path,config);b.config.update(config);var e=url.resolve(config.prefix,a.package_name);var f=new b.S3();var g={Bucket:config.bucket,Key:e};f.headObject(g,function(j,k){if(j&&j.code=="NotFound"){console.log("["+i.name+"] Not found: https://"+g.Bucket+".s3.amazonaws.com/"+g.Key);return h()}else{if(j){return h(j)}else{log.info("unpublish",JSON.stringify(k));f.deleteObject(g,function(l,m){if(l){return h(l)}log.info(JSON.stringify(m));console.log("["+i.name+"] Success: removed https://"+g.Bucket+".s3.amazonaws.com/"+g.Key);return h()})}}})};