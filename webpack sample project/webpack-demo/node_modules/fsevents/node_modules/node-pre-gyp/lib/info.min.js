"use strict";module.exports=exports=unpublish;exports.usage="Lists all published binaries (requires aws-sdk)";var fs=require("fs");var log=require("npmlog");var versioning=require("./util/versioning.js");var s3_setup=require("./util/s3_setup.js");var config=require("rc")("node_pre_gyp",{acl:"public-read"});function unpublish(c,a,h){var g=require("aws-sdk");var e=JSON.parse(fs.readFileSync("./package.json"));var f=versioning.evaluate(e,c.opts);s3_setup.detect(f.hosted_path,config);g.config.update(config);var b=new g.S3();var d={Bucket:config.bucket,Prefix:config.prefix};b.listObjects(d,function(i,j){if(i&&i.code=="NotFound"){return h(new Error("["+e.name+"] Not found: https://"+d.Bucket+".s3.amazonaws.com/"+config.prefix))}else{if(i){return h(i)}else{log.verbose(JSON.stringify(j,null,1));if(j&&j.Contents){j.Contents.forEach(function(k){console.log(k.Key)})}else{console.error("["+e.name+"] No objects found at https://"+d.Bucket+".s3.amazonaws.com/"+config.prefix)}return h()}}})};