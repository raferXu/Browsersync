"use strict";module.exports=exports;var path=require("path");var semver=require("semver");var url=require("url");var abi_crosswalk;if(process.env.NODE_PRE_GYP_ABI_CROSSWALK){abi_crosswalk=require(process.env.NODE_PRE_GYP_ABI_CROSSWALK)}else{abi_crosswalk=require("./abi_crosswalk.json")}function get_electron_abi(c,b){if(!c){throw new Error("get_electron_abi requires valid runtime arg")}if(typeof b==="undefined"){throw new Error("Empty target version is not supported if electron is the target.")}var a=semver.parse(b);return c+"-v"+a.major+"."+a.minor}module.exports.get_electron_abi=get_electron_abi;function get_node_webkit_abi(b,a){if(!b){throw new Error("get_node_webkit_abi requires valid runtime arg")}if(typeof a==="undefined"){throw new Error("Empty target version is not supported if node-webkit is the target.")}return b+"-v"+a}module.exports.get_node_webkit_abi=get_node_webkit_abi;function get_node_abi(c,b){if(!c){throw new Error("get_node_abi requires valid runtime arg")}if(!b){throw new Error("get_node_abi requires valid process.versions object")}var a=semver.parse(b.node);if(a.major===0&&a.minor%2){return c+"-v"+b.node}else{return b.modules?c+"-v"+(+b.modules):"v8-"+b.v8.split(".").slice(0,2).join(".")}}module.exports.get_node_abi=get_node_abi;function get_runtime_abi(e,h){if(!e){throw new Error("get_runtime_abi requires valid runtime arg")}if(e==="node-webkit"){return get_node_webkit_abi(e,h||process.versions["node-webkit"])}else{if(e==="electron"){return get_electron_abi(e,h||process.versions.electron)}else{if(e!="node"){throw new Error("Unknown Runtime: '"+e+"'")}if(!h){return get_node_abi(e,process.versions)}else{var f;if(abi_crosswalk[h]){f=abi_crosswalk[h]}else{var j=h.split(".").map(function(k){return +k});if(j.length!=3){throw new Error("Unknown target version: "+h)}var i=j[0];var g=j[1];var b=j[2];if(i===1){while(true){if(g>0){--g}if(b>0){--b}var d=""+i+"."+g+"."+b;if(abi_crosswalk[d]){f=abi_crosswalk[d];console.log("Warning: node-pre-gyp could not find exact match for "+h);console.log("Warning: but node-pre-gyp successfully choose "+d+" as ABI compatible target");break}if(g===0&&b===0){break}}}else{if(i===0){if(j[1]%2===0){while(--b>0){var a=""+i+"."+g+"."+b;if(abi_crosswalk[a]){f=abi_crosswalk[a];console.log("Warning: node-pre-gyp could not find exact match for "+h);console.log("Warning: but node-pre-gyp successfully choose "+a+" as ABI compatible target");break}}}}}}if(!f){throw new Error("Unsupported target version: "+h)}var c={node:h,v8:f.v8+".0",modules:f.node_abi>1?f.node_abi:undefined};return get_node_abi(e,c)}}}}module.exports.get_runtime_abi=get_runtime_abi;var required_parameters=["module_name","module_path","host"];function validate_config(b){var e=b.name+" package.json is not node-pre-gyp ready:\n";var a=[];if(!b.main){a.push("main")}if(!b.version){a.push("version")}if(!b.name){a.push("name")}if(!b.binary){a.push("binary")}var d=b.binary;required_parameters.forEach(function(f){if(a.indexOf("binary")>-1){a.pop("binary")}if(!d||d[f]===undefined){a.push("binary."+f)}});if(a.length>=1){throw new Error(e+"package.json must declare these properties: \n"+a.join("\n"))}if(d){var c=url.parse(d.host).protocol;if(c==="http:"){throw new Error("'host' protocol ("+c+") is invalid - only 'https:' is accepted")}}}module.exports.validate_config=validate_config;function eval_template(a,b){Object.keys(b).forEach(function(c){var d="{"+c+"}";while(a.indexOf(d)>-1){a=a.replace(d,b[c])}});return a}function fix_slashes(a){if(a.slice(-1)!="/"){return a+"/"}return a}function drop_double_slashes(a){return a.replace(/\/\//g,"/")}function get_process_runtime(a){var b="node";if(a["node-webkit"]){b="node-webkit"}else{if(a.electron){b="electron"}}return b}module.exports.get_process_runtime=get_process_runtime;var default_package_name="{module_name}-v{version}-{node_abi}-{platform}-{arch}.tar.gz";var default_remote_path="";module.exports.evaluate=function(d,c){c=c||{};validate_config(d);var a=d.version;var h=semver.parse(a);var g=c.runtime||get_process_runtime(process.versions);var f={name:d.name,configuration:Boolean(c.debug)?"Debug":"Release",debug:c.debug,module_name:d.binary.module_name,version:h.version,prerelease:h.prerelease.length?h.prerelease.join("."):"",build:h.build.length?h.build.join("."):"",major:h.major,minor:h.minor,patch:h.patch,runtime:g,node_abi:get_runtime_abi(g,c.target),target:c.target||"",platform:c.target_platform||process.platform,target_platform:c.target_platform||process.platform,arch:c.target_arch||process.arch,target_arch:c.target_arch||process.arch,module_main:d.main,toolset:c.toolset||""};var e=process.env["npm_config_"+f.module_name+"_binary_host_mirror"]||d.binary.host;f.host=fix_slashes(eval_template(e,f));f.module_path=eval_template(d.binary.module_path,f);if(c.module_root){f.module_path=path.join(c.module_root,f.module_path)}else{f.module_path=path.resolve(f.module_path)}f.module=path.join(f.module_path,f.module_name+".node");f.remote_path=d.binary.remote_path?drop_double_slashes(fix_slashes(eval_template(d.binary.remote_path,f))):default_remote_path;var b=d.binary.package_name?d.binary.package_name:default_package_name;f.package_name=eval_template(b,f);f.staged_tarball=path.join("build/stage",f.remote_path,f.package_name);f.hosted_path=url.resolve(f.host,f.remote_path);f.hosted_tarball=url.resolve(f.hosted_path,f.package_name);return f};