var hawk={internals:{}};hawk.client={header:function(c,b,j){var k={field:"",artifacts:{}};if(!c||(typeof c!=="string"&&typeof c!=="object")||!b||typeof b!=="string"||!j||typeof j!=="object"){k.err="Invalid argument type";return k}var f=j.timestamp||hawk.utils.now(j.localtimeOffsetMsec);var d=j.credentials;if(!d||!d.id||!d.key||!d.algorithm){k.err="Invalid credentials object";return k}if(hawk.crypto.algorithms.indexOf(d.algorithm)===-1){k.err="Unknown algorithm";return k}if(typeof c==="string"){c=hawk.utils.parseUri(c)}var i={ts:f,nonce:j.nonce||hawk.utils.randomString(6),method:b,resource:c.resource,host:c.host,port:c.port,hash:j.hash,ext:j.ext,app:j.app,dlg:j.dlg};k.artifacts=i;if(!i.hash&&(j.payload||j.payload==="")){i.hash=hawk.crypto.calculatePayloadHash(j.payload,d.algorithm,j.contentType)}var g=hawk.crypto.calculateMac("header",d,i);var h=i.ext!==null&&i.ext!==undefined&&i.ext!=="";var e='Hawk id="'+d.id+'", ts="'+i.ts+'", nonce="'+i.nonce+(i.hash?'", hash="'+i.hash:"")+(h?'", ext="'+hawk.utils.escapeHeaderAttribute(i.ext):"")+'", mac="'+g+'"';if(i.app){e+=', app="'+i.app+(i.dlg?'", dlg="'+i.dlg:"")+'"'}k.field=e;return k},bewit:function(f,d){if(!f||(typeof f!=="string")||!d||typeof d!=="object"||!d.ttlSec){return""}d.ext=(d.ext===null||d.ext===undefined?"":d.ext);var c=hawk.utils.now(d.localtimeOffsetMsec);var e=d.credentials;if(!e||!e.id||!e.key||!e.algorithm){return""}if(hawk.crypto.algorithms.indexOf(e.algorithm)===-1){return""}f=hawk.utils.parseUri(f);var g=c+d.ttlSec;var h=hawk.crypto.calculateMac("bewit",e,{ts:g,nonce:"",method:"GET",resource:f.resource,host:f.host,port:f.port,ext:d.ext});var b=e.id+"\\"+g+"\\"+h+"\\"+d.ext;return hawk.utils.base64urlEncode(b)},authenticate:function(j,g,m,n){n=n||{};var b=function(o){return j.getResponseHeader?j.getResponseHeader(o):j.getHeader(o)};var d=b("www-authenticate");if(d){var c=hawk.utils.parseAuthorizationHeader(d,["ts","tsm","error"]);if(!c){return false}if(c.ts){var k=hawk.crypto.calculateTsMac(c.ts,g);if(k!==c.tsm){return false}hawk.utils.setNtpOffset(c.ts-Math.floor((new Date()).getTime()/1000))}}var f=b("server-authorization");if(!f&&!n.required){return true}var i=hawk.utils.parseAuthorizationHeader(f,["mac","ext","hash"]);if(!i){return false}var e={ts:m.ts,nonce:m.nonce,method:m.method,resource:m.resource,host:m.host,port:m.port,hash:i.hash,ext:i.ext,app:m.app,dlg:m.dlg};var l=hawk.crypto.calculateMac("response",g,e);if(l!==i.mac){return false}if(!n.payload&&n.payload!==""){return true}if(!i.hash){return false}var h=hawk.crypto.calculatePayloadHash(n.payload,g.algorithm,b("content-type"));return(h===i.hash)},message:function(h,c,g,e){if(!h||typeof h!=="string"||!c||typeof c!=="number"||g===null||g===undefined||typeof g!=="string"||!e||typeof e!=="object"){return null}var i=e.timestamp||hawk.utils.now(e.localtimeOffsetMsec);var f=e.credentials;if(!f||!f.id||!f.key||!f.algorithm){return null}if(hawk.crypto.algorithms.indexOf(f.algorithm)===-1){return null}var d={ts:i,nonce:e.nonce||hawk.utils.randomString(6),host:h,port:c,hash:hawk.crypto.calculatePayloadHash(g,f.algorithm)};var b={id:f.id,ts:d.ts,nonce:d.nonce,hash:d.hash,mac:hawk.crypto.calculateMac("message",f,d)};return b},authenticateTimestamp:function(c,b,e){var d=hawk.crypto.calculateTsMac(c.ts,b);if(d!==c.tsm){return false}if(e!==false){hawk.utils.setNtpOffset(c.ts-Math.floor((new Date()).getTime()/1000))}return true}};hawk.crypto={headerVersion:"1",algorithms:["sha1","sha256"],calculateMac:function(d,c,b){var f=hawk.crypto.generateNormalizedString(d,b);var e=CryptoJS["Hmac"+c.algorithm.toUpperCase()](f,c.key);return e.toString(CryptoJS.enc.Base64)},generateNormalizedString:function(c,b){var d="hawk."+hawk.crypto.headerVersion+"."+c+"\n"+b.ts+"\n"+b.nonce+"\n"+(b.method||"").toUpperCase()+"\n"+(b.resource||"")+"\n"+b.host.toLowerCase()+"\n"+b.port+"\n"+(b.hash||"")+"\n";if(b.ext){d+=b.ext.replace("\\","\\\\").replace("\n","\\n")}d+="\n";if(b.app){d+=b.app+"\n"+(b.dlg||"")+"\n"}return d},calculatePayloadHash:function(d,b,e){var c=CryptoJS.algo[b.toUpperCase()].create();c.update("hawk."+hawk.crypto.headerVersion+".payload\n");c.update(hawk.utils.parseContentType(e)+"\n");c.update(d);c.update("\n");return c.finalize().toString(CryptoJS.enc.Base64)},calculateTsMac:function(c,b){var d=CryptoJS["Hmac"+b.algorithm.toUpperCase()]("hawk."+hawk.crypto.headerVersion+".ts\n"+c+"\n",b.key);return d.toString(CryptoJS.enc.Base64)}};hawk.internals.LocalStorage=function(){this._cache={};this.length=0;this.getItem=function(b){return this._cache.hasOwnProperty(b)?String(this._cache[b]):null};this.setItem=function(b,c){this._cache[b]=String(c);this.length=Object.keys(this._cache).length};this.removeItem=function(b){delete this._cache[b];this.length=Object.keys(this._cache).length};this.clear=function(){this._cache={};this.length=0};this.key=function(b){return Object.keys(this._cache)[b||0]}};hawk.utils={storage:new hawk.internals.LocalStorage(),setStorage:function(c){var b=hawk.utils.storage.getItem("hawk_ntp_offset");hawk.utils.storage=c;if(b){hawk.utils.setNtpOffset(b)}},setNtpOffset:function(c){try{hawk.utils.storage.setItem("hawk_ntp_offset",c)}catch(b){console.error("[hawk] could not write to storage.");console.error(b)}},getNtpOffset:function(){var b=hawk.utils.storage.getItem("hawk_ntp_offset");if(!b){return 0}return parseInt(b,10)},now:function(b){return Math.floor(((new Date()).getTime()+(b||0))/1000)+hawk.utils.getNtpOffset()},escapeHeaderAttribute:function(b){return b.replace(/\\/g,"\\\\").replace(/\"/g,'\\"')},parseContentType:function(b){if(!b){return""}return b.split(";")[0].replace(/^\s+|\s+$/g,"").toLowerCase()},parseAuthorizationHeader:function(h,f){if(!h){return null}var e=h.match(/^(\w+)(?:\s+(.*))?$/);if(!e){return null}var c=e[1];if(c.toLowerCase()!=="hawk"){return null}var d=e[2];if(!d){return null}var b={};var g=d.replace(/(\w+)="([^"\\]*)"\s*(?:,\s*|$)/g,function(j,i,k){if(f.indexOf(i)===-1){return}if(k.match(/^[ \w\!#\$%&'\(\)\*\+,\-\.\/\:;<\=>\?@\[\]\^`\{\|\}~]+$/)===null){return}if(b.hasOwnProperty(i)){return}b[i]=k;return""});if(g!==""){return null}return b},randomString:function(e){var f="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";var c=f.length;var b=[];for(var d=0;d<e;++d){b[d]=f[Math.floor(Math.random()*c)]}return b.join("")},uriRegex:/^([^:]+)\:\/\/(?:[^@]*@)?([^\/:]+)(?:\:(\d+))?([^#]*)(?:#.*)?$/,parseUri:function(c){var e=c.match(hawk.utils.uriRegex);if(!e){return{host:"",port:"",resource:""}}var b=e[1].toLowerCase();var d={host:e[2],port:e[3]||(b==="http"?"80":(b==="https"?"443":"")),resource:e[4]};return d},base64urlEncode:function(c){var b=CryptoJS.enc.Utf8.parse(c);var d=CryptoJS.enc.Base64.stringify(b);return d.replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}};var CryptoJS=CryptoJS||function(w,b){var o={},i=o.lib={},e=function(){},x=i.Base={extend:function(h){e.prototype=this;var f=new e;h&&f.mixIn(h);f.hasOwnProperty("init")||(f.init=function(){f.$super.init.apply(this,arguments)});f.init.prototype=f;f.$super=this;return f},create:function(){var f=this.extend();f.init.apply(f,arguments);return f},init:function(){},mixIn:function(h){for(var f in h){h.hasOwnProperty(f)&&(this[f]=h[f])}h.hasOwnProperty("toString")&&(this.toString=h.toString)},clone:function(){return this.init.prototype.extend(this)}},v=i.WordArray=x.extend({init:function(h,f){h=this.words=h||[];this.sigBytes=f!=b?f:4*h.length},toString:function(f){return(f||A).stringify(this)},concat:function(h){var f=this.words,k=h.words,l=this.sigBytes;h=h.sigBytes;this.clamp();if(l%4){for(var j=0;j<h;j++){f[l+j>>>2]|=(k[j>>>2]>>>24-8*(j%4)&255)<<24-8*((l+j)%4)}}else{if(65535<k.length){for(j=0;j<h;j+=4){f[l+j>>>2]=k[j>>>2]}}else{f.push.apply(f,k)}}this.sigBytes+=h;return this},clamp:function(){var h=this.words,f=this.sigBytes;h[f>>>2]&=4294967295<<32-8*(f%4);h.length=w.ceil(f/4)},clone:function(){var f=x.clone.call(this);f.words=this.words.slice(0);return f},random:function(h){for(var f=[],j=0;j<h;j+=4){f.push(4294967296*w.random()|0)}return new v.init(f,h)}}),g=o.enc={},A=g.Hex={stringify:function(h){var f=h.words;h=h.sigBytes;for(var k=[],l=0;l<h;l++){var j=f[l>>>2]>>>24-8*(l%4)&255;k.push((j>>>4).toString(16));k.push((j&15).toString(16))}return k.join("")},parse:function(h){for(var f=h.length,j=[],k=0;k<f;k+=2){j[k>>>3]|=parseInt(h.substr(k,2),16)<<24-4*(k%8)}return new v.init(j,f/2)}},d=g.Latin1={stringify:function(h){var f=h.words;h=h.sigBytes;for(var j=[],k=0;k<h;k++){j.push(String.fromCharCode(f[k>>>2]>>>24-8*(k%4)&255))}return j.join("")},parse:function(h){for(var f=h.length,j=[],k=0;k<f;k++){j[k>>>2]|=(h.charCodeAt(k)&255)<<24-8*(k%4)}return new v.init(j,f)}},z=g.Utf8={stringify:function(h){try{return decodeURIComponent(escape(d.stringify(h)))}catch(f){throw Error("Malformed UTF-8 data")}},parse:function(f){return d.parse(unescape(encodeURIComponent(f)))}},c=i.BufferedBlockAlgorithm=x.extend({reset:function(){this._data=new v.init;this._nDataBytes=0},_append:function(f){"string"==typeof f&&(f=z.parse(f));this._data.concat(f);this._nDataBytes+=f.sigBytes},_process:function(j){var h=this._data,n=h.words,p=h.sigBytes,m=this.blockSize,l=p/(4*m),l=j?w.ceil(l):w.max((l|0)-this._minBufferSize,0);j=l*m;p=w.min(4*j,p);if(j){for(var k=0;k<j;k+=m){this._doProcessBlock(n,k)}k=n.splice(0,j);h.sigBytes-=p}return new v.init(k,p)},clone:function(){var f=x.clone.call(this);f._data=this._data.clone();return f},_minBufferSize:0});i.Hasher=c.extend({cfg:x.extend(),init:function(f){this.cfg=this.cfg.extend(f);this.reset()},reset:function(){c.reset.call(this);this._doReset()},update:function(f){this._append(f);this._process();return this},finalize:function(f){f&&this._append(f);return this._doFinalize()},blockSize:16,_createHelper:function(f){return function(h,j){return(new f.init(j)).finalize(h)}},_createHmacHelper:function(f){return function(h,j){return(new y.HMAC.init(f,j)).finalize(h)}}});var y=o.algo={};return o}(Math);(function(){var g=CryptoJS,e=g.lib,c=e.WordArray,f=e.Hasher,h=[],e=g.algo.SHA1=f.extend({_doReset:function(){this._hash=new c.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(i,d){for(var t=this._hash.words,q=t[0],o=t[1],l=t[2],k=t[3],s=t[4],r=0;80>r;r++){if(16>r){h[r]=i[d+r]|0}else{var m=h[r-3]^h[r-8]^h[r-14]^h[r-16];h[r]=m<<1|m>>>31}m=(q<<5|q>>>27)+s+h[r];m=20>r?m+((o&l|~o&k)+1518500249):40>r?m+((o^l^k)+1859775393):60>r?m+((o&l|o&k|l&k)-1894007588):m+((o^l^k)-899497514);s=k;k=l;l=o<<30|o>>>2;o=q;q=m}t[0]=t[0]+q|0;t[1]=t[1]+o|0;t[2]=t[2]+l|0;t[3]=t[3]+k|0;t[4]=t[4]+s|0},_doFinalize:function(){var i=this._data,l=i.words,j=8*this._nDataBytes,k=8*i.sigBytes;l[k>>>5]|=128<<24-k%32;l[(k+64>>>9<<4)+14]=Math.floor(j/4294967296);l[(k+64>>>9<<4)+15]=j;i.sigBytes=4*l.length;this._process();return this._hash},clone:function(){var d=f.clone.call(this);d._hash=this._hash.clone();return d}});g.SHA1=f._createHelper(e);g.HmacSHA1=f._createHmacHelper(e)})();(function(i){for(var p=CryptoJS,o=p.lib,z=o.WordArray,m=o.Hasher,o=p.algo,C=[],B=[],A=function(b){return 4294967296*(b-(b|0))|0},f=2,x=0;64>x;){var q;a:{q=f;for(var y=i.sqrt(q),c=2;c<=y;c++){if(!(q%c)){q=!1;break a}}q=!0}q&&(8>x&&(C[x]=A(i.pow(f,0.5))),B[x]=A(i.pow(f,1/3)),x++);f++}var e=[],o=o.SHA256=m.extend({_doReset:function(){this._hash=new z.init(C.slice(0))},_doProcessBlock:function(n,w){for(var J=this._hash.words,H=J[0],G=J[1],I=J[2],u=J[3],E=J[4],D=J[5],v=J[6],t=J[7],F=0;64>F;F++){if(16>F){e[F]=n[w+F]|0}else{var s=e[F-15],r=e[F-2];e[F]=((s<<25|s>>>7)^(s<<14|s>>>18)^s>>>3)+e[F-7]+((r<<15|r>>>17)^(r<<13|r>>>19)^r>>>10)+e[F-16]}s=t+((E<<26|E>>>6)^(E<<21|E>>>11)^(E<<7|E>>>25))+(E&D^~E&v)+B[F]+e[F];r=((H<<30|H>>>2)^(H<<19|H>>>13)^(H<<10|H>>>22))+(H&G^H&I^G&I);t=v;v=D;D=E;E=u+s|0;u=I;I=G;G=H;H=s+r|0}J[0]=J[0]+H|0;J[1]=J[1]+G|0;J[2]=J[2]+I|0;J[3]=J[3]+u|0;J[4]=J[4]+E|0;J[5]=J[5]+D|0;J[6]=J[6]+v|0;J[7]=J[7]+t|0},_doFinalize:function(){var j=this._data,g=j.words,h=8*this._nDataBytes,k=8*j.sigBytes;g[k>>>5]|=128<<24-k%32;g[(k+64>>>9<<4)+14]=i.floor(h/4294967296);g[(k+64>>>9<<4)+15]=h;j.sigBytes=4*g.length;this._process();return this._hash},clone:function(){var d=m.clone.call(this);d._hash=this._hash.clone();return d}});p.SHA256=m._createHelper(o);p.HmacSHA256=m._createHmacHelper(o)})(Math);(function(){var d=CryptoJS,b=d.enc.Utf8;d.algo.HMAC=d.lib.Base.extend({init:function(r,q){r=this._hasher=new r.init;"string"==typeof q&&(q=b.parse(q));var p=r.blockSize,n=4*p;q.sigBytes>n&&(q=r.finalize(q));q.clamp();for(var m=this._oKey=q.clone(),l=this._iKey=q.clone(),k=m.words,i=l.words,o=0;o<p;o++){k[o]^=1549556828,i[o]^=909522486}m.sigBytes=l.sigBytes=n;this.reset()},reset:function(){var c=this._hasher;c.reset();c.update(this._iKey)},update:function(c){this._hasher.update(c);return this},finalize:function(e){var c=this._hasher;e=c.finalize(e);c.reset();return c.finalize(this._oKey.clone().concat(e))}})})();(function(){var c=CryptoJS,b=c.lib.WordArray;c.enc.Base64={stringify:function(h){var l=h.words,k=h.sigBytes,n=this._map;h.clamp();h=[];for(var i=0;i<k;i+=3){for(var m=(l[i>>>2]>>>24-8*(i%4)&255)<<16|(l[i+1>>>2]>>>24-8*((i+1)%4)&255)<<8|l[i+2>>>2]>>>24-8*((i+2)%4)&255,j=0;4>j&&i+0.75*j<k;j++){h.push(n.charAt(m>>>6*(3-j)&63))}}if(l=n.charAt(64)){for(;h.length%4;){h.push(l)}}return h.join("")},parse:function(i){var n=i.length,m=this._map,p=m.charAt(64);p&&(p=i.indexOf(p),-1!=p&&(n=p));for(var p=[],j=0,o=0;o<n;o++){if(o%4){var l=m.indexOf(i.charAt(o-1))<<2*(o%4),k=m.indexOf(i.charAt(o))>>>6-2*(o%4);p[j>>>2]|=(l|k)<<24-8*(j%4);j++}}return b.create(p,j)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}})();hawk.crypto.internals=CryptoJS;if(typeof module!=="undefined"&&module.exports){module.exports=hawk};