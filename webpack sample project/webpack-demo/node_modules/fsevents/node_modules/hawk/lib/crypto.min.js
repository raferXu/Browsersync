var Crypto=require("crypto");var Url=require("url");var Utils=require("./utils");var internals={};exports.headerVersion="1";exports.algorithms=["sha1","sha256"];exports.calculateMac=function(c,b,a){var f=exports.generateNormalizedString(c,a);var d=Crypto.createHmac(b.algorithm,b.key).update(f);var e=d.digest("base64");return e};exports.generateNormalizedString=function(c,b){var d=b.resource||"";if(d&&d[0]!=="/"){var a=Url.parse(d,false);d=a.path}var e="hawk."+exports.headerVersion+"."+c+"\n"+b.ts+"\n"+b.nonce+"\n"+(b.method||"").toUpperCase()+"\n"+d+"\n"+b.host.toLowerCase()+"\n"+b.port+"\n"+(b.hash||"")+"\n";if(b.ext){e+=b.ext.replace("\\","\\\\").replace("\n","\\n")}e+="\n";if(b.app){e+=b.app+"\n"+(b.dlg||"")+"\n"}return e};exports.calculatePayloadHash=function(c,a,d){var b=exports.initializePayloadHash(a,d);b.update(c||"");return exports.finalizePayloadHash(b)};exports.initializePayloadHash=function(a,c){var b=Crypto.createHash(a);b.update("hawk."+exports.headerVersion+".payload\n");b.update(Utils.parseContentType(c)+"\n");return b};exports.finalizePayloadHash=function(a){a.update("\n");return a.digest("base64")};exports.calculateTsMac=function(c,a){var b=Crypto.createHmac(a.algorithm,a.key);b.update("hawk."+exports.headerVersion+".ts\n"+c+"\n");return b.digest("base64")};exports.timestampMessage=function(b,d){var a=Utils.nowSecs(d);var c=exports.calculateTsMac(a,b);return{ts:a,tsm:c}};