var crypto=require("crypto"),qs=require("querystring");function sha1(b,a){return crypto.createHmac("sha1",b).update(a).digest("base64")}function rsa(b,a){return crypto.createSign("RSA-SHA1").update(a).sign(b,"base64")}function rfc3986(a){return encodeURIComponent(a).replace(/!/g,"%21").replace(/\*/g,"%2A").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/'/g,"%27")}function map(d){var c,e,a=[];for(c in d){e=d[c];if(Array.isArray(e)){for(var b=0;b<e.length;b++){a.push([c,e[b]])}}else{if(typeof e==="object"){for(var f in e){a.push([c+"["+f+"]",e[f]])}}else{a.push([c,e])}}}return a}function compare(d,c){return d>c?1:d<c?-1:0}function generateBase(b,a,e){var d=map(e).map(function(f){return[rfc3986(f[0]),rfc3986(f[1]||"")]}).sort(function(g,f){return compare(g[0],f[0])||compare(g[1],f[1])}).map(function(f){return f.join("=")}).join("&");var c=[rfc3986(b?b.toUpperCase():"GET"),rfc3986(a),rfc3986(d)].join("&");return c}function hmacsign(c,b,g,a,e){var f=generateBase(c,b,g);var d=[a||"",e||""].map(rfc3986).join("&");return sha1(d,f)}function rsasign(b,a,g,f,d){var e=generateBase(b,a,g);var c=f||"";return rsa(c,e)}function plaintext(a,c){var b=[a||"",c||""].map(rfc3986).join("&");return b}function sign(f,c,b,g,a,e){var h;var d=1;switch(f){case"RSA-SHA1":h=rsasign;break;case"HMAC-SHA1":h=hmacsign;break;case"PLAINTEXT":h=plaintext;d=4;break;default:throw new Error("Signature method not supported: "+f)}return h.apply(null,[].slice.call(arguments,d))}exports.hmacsign=hmacsign;exports.rsasign=rsasign;exports.plaintext=plaintext;exports.sign=sign;exports.rfc3986=rfc3986;exports.generateBase=generateBase;