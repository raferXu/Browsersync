/*!
 * Copyright (c) 2015, Salesforce.com, Inc.
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice,
 * this list of conditions and the following disclaimer.
 *
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 * this list of conditions and the following disclaimer in the documentation
 * and/or other materials provided with the distribution.
 *
 * 3. Neither the name of Salesforce.com nor the names of its contributors may
 * be used to endorse or promote products derived from this software without
 * specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */
;"use strict";var Store=require("./store").Store;var permuteDomain=require("./permuteDomain").permuteDomain;var pathMatch=require("./pathMatch").pathMatch;var util=require("util");function MemoryCookieStore(){Store.call(this);this.idx={}}util.inherits(MemoryCookieStore,Store);exports.MemoryCookieStore=MemoryCookieStore;MemoryCookieStore.prototype.idx=null;MemoryCookieStore.prototype.synchronous=true;MemoryCookieStore.prototype.inspect=function(){return"{ idx: "+util.inspect(this.idx,false,2)+" }"};MemoryCookieStore.prototype.findCookie=function(c,d,b,a){if(!this.idx[c]){return a(null,undefined)}if(!this.idx[c][d]){return a(null,undefined)}return a(null,this.idx[c][d][b]||null)};MemoryCookieStore.prototype.findCookies=function(c,h,b){var d=[];if(!c){return b(null,[])}var a;if(!h){a=function g(l){for(var m in l){var j=l[m];for(var k in j){d.push(j[k])}}}}else{a=function e(j){Object.keys(j).forEach(function(m){if(pathMatch(h,m)){var k=j[m];for(var l in k){d.push(k[l])}}})}}var i=permuteDomain(c)||[c];var f=this.idx;i.forEach(function(k){var j=f[k];if(!j){return}a(j)});b(null,d)};MemoryCookieStore.prototype.putCookie=function(b,a){if(!this.idx[b.domain]){this.idx[b.domain]={}}if(!this.idx[b.domain][b.path]){this.idx[b.domain][b.path]={}}this.idx[b.domain][b.path][b.key]=b;a(null)};MemoryCookieStore.prototype.updateCookie=function(b,c,a){this.putCookie(c,a)};MemoryCookieStore.prototype.removeCookie=function(c,d,b,a){if(this.idx[c]&&this.idx[c][d]&&this.idx[c][d][b]){delete this.idx[c][d][b]}a(null)};MemoryCookieStore.prototype.removeCookies=function(b,c,a){if(this.idx[b]){if(c){delete this.idx[b][c]}else{delete this.idx[b]}}return a(null)};MemoryCookieStore.prototype.getAllCookies=function(c){var d=[];var b=this.idx;var a=Object.keys(b);a.forEach(function(e){var f=Object.keys(b[e]);f.forEach(function(h){var g=Object.keys(b[e][h]);g.forEach(function(i){if(i!==null){d.push(b[e][h][i])}})})});d.sort(function(f,e){return(f.creationIndex||0)-(e.creationIndex||0)});c(null,d)};