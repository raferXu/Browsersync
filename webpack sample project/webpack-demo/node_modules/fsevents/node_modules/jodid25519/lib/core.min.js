"use strict";var crypto=require("crypto");var ns={};function _setbit(g,f,d){var e=f>>4;var b=g[e];b=b+(1<<(f&15))*d;g[e]=b}function _getbit(b,a){return(b[a>>4]>>(a&15))&1}function _ZERO(){return[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}function _ONE(){return[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}function _BASE(){return[9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}function _bigintcmp(g,e){var k,h,f;var i=0;for(k=15;k>=0;k--){var d=g[k];var j=e[k];i=i+(d-j)*(1-i*i);f=i>>31;h=(i+f)^f;i=~~((i<<1)/(h+1))}return i}function _bigintadd(d,c){var f=[];var e;f[0]=(e=d[0]+c[0])&65535;f[1]=(e=(e>>>16)+d[1]+c[1])&65535;f[2]=(e=(e>>>16)+d[2]+c[2])&65535;f[3]=(e=(e>>>16)+d[3]+c[3])&65535;f[4]=(e=(e>>>16)+d[4]+c[4])&65535;f[5]=(e=(e>>>16)+d[5]+c[5])&65535;f[6]=(e=(e>>>16)+d[6]+c[6])&65535;f[7]=(e=(e>>>16)+d[7]+c[7])&65535;f[8]=(e=(e>>>16)+d[8]+c[8])&65535;f[9]=(e=(e>>>16)+d[9]+c[9])&65535;f[10]=(e=(e>>>16)+d[10]+c[10])&65535;f[11]=(e=(e>>>16)+d[11]+c[11])&65535;f[12]=(e=(e>>>16)+d[12]+c[12])&65535;f[13]=(e=(e>>>16)+d[13]+c[13])&65535;f[14]=(e=(e>>>16)+d[14]+c[14])&65535;f[15]=(e>>>16)+d[15]+c[15];return f}function _bigintsub(d,c){var f=[];var e;f[0]=(e=524288+d[0]-c[0])&65535;f[1]=(e=(e>>>16)+524280+d[1]-c[1])&65535;f[2]=(e=(e>>>16)+524280+d[2]-c[2])&65535;f[3]=(e=(e>>>16)+524280+d[3]-c[3])&65535;f[4]=(e=(e>>>16)+524280+d[4]-c[4])&65535;f[5]=(e=(e>>>16)+524280+d[5]-c[5])&65535;f[6]=(e=(e>>>16)+524280+d[6]-c[6])&65535;f[7]=(e=(e>>>16)+524280+d[7]-c[7])&65535;f[8]=(e=(e>>>16)+524280+d[8]-c[8])&65535;f[9]=(e=(e>>>16)+524280+d[9]-c[9])&65535;f[10]=(e=(e>>>16)+524280+d[10]-c[10])&65535;f[11]=(e=(e>>>16)+524280+d[11]-c[11])&65535;f[12]=(e=(e>>>16)+524280+d[12]-c[12])&65535;f[13]=(e=(e>>>16)+524280+d[13]-c[13])&65535;f[14]=(e=(e>>>16)+524280+d[14]-c[14])&65535;f[15]=(e>>>16)-8+d[15]-c[15];return f}function _sqr8h(g,h,i,j,b,c,d,e){var a=[];var f;a[0]=(f=e*e)&65535;a[1]=(f=(0|(f/65536))+2*e*d)&65535;a[2]=(f=(0|(f/65536))+2*e*c+d*d)&65535;a[3]=(f=(0|(f/65536))+2*e*b+2*d*c)&65535;a[4]=(f=(0|(f/65536))+2*e*j+2*d*b+c*c)&65535;a[5]=(f=(0|(f/65536))+2*e*i+2*d*j+2*c*b)&65535;a[6]=(f=(0|(f/65536))+2*e*h+2*d*i+2*c*j+b*b)&65535;a[7]=(f=(0|(f/65536))+2*e*g+2*d*h+2*c*i+2*b*j)&65535;a[8]=(f=(0|(f/65536))+2*d*g+2*c*h+2*b*i+j*j)&65535;a[9]=(f=(0|(f/65536))+2*c*g+2*b*h+2*j*i)&65535;a[10]=(f=(0|(f/65536))+2*b*g+2*j*h+i*i)&65535;a[11]=(f=(0|(f/65536))+2*j*g+2*i*h)&65535;a[12]=(f=(0|(f/65536))+2*i*g+h*h)&65535;a[13]=(f=(0|(f/65536))+2*h*g)&65535;a[14]=(f=(0|(f/65536))+g*g)&65535;a[15]=0|(f/65536);return a}function _sqrmodp(c){var b=_sqr8h(c[15],c[14],c[13],c[12],c[11],c[10],c[9],c[8]);var f=_sqr8h(c[7],c[6],c[5],c[4],c[3],c[2],c[1],c[0]);var g=_sqr8h(c[15]+c[7],c[14]+c[6],c[13]+c[5],c[12]+c[4],c[11]+c[3],c[10]+c[2],c[9]+c[1],c[8]+c[0]);var e=[];var d;e[0]=(d=8388608+f[0]+(g[8]-b[8]-f[8]+b[0]-128)*38)&65535;e[1]=(d=8388480+(d>>>16)+f[1]+(g[9]-b[9]-f[9]+b[1])*38)&65535;e[2]=(d=8388480+(d>>>16)+f[2]+(g[10]-b[10]-f[10]+b[2])*38)&65535;e[3]=(d=8388480+(d>>>16)+f[3]+(g[11]-b[11]-f[11]+b[3])*38)&65535;e[4]=(d=8388480+(d>>>16)+f[4]+(g[12]-b[12]-f[12]+b[4])*38)&65535;e[5]=(d=8388480+(d>>>16)+f[5]+(g[13]-b[13]-f[13]+b[5])*38)&65535;e[6]=(d=8388480+(d>>>16)+f[6]+(g[14]-b[14]-f[14]+b[6])*38)&65535;e[7]=(d=8388480+(d>>>16)+f[7]+(g[15]-b[15]-f[15]+b[7])*38)&65535;e[8]=(d=8388480+(d>>>16)+f[8]+g[0]-b[0]-f[0]+b[8]*38)&65535;e[9]=(d=8388480+(d>>>16)+f[9]+g[1]-b[1]-f[1]+b[9]*38)&65535;e[10]=(d=8388480+(d>>>16)+f[10]+g[2]-b[2]-f[2]+b[10]*38)&65535;e[11]=(d=8388480+(d>>>16)+f[11]+g[3]-b[3]-f[3]+b[11]*38)&65535;e[12]=(d=8388480+(d>>>16)+f[12]+g[4]-b[4]-f[4]+b[12]*38)&65535;e[13]=(d=8388480+(d>>>16)+f[13]+g[5]-b[5]-f[5]+b[13]*38)&65535;e[14]=(d=8388480+(d>>>16)+f[14]+g[6]-b[6]-f[6]+b[14]*38)&65535;e[15]=8388480+(d>>>16)+f[15]+g[7]-b[7]-f[7]+b[15]*38;_reduce(e);return e}function _mul8h(k,l,m,n,o,p,q,s,a,b,c,d,e,f,g,h){var j=[];var i;j[0]=(i=s*h)&65535;j[1]=(i=(0|(i/65536))+s*g+q*h)&65535;j[2]=(i=(0|(i/65536))+s*f+q*g+p*h)&65535;j[3]=(i=(0|(i/65536))+s*e+q*f+p*g+o*h)&65535;j[4]=(i=(0|(i/65536))+s*d+q*e+p*f+o*g+n*h)&65535;j[5]=(i=(0|(i/65536))+s*c+q*d+p*e+o*f+n*g+m*h)&65535;j[6]=(i=(0|(i/65536))+s*b+q*c+p*d+o*e+n*f+m*g+l*h)&65535;j[7]=(i=(0|(i/65536))+s*a+q*b+p*c+o*d+n*e+m*f+l*g+k*h)&65535;j[8]=(i=(0|(i/65536))+q*a+p*b+o*c+n*d+m*e+l*f+k*g)&65535;j[9]=(i=(0|(i/65536))+p*a+o*b+n*c+m*d+l*e+k*f)&65535;j[10]=(i=(0|(i/65536))+o*a+n*b+m*c+l*d+k*e)&65535;j[11]=(i=(0|(i/65536))+n*a+m*b+l*c+k*d)&65535;j[12]=(i=(0|(i/65536))+m*a+l*b+k*c)&65535;j[13]=(i=(0|(i/65536))+l*a+k*b)&65535;j[14]=(i=(0|(i/65536))+k*a)&65535;j[15]=(0|(i/65536));return j}function _mulmodp(e,d){var c=_mul8h(e[15],e[14],e[13],e[12],e[11],e[10],e[9],e[8],d[15],d[14],d[13],d[12],d[11],d[10],d[9],d[8]);var h=_mul8h(e[7],e[6],e[5],e[4],e[3],e[2],e[1],e[0],d[7],d[6],d[5],d[4],d[3],d[2],d[1],d[0]);var i=_mul8h(e[15]+e[7],e[14]+e[6],e[13]+e[5],e[12]+e[4],e[11]+e[3],e[10]+e[2],e[9]+e[1],e[8]+e[0],d[15]+d[7],d[14]+d[6],d[13]+d[5],d[12]+d[4],d[11]+d[3],d[10]+d[2],d[9]+d[1],d[8]+d[0]);var g=[];var f;g[0]=(f=8388608+h[0]+(i[8]-c[8]-h[8]+c[0]-128)*38)&65535;g[1]=(f=8388480+(f>>>16)+h[1]+(i[9]-c[9]-h[9]+c[1])*38)&65535;g[2]=(f=8388480+(f>>>16)+h[2]+(i[10]-c[10]-h[10]+c[2])*38)&65535;g[3]=(f=8388480+(f>>>16)+h[3]+(i[11]-c[11]-h[11]+c[3])*38)&65535;g[4]=(f=8388480+(f>>>16)+h[4]+(i[12]-c[12]-h[12]+c[4])*38)&65535;g[5]=(f=8388480+(f>>>16)+h[5]+(i[13]-c[13]-h[13]+c[5])*38)&65535;g[6]=(f=8388480+(f>>>16)+h[6]+(i[14]-c[14]-h[14]+c[6])*38)&65535;g[7]=(f=8388480+(f>>>16)+h[7]+(i[15]-c[15]-h[15]+c[7])*38)&65535;g[8]=(f=8388480+(f>>>16)+h[8]+i[0]-c[0]-h[0]+c[8]*38)&65535;g[9]=(f=8388480+(f>>>16)+h[9]+i[1]-c[1]-h[1]+c[9]*38)&65535;g[10]=(f=8388480+(f>>>16)+h[10]+i[2]-c[2]-h[2]+c[10]*38)&65535;g[11]=(f=8388480+(f>>>16)+h[11]+i[3]-c[3]-h[3]+c[11]*38)&65535;g[12]=(f=8388480+(f>>>16)+h[12]+i[4]-c[4]-h[4]+c[12]*38)&65535;g[13]=(f=8388480+(f>>>16)+h[13]+i[5]-c[5]-h[5]+c[13]*38)&65535;g[14]=(f=8388480+(f>>>16)+h[14]+i[6]-c[6]-h[6]+c[14]*38)&65535;g[15]=8388480+(f>>>16)+h[15]+i[7]-c[7]-h[7]+c[15]*38;_reduce(g);return g}function _reduce(b){var f=b.slice(0);var e=[b,f];var d=b[15];var c=e[(d<32768)&1];c[15]=d&32767;d=(0|(d/32768))*19;c[0]=(d+=c[0])&65535;d=d>>>16;c[1]=(d+=c[1])&65535;d=d>>>16;c[2]=(d+=c[2])&65535;d=d>>>16;c[3]=(d+=c[3])&65535;d=d>>>16;c[4]=(d+=c[4])&65535;d=d>>>16;c[5]=(d+=c[5])&65535;d=d>>>16;c[6]=(d+=c[6])&65535;d=d>>>16;c[7]=(d+=c[7])&65535;d=d>>>16;c[8]=(d+=c[8])&65535;d=d>>>16;c[9]=(d+=c[9])&65535;d=d>>>16;c[10]=(d+=c[10])&65535;d=d>>>16;c[11]=(d+=c[11])&65535;d=d>>>16;c[12]=(d+=c[12])&65535;d=d>>>16;c[13]=(d+=c[13])&65535;d=d>>>16;c[14]=(d+=c[14])&65535;d=d>>>16;c[15]+=d}function _addmodp(d,c){var f=[];var e;f[0]=(e=((0|(d[15]>>>15))+(0|(c[15]>>>15)))*19+d[0]+c[0])&65535;f[1]=(e=(e>>>16)+d[1]+c[1])&65535;f[2]=(e=(e>>>16)+d[2]+c[2])&65535;f[3]=(e=(e>>>16)+d[3]+c[3])&65535;f[4]=(e=(e>>>16)+d[4]+c[4])&65535;f[5]=(e=(e>>>16)+d[5]+c[5])&65535;f[6]=(e=(e>>>16)+d[6]+c[6])&65535;f[7]=(e=(e>>>16)+d[7]+c[7])&65535;f[8]=(e=(e>>>16)+d[8]+c[8])&65535;f[9]=(e=(e>>>16)+d[9]+c[9])&65535;f[10]=(e=(e>>>16)+d[10]+c[10])&65535;f[11]=(e=(e>>>16)+d[11]+c[11])&65535;f[12]=(e=(e>>>16)+d[12]+c[12])&65535;f[13]=(e=(e>>>16)+d[13]+c[13])&65535;f[14]=(e=(e>>>16)+d[14]+c[14])&65535;f[15]=(e>>>16)+(d[15]&32767)+(c[15]&32767);return f}function _submodp(d,c){var f=[];var e;f[0]=(e=524288+((0|(d[15]>>>15))-(0|(c[15]>>>15))-1)*19+d[0]-c[0])&65535;f[1]=(e=(e>>>16)+524280+d[1]-c[1])&65535;f[2]=(e=(e>>>16)+524280+d[2]-c[2])&65535;f[3]=(e=(e>>>16)+524280+d[3]-c[3])&65535;f[4]=(e=(e>>>16)+524280+d[4]-c[4])&65535;f[5]=(e=(e>>>16)+524280+d[5]-c[5])&65535;f[6]=(e=(e>>>16)+524280+d[6]-c[6])&65535;f[7]=(e=(e>>>16)+524280+d[7]-c[7])&65535;f[8]=(e=(e>>>16)+524280+d[8]-c[8])&65535;f[9]=(e=(e>>>16)+524280+d[9]-c[9])&65535;f[10]=(e=(e>>>16)+524280+d[10]-c[10])&65535;f[11]=(e=(e>>>16)+524280+d[11]-c[11])&65535;f[12]=(e=(e>>>16)+524280+d[12]-c[12])&65535;f[13]=(e=(e>>>16)+524280+d[13]-c[13])&65535;f[14]=(e=(e>>>16)+524280+d[14]-c[14])&65535;f[15]=(e>>>16)+32760+(d[15]&32767)-(c[15]&32767);return f}function _invmodp(b){var e=b;var d=250;while(--d){b=_sqrmodp(b);b=_mulmodp(b,e)}b=_sqrmodp(b);b=_sqrmodp(b);b=_mulmodp(b,e);b=_sqrmodp(b);b=_sqrmodp(b);b=_mulmodp(b,e);b=_sqrmodp(b);b=_mulmodp(b,e);return b}function _mulasmall(c){var b=121665;var e=[];var d;e[0]=(d=c[0]*b)&65535;e[1]=(d=(0|(d/65536))+c[1]*b)&65535;e[2]=(d=(0|(d/65536))+c[2]*b)&65535;e[3]=(d=(0|(d/65536))+c[3]*b)&65535;e[4]=(d=(0|(d/65536))+c[4]*b)&65535;e[5]=(d=(0|(d/65536))+c[5]*b)&65535;e[6]=(d=(0|(d/65536))+c[6]*b)&65535;e[7]=(d=(0|(d/65536))+c[7]*b)&65535;e[8]=(d=(0|(d/65536))+c[8]*b)&65535;e[9]=(d=(0|(d/65536))+c[9]*b)&65535;e[10]=(d=(0|(d/65536))+c[10]*b)&65535;e[11]=(d=(0|(d/65536))+c[11]*b)&65535;e[12]=(d=(0|(d/65536))+c[12]*b)&65535;e[13]=(d=(0|(d/65536))+c[13]*b)&65535;e[14]=(d=(0|(d/65536))+c[14]*b)&65535;e[15]=(0|(d/65536))+c[15]*b;_reduce(e);return e}function _dbl(c,f){var b,d,a,g,e;a=_sqrmodp(_addmodp(c,f));g=_sqrmodp(_submodp(c,f));e=_submodp(a,g);b=_mulmodp(g,a);d=_mulmodp(_addmodp(_mulasmall(e),a),e);return[b,d]}function _sum(g,f,c,e,i){var h,d,b,a;b=_mulmodp(_submodp(g,f),_addmodp(c,e));a=_mulmodp(_addmodp(g,f),_submodp(c,e));h=_sqrmodp(_addmodp(b,a));d=_mulmodp(_sqrmodp(_submodp(b,a)),i);return[h,d]}function _generateKey(d){var b=crypto.randomBytes(32);if(d===true){b[0]&=248;b[31]=(b[31]&127)|64}var a=[];for(var c=0;c<b.length;c++){a.push(String.fromCharCode(b[c]))}return a.join("")}ns.getbit=_getbit;ns.setbit=_setbit;ns.addmodp=_addmodp;ns.invmodp=_invmodp;ns.mulmodp=_mulmodp;ns.reduce=_reduce;ns.dbl=_dbl;ns.sum=_sum;ns.ZERO=_ZERO;ns.ONE=_ONE;ns.BASE=_BASE;ns.bigintadd=_bigintadd;ns.bigintsub=_bigintsub;ns.bigintcmp=_bigintcmp;ns.mulmodp=_mulmodp;ns.sqrmodp=_sqrmodp;ns.generateKey=_generateKey;module.exports=ns;