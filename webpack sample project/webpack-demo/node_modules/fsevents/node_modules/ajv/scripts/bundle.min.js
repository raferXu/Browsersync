"use strict";var fs=require("fs"),path=require("path"),browserify=require("browserify"),uglify=require("uglify-js");var pkg=process.argv[2],standalone=process.argv[3],compress=process.argv[4];var packageDir=path.join(__dirname,"..");if(pkg!="."){packageDir=path.join(packageDir,"node_modules",pkg)}var json=require(path.join(packageDir,"package.json"));var distDir=path.join(__dirname,"..","dist");if(!fs.existsSync(distDir)){fs.mkdirSync(distDir)}var bOpts={};if(standalone){bOpts.standalone=standalone}browserify(bOpts).require(path.join(packageDir,json.main),{expose:json.name}).bundle(function(b,a){if(b){console.error("browserify error:",b);process.exit(1)}var f=path.join(distDir,json.name);var g=f+".bundle.js";fs.writeFileSync(g,a);var e={warnings:true,compress:{},output:{preamble:"/* "+json.name+" "+json.version+": "+json.description+" */"}};if(compress){var h=compress.split(",");for(var d=0;d<h.length;++d){var c=h[d].split("=");e.compress[c[0]]=c.length<1||c[1]!="false"}}if(standalone){e.outSourceMap=json.name+".min.js.map"}var j=uglify.minify(g,e);fs.writeFileSync(f+".min.js",j.code);if(j.map){fs.writeFileSync(f+".min.js.map",j.map)}if(!standalone){fs.unlinkSync(g)}});