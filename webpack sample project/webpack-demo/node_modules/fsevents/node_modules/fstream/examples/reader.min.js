var fstream=require("../fstream.js");var tap=require("tap");var fs=require("fs");var path=require("path");var dir=path.dirname(__dirname);tap.test("reader test",function(c){var b=-1;var e=false;var f=false;var d=fstream.Reader({path:dir,filter:function(){return this.parent===d||this===d}});d.on("ready",function(){e=true;b=fs.readdirSync(dir).length;console.error("Setting expected children to "+b);c.equal(d.type,"Directory","should be a directory")});d.on("entry",function(g){b--;if(!e){c.fail("children before ready!")}c.equal(g.dirname,d.path,"basename is parent dir")});d.on("error",function(g){c.fail(g);c.end();process.exit(1)});d.on("end",function(){c.equal(b,0,"should have seen all children");f=true});var a=false;d.on("close",function(){c.ok(f,"saw end before close");c.notOk(a,"close should only happen once");a=true;c.end()})});tap.test("reader error test",function(a){var b=fstream.Reader({path:"/etc/shadow"});b.once("error",function(c){a.ok(true);a.end()});b.on("end",function(){a.fail("reader ended without error");a.end()})});