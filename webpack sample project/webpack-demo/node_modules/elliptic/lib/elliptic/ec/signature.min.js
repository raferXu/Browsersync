"use strict";var BN=require("bn.js");var elliptic=require("../../elliptic");var utils=elliptic.utils;var assert=utils.assert;function Signature(b,a){if(b instanceof Signature){return b}if(this._importDER(b,a)){return}assert(b.r&&b.s,"Signature without r or s");this.r=new BN(b.r,16);this.s=new BN(b.s,16);if(b.recoveryParam===undefined){this.recoveryParam=null}else{this.recoveryParam=b.recoveryParam}}module.exports=Signature;function Position(){this.place=0}function getLength(b,e){var a=b[e.place++];if(!(a&128)){return a}var d=a&15;var g=0;for(var c=0,f=e.place;c<d;c++,f++){g<<=8;g|=b[f]}e.place=f;return g}function rmPadding(b){var c=0;var a=b.length-1;while(!b[c]&&!(b[c+1]&128)&&c<a){c++}if(c===0){return b}return b.slice(c)}Signature.prototype._importDER=function _importDER(f,b){f=utils.toArray(f,b);var g=new Position();if(f[g.place++]!==48){return false}var a=getLength(f,g);if((a+g.place)!==f.length){return false}if(f[g.place++]!==2){return false}var h=getLength(f,g);var d=f.slice(g.place,h+g.place);g.place+=h;if(f[g.place++]!==2){return false}var e=getLength(f,g);if(f.length!==e+g.place){return false}var c=f.slice(g.place,e+g.place);if(d[0]===0&&(d[1]&128)){d=d.slice(1)}if(c[0]===0&&(c[1]&128)){c=c.slice(1)}this.r=new BN(d);this.s=new BN(c);this.recoveryParam=null;return true};function constructLength(b,a){if(a<128){b.push(a);return}var c=1+(Math.log(a)/Math.LN2>>>3);b.push(c|128);while(--c){b.push((a>>>(c<<3))&255)}b.push(a)}Signature.prototype.toDER=function toDER(b){var f=this.r.toArray();var e=this.s.toArray();if(f[0]&128){f=[0].concat(f)}if(e[0]&128){e=[0].concat(e)}f=rmPadding(f);e=rmPadding(e);while(!e[0]&&!(e[1]&128)){e=e.slice(1)}var a=[2];constructLength(a,f.length);a=a.concat(f);a.push(2);constructLength(a,e.length);var d=a.concat(e);var c=[48];constructLength(c,d.length);c=c.concat(d);return utils.encode(c,b)};