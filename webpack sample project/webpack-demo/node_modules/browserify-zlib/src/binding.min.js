var msg=require("pako/lib/zlib/messages");var zstream=require("pako/lib/zlib/zstream");var zlib_deflate=require("pako/lib/zlib/deflate.js");var zlib_inflate=require("pako/lib/zlib/inflate.js");var constants=require("pako/lib/zlib/constants");for(var key in constants){exports[key]=constants[key]}exports.NONE=0;exports.DEFLATE=1;exports.INFLATE=2;exports.GZIP=3;exports.GUNZIP=4;exports.DEFLATERAW=5;exports.INFLATERAW=6;exports.UNZIP=7;function Zlib(a){if(a<exports.DEFLATE||a>exports.UNZIP){throw new TypeError("Bad argument")}this.mode=a;this.init_done=false;this.write_in_progress=false;this.pending_close=false;this.windowBits=0;this.level=0;this.memLevel=0;this.strategy=0;this.dictionary=null}Zlib.prototype.init=function(b,f,e,c,d){this.windowBits=b;this.level=f;this.memLevel=e;this.strategy=c;if(this.mode===exports.GZIP||this.mode===exports.GUNZIP){this.windowBits+=16}if(this.mode===exports.UNZIP){this.windowBits+=32}if(this.mode===exports.DEFLATERAW||this.mode===exports.INFLATERAW){this.windowBits=-this.windowBits}this.strm=new zstream();switch(this.mode){case exports.DEFLATE:case exports.GZIP:case exports.DEFLATERAW:var a=zlib_deflate.deflateInit2(this.strm,this.level,exports.Z_DEFLATED,this.windowBits,this.memLevel,this.strategy);break;case exports.INFLATE:case exports.GUNZIP:case exports.INFLATERAW:case exports.UNZIP:var a=zlib_inflate.inflateInit2(this.strm,this.windowBits);break;default:throw new Error("Unknown mode "+this.mode)}if(a!==exports.Z_OK){this._error(a);return}this.write_in_progress=false;this.init_done=true};Zlib.prototype.params=function(){throw new Error("deflateParams Not supported")};Zlib.prototype._writeCheck=function(){if(!this.init_done){throw new Error("write before init")}if(this.mode===exports.NONE){throw new Error("already finalized")}if(this.write_in_progress){throw new Error("write already in progress")}if(this.pending_close){throw new Error("close is pending")}};Zlib.prototype.write=function(a,c,g,h,e,d,f){this._writeCheck();this.write_in_progress=true;var b=this;process.nextTick(function(){b.write_in_progress=false;var i=b._write(a,c,g,h,e,d,f);b.callback(i[0],i[1]);if(b.pending_close){b.close()}});return this};function bufferSet(b,c){for(var a=0;a<b.length;a++){this[c+a]=b[a]}}Zlib.prototype.writeSync=function(a,b,f,g,d,c,e){this._writeCheck();return this._write(a,b,f,g,d,c,e)};Zlib.prototype._write=function(i,f,a,d,c,e,g){this.write_in_progress=true;if(i!==exports.Z_NO_FLUSH&&i!==exports.Z_PARTIAL_FLUSH&&i!==exports.Z_SYNC_FLUSH&&i!==exports.Z_FULL_FLUSH&&i!==exports.Z_FINISH&&i!==exports.Z_BLOCK){throw new Error("Invalid flush value")}if(f==null){f=new Buffer(0);d=0;a=0}if(c._set){c.set=c._set}else{c.set=bufferSet}var h=this.strm;h.avail_in=d;h.input=f;h.next_in=a;h.avail_out=g;h.output=c;h.next_out=e;switch(this.mode){case exports.DEFLATE:case exports.GZIP:case exports.DEFLATERAW:var b=zlib_deflate.deflate(h,i);break;case exports.UNZIP:case exports.INFLATE:case exports.GUNZIP:case exports.INFLATERAW:var b=zlib_inflate.inflate(h,i);break;default:throw new Error("Unknown mode "+this.mode)}if(b!==exports.Z_STREAM_END&&b!==exports.Z_OK){this._error(b)}this.write_in_progress=false;return[h.avail_in,h.avail_out]};Zlib.prototype.close=function(){if(this.write_in_progress){this.pending_close=true;return}this.pending_close=false;if(this.mode===exports.DEFLATE||this.mode===exports.GZIP||this.mode===exports.DEFLATERAW){zlib_deflate.deflateEnd(this.strm)}else{zlib_inflate.inflateEnd(this.strm)}this.mode=exports.NONE};Zlib.prototype.reset=function(){switch(this.mode){case exports.DEFLATE:case exports.DEFLATERAW:var a=zlib_deflate.deflateReset(this.strm);break;case exports.INFLATE:case exports.INFLATERAW:var a=zlib_inflate.inflateReset(this.strm);break}if(a!==exports.Z_OK){this._error(a)}};Zlib.prototype._error=function(a){this.onerror(msg[a]+": "+this.strm.msg,a);this.write_in_progress=false;if(this.pending_close){this.close()}};exports.Zlib=Zlib;