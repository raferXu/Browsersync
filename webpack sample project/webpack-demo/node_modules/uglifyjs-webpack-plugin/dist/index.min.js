"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol==="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};var _createClass=function(){function a(e,c){for(var b=0;b<c.length;b++){var d=c[b];d.enumerable=d.enumerable||false;d.configurable=true;if("value" in d){d.writable=true}Object.defineProperty(e,d.key,d)}}return function(d,b,c){if(b){a(d.prototype,b)}if(c){a(d,c)}return d}}();function _classCallCheck(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}var SourceMapConsumer=require("source-map").SourceMapConsumer;var SourceMapSource=require("webpack-sources").SourceMapSource;var RawSource=require("webpack-sources").RawSource;var ConcatSource=require("webpack-sources").ConcatSource;var RequestShortener=require("webpack/lib/RequestShortener");var ModuleFilenameHelpers=require("webpack/lib/ModuleFilenameHelpers");var uglify=require("uglify-js");var UglifyJsPlugin=function(){function a(c){_classCallCheck(this,a);if((typeof c==="undefined"?"undefined":_typeof(c))!=="object"||Array.isArray(c)){c={}}if(typeof c.compressor!=="undefined"){c.compress=c.compressor}this.options=c}_createClass(a,[{key:"apply",value:function b(e){var c=this.options;c.test=c.test||/\.js($|\?)/i;var d=c.warningsFilter||function(){return true};var f=new RequestShortener(e.context);e.plugin("compilation",function(g){if(c.sourceMap){g.plugin("build-module",function(h){h.useSourceMap=true})}g.plugin("optimize-chunk-assets",function(k,j){var i=[];k.forEach(function(l){return i.push.apply(i,l.files)});i.push.apply(i,g.additionalChunkAssets);var h=i.filter(ModuleFilenameHelpers.matchObject.bind(undefined,c));h.forEach(function(E){var x=uglify.AST_Node.warn_function;var l=[];var w=void 0;try{var v=g.assets[E];if(v.__UglifyJsPlugin){g.assets[E]=v.__UglifyJsPlugin;return}var t=void 0;var F=void 0;if(c.sourceMap){if(v.sourceAndMap){var r=v.sourceAndMap();F=r.map;t=r.source}else{F=v.map();t=v.source()}w=new SourceMapConsumer(F);uglify.AST_Node.warn_function=function(M){var J=/\[.+:([0-9]+),([0-9]+)\]/.exec(M);var I=+J[1];var L=+J[2];var K=w.originalPositionFor({line:I,column:L});if(!K||!K.source||K.source===E){return}if(!d(K.source)){return}l.push(M.replace(/\[.+:([0-9]+),([0-9]+)\]/,"")+"["+f.shorten(K.source)+":"+K.line+","+K.column+"]")}}else{t=v.source();uglify.AST_Node.warn_function=function(I){l.push(I)}}uglify.base54.reset();var p=uglify.parse(t,{filename:E});if(c.compress!==false){p.figure_out_scope();var D=uglify.Compressor(c.compress||{warnings:false});p=D.compress(p)}if(c.mangle!==false){p.figure_out_scope(c.mangle||{});p.compute_char_frequency(c.mangle||{});p.mangle_names(c.mangle||{});if(c.mangle&&c.mangle.props){uglify.mangle_properties(p,c.mangle.props)}}var s={};s.comments=Object.prototype.hasOwnProperty.call(c,"comments")?c.comments:/^\**!|@preserve|@license/;s.beautify=c.beautify;for(var A in c.output){s[A]=c.output[A]}var m=[];if(c.extractComments){var B={};if(typeof c.extractComments==="string"||c.extractComments instanceof RegExp){B.preserve=s.comments;B.extract=c.extractComments}else{if(Object.prototype.hasOwnProperty.call(c.extractComments,"condition")){B.preserve=s.comments;B.extract=c.extractComments.condition}else{B.preserve=false;B.extract=s.comments}}["preserve","extract"].forEach(function(J){switch(_typeof(B[J])){case"boolean":var I=B[J];B[J]=function(){return I};break;case"function":break;case"string":if(B[J]==="all"){B[J]=function(){return true};break}var K=new RegExp(B[J]);B[J]=function(L,M){return K.test(M.value)};break;default:K=B[J];B[J]=function(L,M){return K.test(M.value)}}});s.comments=function(I,J){if(B.extract(I,J)){m.push(J.type==="comment2"?"/*"+J.value+"*/":"//"+J.value)}return B.preserve(I,J)}}var G=void 0;if(c.sourceMap){G=uglify.SourceMap({file:E,root:""});s.source_map=G}var o=uglify.OutputStream(s);p.print(o);if(G){G=G+""}var y=o+"";var C=G?new SourceMapSource(y,E,JSON.parse(G),t,F):new RawSource(y);if(m.length>0){var u=c.extractComments.filename||E+".LICENSE";if(typeof u==="function"){u=u(E)}var q=new RawSource(m.join("\n\n")+"\n");if(u in g.assets){if(g.assets[u] instanceof ConcatSource){g.assets[u].add("\n");g.assets[u].add(q)}else{g.assets[u]=new ConcatSource(g.assets[u],"\n",q)}}else{g.assets[u]=q}if(c.extractComments.banner!==false){var H=c.extractComments.banner||"For license information please see "+u;if(typeof H==="function"){H=H(u)}if(H){C=new ConcatSource("/*! "+H+" */\n",C)}}}v.__UglifyJsPlugin=g.assets[E]=C;if(l.length>0){g.warnings.push(new Error(E+" from UglifyJs\n"+l.join("\n")))}}catch(n){if(n.line){var z=w&&w.originalPositionFor({line:n.line,column:n.col});if(z&&z.source){g.errors.push(new Error(E+" from UglifyJs\n"+n.message+" ["+f.shorten(z.source)+":"+z.line+","+z.column+"]["+E+":"+n.line+","+n.col+"]"))}else{g.errors.push(new Error(E+" from UglifyJs\n"+n.message+" ["+E+":"+n.line+","+n.col+"]"))}}else{if(n.msg){g.errors.push(new Error(E+" from UglifyJs\n"+n.msg))}else{g.errors.push(new Error(E+" from UglifyJs\n"+n.stack))}}}finally{uglify.AST_Node.warn_function=x}});j()})})}}]);return a}();module.exports=UglifyJsPlugin;