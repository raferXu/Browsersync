"use strict";var clear=require("es5-ext/array/#/clear"),assign=require("es5-ext/object/assign"),callable=require("es5-ext/object/valid-callable"),value=require("es5-ext/object/valid-value"),d=require("d"),autoBind=require("d/auto-bind"),Symbol=require("es6-symbol"),defineProperty=Object.defineProperty,defineProperties=Object.defineProperties,Iterator;module.exports=Iterator=function(b,a){if(!(this instanceof Iterator)){return new Iterator(b,a)}defineProperties(this,{__list__:d("w",value(b)),__context__:d("w",a),__nextIndex__:d("w",0)});if(!a){return}callable(a.on);a.on("_add",this._onAdd);a.on("_delete",this._onDelete);a.on("_clear",this._onClear)};defineProperties(Iterator.prototype,assign({constructor:d(Iterator),_next:d(function(){var a;if(!this.__list__){return}if(this.__redo__){a=this.__redo__.shift();if(a!==undefined){return a}}if(this.__nextIndex__<this.__list__.length){return this.__nextIndex__++}this._unBind()}),next:d(function(){return this._createResult(this._next())}),_createResult:d(function(a){if(a===undefined){return{done:true,value:undefined}}return{done:false,value:this._resolve(a)}}),_resolve:d(function(a){return this.__list__[a]}),_unBind:d(function(){this.__list__=null;delete this.__redo__;if(!this.__context__){return}this.__context__.off("_add",this._onAdd);this.__context__.off("_delete",this._onDelete);this.__context__.off("_clear",this._onClear);this.__context__=null}),toString:d(function(){return"[object Iterator]"})},autoBind({_onAdd:d(function(a){if(a>=this.__nextIndex__){return}++this.__nextIndex__;if(!this.__redo__){defineProperty(this,"__redo__",d("c",[a]));return}this.__redo__.forEach(function(b,c){if(b>=a){this.__redo__[c]=++b}},this);this.__redo__.push(a)}),_onDelete:d(function(a){var b;if(a>=this.__nextIndex__){return}--this.__nextIndex__;if(!this.__redo__){return}b=this.__redo__.indexOf(a);if(b!==-1){this.__redo__.splice(b,1)}this.__redo__.forEach(function(c,e){if(c>a){this.__redo__[e]=--c}},this)}),_onClear:d(function(){if(this.__redo__){clear.call(this.__redo__)}this.__nextIndex__=0})})));defineProperty(Iterator.prototype,Symbol.iterator,d(function(){return this}));defineProperty(Iterator.prototype,Symbol.toStringTag,d("","Iterator"));