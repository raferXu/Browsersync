"use strict";var url=require("url");var gitHosts=require("./git-host-info.js");var GitHost=module.exports=require("./git-host.js");var protocolToRepresentationMap={"git+ssh":"sshurl","git+https":"https",ssh:"sshurl",git:"git"};function protocolToRepresentation(a){if(a.substr(-1)===":"){a=a.slice(0,-1)}return protocolToRepresentationMap[a]||a}var authProtocols={"git:":true,"https:":true,"git+https:":true,"http:":true,"git+http:":true};var cache={};module.exports.fromUrl=function(c,b){var a=c+JSON.stringify(b||{});if(!(a in cache)){cache[a]=fromUrl(c,b)}return cache[a]};function fromUrl(f,d){if(f==null||f===""){return}var c=fixupUnqualifiedGist(isGitHubShorthand(f)?"github:"+f:f);var b=parseGitUrl(c);var a=c.match(new RegExp("^([^:]+):(?:(?:[^@:]+(?:[^@]+)?@)?([^/]*))[/](.+?)(?:[.]git)?($|#)"));var e=Object.keys(gitHosts).map(function(j){try{var l=gitHosts[j];var h=null;if(b.auth&&authProtocols[b.protocol]){h=decodeURIComponent(b.auth)}var m=b.hash?decodeURIComponent(b.hash.substr(1)):null;var k=null;var p=null;var o=null;if(a&&a[1]===j){k=a[2]&&decodeURIComponent(a[2]);p=decodeURIComponent(a[3]);o="shortcut"}else{if(b.host!==l.domain){return}if(!l.protocols_re.test(b.protocol)){return}if(!b.path){return}var i=l.pathmatch;var g=b.path.match(i);if(!g){return}if(g[1]!=null){k=decodeURIComponent(g[1].replace(/^:/,""))}if(g[2]!=null){p=decodeURIComponent(g[2])}o=protocolToRepresentation(b.protocol)}return new GitHost(j,k,h,p,m,o,d)}catch(n){if(!(n instanceof URIError)){throw n}}}).filter(function(g){return g});if(e.length!==1){return}return e[0]}function isGitHubShorthand(a){return/^[^:@%/\s.-][^:@%/\s]*[/][^:@\s/%]+(?:#.*)?$/.test(a)}function fixupUnqualifiedGist(b){var a=url.parse(b);if(a.protocol==="gist:"&&a.host&&!a.path){return a.protocol+"/"+a.host}else{return b}}function parseGitUrl(b){if(typeof b!=="string"){b=""+b}var a=b.match(/^([^@]+)@([^:/]+):[/]?((?:[^/]+[/])?[^/]+?)(?:[.]git)?(#.*)?$/);if(!a){return url.parse(b)}return{protocol:"git+ssh:",slashes:true,auth:a[1],host:a[2],port:null,hostname:a[2],hash:a[4],search:null,query:null,pathname:"/"+a[3],path:"/"+a[3],href:"git+ssh://"+a[1]+"@"+a[2]+"/"+a[3]+(a[4]||"")}};