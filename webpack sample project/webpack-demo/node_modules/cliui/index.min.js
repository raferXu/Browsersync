var wrap=require("wordwrap"),align={right:require("right-align"),center:require("center-align")},top=0,right=1,bottom=2,left=3;function UI(a){this.width=a.width;this.wrap=a.wrap;this.rows=[]}UI.prototype.span=function(){var a=this.div.apply(this,arguments);a.span=true};UI.prototype.div=function(){if(arguments.length===0){this.div("")}if(this.wrap&&this._shouldApplyLayoutDSL.apply(this,arguments)){return this._applyLayoutDSL(arguments[0])}var c=[];for(var b=0,a;(a=arguments[b])!==undefined;b++){if(typeof a==="string"){c.push(this._colFromString(a))}else{c.push(a)}}this.rows.push(c);return c};UI.prototype._shouldApplyLayoutDSL=function(){return arguments.length===1&&typeof arguments[0]==="string"&&/[\t\n]/.test(arguments[0])};UI.prototype._applyLayoutDSL=function(c){var d=this,b=c.split("\n"),a=0;b.forEach(function(f){var e=f.split("\t");if(e.length>1&&e[0].length>a){a=Math.min(Math.floor(d.width*0.5),e[0].length)}});b.forEach(function(f){var e=f.split("\t");d.div.apply(d,e.map(function(h,g){return{text:h.trim(),padding:[0,h.match(/\s*$/)[0].length,0,h.match(/^\s*/)[0].length],width:(g===0&&e.length>1)?a:undefined}}))});return this.rows[this.rows.length-1]};UI.prototype._colFromString=function(a){return{text:a}};UI.prototype.toString=function(){var b=this,a=[];b.rows.forEach(function(d,c){b.rowToString(d,a)});a=a.filter(function(c){return !c.hidden});return a.map(function(c){return c.text}).join("\n")};UI.prototype.rowToString=function(h,i){var d=this,c,a=this._rasterize(h),f="",e,b,g;a.forEach(function(k,j){f="";k.forEach(function(l,n){e="";b=h[n].width;g=d._negatePadding(h[n]);for(var m=0;m<Math.max(g,l.length);m++){e+=l.charAt(m)||" "}if(h[n].align&&h[n].align!=="left"&&d.wrap){e=align[h[n].align](e.trim()+"\n"+new Array(g+1).join(" ")).split("\n")[0];if(e.length<g){e+=new Array(b-e.length).join(" ")}}c=(h[n].padding||[0,0,0,0])[left];if(c){f+=new Array(h[n].padding[left]+1).join(" ")}f+=e;if(h[n].padding&&h[n].padding[right]){f+=new Array(h[n].padding[right]+1).join(" ")}if(j===0&&i.length>0){f=d._renderInline(f,i[i.length-1],c)}});i.push({text:f.replace(/ +$/,""),span:h.span})});return i};UI.prototype._renderInline=function(e,d,b){var f=d.text,h="";if(!d.span){return e}if(!this.wrap){d.hidden=true;return f+e}for(var c=0,a,g;c<Math.max(e.length,f.length);c++){a=f.charAt(c)||" ";g=e.charAt(c)||" ";if(a!==" "&&g!==" "){return e}if(g!==" "&&c<b+f.length){return e}if(a===" "){h+=g}else{h+=a}}d.hidden=true;return h};UI.prototype._rasterize=function(f){var g=this,b,d,e=[],c=this._columnWidths(f),a;f.forEach(function(h,i){h.width=c[i];if(g.wrap){a=wrap.hard(g._negatePadding(h))(h.text).split("\n")}else{a=h.text.split("\n")}if(h.padding){for(b=0;b<(h.padding[top]||0);b++){a.unshift("")}for(b=0;b<(h.padding[bottom]||0);b++){a.push("")}}a.forEach(function(l,k){if(!e[k]){e.push([])}d=e[k];for(var j=0;j<i;j++){if(d[j]===undefined){d.push("")}}d.push(l)})});return e};UI.prototype._negatePadding=function(a){var b=a.width;if(a.padding){b-=(a.padding[left]||0)+(a.padding[right]||0)}return b};UI.prototype._columnWidths=function(e){var f=this,c=[],d=e.length,b,a=this.width;e.forEach(function(g,h){if(g.width){d--;c[h]=g.width;a-=g.width}else{c[h]=undefined}});if(d){b=Math.floor(a/d)}c.forEach(function(g,h){if(!f.wrap){c[h]=e[h].width||e[h].text.length}else{if(g===undefined){c[h]=Math.max(b,_minWidth(e[h]))}}});return c};function _minWidth(a){var b=a.padding||[];return 1+(b[left]||0)+(b[right]||0)}module.exports=function(a){a=a||{};return new UI({width:(a||{}).width||80,wrap:typeof a.wrap==="boolean"?a.wrap:true})};