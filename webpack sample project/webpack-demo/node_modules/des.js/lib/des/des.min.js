"use strict";var assert=require("minimalistic-assert");var inherits=require("inherits");var des=require("../des");var utils=des.utils;var Cipher=des.Cipher;function DESState(){this.tmp=new Array(2);this.keys=null}function DES(a){Cipher.call(this,a);var b=new DESState();this._desState=b;this.deriveKeys(b,a.key)}inherits(DES,Cipher);module.exports=DES;DES.create=function create(a){return new DES(a)};var shiftTable=[1,1,2,2,2,2,2,2,1,2,2,2,2,2,2,1];DES.prototype.deriveKeys=function deriveKeys(e,c){e.keys=new Array(16*2);assert.equal(c.length,this.blockSize,"Invalid key length");var d=utils.readUInt32BE(c,0);var f=utils.readUInt32BE(c,4);utils.pc1(d,f,e.tmp,0);d=e.tmp[0];f=e.tmp[1];for(var b=0;b<e.keys.length;b+=2){var a=shiftTable[b>>>1];d=utils.r28shl(d,a);f=utils.r28shl(f,a);utils.pc2(d,f,e.keys,b)}};DES.prototype._update=function _update(d,g,b,f){var e=this._desState;var a=utils.readUInt32BE(d,g);var c=utils.readUInt32BE(d,g+4);utils.ip(a,c,e.tmp,0);a=e.tmp[0];c=e.tmp[1];if(this.type==="encrypt"){this._encrypt(e,a,c,e.tmp,0)}else{this._decrypt(e,a,c,e.tmp,0)}a=e.tmp[0];c=e.tmp[1];utils.writeUInt32BE(b,a,f);utils.writeUInt32BE(b,c,f+4)};DES.prototype._pad=function _pad(a,d){var c=a.length-d;for(var b=d;b<a.length;b++){a[b]=c}return true};DES.prototype._unpad=function _unpad(a){var c=a[a.length-1];for(var b=a.length-c;b<a.length;b++){assert.equal(a[b],c)}return a.slice(0,a.length-c)};DES.prototype._encrypt=function _encrypt(c,a,n,h,d){var e=a;var b=n;for(var j=0;j<c.keys.length;j+=2){var m=c.keys[j];var g=c.keys[j+1];utils.expand(b,c.tmp,0);m^=c.tmp[0];g^=c.tmp[1];var p=utils.substitute(m,g);var k=utils.permute(p);var o=b;b=(e^k)>>>0;e=o}utils.rip(b,e,h,d)};DES.prototype._decrypt=function _decrypt(c,a,n,h,d){var e=n;var b=a;for(var j=c.keys.length-2;j>=0;j-=2){var m=c.keys[j];var g=c.keys[j+1];utils.expand(e,c.tmp,0);m^=c.tmp[0];g^=c.tmp[1];var p=utils.substitute(m,g);var k=utils.permute(p);var o=e;e=(b^k)>>>0;b=o}utils.rip(e,b,h,d)};