var Buffer=require("safe-buffer").Buffer;function asUInt32Array(c){if(!Buffer.isBuffer(c)){c=Buffer.from(c)}var a=(c.length/4)|0;var b=new Array(a);for(var d=0;d<a;d++){b[d]=c.readUInt32BE(d*4)}return b}function scrubVec(a){for(var b=0;b<a.length;a++){a[b]=0}}function cryptBlock(e,r,g,q,k){var p=g[0];var n=g[1];var m=g[2];var l=g[3];var d=e[0]^r[0];var c=e[1]^r[1];var b=e[2]^r[2];var a=e[3]^r[3];var j,i,h,f;var o=4;for(var s=1;s<k;s++){j=p[d>>>24]^n[(c>>>16)&255]^m[(b>>>8)&255]^l[a&255]^r[o++];i=p[c>>>24]^n[(b>>>16)&255]^m[(a>>>8)&255]^l[d&255]^r[o++];h=p[b>>>24]^n[(a>>>16)&255]^m[(d>>>8)&255]^l[c&255]^r[o++];f=p[a>>>24]^n[(d>>>16)&255]^m[(c>>>8)&255]^l[b&255]^r[o++];d=j;c=i;b=h;a=f}j=((q[d>>>24]<<24)|(q[(c>>>16)&255]<<16)|(q[(b>>>8)&255]<<8)|q[a&255])^r[o++];i=((q[c>>>24]<<24)|(q[(b>>>16)&255]<<16)|(q[(a>>>8)&255]<<8)|q[d&255])^r[o++];h=((q[b>>>24]<<24)|(q[(a>>>16)&255]<<16)|(q[(d>>>8)&255]<<8)|q[c&255])^r[o++];f=((q[a>>>24]<<24)|(q[(d>>>16)&255]<<16)|(q[(c>>>8)&255]<<8)|q[b&255])^r[o++];j=j>>>0;i=i>>>0;h=h>>>0;f=f>>>0;return[j,i,h,f]}var RCON=[0,1,2,4,8,16,32,64,128,27,54];var G=(function(){var h=new Array(256);for(var f=0;f<256;f++){if(f<128){h[f]=f<<1}else{h[f]=(f<<1)^283}}var e=[];var k=[];var c=[[],[],[],[]];var a=[[],[],[],[]];var n=0;var l=0;for(var g=0;g<256;++g){var m=l^(l<<1)^(l<<2)^(l<<3)^(l<<4);m=(m>>>8)^(m&255)^99;e[n]=m;k[m]=n;var b=h[n];var q=h[b];var o=h[q];var p=(h[m]*257)^(m*16843008);c[0][n]=(p<<24)|(p>>>8);c[1][n]=(p<<16)|(p>>>16);c[2][n]=(p<<8)|(p>>>24);c[3][n]=p;p=(o*16843009)^(q*65537)^(b*257)^(n*16843008);a[0][m]=(p<<24)|(p>>>8);a[1][m]=(p<<16)|(p>>>16);a[2][m]=(p<<8)|(p>>>24);a[3][m]=p;if(n===0){n=l=1}else{n=b^h[h[h[o^b]]];l^=h[h[l]]}}return{SBOX:e,INV_SBOX:k,SUB_MIX:c,INV_SUB_MIX:a}})();function AES(a){this._key=asUInt32Array(a);this._reset()}AES.blockSize=4*4;AES.keySize=256/8;AES.prototype.blockSize=AES.blockSize;AES.prototype.keySize=AES.keySize;AES.prototype._reset=function(){var b=this._key;var j=b.length;var h=j+6;var a=(h+1)*4;var c=[];for(var d=0;d<j;d++){c[d]=b[d]}for(d=j;d<a;d++){var l=c[d-1];if(d%j===0){l=(l<<8)|(l>>>24);l=(G.SBOX[l>>>24]<<24)|(G.SBOX[(l>>>16)&255]<<16)|(G.SBOX[(l>>>8)&255]<<8)|(G.SBOX[l&255]);l^=RCON[(d/j)|0]<<24}else{if(j>6&&d%j===4){l=(G.SBOX[l>>>24]<<24)|(G.SBOX[(l>>>16)&255]<<16)|(G.SBOX[(l>>>8)&255]<<8)|(G.SBOX[l&255])}}c[d]=c[d-j]^l}var e=[];for(var i=0;i<a;i++){var g=a-i;var f=c[g-(i%4?0:4)];if(i<4||g<=4){e[i]=f}else{e[i]=G.INV_SUB_MIX[0][G.SBOX[f>>>24]]^G.INV_SUB_MIX[1][G.SBOX[(f>>>16)&255]]^G.INV_SUB_MIX[2][G.SBOX[(f>>>8)&255]]^G.INV_SUB_MIX[3][G.SBOX[f&255]]}}this._nRounds=h;this._keySchedule=c;this._invKeySchedule=e};AES.prototype.encryptBlockRaw=function(a){a=asUInt32Array(a);return cryptBlock(a,this._keySchedule,G.SUB_MIX,G.SBOX,this._nRounds)};AES.prototype.encryptBlock=function(c){var b=this.encryptBlockRaw(c);var a=Buffer.allocUnsafe(16);a.writeUInt32BE(b[0],0);a.writeUInt32BE(b[1],4);a.writeUInt32BE(b[2],8);a.writeUInt32BE(b[3],12);return a};AES.prototype.decryptBlock=function(d){d=asUInt32Array(d);var c=d[1];d[1]=d[3];d[3]=c;var b=cryptBlock(d,this._invKeySchedule,G.INV_SUB_MIX,G.INV_SBOX,this._nRounds);var a=Buffer.allocUnsafe(16);a.writeUInt32BE(b[0],0);a.writeUInt32BE(b[3],4);a.writeUInt32BE(b[2],8);a.writeUInt32BE(b[1],12);return a};AES.prototype.scrub=function(){scrubVec(this._keySchedule);scrubVec(this._invKeySchedule);scrubVec(this._key)};module.exports.AES=AES;