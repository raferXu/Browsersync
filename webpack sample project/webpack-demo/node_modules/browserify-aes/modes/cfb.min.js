var Buffer=require("safe-buffer").Buffer;var xor=require("buffer-xor");function encryptStart(b,e,d){var a=e.length;var c=xor(e,b._cache);b._cache=b._cache.slice(a);b._prev=Buffer.concat([b._prev,d?e:c]);return c}exports.encrypt=function(b,e,d){var c=Buffer.allocUnsafe(0);var a;while(e.length){if(b._cache.length===0){b._cache=b._cipher.encryptBlock(b._prev);b._prev=Buffer.allocUnsafe(0)}if(b._cache.length<=e.length){a=b._cache.length;c=Buffer.concat([c,encryptStart(b,e.slice(0,a),d)]);e=e.slice(a)}else{c=Buffer.concat([c,encryptStart(b,e,d)]);break}}return c};