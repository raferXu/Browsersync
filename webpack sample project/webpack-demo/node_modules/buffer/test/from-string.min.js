if(process.env.OBJECT_IMPL){global.TYPED_ARRAY_SUPPORT=false}var B=require("../").Buffer;var test=require("tape");test("detect utf16 surrogate pairs",function(b){var c="\uD83D\uDE38\uD83D\uDCAD\uD83D\uDC4D";var a=new B(c);b.equal(c,a.toString());b.end()});test("detect utf16 surrogate pairs over U+20000 until U+10FFFF",function(b){var c="\uD842\uDFB7\uD93D\uDCAD\uDBFF\uDFFF";var a=new B(c);b.equal(c,a.toString());b.end()});test("replace orphaned utf16 surrogate lead code point",function(b){var c="\uD83D\uDE38\uD83D\uD83D\uDC4D";var a=new B(c);b.deepEqual(a,new B([240,159,152,184,239,191,189,240,159,145,141]));b.end()});test("replace orphaned utf16 surrogate trail code point",function(b){var c="\uD83D\uDE38\uDCAD\uD83D\uDC4D";var a=new B(c);b.deepEqual(a,new B([240,159,152,184,239,191,189,240,159,145,141]));b.end()});test("do not write partial utf16 code units",function(b){var c=new B([0,0,0,0,0]);b.equal(c.length,5);var a=c.write("あいうえお","utf16le");b.equal(a,4);b.deepEqual(c,new B([66,48,68,48,0]));b.end()});test("handle partial utf16 code points when encoding to utf8 the way node does",function(b){var c="\uD83D\uDE38\uD83D\uDC4D";var a=new B(8);a.fill(0);a.write(c);b.deepEqual(a,new B([240,159,152,184,240,159,145,141]));a=new B(7);a.fill(0);a.write(c);b.deepEqual(a,new B([240,159,152,184,0,0,0]));a=new B(6);a.fill(0);a.write(c);b.deepEqual(a,new B([240,159,152,184,0,0]));a=new B(5);a.fill(0);a.write(c);b.deepEqual(a,new B([240,159,152,184,0]));a=new B(4);a.fill(0);a.write(c);b.deepEqual(a,new B([240,159,152,184]));a=new B(3);a.fill(0);a.write(c);b.deepEqual(a,new B([0,0,0]));a=new B(2);a.fill(0);a.write(c);b.deepEqual(a,new B([0,0]));a=new B(1);a.fill(0);a.write(c);b.deepEqual(a,new B([0]));b.end()});test("handle invalid utf16 code points when encoding to utf8 the way node does",function(b){var c="a\uDE38\uD83Db";var a=new B(8);a.fill(0);a.write(c);b.deepEqual(a,new B([97,239,191,189,239,191,189,98]));a=new B(7);a.fill(0);a.write(c);b.deepEqual(a,new B([97,239,191,189,239,191,189]));a=new B(6);a.fill(0);a.write(c);b.deepEqual(a,new B([97,239,191,189,0,0]));a=new B(5);a.fill(0);a.write(c);b.deepEqual(a,new B([97,239,191,189,0]));a=new B(4);a.fill(0);a.write(c);b.deepEqual(a,new B([97,239,191,189]));a=new B(3);a.fill(0);a.write(c);b.deepEqual(a,new B([97,0,0]));a=new B(2);a.fill(0);a.write(c);b.deepEqual(a,new B([97,0]));a=new B(1);a.fill(0);a.write(c);b.deepEqual(a,new B([97]));b.end()});