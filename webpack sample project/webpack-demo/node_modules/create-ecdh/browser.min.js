var elliptic=require("elliptic");var BN=require("bn.js");module.exports=function createECDH(a){return new ECDH(a)};var aliases={secp256k1:{name:"secp256k1",byteLength:32},secp224r1:{name:"p224",byteLength:28},prime256v1:{name:"p256",byteLength:32},prime192v1:{name:"p192",byteLength:24},ed25519:{name:"ed25519",byteLength:32},secp384r1:{name:"p384",byteLength:48},secp521r1:{name:"p521",byteLength:66}};aliases.p224=aliases.secp224r1;aliases.p256=aliases.secp256r1=aliases.prime256v1;aliases.p192=aliases.secp192r1=aliases.prime192v1;aliases.p384=aliases.secp384r1;aliases.p521=aliases.secp521r1;function ECDH(a){this.curveType=aliases[a];if(!this.curveType){this.curveType={name:a}}this.curve=new elliptic.ec(this.curveType.name);this.keys=void 0}ECDH.prototype.generateKeys=function(a,b){this.keys=this.curve.genKeyPair();return this.getPublicKey(a,b)};ECDH.prototype.computeSecret=function(a,d,b){d=d||"utf8";if(!Buffer.isBuffer(a)){a=new Buffer(a,d)}var e=this.curve.keyFromPublic(a).getPublic();var c=e.mul(this.keys.getPrivate()).getX();return formatReturnValue(c,b,this.curveType.byteLength)};ECDH.prototype.getPublicKey=function(a,c){var b=this.keys.getPublic(c==="compressed",true);if(c==="hybrid"){if(b[b.length-1]%2){b[0]=7}else{b[0]=6}}return formatReturnValue(b,a)};ECDH.prototype.getPrivateKey=function(a){return formatReturnValue(this.keys.getPrivate(),a)};ECDH.prototype.setPublicKey=function(b,a){a=a||"utf8";if(!Buffer.isBuffer(b)){b=new Buffer(b,a)}this.keys._importPublic(b);return this};ECDH.prototype.setPrivateKey=function(c,b){b=b||"utf8";if(!Buffer.isBuffer(c)){c=new Buffer(c,b)}var a=new BN(c);a=a.toString(16);this.keys._importPrivate(a);return this};function formatReturnValue(e,c,a){if(!Array.isArray(e)){e=e.toArray()}var d=new Buffer(e);if(a&&d.length<a){var b=new Buffer(a-d.length);b.fill(0);d=Buffer.concat([b,d])}if(!c){return d}else{return d.toString(c)}};