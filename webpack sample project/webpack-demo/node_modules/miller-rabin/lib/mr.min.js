var bn=require("bn.js");var brorand=require("brorand");function MillerRabin(a){this.rand=a||new brorand.Rand()}module.exports=MillerRabin;MillerRabin.create=function create(a){return new MillerRabin(a)};MillerRabin.prototype._rand=function _rand(d){var a=d.bitLength();var c=this.rand.generate(Math.ceil(a/8));c[0]|=3;var b=a&7;if(b!==0){c[c.length-1]>>=7-b}return new bn(c)};MillerRabin.prototype.test=function test(c,g,f){var m=c.bitLength();var e=bn.mont(c);var q=new bn(1).toRed(e);if(!g){g=Math.max(1,(m/48)|0)}var o=c.subn(1);var l=o.subn(1);for(var u=0;!o.testn(u);u++){}var p=c.shrn(u);var h=o.toRed(e);var b=true;for(;g>0;g--){var t=this._rand(l);if(f){f(t)}var r=t.toRed(e).redPow(p);if(r.cmp(q)===0||r.cmp(h)===0){continue}for(var j=1;j<u;j++){r=r.redSqr();if(r.cmp(q)===0){return false}if(r.cmp(h)===0){break}}if(j===u){return false}}return b};MillerRabin.prototype.getDivisor=function getDivisor(b,e){var m=b.bitLength();var c=bn.mont(b);var q=new bn(1).toRed(c);if(!e){e=Math.max(1,(m/48)|0)}var o=b.subn(1);var l=o.subn(1);for(var u=0;!o.testn(u);u++){}var p=b.shrn(u);var f=o.toRed(c);for(;e>0;e--){var t=this._rand(l);var j=b.gcd(t);if(j.cmpn(1)!==0){return j}var r=t.toRed(c).redPow(p);if(r.cmp(q)===0||r.cmp(f)===0){continue}for(var h=1;h<u;h++){r=r.redSqr();if(r.cmp(q)===0){return r.fromRed().subn(1).gcd(b)}if(r.cmp(f)===0){break}}if(h===u){r=r.redSqr();return r.fromRed().subn(1).gcd(b)}}return false};