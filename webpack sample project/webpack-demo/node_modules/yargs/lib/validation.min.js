const objFilter=require("./obj-filter");const specialKeys=["$0","--","_"];module.exports=function(c,e,i){const h=i.__;const g=i.__n;const j={};j.nonOptionCount=function(k){const l=c.getDemandedCommands();const m=k._.length-c.getContext().commands.length;if(l._&&(m<l._.min||m>l._.max)){if(m<l._.min){if(l._.minMsg!==undefined){e.fail(l._.minMsg?l._.minMsg.replace(/\$0/g,m).replace(/\$1/,l._.min):null)}else{e.fail(h("Not enough non-option arguments: got %s, need at least %s",m,l._.min))}}else{if(m>l._.max){if(l._.maxMsg!==undefined){e.fail(l._.maxMsg?l._.maxMsg.replace(/\$0/g,m).replace(/\$1/,l._.max):null)}else{e.fail(h("Too many non-option arguments: got %s, maximum of %s",m,l._.max))}}}}};j.positionalCount=function(l,k){if(k<l){e.fail(h("Not enough non-option arguments: got %s, need at least %s",k,l))}};j.missingArgumentValue=function(k){const n=[true,false,""];const m=c.getOptions();if(m.requiresArg.length>0){const l=[];m.requiresArg.forEach(function(o){const p=k[o];if(~n.indexOf(p)||(Array.isArray(p)&&!p.length)){l.push(o)}});if(l.length>0){e.fail(g("Missing argument value: %s","Missing argument values: %s",l.length,l.join(", ")))}}};j.requiredArguments=function(l){const k=c.getDemandedOptions();var n=null;Object.keys(k).forEach(function(p){if(!l.hasOwnProperty(p)||typeof l[p]==="undefined"){n=n||{};n[p]=k[p]}});if(n){const o=[];Object.keys(n).forEach(function(p){const q=n[p];if(q&&o.indexOf(q)<0){o.push(q)}});const m=o.length?"\n"+o.join("\n"):"";e.fail(g("Missing required argument: %s","Missing required arguments: %s",Object.keys(n).length,Object.keys(n).join(", ")+m))}};j.unknownArguments=function(q,l,s){const r={};const p=e.getDescriptions();const o=c.getDemandedOptions();const n=c.getCommandInstance().getCommands();const k=[];const m=c.getContext();Object.keys(l).forEach(function(t){l[t].forEach(function(u){r[u]=t})});Object.keys(q).forEach(function(t){if(specialKeys.indexOf(t)===-1&&!p.hasOwnProperty(t)&&!o.hasOwnProperty(t)&&!s.hasOwnProperty(t)&&!c._getParseContext().hasOwnProperty(t)&&!r.hasOwnProperty(t)){k.push(t)}});if(n.length>0){q._.slice(m.commands.length).forEach(function(t){if(n.indexOf(t)===-1){k.push(t)}})}if(k.length>0){e.fail(g("Unknown argument: %s","Unknown arguments: %s",k.length,k.join(", ")))}};j.limitedChoices=function(k){const l=c.getOptions();const n={};if(!Object.keys(l.choices).length){return}Object.keys(k).forEach(function(p){if(specialKeys.indexOf(p)===-1&&l.choices.hasOwnProperty(p)){[].concat(k[p]).forEach(function(q){if(l.choices[p].indexOf(q)===-1){n[p]=(n[p]||[]).concat(q)}})}});const m=Object.keys(n);if(!m.length){return}var o=h("Invalid values:");m.forEach(function(p){o+="\n  "+h("Argument: %s, Given: %s, Choices: %s",p,e.stringifiedValues(n[p]),e.stringifiedValues(l.choices[p]))});e.fail(o)};var d=[];j.check=function(l,k){d.push({func:l,global:k})};j.customChecks=function(l,m){for(var n=0,q;(q=d[n])!==undefined;n++){var p=q.func;var k=null;try{k=p(l,m)}catch(o){e.fail(o.message?o.message:o,o);continue}if(!k){e.fail(h("Argument check failed: %s",p.toString()))}else{if(typeof k==="string"||k instanceof Error){e.fail(k.toString(),k)}}}};var f={};j.implies=function(k,l){if(typeof k==="object"){Object.keys(k).forEach(function(m){j.implies(m,k[m])})}else{c.global(k);f[k]=l}};j.getImplied=function(){return f};j.implications=function(k){const l=[];Object.keys(f).forEach(function(o){var n;const p=o;var q=f[o];n=Number(o);o=isNaN(n)?o:n;if(typeof o==="number"){o=k._.length>=o}else{if(o.match(/^--no-.+/)){o=o.match(/^--no-(.+)/)[1];o=!k[o]}else{o=k[o]}}n=Number(q);q=isNaN(n)?q:n;if(typeof q==="number"){q=k._.length>=q}else{if(q.match(/^--no-.+/)){q=q.match(/^--no-(.+)/)[1];q=!k[q]}else{q=k[q]}}if(o&&!q){l.push(p)}});if(l.length){var m=h("Implications failed:")+"\n";l.forEach(function(n){m+=("  "+n+" -> "+f[n])});e.fail(m)}};var b={};j.conflicts=function(k,l){if(typeof k==="object"){Object.keys(k).forEach(function(m){j.conflicts(m,k[m])})}else{c.global(k);b[k]=l}};j.getConflicting=function(){return b};j.conflicting=function(k){var l=Object.getOwnPropertyNames(k);l.forEach(function(m){if(b[m]&&l.indexOf(b[m])!==-1){e.fail(h("Arguments %s and %s are mutually exclusive",m,b[m]))}})};j.recommendCommands=function(l,q){const k=require("./levenshtein");const n=3;q=q.sort(function(u,t){return t.length-u.length});var r=null;var o=Infinity;for(var m=0,s;(s=q[m])!==undefined;m++){var p=k(l,s);if(p<=n&&p<o){o=p;r=s}}if(r){e.fail(h("Did you mean %s?",r))}};j.reset=function(k){f=objFilter(f,function(m,l){return !k[m]});b=objFilter(b,function(m,l){return !k[m]});d=d.filter(function(l){return l.global});return j};var a;j.freeze=function(){a={};a.implied=f;a.checks=d;a.conflicting=b};j.unfreeze=function(){f=a.implied;d=a.checks;b=a.conflicting;a=undefined};return j};