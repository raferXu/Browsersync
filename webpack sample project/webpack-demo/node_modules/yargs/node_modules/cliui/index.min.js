var stringWidth=require("string-width");var stripAnsi=require("strip-ansi");var wrap=require("wrap-ansi");var align={right:alignRight,center:alignCenter};var top=0;var right=1;var bottom=2;var left=3;function UI(a){this.width=a.width;this.wrap=a.wrap;this.rows=[]}UI.prototype.span=function(){var a=this.div.apply(this,arguments);a.span=true};UI.prototype.div=function(){if(arguments.length===0){this.div("")}if(this.wrap&&this._shouldApplyLayoutDSL.apply(this,arguments)){return this._applyLayoutDSL(arguments[0])}var c=[];for(var b=0,a;(a=arguments[b])!==undefined;b++){if(typeof a==="string"){c.push(this._colFromString(a))}else{c.push(a)}}this.rows.push(c);return c};UI.prototype._shouldApplyLayoutDSL=function(){return arguments.length===1&&typeof arguments[0]==="string"&&/[\t\n]/.test(arguments[0])};UI.prototype._applyLayoutDSL=function(c){var d=this;var b=c.split("\n");var a=0;b.forEach(function(f){var e=f.split("\t");if(e.length>1&&stringWidth(e[0])>a){a=Math.min(Math.floor(d.width*0.5),stringWidth(e[0]))}});b.forEach(function(f){var e=f.split("\t");d.div.apply(d,e.map(function(h,g){return{text:h.trim(),padding:d._measurePadding(h),width:(g===0&&e.length>1)?a:undefined}}))});return this.rows[this.rows.length-1]};UI.prototype._colFromString=function(a){return{text:a,padding:this._measurePadding(a)}};UI.prototype._measurePadding=function(b){var a=stripAnsi(b);return[0,a.match(/\s*$/)[0].length,0,a.match(/^\s*/)[0].length]};UI.prototype.toString=function(){var b=this;var a=[];b.rows.forEach(function(d,c){b.rowToString(d,a)});a=a.filter(function(c){return !c.hidden});return a.map(function(c){return c.text}).join("\n")};UI.prototype.rowToString=function(h,i){var c=this;var g;var a=this._rasterize(h);var e="";var d;var b;var f;a.forEach(function(k,j){e="";k.forEach(function(l,n){d="";b=h[n].width;f=c._negatePadding(h[n]);d+=l;for(var m=0;m<f-stringWidth(l);m++){d+=" "}if(h[n].align&&h[n].align!=="left"&&c.wrap){d=align[h[n].align](d,f);if(stringWidth(d)<f){d+=new Array(b-stringWidth(d)).join(" ")}}g=h[n].padding||[0,0,0,0];if(g[left]){e+=new Array(g[left]+1).join(" ")}e+=addBorder(h[n],d,"| ");e+=d;e+=addBorder(h[n],d," |");if(g[right]){e+=new Array(g[right]+1).join(" ")}if(j===0&&i.length>0){e=c._renderInline(e,i[i.length-1])}});i.push({text:e.replace(/ +$/,""),span:h.span})});return i};function addBorder(a,c,b){if(a.border){if(/[.']-+[.']/.test(c)){return""}else{if(c.trim().length){return b}else{return"  "}}}return""}UI.prototype._renderInline=function(c,b){var e=c.match(/^ */)[0].length;var d=b.text;var a=stringWidth(d.trimRight());if(!b.span){return c}if(!this.wrap){b.hidden=true;return d+c}if(e<a){return c}b.hidden=true;return d.trimRight()+new Array(e-a+1).join(" ")+c.trimLeft()};UI.prototype._rasterize=function(f){var g=this;var b;var d;var e=[];var c=this._columnWidths(f);var a;f.forEach(function(h,i){h.width=c[i];if(g.wrap){a=wrap(h.text,g._negatePadding(h),{hard:true}).split("\n")}else{a=h.text.split("\n")}if(h.border){a.unshift("."+new Array(g._negatePadding(h)+3).join("-")+".");a.push("'"+new Array(g._negatePadding(h)+3).join("-")+"'")}if(h.padding){for(b=0;b<(h.padding[top]||0);b++){a.unshift("")}for(b=0;b<(h.padding[bottom]||0);b++){a.push("")}}a.forEach(function(l,k){if(!e[k]){e.push([])}d=e[k];for(var j=0;j<i;j++){if(d[j]===undefined){d.push("")}}d.push(l)})});return e};UI.prototype._negatePadding=function(a){var b=a.width;if(a.padding){b-=(a.padding[left]||0)+(a.padding[right]||0)}if(a.border){b-=4}return b};UI.prototype._columnWidths=function(e){var f=this;var c=[];var d=e.length;var b;var a=this.width;e.forEach(function(g,h){if(g.width){d--;c[h]=g.width;a-=g.width}else{c[h]=undefined}});if(d){b=Math.floor(a/d)}c.forEach(function(g,h){if(!f.wrap){c[h]=e[h].width||stringWidth(e[h].text)}else{if(g===undefined){c[h]=Math.max(b,_minWidth(e[h]))}}});return c};function _minWidth(a){var c=a.padding||[];var b=1+(c[left]||0)+(c[right]||0);if(a.border){b+=4}return b}function alignRight(d,a){d=d.trim();var c="";var b=stringWidth(d);if(b<a){c=new Array(a-b+1).join(" ")}return c+d}function alignCenter(d,a){d=d.trim();var c="";var b=stringWidth(d.trim());if(b<a){c=new Array(parseInt((a-b)/2,10)+1).join(" ")}return c+d}module.exports=function(a){a=a||{};return new UI({width:(a||{}).width||80,wrap:typeof a.wrap==="boolean"?a.wrap:true})};