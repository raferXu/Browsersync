var parseKeys=require("parse-asn1");var mgf=require("./mgf");var xor=require("./xor");var bn=require("bn.js");var crt=require("browserify-rsa");var createHash=require("create-hash");var withPublic=require("./withPublic");module.exports=function privateDecrypt(h,b,d){var f;if(h.padding){f=h.padding}else{if(d){f=1}else{f=4}}var e=parseKeys(h);var a=e.modulus.byteLength();if(b.length>a||new bn(b).cmp(e.modulus)>=0){throw new Error("decryption error")}var g;if(d){g=withPublic(new bn(b),e)}else{g=crt(b,e)}var c=new Buffer(a-g.length);c.fill(0);g=Buffer.concat([c,g],a);if(f===4){return oaep(e,g)}else{if(f===1){return pkcs1(e,g,d)}else{if(f===3){return g}else{throw new Error("unknown padding")}}}};function oaep(o,c){var b=o.modulus;var e=o.modulus.byteLength();var a=c.length;var l=createHash("sha1").update(new Buffer("")).digest();var h=l.length;var m=2*h;if(c[0]!==0){throw new Error("decryption error")}var d=c.slice(1,h+1);var j=c.slice(h+1);var g=xor(d,mgf(j,h));var p=xor(j,mgf(g,e-h-1));if(compare(l,p.slice(0,h))){throw new Error("decryption error")}var f=h;while(p[f]===0){f++}if(p[f++]!==1){throw new Error("decryption error")}return p.slice(f)}function pkcs1(d,h,b){var g=h.slice(0,2);var c=2;var a=0;while(h[c++]!==0){if(c>=h.length){a++;break}}var f=h.slice(2,c-1);var e=h.slice(c-1,c);if((g.toString("hex")!=="0002"&&!b)||(g.toString("hex")!=="0001"&&b)){a++}if(f.length<8){a++}if(a){throw new Error("decryption error")}return h.slice(c)}function compare(e,d){e=new Buffer(e);d=new Buffer(d);var g=0;var c=e.length;if(e.length!==d.length){g++;c=Math.min(e.length,d.length)}var f=-1;while(++f<c){g+=(e[f]^d[f])}return g};