var parseKeys=require("parse-asn1");var randomBytes=require("randombytes");var createHash=require("create-hash");var mgf=require("./mgf");var xor=require("./xor");var bn=require("bn.js");var withPublic=require("./withPublic");var crt=require("browserify-rsa");var constants={RSA_PKCS1_OAEP_PADDING:4,RSA_PKCS1_PADDIN:1,RSA_NO_PADDING:3};module.exports=function publicEncrypt(c,f,a){var d;if(c.padding){d=c.padding}else{if(a){d=1}else{d=4}}var b=parseKeys(c);var e;if(d===4){e=oaep(b,f)}else{if(d===1){e=pkcs1(b,f,a)}else{if(d===3){e=new bn(f);if(e.cmp(b.modulus)>=0){throw new Error("data too long for modulus")}}else{throw new Error("unknown padding")}}}if(a){return crt(e,b)}else{return withPublic(e,b)}};function oaep(m,c){var f=m.modulus.byteLength();var b=c.length;var j=createHash("sha1").update(new Buffer("")).digest();var h=j.length;var l=2*h;if(b>f-l-2){throw new Error("message too long")}var a=new Buffer(f-b-l-2);a.fill(0);var e=f-h-1;var g=randomBytes(h);var i=xor(Buffer.concat([j,a,new Buffer([1]),c],e),mgf(g,e));var d=xor(g,mgf(i,h));return new bn(Buffer.concat([new Buffer([0]),d,i],f))}function pkcs1(c,e,b){var f=e.length;var a=c.modulus.byteLength();if(f>a-11){throw new Error("message too long")}var d;if(b){d=new Buffer(a-f-3);d.fill(255)}else{d=nonZero(a-f-3)}return new bn(Buffer.concat([new Buffer([0,b?1:2]),d,new Buffer([0]),e],a))}function nonZero(a,f){var d=new Buffer(a);var e=0;var b=randomBytes(a*2);var g=0;var c;while(e<a){if(g===b.length){b=randomBytes(a*2);g=0}c=b[g++];if(c){d[e++]=c}}return d};