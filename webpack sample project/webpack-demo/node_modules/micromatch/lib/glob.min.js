"use strict";var chars=require("./chars");var utils=require("./utils");var Glob=module.exports=function Glob(b,a){if(!(this instanceof Glob)){return new Glob(b,a)}this.options=a||{};this.pattern=b;this.history=[];this.tokens={};this.init(b)};Glob.prototype.init=function(a){this.orig=a;this.negated=this.isNegated();this.options.track=this.options.track||false;this.options.makeRe=true};Glob.prototype.track=function(a){if(this.options.track){this.history.push({msg:a,pattern:this.pattern})}};Glob.prototype.isNegated=function(){if(this.pattern.charCodeAt(0)===33){this.pattern=this.pattern.slice(1);return true}return false};Glob.prototype.braces=function(){if(this.options.nobraces!==true&&this.options.nobrace!==true){var d=this.pattern.match(/[\{\(\[]/g);var c=this.pattern.match(/[\}\)\]]/g);if(d&&c&&(d.length!==c.length)){this.options.makeRe=false}var e=utils.braces(this.pattern,this.options);this.pattern=e.join("|")}};Glob.prototype.brackets=function(){if(this.options.nobrackets!==true){this.pattern=utils.brackets(this.pattern)}};Glob.prototype.extglob=function(){if(this.options.noextglob===true){return}if(utils.isExtglob(this.pattern)){this.pattern=utils.extglob(this.pattern,{escape:true})}};Glob.prototype.parse=function(a){this.tokens=utils.parseGlob(a||this.pattern,true);return this.tokens};Glob.prototype._replace=function(d,c,e){this.track('before (find): "'+d+'" (replace with): "'+c+'"');if(e){c=esc(c)}if(d&&c&&typeof d==="string"){this.pattern=this.pattern.split(d).join(c)}else{this.pattern=this.pattern.replace(d,c)}this.track("after")};Glob.prototype.escape=function(b){this.track("before escape: ");var a=/["\\](['"]?[^"'\\]['"]?)/g;this.pattern=b.replace(a,function(d,c){var f=chars.ESC;var e=f&&f[c];if(e){return e}if(/[a-z]/i.test(d)){return d.split("\\").join("")}return d});this.track("after escape: ")};Glob.prototype.unescape=function(b){var a=/__([A-Z]+)_([A-Z]+)__/g;this.pattern=b.replace(a,function(d,c){return chars[c][d]});this.pattern=unesc(this.pattern)};function esc(a){a=a.split("?").join("%~");a=a.split("*").join("%%");return a}function unesc(a){a=a.split("%~").join("?");a=a.split("%%").join("*");return a};