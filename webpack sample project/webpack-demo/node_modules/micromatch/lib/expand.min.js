/*!
 * micromatch <https://github.com/jonschlinkert/micromatch>
 *
 * Copyright (c) 2014-2015, Jon Schlinkert.
 * Licensed under the MIT License.
 */
;"use strict";var utils=require("./utils");var Glob=require("./glob");module.exports=expand;function expand(d,b){if(typeof d!=="string"){throw new TypeError("micromatch.expand(): argument should be a string.")}var e=new Glob(d,b||{});var c=e.options;if(!utils.isGlob(d)){e.pattern=e.pattern.replace(/([\/.])/g,"\\$1");return e}e.pattern=e.pattern.replace(/(\+)(?!\()/g,"\\$1");e.pattern=e.pattern.split("$").join("\\$");if(typeof c.braces!=="boolean"&&typeof c.nobraces!=="boolean"){c.braces=true}if(e.pattern===".*"){return{pattern:"\\."+star,tokens:a,options:c}}if(e.pattern==="*"){return{pattern:oneStar(c.dot),tokens:a,options:c}}e.parse();var a=e.tokens;a.is.negated=c.negated;if((c.dotfiles===true||a.is.dotfile)&&c.dot!==false){c.dotfiles=true;c.dot=true}if((c.dotdirs===true||a.is.dotdir)&&c.dot!==false){c.dotdirs=true;c.dot=true}if(/[{,]\./.test(e.pattern)){c.makeRe=false;c.dot=true}if(c.nonegate!==true){c.negated=e.negated}if(e.pattern.charAt(0)==="."&&e.pattern.charAt(1)!=="/"){e.pattern="\\"+e.pattern}e.track("before braces");if(a.is.braces){e.braces()}e.track("after braces");e.track("before extglob");if(a.is.extglob){e.extglob()}e.track("after extglob");e.track("before brackets");if(a.is.brackets){e.brackets()}e.track("after brackets");e._replace("[!","[^");e._replace("(?","(%~");e._replace(/\[\]/,"\\[\\]");e._replace("/[","/"+(c.dot?dotfiles:nodot)+"[",true);e._replace("/?","/"+(c.dot?dotfiles:nodot)+"[^/]",true);e._replace("/.","/(?=.)\\.",true);e._replace(/^(\w):([\\\/]+?)/gi,"(?=.)$1:$2",true);if(e.pattern.indexOf("[^")!==-1){e.pattern=negateSlash(e.pattern)}if(c.globstar!==false&&e.pattern==="**"){e.pattern=globstar(c.dot)}else{e.pattern=balance(e.pattern,"[","]");e.escape(e.pattern);if(a.is.globstar){e.pattern=collapse(e.pattern,"/**");e.pattern=collapse(e.pattern,"**/");e._replace("/**/","(?:/"+globstar(c.dot)+"/|/)",true);e._replace(/\*{2,}/g,"**");e._replace(/(\w+)\*(?!\/)/g,"$1[^/]*?",true);e._replace(/\*\*\/\*(\w)/g,globstar(c.dot)+"\\/"+(c.dot?dotfiles:nodot)+"[^/]*?$1",true);if(c.dot!==true){e._replace(/\*\*\/(.)/g,"(?:**\\/|)$1")}if(a.path.dirname!==""||/,\*\*|\*\*,/.test(e.orig)){e._replace("**",globstar(c.dot),true)}}e._replace(/\/\*$/,"\\/"+oneStar(c.dot),true);e._replace(/(?!\/)\*$/,star,true);e._replace(/([^\/]+)\*/,"$1"+oneStar(true),true);e._replace("*",oneStar(c.dot),true);e._replace("?.","?\\.",true);e._replace("?:","?:",true);e._replace(/\?+/g,function(g){var f=g.length;if(f===1){return qmark}return qmark+"{"+f+"}"});e._replace(/\.([*\w]+)/g,"\\.$1");e._replace(/\[\^[\\\/]+\]/g,qmark);e._replace(/\/+/g,"\\/");e._replace(/\\{2,}/g,"\\")}e.unescape(e.pattern);e._replace("__UNESC_STAR__","*");e._replace("?.","?\\.");e._replace("[^\\/]",qmark);if(e.pattern.length>1){if(/^[\[?*]/.test(e.pattern)){e.pattern=(c.dot?dotfiles:nodot)+e.pattern}}return e}function collapse(e,c){var b=e.split(c);var a=b[0]==="";var d=b[b.length-1]==="";b=b.filter(Boolean);if(a){b.unshift("")}if(d){b.push("")}return b.join(c)}function negateSlash(a){return a.replace(/\[\^([^\]]*?)\]/g,function(c,b){if(b.indexOf("/")===-1){b="\\/"+b}return"[^"+b+"]"})}function balance(h,d,c){var g=h.split(d);var f=g.join("").length;var e=h.split(c).join("").length;if(f!==e){h=g.join("\\"+d);return h.split(c).join("\\"+c)}return h}var qmark="[^/]";var star=qmark+"*?";var nodot="(?!\\.)(?=.)";var dotfileGlob="(?:\\/|^)\\.{1,2}($|\\/)";var dotfiles="(?!"+dotfileGlob+")(?=.)";var twoStarDot="(?:(?!"+dotfileGlob+").)*?";function oneStar(a){return a?"(?!"+dotfileGlob+")(?=.)"+star:(nodot+star)}function globstar(a){if(a){return twoStarDot}return"(?:(?!(?:\\/|^)\\.).)*?"};