var inherits=require("inherits");function Reporter(a){this._reporterState={obj:null,path:[],options:a||{},errors:[]}}exports.Reporter=Reporter;Reporter.prototype.isError=function isError(a){return a instanceof ReporterError};Reporter.prototype.save=function save(){var a=this._reporterState;return{obj:a.obj,pathLen:a.path.length}};Reporter.prototype.restore=function restore(b){var a=this._reporterState;a.obj=b.obj;a.path=a.path.slice(0,b.pathLen)};Reporter.prototype.enterKey=function enterKey(a){return this._reporterState.path.push(a)};Reporter.prototype.exitKey=function exitKey(a){var b=this._reporterState;b.path=b.path.slice(0,a-1)};Reporter.prototype.leaveKey=function leaveKey(a,b,d){var c=this._reporterState;this.exitKey(a);if(c.obj!==null){c.obj[b]=d}};Reporter.prototype.path=function path(){return this._reporterState.path.join("/")};Reporter.prototype.enterObject=function enterObject(){var b=this._reporterState;var a=b.obj;b.obj={};return a};Reporter.prototype.leaveObject=function leaveObject(b){var c=this._reporterState;var a=c.obj;c.obj=b;return a};Reporter.prototype.error=function error(d){var b;var c=this._reporterState;var a=d instanceof ReporterError;if(a){b=d}else{b=new ReporterError(c.path.map(function(e){return"["+JSON.stringify(e)+"]"}).join(""),d.message||d,d.stack)}if(!c.options.partial){throw b}if(!a){c.errors.push(b)}return b};Reporter.prototype.wrapResult=function wrapResult(a){var b=this._reporterState;if(!b.options.partial){return a}return{result:this.isError(a)?null:a,errors:b.errors}};function ReporterError(a,b){this.path=a;this.rethrow(b)}inherits(ReporterError,Error);ReporterError.prototype.rethrow=function rethrow(b){this.message=b+" at: "+(this.path||"(shallow)");if(Error.captureStackTrace){Error.captureStackTrace(this,ReporterError)}if(!this.stack){try{throw new Error(this.message)}catch(a){this.stack=a.stack}}return this};