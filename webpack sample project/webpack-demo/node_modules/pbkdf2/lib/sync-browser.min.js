var md5=require("create-hash/md5");var rmd160=require("ripemd160");var sha=require("sha.js");var checkParameters=require("./precondition");var defaultEncoding=require("./default-encoding");var Buffer=require("safe-buffer").Buffer;var ZEROS=Buffer.alloc(128);var sizes={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,rmd160:20,ripemd160:20};function Hmac(a,g,j){var d=getDigest(a);var b=(a==="sha512"||a==="sha384")?128:64;if(g.length>b){g=d(g)}else{if(g.length<b){g=Buffer.concat([g,ZEROS],b)}}var h=Buffer.allocUnsafe(b+sizes[a]);var c=Buffer.allocUnsafe(b+sizes[a]);for(var e=0;e<b;e++){h[e]=g[e]^54;c[e]=g[e]^92}var f=Buffer.allocUnsafe(b+j+4);h.copy(f,0,0,b);this.ipad1=f;this.ipad2=h;this.opad=c;this.alg=a;this.blocksize=b;this.hash=d;this.size=sizes[a]}Hmac.prototype.run=function(c,a){c.copy(a,this.blocksize);var b=this.hash(a);b.copy(this.opad,this.blocksize);return this.hash(this.opad)};function getDigest(b){function a(c){return sha(b).update(c).digest()}if(b==="rmd160"||b==="ripemd160"){return rmd160}if(b==="md5"){return md5}return a}function pbkdf2(s,o,c,a,q){if(!Buffer.isBuffer(s)){s=Buffer.from(s,defaultEncoding)}if(!Buffer.isBuffer(o)){o=Buffer.from(o,defaultEncoding)}checkParameters(c,a);q=q||"sha1";var p=new Hmac(q,s,o.length);var b=Buffer.allocUnsafe(a);var t=Buffer.allocUnsafe(o.length+4);o.copy(t,0,0,o.length);var r=0;var n=sizes[q];var e=Math.ceil(a/n);for(var m=1;m<=e;m++){t.writeUInt32BE(m,o.length);var g=p.run(t,p.ipad1);var d=g;for(var h=1;h<c;h++){d=p.run(d,p.ipad2);for(var f=0;f<n;f++){g[f]^=d[f]}}g.copy(b,r);r+=n}return b}module.exports=pbkdf2;