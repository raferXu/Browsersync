"use strict";var resolveCommand=require("./util/resolveCommand");var hasEmptyArgumentBug=require("./util/hasEmptyArgumentBug");var escapeArgument=require("./util/escapeArgument");var escapeCommand=require("./util/escapeCommand");var readShebang=require("./util/readShebang");var isWin=process.platform==="win32";var skipShellRegExp=/\.(?:com|exe)$/i;var supportsShellOption=parseInt(process.version.substr(1).split(".")[0],10)>=6||parseInt(process.version.substr(1).split(".")[0],10)===4&&parseInt(process.version.substr(1).split(".")[1],10)>=8;function parseNonShell(b){var d;var c;var a;if(!isWin){return b}b.file=resolveCommand(b.command);b.file=b.file||resolveCommand(b.command,true);d=b.file&&readShebang(b.file);if(d){b.args.unshift(b.file);b.command=d;c=hasEmptyArgumentBug||!skipShellRegExp.test(resolveCommand(d)||resolveCommand(d,true))}else{c=hasEmptyArgumentBug||!skipShellRegExp.test(b.file)}if(c){a=(b.command!=="echo");b.command=escapeCommand(b.command);b.args=b.args.map(function(e){return escapeArgument(e,a)});b.args=["/d","/s","/c",'"'+b.command+(b.args.length?" "+b.args.join(" "):"")+'"'];b.command=process.env.comspec||"cmd.exe";b.options.windowsVerbatimArguments=true}return b}function parseShell(b){var a;if(supportsShellOption){return b}a=[b.command].concat(b.args).join(" ");if(isWin){b.command=typeof b.options.shell==="string"?b.options.shell:process.env.comspec||"cmd.exe";b.args=["/d","/s","/c",'"'+a+'"'];b.options.windowsVerbatimArguments=true}else{if(typeof b.options.shell==="string"){b.command=b.options.shell}else{if(process.platform==="android"){b.command="/system/bin/sh"}else{b.command="/bin/sh"}}b.args=["-c",a]}return b}function parse(d,c,b){var a;if(c&&!Array.isArray(c)){b=c;c=null}c=c?c.slice(0):[];b=b||{};a={command:d,args:c,options:b,file:undefined,original:d};return b.shell?parseShell(a):parseNonShell(a)}module.exports=parse;