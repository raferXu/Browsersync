"use strict";var zlib_inflate=require("./zlib/inflate");var utils=require("./utils/common");var strings=require("./utils/strings");var c=require("./zlib/constants");var msg=require("./zlib/messages");var ZStream=require("./zlib/zstream");var GZheader=require("./zlib/gzheader");var toString=Object.prototype.toString;function Inflate(b){if(!(this instanceof Inflate)){return new Inflate(b)}this.options=utils.assign({chunkSize:16384,windowBits:0,to:""},b||{});var d=this.options;if(d.raw&&(d.windowBits>=0)&&(d.windowBits<16)){d.windowBits=-d.windowBits;if(d.windowBits===0){d.windowBits=-15}}if((d.windowBits>=0)&&(d.windowBits<16)&&!(b&&b.windowBits)){d.windowBits+=32}if((d.windowBits>15)&&(d.windowBits<48)){if((d.windowBits&15)===0){d.windowBits|=15}}this.err=0;this.msg="";this.ended=false;this.chunks=[];this.strm=new ZStream();this.strm.avail_out=0;var a=zlib_inflate.inflateInit2(this.strm,d.windowBits);if(a!==c.Z_OK){throw new Error(msg[a])}this.header=new GZheader();zlib_inflate.inflateGetHeader(this.strm,this.header)}Inflate.prototype.push=function(h,i){var m=this.strm;var f=this.options.chunkSize;var l=this.options.dictionary;var g,e;var b,j,a;var d;var k=false;if(this.ended){return false}e=(i===~~i)?i:((i===true)?c.Z_FINISH:c.Z_NO_FLUSH);if(typeof h==="string"){m.input=strings.binstring2buf(h)}else{if(toString.call(h)==="[object ArrayBuffer]"){m.input=new Uint8Array(h)}else{m.input=h}}m.next_in=0;m.avail_in=m.input.length;do{if(m.avail_out===0){m.output=new utils.Buf8(f);m.next_out=0;m.avail_out=f}g=zlib_inflate.inflate(m,c.Z_NO_FLUSH);if(g===c.Z_NEED_DICT&&l){if(typeof l==="string"){d=strings.string2buf(l)}else{if(toString.call(l)==="[object ArrayBuffer]"){d=new Uint8Array(l)}else{d=l}}g=zlib_inflate.inflateSetDictionary(this.strm,d)}if(g===c.Z_BUF_ERROR&&k===true){g=c.Z_OK;k=false}if(g!==c.Z_STREAM_END&&g!==c.Z_OK){this.onEnd(g);this.ended=true;return false}if(m.next_out){if(m.avail_out===0||g===c.Z_STREAM_END||(m.avail_in===0&&(e===c.Z_FINISH||e===c.Z_SYNC_FLUSH))){if(this.options.to==="string"){b=strings.utf8border(m.output,m.next_out);j=m.next_out-b;a=strings.buf2string(m.output,b);m.next_out=j;m.avail_out=f-j;if(j){utils.arraySet(m.output,m.output,b,j,0)}this.onData(a)}else{this.onData(utils.shrinkBuf(m.output,m.next_out))}}}if(m.avail_in===0&&m.avail_out===0){k=true}}while((m.avail_in>0||m.avail_out===0)&&g!==c.Z_STREAM_END);if(g===c.Z_STREAM_END){e=c.Z_FINISH}if(e===c.Z_FINISH){g=zlib_inflate.inflateEnd(this.strm);this.onEnd(g);this.ended=true;return g===c.Z_OK}if(e===c.Z_SYNC_FLUSH){this.onEnd(c.Z_OK);m.avail_out=0;return true}return true};Inflate.prototype.onData=function(a){this.chunks.push(a)};Inflate.prototype.onEnd=function(a){if(a===c.Z_OK){if(this.options.to==="string"){this.result=this.chunks.join("")}else{this.result=utils.flattenChunks(this.chunks)}}this.chunks=[];this.err=a;this.msg=this.strm.msg};function inflate(a,b){var d=new Inflate(b);d.push(a,true);if(d.err){throw d.msg}return d.result}function inflateRaw(a,b){b=b||{};b.raw=true;return inflate(a,b)}exports.Inflate=Inflate;exports.inflate=inflate;exports.inflateRaw=inflateRaw;exports.ungzip=inflate;