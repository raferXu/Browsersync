"use strict";var utils=require("../utils/common");var trees=require("./trees");var adler32=require("./adler32");var crc32=require("./crc32");var msg=require("./messages");var Z_NO_FLUSH=0;var Z_PARTIAL_FLUSH=1;var Z_FULL_FLUSH=3;var Z_FINISH=4;var Z_BLOCK=5;var Z_OK=0;var Z_STREAM_END=1;var Z_STREAM_ERROR=-2;var Z_DATA_ERROR=-3;var Z_BUF_ERROR=-5;var Z_DEFAULT_COMPRESSION=-1;var Z_FILTERED=1;var Z_HUFFMAN_ONLY=2;var Z_RLE=3;var Z_FIXED=4;var Z_DEFAULT_STRATEGY=0;var Z_UNKNOWN=2;var Z_DEFLATED=8;var MAX_MEM_LEVEL=9;var MAX_WBITS=15;var DEF_MEM_LEVEL=8;var LENGTH_CODES=29;var LITERALS=256;var L_CODES=LITERALS+1+LENGTH_CODES;var D_CODES=30;var BL_CODES=19;var HEAP_SIZE=2*L_CODES+1;var MAX_BITS=15;var MIN_MATCH=3;var MAX_MATCH=258;var MIN_LOOKAHEAD=(MAX_MATCH+MIN_MATCH+1);var PRESET_DICT=32;var INIT_STATE=42;var EXTRA_STATE=69;var NAME_STATE=73;var COMMENT_STATE=91;var HCRC_STATE=103;var BUSY_STATE=113;var FINISH_STATE=666;var BS_NEED_MORE=1;var BS_BLOCK_DONE=2;var BS_FINISH_STARTED=3;var BS_FINISH_DONE=4;var OS_CODE=3;function err(a,b){a.msg=msg[b];return b}function rank(a){return((a)<<1)-((a)>4?9:0)}function zero(b){var a=b.length;while(--a>=0){b[a]=0}}function flush_pending(b){var c=b.state;var a=c.pending;if(a>b.avail_out){a=b.avail_out}if(a===0){return}utils.arraySet(b.output,c.pending_buf,c.pending_out,a,b.next_out);b.next_out+=a;c.pending_out+=a;b.total_out+=a;b.avail_out-=a;c.pending-=a;if(c.pending===0){c.pending_out=0}}function flush_block_only(a,b){trees._tr_flush_block(a,(a.block_start>=0?a.block_start:-1),a.strstart-a.block_start,b);a.block_start=a.strstart;flush_pending(a.strm)}function put_byte(c,a){c.pending_buf[c.pending++]=a}function putShortMSB(c,a){c.pending_buf[c.pending++]=(a>>>8)&255;c.pending_buf[c.pending++]=a&255}function read_buf(b,c,e,d){var a=b.avail_in;if(a>d){a=d}if(a===0){return 0}b.avail_in-=a;utils.arraySet(c,b.input,b.next_in,a,e);if(b.state.wrap===1){b.adler=adler32(b.adler,c,a,e)}else{if(b.state.wrap===2){b.adler=crc32(b.adler,c,a,e)}}b.next_in+=a;b.total_in+=a;return a}function longest_match(n,e){var h=n.max_chain_length;var o=n.strstart;var f;var g;var a=n.prev_length;var b=n.nice_match;var d=(n.strstart>(n.w_size-MIN_LOOKAHEAD))?n.strstart-(n.w_size-MIN_LOOKAHEAD):0;var l=n.window;var i=n.w_mask;var c=n.prev;var k=n.strstart+MAX_MATCH;var m=l[o+a-1];var j=l[o+a];if(n.prev_length>=n.good_match){h>>=2}if(b>n.lookahead){b=n.lookahead}do{f=e;if(l[f+a]!==j||l[f+a-1]!==m||l[f]!==l[o]||l[++f]!==l[o+1]){continue}o+=2;f++;do{}while(l[++o]===l[++f]&&l[++o]===l[++f]&&l[++o]===l[++f]&&l[++o]===l[++f]&&l[++o]===l[++f]&&l[++o]===l[++f]&&l[++o]===l[++f]&&l[++o]===l[++f]&&o<k);g=MAX_MATCH-(k-o);o=k-MAX_MATCH;if(g>a){n.match_start=e;a=g;if(g>=b){break}m=l[o+a-1];j=l[o+a]}}while((e=c[e&i])>d&&--h!==0);if(a<=n.lookahead){return a}return n.lookahead}function fill_window(c){var g=c.w_size;var d,f,a,b,e;do{b=c.window_size-c.lookahead-c.strstart;if(c.strstart>=g+(g-MIN_LOOKAHEAD)){utils.arraySet(c.window,c.window,g,g,0);c.match_start-=g;c.strstart-=g;c.block_start-=g;f=c.hash_size;d=f;do{a=c.head[--d];c.head[d]=(a>=g?a-g:0)}while(--f);f=g;d=f;do{a=c.prev[--d];c.prev[d]=(a>=g?a-g:0)}while(--f);b+=g}if(c.strm.avail_in===0){break}f=read_buf(c.strm,c.window,c.strstart+c.lookahead,b);c.lookahead+=f;if(c.lookahead+c.insert>=MIN_MATCH){e=c.strstart-c.insert;c.ins_h=c.window[e];c.ins_h=((c.ins_h<<c.hash_shift)^c.window[e+1])&c.hash_mask;while(c.insert){c.ins_h=((c.ins_h<<c.hash_shift)^c.window[e+MIN_MATCH-1])&c.hash_mask;c.prev[e&c.w_mask]=c.head[c.ins_h];c.head[c.ins_h]=e;e++;c.insert--;if(c.lookahead+c.insert<MIN_MATCH){break}}}}while(c.lookahead<MIN_LOOKAHEAD&&c.strm.avail_in!==0)}function deflate_stored(d,a){var c=65535;if(c>d.pending_buf_size-5){c=d.pending_buf_size-5}for(;;){if(d.lookahead<=1){fill_window(d);if(d.lookahead===0&&a===Z_NO_FLUSH){return BS_NEED_MORE}if(d.lookahead===0){break}}d.strstart+=d.lookahead;d.lookahead=0;var b=d.block_start+c;if(d.strstart===0||d.strstart>=b){d.lookahead=d.strstart-b;d.strstart=b;flush_block_only(d,false);if(d.strm.avail_out===0){return BS_NEED_MORE}}if(d.strstart-d.block_start>=(d.w_size-MIN_LOOKAHEAD)){flush_block_only(d,false);if(d.strm.avail_out===0){return BS_NEED_MORE}}}d.insert=0;if(a===Z_FINISH){flush_block_only(d,true);if(d.strm.avail_out===0){return BS_FINISH_STARTED}return BS_FINISH_DONE}if(d.strstart>d.block_start){flush_block_only(d,false);if(d.strm.avail_out===0){return BS_NEED_MORE}}return BS_NEED_MORE}function deflate_fast(c,a){var d;var b;for(;;){if(c.lookahead<MIN_LOOKAHEAD){fill_window(c);if(c.lookahead<MIN_LOOKAHEAD&&a===Z_NO_FLUSH){return BS_NEED_MORE}if(c.lookahead===0){break}}d=0;if(c.lookahead>=MIN_MATCH){c.ins_h=((c.ins_h<<c.hash_shift)^c.window[c.strstart+MIN_MATCH-1])&c.hash_mask;d=c.prev[c.strstart&c.w_mask]=c.head[c.ins_h];c.head[c.ins_h]=c.strstart}if(d!==0&&((c.strstart-d)<=(c.w_size-MIN_LOOKAHEAD))){c.match_length=longest_match(c,d)}if(c.match_length>=MIN_MATCH){b=trees._tr_tally(c,c.strstart-c.match_start,c.match_length-MIN_MATCH);c.lookahead-=c.match_length;if(c.match_length<=c.max_lazy_match&&c.lookahead>=MIN_MATCH){c.match_length--;do{c.strstart++;c.ins_h=((c.ins_h<<c.hash_shift)^c.window[c.strstart+MIN_MATCH-1])&c.hash_mask;d=c.prev[c.strstart&c.w_mask]=c.head[c.ins_h];c.head[c.ins_h]=c.strstart}while(--c.match_length!==0);c.strstart++}else{c.strstart+=c.match_length;c.match_length=0;c.ins_h=c.window[c.strstart];c.ins_h=((c.ins_h<<c.hash_shift)^c.window[c.strstart+1])&c.hash_mask}}else{b=trees._tr_tally(c,0,c.window[c.strstart]);c.lookahead--;c.strstart++}if(b){flush_block_only(c,false);if(c.strm.avail_out===0){return BS_NEED_MORE}}}c.insert=((c.strstart<(MIN_MATCH-1))?c.strstart:MIN_MATCH-1);if(a===Z_FINISH){flush_block_only(c,true);if(c.strm.avail_out===0){return BS_FINISH_STARTED}return BS_FINISH_DONE}if(c.last_lit){flush_block_only(c,false);if(c.strm.avail_out===0){return BS_NEED_MORE}}return BS_BLOCK_DONE}function deflate_slow(d,b){var e;var c;var a;for(;;){if(d.lookahead<MIN_LOOKAHEAD){fill_window(d);if(d.lookahead<MIN_LOOKAHEAD&&b===Z_NO_FLUSH){return BS_NEED_MORE}if(d.lookahead===0){break}}e=0;if(d.lookahead>=MIN_MATCH){d.ins_h=((d.ins_h<<d.hash_shift)^d.window[d.strstart+MIN_MATCH-1])&d.hash_mask;e=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h];d.head[d.ins_h]=d.strstart}d.prev_length=d.match_length;d.prev_match=d.match_start;d.match_length=MIN_MATCH-1;if(e!==0&&d.prev_length<d.max_lazy_match&&d.strstart-e<=(d.w_size-MIN_LOOKAHEAD)){d.match_length=longest_match(d,e);if(d.match_length<=5&&(d.strategy===Z_FILTERED||(d.match_length===MIN_MATCH&&d.strstart-d.match_start>4096))){d.match_length=MIN_MATCH-1}}if(d.prev_length>=MIN_MATCH&&d.match_length<=d.prev_length){a=d.strstart+d.lookahead-MIN_MATCH;c=trees._tr_tally(d,d.strstart-1-d.prev_match,d.prev_length-MIN_MATCH);d.lookahead-=d.prev_length-1;d.prev_length-=2;do{if(++d.strstart<=a){d.ins_h=((d.ins_h<<d.hash_shift)^d.window[d.strstart+MIN_MATCH-1])&d.hash_mask;e=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h];d.head[d.ins_h]=d.strstart}}while(--d.prev_length!==0);d.match_available=0;d.match_length=MIN_MATCH-1;d.strstart++;if(c){flush_block_only(d,false);if(d.strm.avail_out===0){return BS_NEED_MORE}}}else{if(d.match_available){c=trees._tr_tally(d,0,d.window[d.strstart-1]);if(c){flush_block_only(d,false)}d.strstart++;d.lookahead--;if(d.strm.avail_out===0){return BS_NEED_MORE}}else{d.match_available=1;d.strstart++;d.lookahead--}}}if(d.match_available){c=trees._tr_tally(d,0,d.window[d.strstart-1]);d.match_available=0}d.insert=d.strstart<MIN_MATCH-1?d.strstart:MIN_MATCH-1;if(b===Z_FINISH){flush_block_only(d,true);if(d.strm.avail_out===0){return BS_FINISH_STARTED}return BS_FINISH_DONE}if(d.last_lit){flush_block_only(d,false);if(d.strm.avail_out===0){return BS_NEED_MORE}}return BS_BLOCK_DONE}function deflate_rle(e,b){var d;var f;var c,a;var g=e.window;for(;;){if(e.lookahead<=MAX_MATCH){fill_window(e);if(e.lookahead<=MAX_MATCH&&b===Z_NO_FLUSH){return BS_NEED_MORE}if(e.lookahead===0){break}}e.match_length=0;if(e.lookahead>=MIN_MATCH&&e.strstart>0){c=e.strstart-1;f=g[c];if(f===g[++c]&&f===g[++c]&&f===g[++c]){a=e.strstart+MAX_MATCH;do{}while(f===g[++c]&&f===g[++c]&&f===g[++c]&&f===g[++c]&&f===g[++c]&&f===g[++c]&&f===g[++c]&&f===g[++c]&&c<a);e.match_length=MAX_MATCH-(a-c);if(e.match_length>e.lookahead){e.match_length=e.lookahead}}}if(e.match_length>=MIN_MATCH){d=trees._tr_tally(e,1,e.match_length-MIN_MATCH);e.lookahead-=e.match_length;e.strstart+=e.match_length;e.match_length=0}else{d=trees._tr_tally(e,0,e.window[e.strstart]);e.lookahead--;e.strstart++}if(d){flush_block_only(e,false);if(e.strm.avail_out===0){return BS_NEED_MORE}}}e.insert=0;if(b===Z_FINISH){flush_block_only(e,true);if(e.strm.avail_out===0){return BS_FINISH_STARTED}return BS_FINISH_DONE}if(e.last_lit){flush_block_only(e,false);if(e.strm.avail_out===0){return BS_NEED_MORE}}return BS_BLOCK_DONE}function deflate_huff(c,a){var b;for(;;){if(c.lookahead===0){fill_window(c);if(c.lookahead===0){if(a===Z_NO_FLUSH){return BS_NEED_MORE}break}}c.match_length=0;b=trees._tr_tally(c,0,c.window[c.strstart]);c.lookahead--;c.strstart++;if(b){flush_block_only(c,false);if(c.strm.avail_out===0){return BS_NEED_MORE}}}c.insert=0;if(a===Z_FINISH){flush_block_only(c,true);if(c.strm.avail_out===0){return BS_FINISH_STARTED}return BS_FINISH_DONE}if(c.last_lit){flush_block_only(c,false);if(c.strm.avail_out===0){return BS_NEED_MORE}}return BS_BLOCK_DONE}function Config(a,e,b,d,c){this.good_length=a;this.max_lazy=e;this.nice_length=b;this.max_chain=d;this.func=c}var configuration_table;configuration_table=[new Config(0,0,0,0,deflate_stored),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)];function lm_init(a){a.window_size=2*a.w_size;zero(a.head);a.max_lazy_match=configuration_table[a.level].max_lazy;a.good_match=configuration_table[a.level].good_length;a.nice_match=configuration_table[a.level].nice_length;a.max_chain_length=configuration_table[a.level].max_chain;a.strstart=0;a.block_start=0;a.lookahead=0;a.insert=0;a.match_length=a.prev_length=MIN_MATCH-1;a.match_available=0;a.ins_h=0}function DeflateState(){this.strm=null;this.status=0;this.pending_buf=null;this.pending_buf_size=0;this.pending_out=0;this.pending=0;this.wrap=0;this.gzhead=null;this.gzindex=0;this.method=Z_DEFLATED;this.last_flush=-1;this.w_size=0;this.w_bits=0;this.w_mask=0;this.window=null;this.window_size=0;this.prev=null;this.head=null;this.ins_h=0;this.hash_size=0;this.hash_bits=0;this.hash_mask=0;this.hash_shift=0;this.block_start=0;this.match_length=0;this.prev_match=0;this.match_available=0;this.strstart=0;this.match_start=0;this.lookahead=0;this.prev_length=0;this.max_chain_length=0;this.max_lazy_match=0;this.level=0;this.strategy=0;this.good_match=0;this.nice_match=0;this.dyn_ltree=new utils.Buf16(HEAP_SIZE*2);this.dyn_dtree=new utils.Buf16((2*D_CODES+1)*2);this.bl_tree=new utils.Buf16((2*BL_CODES+1)*2);zero(this.dyn_ltree);zero(this.dyn_dtree);zero(this.bl_tree);this.l_desc=null;this.d_desc=null;this.bl_desc=null;this.bl_count=new utils.Buf16(MAX_BITS+1);this.heap=new utils.Buf16(2*L_CODES+1);zero(this.heap);this.heap_len=0;this.heap_max=0;this.depth=new utils.Buf16(2*L_CODES+1);zero(this.depth);this.l_buf=0;this.lit_bufsize=0;this.last_lit=0;this.d_buf=0;this.opt_len=0;this.static_len=0;this.matches=0;this.insert=0;this.bi_buf=0;this.bi_valid=0}function deflateResetKeep(a){var b;if(!a||!a.state){return err(a,Z_STREAM_ERROR)}a.total_in=a.total_out=0;a.data_type=Z_UNKNOWN;b=a.state;b.pending=0;b.pending_out=0;if(b.wrap<0){b.wrap=-b.wrap}b.status=(b.wrap?INIT_STATE:BUSY_STATE);a.adler=(b.wrap===2)?0:1;b.last_flush=Z_NO_FLUSH;trees._tr_init(b);return Z_OK}function deflateReset(a){var b=deflateResetKeep(a);if(b===Z_OK){lm_init(a.state)}return b}function deflateSetHeader(a,b){if(!a||!a.state){return Z_STREAM_ERROR}if(a.state.wrap!==2){return Z_STREAM_ERROR}a.state.gzhead=b;return Z_OK}function deflateInit2(a,h,g,d,f,e){if(!a){return Z_STREAM_ERROR}var c=1;if(h===Z_DEFAULT_COMPRESSION){h=6}if(d<0){c=0;d=-d}else{if(d>15){c=2;d-=16}}if(f<1||f>MAX_MEM_LEVEL||g!==Z_DEFLATED||d<8||d>15||h<0||h>9||e<0||e>Z_FIXED){return err(a,Z_STREAM_ERROR)}if(d===8){d=9}var b=new DeflateState();a.state=b;b.strm=a;b.wrap=c;b.gzhead=null;b.w_bits=d;b.w_size=1<<b.w_bits;b.w_mask=b.w_size-1;b.hash_bits=f+7;b.hash_size=1<<b.hash_bits;b.hash_mask=b.hash_size-1;b.hash_shift=~~((b.hash_bits+MIN_MATCH-1)/MIN_MATCH);b.window=new utils.Buf8(b.w_size*2);b.head=new utils.Buf16(b.hash_size);b.prev=new utils.Buf16(b.w_size);b.lit_bufsize=1<<(f+6);b.pending_buf_size=b.lit_bufsize*4;b.pending_buf=new utils.Buf8(b.pending_buf_size);b.d_buf=1*b.lit_bufsize;b.l_buf=(1+2)*b.lit_bufsize;b.level=h;b.strategy=e;b.method=g;return deflateReset(a)}function deflateInit(a,b){return deflateInit2(a,b,Z_DEFLATED,MAX_WBITS,DEF_MEM_LEVEL,Z_DEFAULT_STRATEGY)}function deflate(f,g){var e,i;var d,b;if(!f||!f.state||g>Z_BLOCK||g<0){return f?err(f,Z_STREAM_ERROR):Z_STREAM_ERROR}i=f.state;if(!f.output||(!f.input&&f.avail_in!==0)||(i.status===FINISH_STATE&&g!==Z_FINISH)){return err(f,(f.avail_out===0)?Z_BUF_ERROR:Z_STREAM_ERROR)}i.strm=f;e=i.last_flush;i.last_flush=g;if(i.status===INIT_STATE){if(i.wrap===2){f.adler=0;put_byte(i,31);put_byte(i,139);put_byte(i,8);if(!i.gzhead){put_byte(i,0);put_byte(i,0);put_byte(i,0);put_byte(i,0);put_byte(i,0);put_byte(i,i.level===9?2:(i.strategy>=Z_HUFFMAN_ONLY||i.level<2?4:0));put_byte(i,OS_CODE);i.status=BUSY_STATE}else{put_byte(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(!i.gzhead.extra?0:4)+(!i.gzhead.name?0:8)+(!i.gzhead.comment?0:16));put_byte(i,i.gzhead.time&255);put_byte(i,(i.gzhead.time>>8)&255);put_byte(i,(i.gzhead.time>>16)&255);put_byte(i,(i.gzhead.time>>24)&255);put_byte(i,i.level===9?2:(i.strategy>=Z_HUFFMAN_ONLY||i.level<2?4:0));put_byte(i,i.gzhead.os&255);if(i.gzhead.extra&&i.gzhead.extra.length){put_byte(i,i.gzhead.extra.length&255);put_byte(i,(i.gzhead.extra.length>>8)&255)}if(i.gzhead.hcrc){f.adler=crc32(f.adler,i.pending_buf,i.pending,0)}i.gzindex=0;i.status=EXTRA_STATE}}else{var c=(Z_DEFLATED+((i.w_bits-8)<<4))<<8;var h=-1;if(i.strategy>=Z_HUFFMAN_ONLY||i.level<2){h=0}else{if(i.level<6){h=1}else{if(i.level===6){h=2}else{h=3}}}c|=(h<<6);if(i.strstart!==0){c|=PRESET_DICT}c+=31-(c%31);i.status=BUSY_STATE;putShortMSB(i,c);if(i.strstart!==0){putShortMSB(i,f.adler>>>16);putShortMSB(i,f.adler&65535)}f.adler=1}}if(i.status===EXTRA_STATE){if(i.gzhead.extra){d=i.pending;while(i.gzindex<(i.gzhead.extra.length&65535)){if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>d){f.adler=crc32(f.adler,i.pending_buf,i.pending-d,d)}flush_pending(f);d=i.pending;if(i.pending===i.pending_buf_size){break}}put_byte(i,i.gzhead.extra[i.gzindex]&255);i.gzindex++}if(i.gzhead.hcrc&&i.pending>d){f.adler=crc32(f.adler,i.pending_buf,i.pending-d,d)}if(i.gzindex===i.gzhead.extra.length){i.gzindex=0;i.status=NAME_STATE}}else{i.status=NAME_STATE}}if(i.status===NAME_STATE){if(i.gzhead.name){d=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>d){f.adler=crc32(f.adler,i.pending_buf,i.pending-d,d)}flush_pending(f);d=i.pending;if(i.pending===i.pending_buf_size){b=1;break}}if(i.gzindex<i.gzhead.name.length){b=i.gzhead.name.charCodeAt(i.gzindex++)&255}else{b=0}put_byte(i,b)}while(b!==0);if(i.gzhead.hcrc&&i.pending>d){f.adler=crc32(f.adler,i.pending_buf,i.pending-d,d)}if(b===0){i.gzindex=0;i.status=COMMENT_STATE}}else{i.status=COMMENT_STATE}}if(i.status===COMMENT_STATE){if(i.gzhead.comment){d=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>d){f.adler=crc32(f.adler,i.pending_buf,i.pending-d,d)}flush_pending(f);d=i.pending;if(i.pending===i.pending_buf_size){b=1;break}}if(i.gzindex<i.gzhead.comment.length){b=i.gzhead.comment.charCodeAt(i.gzindex++)&255}else{b=0}put_byte(i,b)}while(b!==0);if(i.gzhead.hcrc&&i.pending>d){f.adler=crc32(f.adler,i.pending_buf,i.pending-d,d)}if(b===0){i.status=HCRC_STATE}}else{i.status=HCRC_STATE}}if(i.status===HCRC_STATE){if(i.gzhead.hcrc){if(i.pending+2>i.pending_buf_size){flush_pending(f)}if(i.pending+2<=i.pending_buf_size){put_byte(i,f.adler&255);put_byte(i,(f.adler>>8)&255);f.adler=0;i.status=BUSY_STATE}}else{i.status=BUSY_STATE}}if(i.pending!==0){flush_pending(f);if(f.avail_out===0){i.last_flush=-1;return Z_OK}}else{if(f.avail_in===0&&rank(g)<=rank(e)&&g!==Z_FINISH){return err(f,Z_BUF_ERROR)}}if(i.status===FINISH_STATE&&f.avail_in!==0){return err(f,Z_BUF_ERROR)}if(f.avail_in!==0||i.lookahead!==0||(g!==Z_NO_FLUSH&&i.status!==FINISH_STATE)){var a=(i.strategy===Z_HUFFMAN_ONLY)?deflate_huff(i,g):(i.strategy===Z_RLE?deflate_rle(i,g):configuration_table[i.level].func(i,g));if(a===BS_FINISH_STARTED||a===BS_FINISH_DONE){i.status=FINISH_STATE}if(a===BS_NEED_MORE||a===BS_FINISH_STARTED){if(f.avail_out===0){i.last_flush=-1}return Z_OK}if(a===BS_BLOCK_DONE){if(g===Z_PARTIAL_FLUSH){trees._tr_align(i)}else{if(g!==Z_BLOCK){trees._tr_stored_block(i,0,0,false);if(g===Z_FULL_FLUSH){zero(i.head);if(i.lookahead===0){i.strstart=0;i.block_start=0;i.insert=0}}}}flush_pending(f);if(f.avail_out===0){i.last_flush=-1;return Z_OK}}}if(g!==Z_FINISH){return Z_OK}if(i.wrap<=0){return Z_STREAM_END}if(i.wrap===2){put_byte(i,f.adler&255);put_byte(i,(f.adler>>8)&255);put_byte(i,(f.adler>>16)&255);put_byte(i,(f.adler>>24)&255);put_byte(i,f.total_in&255);put_byte(i,(f.total_in>>8)&255);put_byte(i,(f.total_in>>16)&255);put_byte(i,(f.total_in>>24)&255)}else{putShortMSB(i,f.adler>>>16);putShortMSB(i,f.adler&65535)}flush_pending(f);if(i.wrap>0){i.wrap=-i.wrap}return i.pending!==0?Z_OK:Z_STREAM_END}function deflateEnd(b){var a;if(!b||!b.state){return Z_STREAM_ERROR}a=b.state.status;if(a!==INIT_STATE&&a!==EXTRA_STATE&&a!==NAME_STATE&&a!==COMMENT_STATE&&a!==HCRC_STATE&&a!==BUSY_STATE&&a!==FINISH_STATE){return err(b,Z_STREAM_ERROR)}b.state=null;return a===BUSY_STATE?err(b,Z_DATA_ERROR):Z_OK}function deflateSetDictionary(i,h){var j=h.length;var k;var f,b;var a;var e;var d;var g;var c;if(!i||!i.state){return Z_STREAM_ERROR}k=i.state;a=k.wrap;if(a===2||(a===1&&k.status!==INIT_STATE)||k.lookahead){return Z_STREAM_ERROR}if(a===1){i.adler=adler32(i.adler,h,j,0)}k.wrap=0;if(j>=k.w_size){if(a===0){zero(k.head);k.strstart=0;k.block_start=0;k.insert=0}c=new utils.Buf8(k.w_size);utils.arraySet(c,h,j-k.w_size,k.w_size,0);h=c;j=k.w_size}e=i.avail_in;d=i.next_in;g=i.input;i.avail_in=j;i.next_in=0;i.input=h;fill_window(k);while(k.lookahead>=MIN_MATCH){f=k.strstart;b=k.lookahead-(MIN_MATCH-1);do{k.ins_h=((k.ins_h<<k.hash_shift)^k.window[f+MIN_MATCH-1])&k.hash_mask;k.prev[f&k.w_mask]=k.head[k.ins_h];k.head[k.ins_h]=f;f++}while(--b);k.strstart=f;k.lookahead=MIN_MATCH-1;fill_window(k)}k.strstart+=k.lookahead;k.block_start=k.strstart;k.insert=k.lookahead;k.lookahead=0;k.match_length=k.prev_length=MIN_MATCH-1;k.match_available=0;i.next_in=d;i.input=g;i.avail_in=e;k.wrap=a;return Z_OK}exports.deflateInit=deflateInit;exports.deflateInit2=deflateInit2;exports.deflateReset=deflateReset;exports.deflateResetKeep=deflateResetKeep;exports.deflateSetHeader=deflateSetHeader;exports.deflate=deflate;exports.deflateEnd=deflateEnd;exports.deflateSetDictionary=deflateSetDictionary;exports.deflateInfo="pako deflate (from Nodeca project)";