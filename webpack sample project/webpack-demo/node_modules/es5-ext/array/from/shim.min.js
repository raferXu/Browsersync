"use strict";var iteratorSymbol=require("es6-symbol").iterator,isArguments=require("../../function/is-arguments"),isFunction=require("../../function/is-function"),toPosInt=require("../../number/to-pos-integer"),callable=require("../../object/valid-callable"),validValue=require("../../object/valid-value"),isValue=require("../../object/is-value"),isString=require("../../string/is-string"),isArray=Array.isArray,call=Function.prototype.call,desc={configurable:true,enumerable:true,writable:true,value:null},defineProperty=Object.defineProperty;module.exports=function(o){var d=arguments[1],h=arguments[2],l,e,c,g,b,a,f,n,m,k;o=Object(validValue(o));if(isValue(d)){callable(d)}if(!this||this===Array||!isFunction(this)){if(!d){if(isArguments(o)){b=o.length;if(b!==1){return Array.apply(null,o)}g=new Array(1);g[0]=o[0];return g}if(isArray(o)){g=new Array(b=o.length);for(e=0;e<b;++e){g[e]=o[e]}return g}}g=[]}else{l=this}if(!isArray(o)){if((m=o[iteratorSymbol])!==undefined){f=callable(m).call(o);if(l){g=new l()}n=f.next();e=0;while(!n.done){k=d?call.call(d,h,n.value,e):n.value;if(l){desc.value=k;defineProperty(g,e,desc)}else{g[e]=k}n=f.next();++e}b=e}else{if(isString(o)){b=o.length;if(l){g=new l()}for(e=0,c=0;e<b;++e){k=o[e];if(e+1<b){a=k.charCodeAt(0);if(a>=55296&&a<=56319){k+=o[++e]}}k=d?call.call(d,h,k,c):k;if(l){desc.value=k;defineProperty(g,c,desc)}else{g[c]=k}++c}b=c}}}if(b===undefined){b=toPosInt(o.length);if(l){g=new l(b)}for(e=0;e<b;++e){k=d?call.call(d,h,o[e],e):o[e];if(l){desc.value=k;defineProperty(g,e,desc)}else{g[e]=k}}}if(l){desc.value=null;g.length=b}return g};