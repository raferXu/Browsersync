"use strict";function Compressor(b,d){if(!(this instanceof Compressor)){return new Compressor(b,d)}TreeTransformer.call(this,this.before,this.after);this.options=defaults(b,{angular:false,booleans:!d,cascade:!d,collapse_vars:!d,comparisons:!d,conditionals:!d,dead_code:!d,drop_console:false,drop_debugger:!d,evaluate:!d,expression:false,global_defs:{},hoist_funs:!d,hoist_vars:false,if_return:!d,join_vars:!d,keep_fargs:true,keep_fnames:false,keep_infinity:false,loops:!d,negate_iife:!d,passes:1,properties:!d,pure_getters:!d&&"strict",pure_funcs:null,reduce_vars:!d,screw_ie8:true,sequences:!d,side_effects:!d,switches:!d,top_retain:null,toplevel:!!(b&&b.top_retain),unsafe:false,unsafe_comps:false,unsafe_math:false,unsafe_proto:false,unsafe_regexp:false,unused:!d,warnings:true},true);var c=this.options.pure_funcs;if(typeof c=="function"){this.pure_funcs=c}else{this.pure_funcs=c?function(f){return c.indexOf(f.expression.print_to_string())<0}:return_true}var a=this.options.top_retain;if(a instanceof RegExp){this.top_retain=function(f){return a.test(f.name)}}else{if(typeof a=="function"){this.top_retain=a}else{if(a){if(typeof a=="string"){a=a.split(/,/)}this.top_retain=function(f){return a.indexOf(f.name)>=0}}}}var e=this.options.sequences;this.sequences_limit=e==1?200:e|0;this.warnings_produced={}}Compressor.prototype=new TreeTransformer;merge(Compressor.prototype,{option:function(a){return this.options[a]},compress:function(c){if(this.option("expression")){c=c.process_expression(true)}var b=+this.options.passes||1;for(var a=0;a<b&&a<3;++a){if(a>0||this.option("reduce_vars")){c.reset_opt_flags(this,true)}c=c.transform(this)}if(this.option("expression")){c=c.process_expression(false)}return c},info:function(){if(this.options.warnings=="verbose"){AST_Node.warn.apply(AST_Node,arguments)}},warn:function(c,a){if(this.options.warnings){var b=string_template(c,a);if(!(b in this.warnings_produced)){this.warnings_produced[b]=true;AST_Node.warn.apply(AST_Node,arguments)}}},clear_warnings:function(){this.warnings_produced={}},before:function(d,b,c){if(d._squeezed){return d}var e=false;if(d instanceof AST_Scope){d=d.hoist_declarations(this);e=true}b(d,this);b(d,this);var a=d.optimize(this);if(e&&a instanceof AST_Scope){a.drop_unused(this);b(a,this)}if(a===d){a._squeezed=true}return a}});(function(){function j(B,A){B.DEFMETHOD("optimize",function(E){var C=this;if(C._optimized){return C}if(E.has_directive("use asm")){return C}var D=A(C,E);D._optimized=true;return D})}j(AST_Node,function(A,B){return A});AST_Node.DEFMETHOD("equivalent_to",function(A){return this.TYPE==A.TYPE&&this.print_to_string()==A.print_to_string()});AST_Node.DEFMETHOD("process_expression",function(C,D){var A=this;var B=new TreeTransformer(function(F){if(C&&F instanceof AST_SimpleStatement){return h(AST_Return,F,{value:F.body})}if(!C&&F instanceof AST_Return){if(D){var G=F.value&&F.value.drop_side_effect_free(D,true);return G?h(AST_SimpleStatement,F,{body:G}):h(AST_EmptyStatement,F)}return h(AST_SimpleStatement,F,{body:F.value||h(AST_UnaryPrefix,F,{operator:"void",expression:h(AST_Number,F,{value:0})})})}if(F instanceof AST_Lambda&&F!==A){return F}if(F instanceof AST_Block){var E=F.body.length-1;if(E>=0){F.body[E]=F.body[E].transform(B)}}if(F instanceof AST_If){F.body=F.body.transform(B);if(F.alternative){F.alternative=F.alternative.transform(B)}}if(F instanceof AST_With){F.body=F.body.transform(B)}return F});return A.transform(B)});AST_Node.DEFMETHOD("reset_opt_flags",function(E,C){var M=C&&E.option("reduce_vars");var K=E.option("toplevel");var G=Object.create(null);var B=new TreeWalker(function(N){if(N instanceof AST_Symbol){var O=N.definition();if(N instanceof AST_SymbolRef){O.references.push(N)}O.fixed=false}});var F=new TreeWalker(function(R,Q){R._squeezed=false;R._optimized=false;if(M){if(R instanceof AST_Toplevel){R.globals.each(I)}if(R instanceof AST_Scope){R.variables.each(I)}if(R instanceof AST_SymbolRef){var S=R.definition();S.references.push(R);if(S.fixed===undefined||!A(S)||J(R,0,R.fixed_value() instanceof AST_Lambda)){S.fixed=false}else{var P=F.parent();if(P instanceof AST_Assign&&P.operator=="="&&R===P.right||P instanceof AST_Call&&R!==P.expression||P instanceof AST_Return&&R===P.value&&R.scope!==S.scope||P instanceof AST_VarDef&&R===P.value){S.escaped=true}}}if(R instanceof AST_SymbolCatch){R.definition().fixed=false}if(R instanceof AST_VarDef){var S=R.name.definition();if(S.fixed==null){if(R.value){S.fixed=function(){return R.value};D(S,false);Q()}else{S.fixed=null}D(S,true);return true}else{if(R.value){S.fixed=false}}}if(R instanceof AST_Defun){var S=R.name.definition();if(!K&&S.global||A(S)){S.fixed=false}else{S.fixed=R;D(S,true)}var N=G;G=Object.create(null);Q();G=N;return true}if(R instanceof AST_Function){H();var O;if(!R.name&&(O=F.parent()) instanceof AST_Call&&O.expression===R){R.argnames.forEach(function(T,U){var V=T.definition();if(!R.uses_arguments&&V.fixed===undefined){V.fixed=function(){return O.args[U]||h(AST_Undefined,O)};D(V,true)}else{V.fixed=false}})}Q();L();return true}if(R instanceof AST_Accessor){var N=G;G=Object.create(null);Q();G=N;return true}if(R instanceof AST_Binary&&(R.operator=="&&"||R.operator=="||")){R.left.walk(F);H();R.right.walk(F);L();return true}if(R instanceof AST_Conditional){R.condition.walk(F);H();R.consequent.walk(F);L();H();R.alternative.walk(F);L();return true}if(R instanceof AST_If||R instanceof AST_DWLoop){R.condition.walk(F);H();R.body.walk(F);L();if(R.alternative){H();R.alternative.walk(F);L()}return true}if(R instanceof AST_LabeledStatement){H();R.body.walk(F);L();return true}if(R instanceof AST_For){if(R.init){R.init.walk(F)}H();if(R.condition){R.condition.walk(F)}R.body.walk(F);if(R.step){R.step.walk(F)}L();return true}if(R instanceof AST_ForIn){R.init.walk(B);R.object.walk(F);H();R.body.walk(F);L();return true}if(R instanceof AST_Try){H();walk_body(R,F);L();if(R.bcatch){H();R.bcatch.walk(F);L()}if(R.bfinally){R.bfinally.walk(F)}return true}if(R instanceof AST_SwitchBranch){H();Q();L();return true}}});this.walk(F);function D(O,N){G[O.id]=N}function A(N){if(G[N.id]){if(N.fixed==null){var O=N.orig[0];if(O instanceof AST_SymbolFunarg||O.name=="arguments"){return false}N.fixed=h(AST_Undefined,O)}return true}}function H(){G=Object.create(G)}function L(){G=Object.getPrototypeOf(G)}function I(N){N.escaped=false;if(N.scope.uses_eval){N.fixed=false}else{if(K||!N.global||N.orig[0] instanceof AST_SymbolConst){N.fixed=undefined}else{N.fixed=false}}N.references=[];N.should_replace=undefined}function J(P,Q,O){var N=F.parent(Q);if(r(P,N)||!O&&N instanceof AST_Call&&N.expression===P){return true}else{if(N instanceof AST_PropAccess&&N.expression===P){return !O&&J(N,Q+1)}}}});AST_SymbolRef.DEFMETHOD("fixed_value",function(){var A=this.definition().fixed;if(!A||A instanceof AST_Node){return A}return A()});function w(B){if(!(B instanceof AST_SymbolRef)){return false}var C=B.definition().orig;for(var A=C.length;--A>=0;){if(C[A] instanceof AST_SymbolConst){return true}}}function f(D,A){var C,B=0;while(C=D.parent(B++)){if(C instanceof AST_Scope){break}if(C instanceof AST_Catch){C=C.argname.definition().scope;break}}return C.find_variable(A)}function h(B,C,A){if(!A){A={}}if(C){if(!A.start){A.start=C.start}if(!A.end){A.end=C.end}}return new B(A)}function a(A,B){switch(typeof A){case"string":return h(AST_String,B,{value:A});case"number":if(isNaN(A)){return h(AST_NaN,B)}if(isFinite(A)){return 1/A<0?h(AST_UnaryPrefix,B,{operator:"-",expression:h(AST_Number,B,{value:-A})}):h(AST_Number,B,{value:A})}return A<0?h(AST_UnaryPrefix,B,{operator:"-",expression:h(AST_Infinity,B)}):h(AST_Infinity,B);case"boolean":return h(A?AST_True:AST_False,B);case"undefined":return h(AST_Undefined,B);default:if(A===null){return h(AST_Null,B,{value:null})}if(A instanceof RegExp){return h(AST_RegExp,B,{value:A})}throw new Error(string_template("Can't handle constant of type: {type}",{type:typeof A}))}}function s(A,C,B){if(A instanceof AST_UnaryPrefix&&A.operator=="delete"||A instanceof AST_Call&&A.expression===C&&(B instanceof AST_PropAccess||B instanceof AST_SymbolRef&&B.name=="eval")){return h(AST_Seq,C,{car:h(AST_Number,C,{value:0}),cdr:B})}return B}function d(A){if(A===null){return[]}if(A instanceof AST_BlockStatement){return A.body}if(A instanceof AST_EmptyStatement){return[]}if(A instanceof AST_Statement){return[A]}throw new Error("Can't convert thing to statement array")}function z(A){if(A===null){return true}if(A instanceof AST_EmptyStatement){return true}if(A instanceof AST_BlockStatement){return A.body.length==0}return false}function c(A){if(A instanceof AST_Switch){return A}if(A instanceof AST_For||A instanceof AST_ForIn||A instanceof AST_DWLoop){return(A.body instanceof AST_BlockStatement?A.body:A)}return A}function i(A){if(A instanceof AST_Call&&!(A instanceof AST_New)){return A.expression instanceof AST_Function||i(A.expression)}return false}function l(H,D){var K,E=10;do{K=false;if(D.option("angular")){H=L(H)}H=I(H);if(D.option("dead_code")){H=G(H,D)}if(D.option("if_return")){H=C(H,D)}if(D.sequences_limit>0){H=F(H,D)}if(D.option("join_vars")){H=M(H,D)}if(D.option("collapse_vars")){H=J(H,D)}}while(K&&E-->0);return H;function J(al,ab){var ad=ab.self();var V=false;var ac=ab.option("toplevel");for(var P=al.length;--P>=0;){var am=al[P];if(am instanceof AST_Definitions){continue}[am,am.body,am.alternative,am.bcatch,am.bfinally].forEach(function(aq){aq&&aq.body&&J(aq.body,ab)});if(P<=0){break}var Z=P-1;var R=al[Z];if(!(R instanceof AST_Definitions)){continue}var U=R.definitions;if(U==null){continue}var O={};var X=false;var ap=false;var af={};for(var aj=U.length;--aj>=0;){var Y=U[aj];if(Y.value==null){break}var T=Y.name.name;if(!T||!T.length){break}if(T in O){break}O[T]=true;var aa=ad.find_variable&&ad.find_variable(T);if(!aa||!aa.references||aa.references.length!==1||T=="arguments"||(!ac&&aa.global)){X=true;continue}var S=aa.references[0];if(S.scope.uses_eval||S.scope.uses_with){break}if(Y.value.is_constant()){var ak=new TreeTransformer(function(ar){var aq=ak.parent();if(aq instanceof AST_IterationStatement&&(aq.condition===ar||aq.init===ar)){return ar}if(ar===S){return ae(ar,aq,true)}});am.transform(ak);continue}if(X|=ap){continue}var Q=Y.value.has_side_effects(ab);if(S.scope!==ad){X|=Q;continue}var ao=new TreeWalker(function(aq){if(aq instanceof AST_SymbolRef&&ah(aq,ao.parent())){af[aq.name]=ap=true}});Y.value.walk(ao);var W=false;var N=new TreeTransformer(function ag(at){if(W){return at}var ar=N.parent();if(at instanceof AST_Lambda||at instanceof AST_Try||at instanceof AST_With||at instanceof AST_Case||at instanceof AST_IterationStatement||(ar instanceof AST_If&&at!==ar.condition)||(ar instanceof AST_Conditional&&at!==ar.condition)||(at instanceof AST_SymbolRef&&Q&&!aq(at.definition(),ad))||(ar instanceof AST_Binary&&(ar.operator=="&&"||ar.operator=="||")&&at===ar.right)||(ar instanceof AST_Switch&&at!==ar.expression)){return X=W=true,at}function aq(ay,ax){if(ay.orig.length===1&&ay.orig[0] instanceof AST_SymbolDefun){return true}if(ay.scope!==ax){return false}var av=ay.references;for(var aw=0,au=av.length;aw<au;aw++){if(av[aw].scope!==ax){return false}}return true}},function an(aq){if(W){return aq}if(aq===S){return W=true,ae(aq,N.parent(),false)}if(X|=aq.has_side_effects(ab)){return W=true,aq}if(ap&&aq instanceof AST_SymbolRef&&aq.name in af){X=true;return W=true,aq}});am.transform(N)}}if(V){for(var ai=al.length;--ai>=0;){if(al.length>1&&al[ai] instanceof AST_EmptyStatement){al.splice(ai,1)}}}return al;function ah(ar,aq){return ar instanceof AST_SymbolRef&&r(ar,aq)}function ae(ar,aq,au){if(ah(ar,aq)){return ar}var at=s(aq,ar,Y.value);Y.value=null;U.splice(aj,1);if(U.length===0){al[Z]=h(AST_EmptyStatement,ad);V=true}am.reset_opt_flags(ab);ab.info("Collapsing "+(au?"constant":"variable")+" "+T+" [{file}:{line},{col}]",ar.start);K=true;return at}}function L(N){function P(T){return/@ngInject/.test(T.value)}function O(T){return T.argnames.map(function(U){return h(AST_String,U,{value:U.name})})}function S(U,T){return h(AST_Array,U,{elements:T})}function R(U,T){return h(AST_SimpleStatement,U,{body:h(AST_Assign,U,{operator:"=",left:h(AST_Dot,T,{expression:h(AST_SymbolRef,T,T),property:"$inject"}),right:S(U,O(U))})})}function Q(T){if(T&&T.args){T.args.forEach(function(V,U,X){var W=V.start.comments_before;if(V instanceof AST_Lambda&&W.length&&P(W[0])){X[U]=S(V,O(V).concat(V))}});if(T.expression&&T.expression.expression){Q(T.expression.expression)}}}return N.reduce(function(T,V){T.push(V);if(V.body&&V.body.args){Q(V.body)}else{var U=V.start;var X=U.comments_before;if(X&&X.length>0){var W=X.pop();if(P(W)){if(V instanceof AST_Defun){T.push(R(V,V.name))}else{if(V instanceof AST_Definitions){V.definitions.forEach(function(Y){if(Y.value&&Y.value instanceof AST_Lambda){T.push(R(Y.value,Y.name))}})}else{D.warn("Unknown statement marked with @ngInject [{file}:{line},{col}]",U)}}}}}return T},[])}function I(O){var N=[];return O.reduce(function(P,Q){if(Q instanceof AST_BlockStatement){K=true;P.push.apply(P,I(Q.body))}else{if(Q instanceof AST_EmptyStatement){K=true}else{if(Q instanceof AST_Directive){if(N.indexOf(Q.value)<0){P.push(Q);N.push(Q.value)}else{K=true}}else{P.push(Q)}}}return P},[])}function C(U,P){var Y=P.self();var N=O(U);var X=Y instanceof AST_Lambda;var V=[];loop:for(var R=U.length;--R>=0;){var Q=U[R];switch(true){case (X&&Q instanceof AST_Return&&!Q.value&&V.length==0):K=true;continue loop;case Q instanceof AST_If:if(Q.body instanceof AST_Return){if(((X&&V.length==0)||(V[0] instanceof AST_Return&&!V[0].value))&&!Q.body.value&&!Q.alternative){K=true;var W=h(AST_SimpleStatement,Q.condition,{body:Q.condition});V.unshift(W);continue loop}if(V[0] instanceof AST_Return&&Q.body.value&&V[0].value&&!Q.alternative){K=true;Q=Q.clone();Q.alternative=V[0];V[0]=Q.transform(P);continue loop}if(N&&(V.length==0||V[0] instanceof AST_Return)&&Q.body.value&&!Q.alternative&&X){K=true;Q=Q.clone();Q.alternative=V[0]||h(AST_Return,Q,{value:null});V[0]=Q.transform(P);continue loop}if(!Q.body.value&&X){K=true;Q=Q.clone();Q.condition=Q.condition.negate(P);var S=d(Q.alternative).concat(V);var T=m(S);Q.body=h(AST_BlockStatement,Q,{body:S});Q.alternative=null;V=T.concat([Q.transform(P)]);continue loop}if(P.option("sequences")&&R>0&&U[R-1] instanceof AST_If&&U[R-1].body instanceof AST_Return&&V.length==1&&X&&V[0] instanceof AST_SimpleStatement&&!Q.alternative){K=true;V.push(h(AST_Return,V[0],{value:null}).transform(P));V.unshift(Q);continue loop}}var aa=y(Q.body);var Z=aa instanceof AST_LoopControl?P.loopcontrol_target(aa):null;if(aa&&((aa instanceof AST_Return&&!aa.value&&X)||(aa instanceof AST_Continue&&Y===c(Z))||(aa instanceof AST_Break&&Z instanceof AST_BlockStatement&&Y===Z))){if(aa.label){remove(aa.label.thedef.references,aa)}K=true;var S=d(Q.body).slice(0,-1);Q=Q.clone();Q.condition=Q.condition.negate(P);Q.body=h(AST_BlockStatement,Q,{body:d(Q.alternative).concat(V)});Q.alternative=h(AST_BlockStatement,Q,{body:S});V=[Q.transform(P)];continue loop}var aa=y(Q.alternative);var Z=aa instanceof AST_LoopControl?P.loopcontrol_target(aa):null;if(aa&&((aa instanceof AST_Return&&!aa.value&&X)||(aa instanceof AST_Continue&&Y===c(Z))||(aa instanceof AST_Break&&Z instanceof AST_BlockStatement&&Y===Z))){if(aa.label){remove(aa.label.thedef.references,aa)}K=true;Q=Q.clone();Q.body=h(AST_BlockStatement,Q.body,{body:d(Q.body).concat(V)});Q.alternative=h(AST_BlockStatement,Q.alternative,{body:d(Q.alternative).slice(0,-1)});V=[Q.transform(P)];continue loop}V.unshift(Q);break;default:V.unshift(Q);break}}return V;function O(ab){var ae=0;for(var ac=ab.length;--ac>=0;){var ad=ab[ac];if(ad instanceof AST_If&&ad.body instanceof AST_Return){if(++ae>1){return true}}}return false}}function G(P,R){var N=false;var Q=P.length;var O=R.self();P=P.reduce(function(T,U){if(N){e(R,U,T)}else{if(U instanceof AST_LoopControl){var S=R.loopcontrol_target(U);if((U instanceof AST_Break&&!(S instanceof AST_IterationStatement)&&c(S)===O)||(U instanceof AST_Continue&&c(S)===O)){if(U.label){remove(U.label.thedef.references,U)}}else{T.push(U)}}else{T.push(U)}if(y(U)){N=true}}return T},[]);K=P.length!=Q;return P}function F(O,R){if(O.length<2){return O}var N=[],P=[];function Q(){N=AST_Seq.from_array(N);if(N){P.push(h(AST_SimpleStatement,N,{body:N}))}N=[]}O.forEach(function(T){if(T instanceof AST_SimpleStatement){if(B(N)>=R.sequences_limit){Q()}var S=T.body;if(N.length>0){S=S.drop_side_effect_free(R)}if(S){N.push(S)}}else{Q();P.push(T)}});Q();P=A(P,R);K=P.length!=O.length;return P}function B(O){for(var N=0,P=0;P<O.length;++P){var Q=O[P];if(Q instanceof AST_Seq){N+=Q.len()}else{N++}}return N}function A(N,R){function P(S){O.pop();var T=Q.body;if(T instanceof AST_Seq){T.add(S)}else{T=AST_Seq.cons(T,S)}return T.transform(R)}var O=[],Q=null;N.forEach(function(U){if(Q){if(U instanceof AST_For){var S={};try{Q.body.walk(new TreeWalker(function(V){if(V instanceof AST_Binary&&V.operator=="in"){throw S}}));if(U.init&&!(U.init instanceof AST_Definitions)){U.init=P(U.init)}else{if(!U.init){U.init=Q.body.drop_side_effect_free(R);O.pop()}}}catch(T){if(T!==S){throw T}}}else{if(U instanceof AST_If){U.condition=P(U.condition)}else{if(U instanceof AST_With){U.expression=P(U.expression)}else{if(U instanceof AST_Exit&&U.value){U.value=P(U.value)}else{if(U instanceof AST_Exit){U.value=P(h(AST_Undefined,U).transform(R))}else{if(U instanceof AST_Switch){U.expression=P(U.expression)}}}}}}}O.push(U);Q=U instanceof AST_SimpleStatement?U:null});return O}function M(N,P){var O=null;return N.reduce(function(Q,R){if(R instanceof AST_Definitions&&O&&O.TYPE==R.TYPE){O.definitions=O.definitions.concat(R.definitions);K=true}else{if(R instanceof AST_For&&O instanceof AST_Var&&(!R.init||R.init.TYPE==O.TYPE)){K=true;Q.pop();if(R.init){R.init.definitions=O.definitions.concat(R.init.definitions)}else{R.init=O}Q.push(R);O=R}else{O=R;Q.push(R)}}return Q},[])}}function m(B){var A=[];for(var C=B.length-1;C>=0;--C){var D=B[C];if(D instanceof AST_Defun){B.splice(C,1);A.unshift(D)}}return A}function e(C,A,B){if(!(A instanceof AST_Defun)){C.warn("Dropping unreachable code [{file}:{line},{col}]",A.start)}A.walk(new TreeWalker(function(D){if(D instanceof AST_Definitions){C.warn("Declarations in unreachable code! [{file}:{line},{col}]",D.start);D.remove_initializers();B.push(D);return true}if(D instanceof AST_Defun){B.push(D);return true}if(D instanceof AST_Scope){return true}}))}function u(A,B){return A.is_undefined||A instanceof AST_Undefined||A instanceof AST_UnaryPrefix&&A.operator=="void"&&!A.expression.has_side_effects(B)}(function(B){AST_Node.DEFMETHOD("may_throw_on_access",function(D){var C=D.option("pure_getters");return !C||this._throw_on_access(C)});function A(C){return/strict/.test(C)}B(AST_Node,A);B(AST_Null,return_true);B(AST_Undefined,return_true);B(AST_Constant,return_false);B(AST_Array,return_false);B(AST_Object,function(D){if(!A(D)){return false}for(var C=this.properties.length;--C>=0;){if(this.properties[C].value instanceof AST_Accessor){return true}}return false});B(AST_Function,return_false);B(AST_UnaryPostfix,return_false);B(AST_UnaryPrefix,function(){return this.operator=="void"});B(AST_Binary,function(C){switch(this.operator){case"&&":return this.left._throw_on_access(C);case"||":return this.left._throw_on_access(C)&&this.right._throw_on_access(C);default:return false}});B(AST_Assign,function(C){return this.operator=="="&&this.right._throw_on_access(C)});B(AST_Conditional,function(C){return this.consequent._throw_on_access(C)||this.alternative._throw_on_access(C)});B(AST_Seq,function(C){return this.cdr._throw_on_access(C)});B(AST_SymbolRef,function(D){if(this.is_undefined){return true}if(!A(D)){return false}var C=this.fixed_value();return !C||C._throw_on_access(D)})})(function(B,A){B.DEFMETHOD("_throw_on_access",A)});(function(B){var A=["!","delete"];var C=["in","instanceof","==","!=","===","!==","<","<=",">=",">"];B(AST_Node,return_false);B(AST_UnaryPrefix,function(){return member(this.operator,A)});B(AST_Binary,function(){return member(this.operator,C)||((this.operator=="&&"||this.operator=="||")&&this.left.is_boolean()&&this.right.is_boolean())});B(AST_Conditional,function(){return this.consequent.is_boolean()&&this.alternative.is_boolean()});B(AST_Assign,function(){return this.operator=="="&&this.right.is_boolean()});B(AST_Seq,function(){return this.cdr.is_boolean()});B(AST_True,return_true);B(AST_False,return_true)})(function(B,A){B.DEFMETHOD("is_boolean",A)});(function(B){B(AST_Node,return_false);B(AST_Number,return_true);var A=makePredicate("+ - ~ ++ --");B(AST_Unary,function(){return A(this.operator)});var C=makePredicate("- * / % & | ^ << >> >>>");B(AST_Binary,function(D){return C(this.operator)||this.operator=="+"&&this.left.is_number(D)&&this.right.is_number(D)});B(AST_Assign,function(D){return C(this.operator.slice(0,-1))||this.operator=="="&&this.right.is_number(D)});B(AST_Seq,function(D){return this.cdr.is_number(D)});B(AST_Conditional,function(D){return this.consequent.is_number(D)&&this.alternative.is_number(D)})})(function(B,A){B.DEFMETHOD("is_number",A)});(function(A){A(AST_Node,return_false);A(AST_String,return_true);A(AST_UnaryPrefix,function(){return this.operator=="typeof"});A(AST_Binary,function(B){return this.operator=="+"&&(this.left.is_string(B)||this.right.is_string(B))});A(AST_Assign,function(B){return(this.operator=="="||this.operator=="+=")&&this.right.is_string(B)});A(AST_Seq,function(B){return this.cdr.is_string(B)});A(AST_Conditional,function(B){return this.consequent.is_string(B)&&this.alternative.is_string(B)})})(function(B,A){B.DEFMETHOD("is_string",A)});var q=makePredicate("delete ++ --");function r(B,A){if(A instanceof AST_Unary&&q(A.operator)){return A.expression}if(A instanceof AST_Assign&&A.left===B){return B}}(function(B){AST_Node.DEFMETHOD("resolve_defines",function(G){if(!G.option("global_defs")){return}var E=this._find_defs(G,"");if(E){var D,C=this,F=0;do{D=C;C=G.parent(F++)}while(C instanceof AST_PropAccess&&C.expression===D);if(r(D,C)){G.warn("global_defs "+this.print_to_string()+" redefined [{file}:{line},{col}]",this.start)}else{return E}}});function A(E,F){if(E instanceof AST_Node){return h(E.CTOR,F,E)}if(Array.isArray(E)){return h(AST_Array,F,{elements:E.map(function(G){return A(G,F)})})}if(E&&typeof E=="object"){var D=[];for(var C in E){D.push(h(AST_ObjectKeyVal,F,{key:C,value:A(E[C],F)}))}return h(AST_Object,F,{properties:D})}return a(E,F)}B(AST_Node,noop);B(AST_Dot,function(D,C){return this.expression._find_defs(D,"."+this.property+C)});B(AST_SymbolRef,function(H,G){if(!this.global()){return}var C;var D=H.option("global_defs");if(D&&HOP(D,(C=this.name+G))){var E=A(D[C],this);var F=H.find_parent(AST_Toplevel);E.walk(new TreeWalker(function(I){if(I instanceof AST_SymbolRef){I.scope=F;I.thedef=F.def_global(I)}}));return E}})})(function(B,A){B.DEFMETHOD("_find_defs",A)});function b(B,A){return B.print_to_string().length>A.print_to_string().length?A:B}function k(B,A){return b(h(AST_SimpleStatement,B,{body:B}),h(AST_SimpleStatement,A,{body:A})).body}function p(C,B,A){return(first_in_statement(C)?k:b)(B,A)}(function(C){AST_Node.DEFMETHOD("evaluate",function(F){if(!F.option("evaluate")){return this}try{var E=this._eval(F);return !E||E instanceof RegExp||typeof E!="object"?E:this}catch(D){if(D!==C){throw D}return this}});var A=makePredicate("! ~ - + void");AST_Node.DEFMETHOD("is_constant",function(){if(this instanceof AST_Constant){return !(this instanceof AST_RegExp)}else{return this instanceof AST_UnaryPrefix&&this.expression instanceof AST_Constant&&A(this.operator)}});AST_Node.DEFMETHOD("constant_value",function(E){if(this instanceof AST_Constant&&!(this instanceof AST_RegExp)){return this.value}if(this instanceof AST_UnaryPrefix&&this.expression instanceof AST_Constant){switch(this.operator){case"!":return !this.expression.value;case"~":return ~this.expression.value;case"-":return -this.expression.value;case"+":return +this.expression.value;default:throw new Error(string_template("Cannot evaluate unary expression {value}",{value:this.print_to_string()}))}}var D=this.evaluate(E);if(D!==this){return D}throw new Error(string_template("Cannot evaluate constant [{file}:{line},{col}]",this.start))});C(AST_Statement,function(){throw new Error(string_template("Cannot evaluate a statement [{file}:{line},{col}]",this.start))});C(AST_Lambda,function(){throw C});function B(D,E){if(!E){throw new Error("Compressor must be passed")}return D._eval(E)}C(AST_Node,function(){throw C});C(AST_Constant,function(){return this.getValue()});C(AST_Array,function(D){if(D.option("unsafe")){return this.elements.map(function(E){return B(E,D)})}throw C});C(AST_Object,function(I){if(I.option("unsafe")){var G={};for(var F=0,D=this.properties.length;F<D;F++){var H=this.properties[F];var E=H.key;if(E instanceof AST_Symbol){E=E.name}else{if(E instanceof AST_Node){E=B(E,I)}}if(typeof Object.prototype[E]==="function"){throw C}G[E]=B(H.value,I)}return G}throw C});C(AST_UnaryPrefix,function(E){var D=this.expression;switch(this.operator){case"!":return !B(D,E);case"typeof":if(D instanceof AST_Function){return typeof function(){}}D=B(D,E);if(D instanceof RegExp){throw C}return typeof D;case"void":return void B(D,E);case"~":return ~B(D,E);case"-":return -B(D,E);case"+":return +B(D,E)}throw C});C(AST_Binary,function(G){var F=this.left,E=this.right,D;switch(this.operator){case"&&":D=B(F,G)&&B(E,G);break;case"||":D=B(F,G)||B(E,G);break;case"|":D=B(F,G)|B(E,G);break;case"&":D=B(F,G)&B(E,G);break;case"^":D=B(F,G)^B(E,G);break;case"+":D=B(F,G)+B(E,G);break;case"*":D=B(F,G)*B(E,G);break;case"/":D=B(F,G)/B(E,G);break;case"%":D=B(F,G)%B(E,G);break;case"-":D=B(F,G)-B(E,G);break;case"<<":D=B(F,G)<<B(E,G);break;case">>":D=B(F,G)>>B(E,G);break;case">>>":D=B(F,G)>>>B(E,G);break;case"==":D=B(F,G)==B(E,G);break;case"===":D=B(F,G)===B(E,G);break;case"!=":D=B(F,G)!=B(E,G);break;case"!==":D=B(F,G)!==B(E,G);break;case"<":D=B(F,G)<B(E,G);break;case"<=":D=B(F,G)<=B(E,G);break;case">":D=B(F,G)>B(E,G);break;case">=":D=B(F,G)>=B(E,G);break;default:throw C}if(isNaN(D)&&G.find_parent(AST_With)){throw C}return D});C(AST_Conditional,function(D){return B(this.condition,D)?B(this.consequent,D):B(this.alternative,D)});C(AST_SymbolRef,function(F){if(!F.option("reduce_vars")||this._evaluating){throw C}this._evaluating=true;try{var D=this.fixed_value();if(!D){throw C}var E=B(D,F);if(!HOP(D,"_eval")){D._eval=function(){return E}}if(E&&typeof E=="object"&&this.definition().escaped){throw C}return E}finally{this._evaluating=false}});C(AST_PropAccess,function(F){if(F.option("unsafe")){var D=this.property;if(D instanceof AST_Node){D=B(D,F)}var E=B(this.expression,F);if(E&&HOP(E,D)){return E[D]}}throw C})})(function(B,A){B.DEFMETHOD("_eval",A)});(function(B){function A(D){return h(AST_UnaryPrefix,D,{operator:"!",expression:D})}function C(H,F,E){var G=A(H);if(E){var D=h(AST_SimpleStatement,F,{body:F});return b(G,D)===D?F:G}return b(G,F)}B(AST_Node,function(){return A(this)});B(AST_Statement,function(){throw new Error("Cannot negate a statement")});B(AST_Function,function(){return A(this)});B(AST_UnaryPrefix,function(){if(this.operator=="!"){return this.expression}return A(this)});B(AST_Seq,function(E){var D=this.clone();D.cdr=D.cdr.negate(E);return D});B(AST_Conditional,function(F,E){var D=this.clone();D.consequent=D.consequent.negate(F);D.alternative=D.alternative.negate(F);return C(this,D,E)});B(AST_Binary,function(G,E){var D=this.clone(),F=this.operator;if(G.option("unsafe_comps")){switch(F){case"<=":D.operator=">";return D;case"<":D.operator=">=";return D;case">=":D.operator="<";return D;case">":D.operator="<=";return D}}switch(F){case"==":D.operator="!=";return D;case"!=":D.operator="==";return D;case"===":D.operator="!==";return D;case"!==":D.operator="===";return D;case"&&":D.operator="||";D.left=D.left.negate(G,E);D.right=D.right.negate(G);return C(this,D,E);case"||":D.operator="&&";D.left=D.left.negate(G,E);D.right=D.right.negate(G);return C(this,D,E)}return A(this)})})(function(B,A){B.DEFMETHOD("negate",function(D,C){return A.call(this,D,C)})});AST_Call.DEFMETHOD("has_pure_annotation",function(D){if(!D.option("side_effects")){return false}if(this.pure!==undefined){return this.pure}var A=false;var C,B;if(this.start&&(C=this.start.comments_before)&&C.length&&/[@#]__PURE__/.test((B=C[C.length-1]).value)){A=B}return this.pure=A});(function(B){B(AST_Node,return_true);B(AST_EmptyStatement,return_false);B(AST_Constant,return_false);B(AST_This,return_false);B(AST_Call,function(D){if(!this.has_pure_annotation(D)&&D.pure_funcs(this)){return true}for(var C=this.args.length;--C>=0;){if(this.args[C].has_side_effects(D)){return true}}return false});function A(D,E){for(var C=D.length;--C>=0;){if(D[C].has_side_effects(E)){return true}}return false}B(AST_Block,function(C){return A(this.body,C)});B(AST_Switch,function(C){return this.expression.has_side_effects(C)||A(this.body,C)});B(AST_Case,function(C){return this.expression.has_side_effects(C)||A(this.body,C)});B(AST_Try,function(C){return A(this.body,C)||this.bcatch&&this.bcatch.has_side_effects(C)||this.bfinally&&this.bfinally.has_side_effects(C)});B(AST_If,function(C){return this.condition.has_side_effects(C)||this.body&&this.body.has_side_effects(C)||this.alternative&&this.alternative.has_side_effects(C)});B(AST_LabeledStatement,function(C){return this.body.has_side_effects(C)});B(AST_SimpleStatement,function(C){return this.body.has_side_effects(C)});B(AST_Defun,return_true);B(AST_Function,return_false);B(AST_Binary,function(C){return this.left.has_side_effects(C)||this.right.has_side_effects(C)});B(AST_Assign,return_true);B(AST_Conditional,function(C){return this.condition.has_side_effects(C)||this.consequent.has_side_effects(C)||this.alternative.has_side_effects(C)});B(AST_Unary,function(C){return q(this.operator)||this.expression.has_side_effects(C)});B(AST_SymbolRef,function(C){return this.undeclared()});B(AST_Object,function(C){return A(this.properties,C)});B(AST_ObjectProperty,function(C){return this.value.has_side_effects(C)});B(AST_Array,function(C){return A(this.elements,C)});B(AST_Dot,function(C){return this.expression.may_throw_on_access(C)||this.expression.has_side_effects(C)});B(AST_Sub,function(C){return this.expression.may_throw_on_access(C)||this.expression.has_side_effects(C)||this.property.has_side_effects(C)});B(AST_Seq,function(C){return this.car.has_side_effects(C)||this.cdr.has_side_effects(C)})})(function(B,A){B.DEFMETHOD("has_side_effects",A)});function y(A){return A&&A.aborts()}(function(A){A(AST_Statement,return_null);A(AST_Jump,return_this);function B(){var C=this.body.length;return C>0&&y(this.body[C-1])}A(AST_BlockStatement,B);A(AST_SwitchBranch,B);A(AST_If,function(){return this.alternative&&y(this.body)&&y(this.alternative)&&this})})(function(B,A){B.DEFMETHOD("aborts",A)});j(AST_Directive,function(A,B){if(B.has_directive(A.value)!==A){return h(AST_EmptyStatement,A)}return A});j(AST_Debugger,function(A,B){if(B.option("drop_debugger")){return h(AST_EmptyStatement,A)}return A});j(AST_LabeledStatement,function(A,B){if(A.body instanceof AST_Break&&B.loopcontrol_target(A.body)===A.body){return h(AST_EmptyStatement,A)}return A.label.references.length==0?A.body:A});j(AST_Block,function(A,B){A.body=l(A.body,B);return A});j(AST_BlockStatement,function(A,B){A.body=l(A.body,B);switch(A.body.length){case 1:return A.body[0];case 0:return h(AST_EmptyStatement,A)}return A});AST_Scope.DEFMETHOD("drop_unused",function(B){var N=this;if(B.has_directive("use asm")){return N}var J=B.option("toplevel");if(B.option("unused")&&(!(N instanceof AST_Toplevel)||J)&&!N.uses_eval&&!N.uses_with){var I=!/keep_assign/.test(B.option("unused"));var C=/funcs/.test(J);var G=/vars/.test(J);if(!(N instanceof AST_Toplevel)||J==true){C=G=true}var L=[];var K=Object.create(null);if(N instanceof AST_Toplevel&&B.top_retain){N.variables.each(function(O){if(B.top_retain(O)&&!(O.id in K)){K[O.id]=true;L.push(O)}})}var E=new Dictionary();var M=this;var D=new TreeWalker(function(Q,P){if(Q!==N){if(Q instanceof AST_Defun){if(!C&&M===N){var R=Q.name.definition();if(!(R.id in K)){K[R.id]=true;L.push(R)}}E.add(Q.name.name,Q);return true}if(Q instanceof AST_Definitions&&M===N){Q.definitions.forEach(function(T){if(!G){var S=T.name.definition();if(!(S.id in K)){K[S.id]=true;L.push(S)}}if(T.value){E.add(T.name.name,T.value);if(T.value.has_side_effects(B)){T.value.walk(D)}}});return true}if(I&&Q instanceof AST_Assign&&Q.operator=="="&&Q.left instanceof AST_SymbolRef&&!w(Q.left)&&M===N){Q.right.walk(D);return true}if(Q instanceof AST_SymbolRef){var R=Q.definition();if(!(R.id in K)){K[R.id]=true;L.push(R)}return true}if(Q instanceof AST_Scope){var O=M;M=Q;P();M=O;return true}}});N.walk(D);for(var A=0;A<L.length;++A){L[A].orig.forEach(function(O){var P=E.get(O.name);if(P){P.forEach(function(R){var Q=new TreeWalker(function(S){if(S instanceof AST_SymbolRef){var T=S.definition();if(!(T.id in K)){K[T.id]=true;L.push(T)}}});R.walk(Q)})}})}var F=new TreeTransformer(function H(R,V,Y){if(R instanceof AST_Function&&R.name&&!B.option("keep_fnames")){var P=R.name.definition();if(!(P.id in K)||P.orig.length>1){R.name=null}}if(R instanceof AST_Lambda&&!(R instanceof AST_Accessor)){var S=!B.option("keep_fargs");for(var X=R.argnames,U=X.length;--U>=0;){var Q=X[U];if(!(Q.definition().id in K)){Q.__unused=true;if(S){X.pop();B[Q.unreferenced()?"warn":"info"]("Dropping unused function argument {name} [{file}:{line},{col}]",{name:Q.name,file:Q.start.file,line:Q.start.line,col:Q.start.col})}}else{S=false}}}if(C&&R instanceof AST_Defun&&R!==N){if(!(R.name.definition().id in K)){B[R.name.unreferenced()?"warn":"info"]("Dropping unused function {name} [{file}:{line},{col}]",{name:R.name.name,file:R.name.start.file,line:R.name.start.line,col:R.name.start.col});return h(AST_EmptyStatement,R)}return R}if(G&&R instanceof AST_Definitions&&!(F.parent() instanceof AST_ForIn&&F.parent().init===R)){var P=R.definitions.filter(function(ab){if(ab.value){ab.value=ab.value.transform(F)}var aa=ab.name.definition();if(aa.id in K){return true}if(aa.orig[0] instanceof AST_SymbolCatch){ab.value=ab.value&&ab.value.drop_side_effect_free(B);return true}var Z={name:ab.name.name,file:ab.name.start.file,line:ab.name.start.line,col:ab.name.start.col};if(ab.value&&(ab._unused_side_effects=ab.value.drop_side_effect_free(B))){B.warn("Side effects in initialization of unused variable {name} [{file}:{line},{col}]",Z);return true}B[ab.name.unreferenced()?"warn":"info"]("Dropping unused variable {name} [{file}:{line},{col}]",Z);return false});P=mergeSort(P,function(aa,Z){if(!aa.value&&Z.value){return -1}if(!Z.value&&aa.value){return 1}return 0});var O=[];for(var U=0;U<P.length;){var W=P[U];if(W._unused_side_effects){O.push(W._unused_side_effects);P.splice(U,1)}else{if(O.length>0){O.push(W.value);W.value=AST_Seq.from_array(O);O=[]}++U}}if(O.length>0){O=h(AST_BlockStatement,R,{body:[h(AST_SimpleStatement,R,{body:AST_Seq.from_array(O)})]})}else{O=null}if(P.length==0&&!O){return h(AST_EmptyStatement,R)}if(P.length==0){return Y?MAP.splice(O.body):O}R.definitions=P;if(O){O.body.unshift(R);return Y?MAP.splice(O.body):O}return R}if(G&&I&&R instanceof AST_Assign&&R.operator=="="&&R.left instanceof AST_SymbolRef){var P=R.left.definition();if(!(P.id in K)&&N.variables.get(P.name)===P){return s(F.parent(),R,R.right.transform(F))}}if(R instanceof AST_For){V(R,this);if(R.init instanceof AST_BlockStatement){var T=R.init;R.init=T.body.pop();T.body.push(R);return Y?MAP.splice(T.body):T}else{if(z(R.init)){R.init=null}}return R}if(R instanceof AST_LabeledStatement&&R.body instanceof AST_For){V(R,this);if(R.body instanceof AST_BlockStatement){var T=R.body;R.body=T.body.pop();T.body.push(R);return Y?MAP.splice(T.body):T}return R}if(R instanceof AST_Scope&&R!==N){return R}});N.transform(F)}});AST_Scope.DEFMETHOD("hoist_declarations",function(I){var L=this;if(I.has_directive("use asm")){return L}var O=I.option("hoist_funs");var E=I.option("hoist_vars");if(O||E){var D=[];var P=[];var M=new Dictionary(),K=0,F=0;L.walk(new TreeWalker(function(S){if(S instanceof AST_Scope&&S!==L){return true}if(S instanceof AST_Var){++F;return true}}));E=E&&F>1;var A=new TreeTransformer(function H(T){if(T!==L){if(T instanceof AST_Directive){D.push(T);return h(AST_EmptyStatement,T)}if(T instanceof AST_Defun&&O){P.push(T);return h(AST_EmptyStatement,T)}if(T instanceof AST_Var&&E){T.definitions.forEach(function(W){M.set(W.name.name,W);++K});var S=T.to_assignments(I);var V=A.parent();if(V instanceof AST_ForIn&&V.init===T){if(S==null){var U=T.definitions[0].name;return h(AST_SymbolRef,U,U)}return S}if(V instanceof AST_For&&V.init===T){return S}if(!S){return h(AST_EmptyStatement,T)}return h(AST_SimpleStatement,T,{body:S})}if(T instanceof AST_Scope){return T}}});L=L.transform(A);if(K>0){var B=[];M.each(function(T,S){if(L instanceof AST_Lambda&&find_if(function(U){return U.name==T.name.name},L.argnames)){M.del(S)}else{T=T.clone();T.value=null;B.push(T);M.set(S,T)}});if(B.length>0){for(var Q=0;Q<L.body.length;){if(L.body[Q] instanceof AST_SimpleStatement){var C=L.body[Q].body,G,N;if(C instanceof AST_Assign&&C.operator=="="&&(G=C.left) instanceof AST_Symbol&&M.has(G.name)){var J=M.get(G.name);if(J.value){break}J.value=C.right;remove(B,J);B.push(J);L.body.splice(Q,1);continue}if(C instanceof AST_Seq&&(N=C.car) instanceof AST_Assign&&N.operator=="="&&(G=N.left) instanceof AST_Symbol&&M.has(G.name)){var J=M.get(G.name);if(J.value){break}J.value=N.right;remove(B,J);B.push(J);L.body[Q].body=C.cdr;continue}}if(L.body[Q] instanceof AST_EmptyStatement){L.body.splice(Q,1);continue}if(L.body[Q] instanceof AST_BlockStatement){var R=[Q,1].concat(L.body[Q].body);L.body.splice.apply(L.body,R);continue}break}B=h(AST_Var,L,{definitions:B});P.push(B)}}L.body=D.concat(P,L.body)}return L});(function(B){function A(D,J,H){var E=[],I=false;for(var F=0,C=D.length;F<C;F++){var G=D[F].drop_side_effect_free(J,H);I|=G!==D[F];if(G){E.push(G);H=false}}return I?E.length?E:null:D}B(AST_Node,return_this);B(AST_Constant,return_null);B(AST_This,return_null);B(AST_Call,function(F,E){if(!this.has_pure_annotation(F)&&F.pure_funcs(this)){if(this.expression instanceof AST_Function&&(!this.expression.name||!this.expression.name.definition().references.length)){var D=this.clone();D.expression=D.expression.process_expression(false,F);return D}return this}if(this.pure){F.warn("Dropping __PURE__ call [{file}:{line},{col}]",this.start);this.pure.value=this.pure.value.replace(/[@#]__PURE__/g," ")}var C=A(this.args,F,E);return C&&AST_Seq.from_array(C)});B(AST_Accessor,return_null);B(AST_Function,return_null);B(AST_Binary,function(G,E){var C=this.right.drop_side_effect_free(G);if(!C){return this.left.drop_side_effect_free(G,E)}switch(this.operator){case"&&":case"||":if(C===this.right){return this}var D=this.clone();D.right=C;return D;default:var F=this.left.drop_side_effect_free(G,E);if(!F){return this.right.drop_side_effect_free(G,E)}return h(AST_Seq,this,{car:F,cdr:C})}});B(AST_Assign,return_this);B(AST_Conditional,function(F){var E=this.consequent.drop_side_effect_free(F);var C=this.alternative.drop_side_effect_free(F);if(E===this.consequent&&C===this.alternative){return this}if(!E){return C?h(AST_Binary,this,{operator:"||",left:this.condition,right:C}):this.condition.drop_side_effect_free(F)}if(!C){return h(AST_Binary,this,{operator:"&&",left:this.condition,right:E})}var D=this.clone();D.consequent=E;D.alternative=C;return D});B(AST_Unary,function(E,C){if(q(this.operator)){return this}if(this.operator=="typeof"&&this.expression instanceof AST_SymbolRef){return null}var D=this.expression.drop_side_effect_free(E,C);if(C&&this instanceof AST_UnaryPrefix&&i(D)){if(D===this.expression&&this.operator.length===1){return this}return h(AST_UnaryPrefix,this,{operator:this.operator.length===1?this.operator:"!",expression:D})}return D});B(AST_SymbolRef,function(){return this.undeclared()?this:null});B(AST_Object,function(E,D){var C=A(this.properties,E,D);return C&&AST_Seq.from_array(C)});B(AST_ObjectProperty,function(D,C){return this.value.drop_side_effect_free(D,C)});B(AST_Array,function(E,D){var C=A(this.elements,E,D);return C&&AST_Seq.from_array(C)});B(AST_Dot,function(D,C){if(this.expression.may_throw_on_access(D)){return this}return this.expression.drop_side_effect_free(D,C)});B(AST_Sub,function(F,D){if(this.expression.may_throw_on_access(F)){return this}var E=this.expression.drop_side_effect_free(F,D);if(!E){return this.property.drop_side_effect_free(F,D)}var C=this.property.drop_side_effect_free(F);if(!C){return E}return h(AST_Seq,this,{car:E,cdr:C})});B(AST_Seq,function(D){var C=this.cdr.drop_side_effect_free(D);if(C===this.cdr){return this}if(!C){return this.car}return h(AST_Seq,this,{car:this.car,cdr:C})})})(function(B,A){B.DEFMETHOD("drop_side_effect_free",A)});j(AST_SimpleStatement,function(B,D){if(D.option("side_effects")){var A=B.body;var C=A.drop_side_effect_free(D,true);if(!C){D.warn("Dropping side-effect-free statement [{file}:{line},{col}]",B.start);return h(AST_EmptyStatement,B)}if(C!==A){return h(AST_SimpleStatement,B,{body:C})}}return B});j(AST_DWLoop,function(C,G){if(!G.option("loops")){return C}var F=C.condition.evaluate(G);if(F!==C.condition){if(F){return h(AST_For,C,{body:C.body})}if(G.option("dead_code")&&C instanceof AST_While){var A=[];e(G,C.body,A);return h(AST_BlockStatement,C,{body:A}).optimize(G)}if(C instanceof AST_Do){var D=false;var B=new TreeWalker(function(H){if(H instanceof AST_Scope||D){return true}if(H instanceof AST_LoopControl&&B.loopcontrol_target(H)===C){return D=true}});var E=G.parent();(E instanceof AST_LabeledStatement?E:C).walk(B);if(!D){return C.body}}}if(C instanceof AST_While){return h(AST_For,C,C).optimize(G)}return C});function x(A,D){function B(E){E=d(E);if(A.body instanceof AST_BlockStatement){A.body=A.body.clone();A.body.body=E.concat(A.body.body.slice(1));A.body=A.body.transform(D)}else{A.body=h(AST_BlockStatement,A.body,{body:E}).transform(D)}x(A,D)}var C=A.body instanceof AST_BlockStatement?A.body.body[0]:A.body;if(C instanceof AST_If){if(C.body instanceof AST_Break&&D.loopcontrol_target(C.body)===D.self()){if(A.condition){A.condition=h(AST_Binary,A.condition,{left:A.condition,operator:"&&",right:C.condition.negate(D)})}else{A.condition=C.condition.negate(D)}B(C.alternative)}else{if(C.alternative instanceof AST_Break&&D.loopcontrol_target(C.alternative)===D.self()){if(A.condition){A.condition=h(AST_Binary,A.condition,{left:A.condition,operator:"&&",right:C.condition})}else{A.condition=C.condition}B(C.body)}}}}j(AST_For,function(B,D){if(!D.option("loops")){return B}if(B.condition){var C=B.condition.evaluate(D);if(D.option("dead_code")&&!C){var A=[];if(B.init instanceof AST_Statement){A.push(B.init)}else{if(B.init){A.push(h(AST_SimpleStatement,B.init,{body:B.init}))}}e(D,B.body,A);return h(AST_BlockStatement,B,{body:A}).optimize(D)}if(C!==B.condition){C=a(C,B.condition).transform(D);B.condition=b(C,B.condition)}}x(B,D);return B});j(AST_If,function(K,E){if(z(K.alternative)){K.alternative=null}if(!E.option("conditionals")){return K}var H=K.condition.evaluate(E);if(H!==K.condition){if(H){E.warn("Condition always true [{file}:{line},{col}]",K.condition.start);if(E.option("dead_code")){var I=[];if(K.alternative){e(E,K.alternative,I)}I.push(K.body);return h(AST_BlockStatement,K,{body:I}).optimize(E)}}else{E.warn("Condition always false [{file}:{line},{col}]",K.condition.start);if(E.option("dead_code")){var I=[];e(E,K.body,I);if(K.alternative){I.push(K.alternative)}return h(AST_BlockStatement,K,{body:I}).optimize(E)}}H=a(H,K.condition).transform(E);K.condition=b(H,K.condition)}var A=K.condition.negate(E);var B=K.condition.print_to_string().length;var J=A.print_to_string().length;var C=J<B;if(K.alternative&&C){C=false;K.condition=A;var D=K.body;K.body=K.alternative||h(AST_EmptyStatement,K);K.alternative=D}if(z(K.body)&&z(K.alternative)){return h(AST_SimpleStatement,K.condition,{body:K.condition.clone()}).optimize(E)}if(K.body instanceof AST_SimpleStatement&&K.alternative instanceof AST_SimpleStatement){return h(AST_SimpleStatement,K,{body:h(AST_Conditional,K,{condition:K.condition,consequent:K.body.body,alternative:K.alternative.body})}).optimize(E)}if(z(K.alternative)&&K.body instanceof AST_SimpleStatement){if(B===J&&!C&&K.condition instanceof AST_Binary&&K.condition.operator=="||"){C=true}if(C){return h(AST_SimpleStatement,K,{body:h(AST_Binary,K,{operator:"||",left:A,right:K.body.body})}).optimize(E)}return h(AST_SimpleStatement,K,{body:h(AST_Binary,K,{operator:"&&",left:K.condition,right:K.body.body})}).optimize(E)}if(K.body instanceof AST_EmptyStatement&&K.alternative instanceof AST_SimpleStatement){return h(AST_SimpleStatement,K,{body:h(AST_Binary,K,{operator:"||",left:K.condition,right:K.alternative.body})}).optimize(E)}if(K.body instanceof AST_Exit&&K.alternative instanceof AST_Exit&&K.body.TYPE==K.alternative.TYPE){return h(K.body.CTOR,K,{value:h(AST_Conditional,K,{condition:K.condition,consequent:K.body.value||h(AST_Undefined,K.body),alternative:K.alternative.value||h(AST_Undefined,K.alternative)}).transform(E)}).optimize(E)}if(K.body instanceof AST_If&&!K.body.alternative&&!K.alternative){K=h(AST_If,K,{condition:h(AST_Binary,K.condition,{operator:"&&",left:K.condition,right:K.body.condition}),body:K.body.body,alternative:null})}if(y(K.body)){if(K.alternative){var F=K.alternative;K.alternative=null;return h(AST_BlockStatement,K,{body:[K,F]}).optimize(E)}}if(y(K.alternative)){var G=K.body;K.body=K.alternative;K.condition=C?A:K.condition.negate(E);K.alternative=null;return h(AST_BlockStatement,K,{body:[K,G]}).optimize(E)}return K});j(AST_Switch,function(J,G){if(!G.option("switches")){return J}var A;var N=J.expression.evaluate(G);if(N!==J.expression){var H=a(N,J.expression).transform(G);J.expression=b(H,J.expression)}if(!G.option("dead_code")){return J}var C=[];var F=[];var K;var B;for(var O=0,P=J.body.length;O<P&&!B;O++){A=J.body[O];if(A instanceof AST_Default){if(!K){K=A}else{D(A,F[F.length-1])}}else{if(N!==J.expression){var E=A.expression.evaluate(G);if(E===N){B=A;if(K){var I=F.indexOf(K);F.splice(I,1);D(K,F[I-1]);K=null}}else{if(E!==A.expression){D(A,F[F.length-1]);continue}}}}if(y(A)){var L=F[F.length-1];if(y(L)&&L.body.length==A.body.length&&h(AST_BlockStatement,L,L).equivalent_to(h(AST_BlockStatement,A,A))){L.body=[]}}F.push(A)}while(O<P){D(J.body[O++],F[F.length-1])}if(F.length>0){F[0].body=C.concat(F[0].body)}J.body=F;while(A=F[F.length-1]){var Q=A.body[A.body.length-1];if(Q instanceof AST_Break&&G.loopcontrol_target(Q)===J){A.body.pop()}if(A.body.length||A instanceof AST_Case&&(K||A.expression.has_side_effects(G))){break}if(F.pop()===K){K=null}}if(F.length==0){return h(AST_BlockStatement,J,{body:C.concat(h(AST_SimpleStatement,J.expression,{body:J.expression}))}).optimize(G)}if(F.length==1&&(F[0]===B||F[0]===K)){var M=false;var R=new TreeWalker(function(S){if(M||S instanceof AST_Lambda||S instanceof AST_SimpleStatement){return true}if(S instanceof AST_Break&&R.loopcontrol_target(S)===J){M=true}});J.walk(R);if(!M){F=F[0].body.slice();F.unshift(h(AST_SimpleStatement,J.expression,{body:J.expression}));return h(AST_BlockStatement,J,{body:F}).optimize(G)}}return J;function D(S,T){if(T&&!y(T)){T.body=T.body.concat(S.body)}else{e(G,S,C)}}});j(AST_Try,function(B,C){B.body=l(B.body,C);if(B.bcatch&&B.bfinally&&all(B.bfinally.body,z)){B.bfinally=null}if(all(B.body,z)){var A=[];if(B.bcatch){e(C,B.bcatch,A)}if(B.bfinally){A=A.concat(B.bfinally.body)}return h(AST_BlockStatement,B,{body:A}).optimize(C)}return B});AST_Definitions.DEFMETHOD("remove_initializers",function(){this.definitions.forEach(function(A){A.value=null})});AST_Definitions.DEFMETHOD("to_assignments",function(C){var B=C.option("reduce_vars");var A=this.definitions.reduce(function(D,F){if(F.value){var E=h(AST_SymbolRef,F.name,F.name);D.push(h(AST_Assign,F,{operator:"=",left:E,right:F.value}));if(B){E.definition().fixed=false}}return D},[]);if(A.length==0){return null}return AST_Seq.from_array(A)});j(AST_Definitions,function(A,B){if(A.definitions.length==0){return h(AST_EmptyStatement,A)}return A});j(AST_Call,function(O,M){var I=O.expression;if(M.option("reduce_vars")&&I instanceof AST_SymbolRef){var N=I.definition();var D=I.fixed_value();if(D instanceof AST_Defun){N.fixed=D=h(AST_Function,D,D).clone(true)}if(D instanceof AST_Function){I=D;if(M.option("unused")&&N.references.length==1&&!(N.scope.uses_arguments&&N.orig[0] instanceof AST_SymbolFunarg)&&!N.scope.uses_eval&&M.find_parent(AST_Scope)===N.scope){O.expression=I}}}if(M.option("unused")&&I instanceof AST_Function&&!I.uses_arguments&&!I.uses_eval){var F=0,K=0;for(var S=0,U=O.args.length;S<U;S++){var T=S>=I.argnames.length;if(T||I.argnames[S].__unused){var R=O.args[S].drop_side_effect_free(M);if(R){O.args[F++]=R}else{if(!T){O.args[F++]=h(AST_Number,O.args[S],{value:0});continue}}}else{O.args[F++]=O.args[S]}K=F}O.args.length=K}if(M.option("unsafe")){if(I instanceof AST_SymbolRef&&I.undeclared()){switch(I.name){case"Array":if(O.args.length!=1){return h(AST_Array,O,{elements:O.args}).optimize(M)}break;case"Object":if(O.args.length==0){return h(AST_Object,O,{properties:[]})}break;case"String":if(O.args.length==0){return h(AST_String,O,{value:""})}if(O.args.length<=1){return h(AST_Binary,O,{left:O.args[0],operator:"+",right:h(AST_String,O,{value:""})}).optimize(M)}break;case"Number":if(O.args.length==0){return h(AST_Number,O,{value:0})}if(O.args.length==1){return h(AST_UnaryPrefix,O,{expression:O.args[0],operator:"+"}).optimize(M)}case"Boolean":if(O.args.length==0){return h(AST_False,O)}if(O.args.length==1){return h(AST_UnaryPrefix,O,{expression:h(AST_UnaryPrefix,O,{expression:O.args[0],operator:"!"}),operator:"!"}).optimize(M)}break;case"Function":if(O.args.length==0){return h(AST_Function,O,{argnames:[],body:[]})}if(all(O.args,function(Z){return Z instanceof AST_String})){try{var A="(function("+O.args.slice(0,-1).map(function(Z){return Z.value}).join(",")+"){"+O.args[O.args.length-1].value+"})()";var J=parse(A);J.figure_out_scope({screw_ie8:M.option("screw_ie8")});var W=new Compressor(M.options);J=J.transform(W);J.figure_out_scope({screw_ie8:M.option("screw_ie8")});J.mangle_names();var X;try{J.walk(new TreeWalker(function(Z){if(Z instanceof AST_Lambda){X=Z;throw J}}))}catch(V){if(V!==J){throw V}}if(!X){return O}var B=X.argnames.map(function(Z,aa){return h(AST_String,O.args[aa],{value:Z.print_to_string()})});var A=OutputStream();AST_BlockStatement.prototype._codegen.call(X,X,A);A=A.toString().replace(/^\{|\}$/g,"");B.push(h(AST_String,O.args[O.args.length-1],{value:A}));O.args=B;return O}catch(V){if(V instanceof JS_Parse_Error){M.warn("Error parsing code passed to new Function [{file}:{line},{col}]",O.args[O.args.length-1].start);M.warn(V.toString())}else{console.log(V);throw V}}}break}}else{if(I instanceof AST_Dot&&I.property=="toString"&&O.args.length==0){return h(AST_Binary,O,{left:h(AST_String,O,{value:""}),operator:"+",right:I.expression}).optimize(M)}else{if(I instanceof AST_Dot&&I.expression instanceof AST_Array&&I.property=="join"){EXIT:{var C;if(O.args.length>0){C=O.args[0].evaluate(M);if(C===O.args[0]){break EXIT}}var L=[];var P=[];I.expression.elements.forEach(function(Z){var aa=Z.evaluate(M);if(aa!==Z){P.push(aa)}else{if(P.length>0){L.push(h(AST_String,O,{value:P.join(C)}));P.length=0}L.push(Z)}});if(P.length>0){L.push(h(AST_String,O,{value:P.join(C)}))}if(L.length==0){return h(AST_String,O,{value:""})}if(L.length==1){if(L[0].is_string(M)){return L[0]}return h(AST_Binary,L[0],{operator:"+",left:h(AST_String,O,{value:""}),right:L[0]})}if(C==""){var H;if(L[0].is_string(M)||L[1].is_string(M)){H=L.shift()}else{H=h(AST_String,O,{value:""})}return L.reduce(function(aa,Z){return h(AST_Binary,Z,{operator:"+",left:aa,right:Z})},H).optimize(M)}var R=O.clone();R.expression=R.expression.clone();R.expression.expression=R.expression.expression.clone();R.expression.expression.elements=L;return p(M,O,R)}}else{if(I instanceof AST_Dot&&I.expression.is_string(M)&&I.property=="charAt"){var E=O.args[0];var G=E?E.evaluate(M):0;if(G!==E){return h(AST_Sub,I,{expression:I.expression,property:a(G|0,E||I)}).optimize(M)}}}}}}if(I instanceof AST_Function){if(I.body[0] instanceof AST_Return){var Q=I.body[0].value;if(!Q||Q.is_constant()){var B=O.args.concat(Q||h(AST_Undefined,O));return AST_Seq.from_array(B).transform(M)}}if(M.option("side_effects")&&all(I.body,z)){var B=O.args.concat(h(AST_Undefined,O));return AST_Seq.from_array(B).transform(M)}}if(M.option("drop_console")){if(I instanceof AST_PropAccess){var Y=I.expression;while(Y.expression){Y=Y.expression}if(Y instanceof AST_SymbolRef&&Y.name=="console"&&Y.undeclared()){return h(AST_Undefined,O).optimize(M)}}}if(M.option("negate_iife")&&M.parent() instanceof AST_SimpleStatement&&i(O)){return O.negate(M,true)}return O});j(AST_New,function(A,C){if(C.option("unsafe")){var B=A.expression;if(B instanceof AST_SymbolRef&&B.undeclared()){switch(B.name){case"Object":case"RegExp":case"Function":case"Error":case"Array":return h(AST_Call,A,A).transform(C)}}}return A});j(AST_Seq,function(B,G){if(!G.option("side_effects")){return B}B.car=B.car.drop_side_effect_free(G,first_in_statement(G));if(!B.car){return s(G.parent(),B,B.cdr)}if(G.option("cascade")){var F;if(B.car instanceof AST_Assign&&!B.car.left.has_side_effects(G)){F=B.car.left}else{if(B.car instanceof AST_Unary&&(B.car.operator=="++"||B.car.operator=="--")){F=B.car.expression}}if(F&&!(F instanceof AST_SymbolRef&&(F.definition().orig[0] instanceof AST_SymbolLambda||w(F)))){var C,E;var D=B.cdr;while(true){if(D.equivalent_to(F)){var A=B.car instanceof AST_UnaryPostfix?h(AST_UnaryPrefix,B.car,{operator:B.car.operator,expression:F}):B.car;if(C){C[E]=A;return B.cdr}return A}if(D instanceof AST_Binary&&!(D instanceof AST_Assign)){if(D.left.is_constant()){if(D.operator=="||"||D.operator=="&&"){break}E="right"}else{E="left"}}else{if(D instanceof AST_Call||D instanceof AST_Unary&&!q(D.operator)){E="expression"}else{break}}C=D;D=D[E]}}}if(u(B.cdr,G)){return h(AST_UnaryPrefix,B,{operator:"void",expression:B.car})}return B});AST_Unary.DEFMETHOD("lift_sequences",function(D){if(D.option("sequences")){if(this.expression instanceof AST_Seq){var B=this.expression;var A=B.to_array();var C=this.clone();C.expression=A.pop();A.push(C);B=AST_Seq.from_array(A).transform(D);return B}}return this});j(AST_UnaryPostfix,function(A,B){return A.lift_sequences(B)});j(AST_UnaryPrefix,function(B,E){var D=B.expression;if(B.operator=="delete"&&!(D instanceof AST_SymbolRef||D instanceof AST_PropAccess||D instanceof AST_NaN||D instanceof AST_Infinity||D instanceof AST_Undefined)){if(D instanceof AST_Seq){D=D.to_array();D.push(h(AST_True,B));return AST_Seq.from_array(D).optimize(E)}return h(AST_Seq,B,{car:D,cdr:h(AST_True,B)}).optimize(E)}var A=B.lift_sequences(E);if(A!==B){return A}if(E.option("side_effects")&&B.operator=="void"){D=D.drop_side_effect_free(E);if(D){B.expression=D;return B}else{return h(AST_Undefined,B).optimize(E)}}if(E.option("booleans")&&E.in_boolean_context()){switch(B.operator){case"!":if(D instanceof AST_UnaryPrefix&&D.operator=="!"){return D.expression}if(D instanceof AST_Binary){B=p(E,B,D.negate(E,first_in_statement(E)))}break;case"typeof":E.warn("Boolean expression always true [{file}:{line},{col}]",B.start);return(D instanceof AST_SymbolRef?h(AST_True,B):h(AST_Seq,B,{car:D,cdr:h(AST_True,B)})).optimize(E)}}if(B.operator=="-"&&D instanceof AST_Infinity){D=D.transform(E)}if(D instanceof AST_Binary&&(B.operator=="+"||B.operator=="-")&&(D.operator=="*"||D.operator=="/"||D.operator=="%")){return h(AST_Binary,B,{operator:D.operator,left:h(AST_UnaryPrefix,D.left,{operator:B.operator,expression:D.left}),right:D.right})}if(B.operator!="-"||!(D instanceof AST_Number||D instanceof AST_Infinity)){var C=B.evaluate(E);if(C!==B){C=a(C,B).optimize(E);return p(E,C,B)}}return B});AST_Binary.DEFMETHOD("lift_sequences",function(G){if(G.option("sequences")){if(this.left instanceof AST_Seq){var D=this.left;var A=D.to_array();var E=this.clone();E.left=A.pop();A.push(E);return AST_Seq.from_array(A).optimize(G)}if(this.right instanceof AST_Seq&&!this.left.has_side_effects(G)){var C=this.operator=="="&&this.left instanceof AST_SymbolRef;var B=this.right.clone();var F,D=B;while(C||!D.car.has_side_effects(G)){F=D;if(D.cdr instanceof AST_Seq){D=D.cdr=D.cdr.clone()}else{break}}if(F){var E=this.clone();E.right=F.cdr;F.cdr=E;return B.optimize(G)}}}return this});var o=makePredicate("== === != !== * & | ^");j(AST_Binary,function(K,F){function B(){return K.left.is_constant()||K.right.is_constant()||!K.left.has_side_effects(F)&&!K.right.has_side_effects(F)}function G(M){if(B()){if(M){K.operator=M}var L=K.left;K.left=K.right;K.right=L}}if(o(K.operator)){if(K.right.is_constant()&&!K.left.is_constant()){if(!(K.left instanceof AST_Binary&&PRECEDENCE[K.left.operator]>=PRECEDENCE[K.operator])){G()}}}K=K.lift_sequences(F);if(F.option("comparisons")){switch(K.operator){case"===":case"!==":if((K.left.is_string(F)&&K.right.is_string(F))||(K.left.is_number(F)&&K.right.is_number(F))||(K.left.is_boolean()&&K.right.is_boolean())){K.operator=K.operator.substr(0,2)}case"==":case"!=":if(K.left instanceof AST_String&&K.left.value=="undefined"&&K.right instanceof AST_UnaryPrefix&&K.right.operator=="typeof"){var J=K.right.expression;if(J instanceof AST_SymbolRef?!J.undeclared():!(J instanceof AST_PropAccess)||F.option("screw_ie8")){K.right=J;K.left=h(AST_Undefined,K.left).optimize(F);if(K.operator.length==2){K.operator+="="}}}break}}if(F.option("booleans")&&K.operator=="+"&&F.in_boolean_context()){var I=K.left.evaluate(F);var D=K.right.evaluate(F);if(I&&typeof I=="string"){F.warn("+ in boolean context always true [{file}:{line},{col}]",K.start);return h(AST_Seq,K,{car:K.right,cdr:h(AST_True,K)}).optimize(F)}if(D&&typeof D=="string"){F.warn("+ in boolean context always true [{file}:{line},{col}]",K.start);return h(AST_Seq,K,{car:K.left,cdr:h(AST_True,K)}).optimize(F)}}if(F.option("comparisons")&&K.is_boolean()){if(!(F.parent() instanceof AST_Binary)||F.parent() instanceof AST_Assign){var A=h(AST_UnaryPrefix,K,{operator:"!",expression:K.negate(F,first_in_statement(F))});K=p(F,K,A)}if(F.option("unsafe_comps")){switch(K.operator){case"<":G(">");break;case"<=":G(">=");break}}}if(K.operator=="+"){if(K.right instanceof AST_String&&K.right.getValue()==""&&K.left.is_string(F)){return K.left}if(K.left instanceof AST_String&&K.left.getValue()==""&&K.right.is_string(F)){return K.right}if(K.left instanceof AST_Binary&&K.left.operator=="+"&&K.left.left instanceof AST_String&&K.left.left.getValue()==""&&K.right.is_string(F)){K.left=K.left.right;return K.transform(F)}}if(F.option("evaluate")){switch(K.operator){case"&&":var I=K.left.evaluate(F);if(!I){F.warn("Condition left of && always false [{file}:{line},{col}]",K.start);return s(F.parent(),K,K.left).optimize(F)}else{if(I!==K.left){F.warn("Condition left of && always true [{file}:{line},{col}]",K.start);return s(F.parent(),K,K.right).optimize(F)}}if(F.option("booleans")&&F.in_boolean_context()){var D=K.right.evaluate(F);if(!D){F.warn("Boolean && always false [{file}:{line},{col}]",K.start);return h(AST_Seq,K,{car:K.left,cdr:h(AST_False,K)}).optimize(F)}else{if(D!==K.right){F.warn("Dropping side-effect-free && in boolean context [{file}:{line},{col}]",K.start);return K.left.optimize(F)}}}break;case"||":var I=K.left.evaluate(F);if(!I){F.warn("Condition left of || always false [{file}:{line},{col}]",K.start);return s(F.parent(),K,K.right).optimize(F)}else{if(I!==K.left){F.warn("Condition left of || always true [{file}:{line},{col}]",K.start);return s(F.parent(),K,K.left).optimize(F)}}if(F.option("booleans")&&F.in_boolean_context()){var D=K.right.evaluate(F);if(!D){F.warn("Dropping side-effect-free || in boolean context [{file}:{line},{col}]",K.start);return K.left.optimize(F)}else{if(D!==K.right){F.warn("Boolean || always true [{file}:{line},{col}]",K.start);return h(AST_Seq,K,{car:K.left,cdr:h(AST_True,K)}).optimize(F)}}}break}var C=true;switch(K.operator){case"+":if(K.left instanceof AST_Constant&&K.right instanceof AST_Binary&&K.right.operator=="+"&&K.right.left instanceof AST_Constant&&K.right.is_string(F)){K=h(AST_Binary,K,{operator:"+",left:h(AST_String,K.left,{value:""+K.left.getValue()+K.right.left.getValue(),start:K.left.start,end:K.right.left.end}),right:K.right.right})}if(K.right instanceof AST_Constant&&K.left instanceof AST_Binary&&K.left.operator=="+"&&K.left.right instanceof AST_Constant&&K.left.is_string(F)){K=h(AST_Binary,K,{operator:"+",left:K.left.left,right:h(AST_String,K.right,{value:""+K.left.right.getValue()+K.right.getValue(),start:K.left.right.start,end:K.right.end})})}if(K.left instanceof AST_Binary&&K.left.operator=="+"&&K.left.is_string(F)&&K.left.right instanceof AST_Constant&&K.right instanceof AST_Binary&&K.right.operator=="+"&&K.right.left instanceof AST_Constant&&K.right.is_string(F)){K=h(AST_Binary,K,{operator:"+",left:h(AST_Binary,K.left,{operator:"+",left:K.left.left,right:h(AST_String,K.left.right,{value:""+K.left.right.getValue()+K.right.left.getValue(),start:K.left.right.start,end:K.right.left.end})}),right:K.right.right})}if(K.right instanceof AST_UnaryPrefix&&K.right.operator=="-"&&K.left.is_number(F)){K=h(AST_Binary,K,{operator:"-",left:K.left,right:K.right.expression});break}if(K.left instanceof AST_UnaryPrefix&&K.left.operator=="-"&&B()&&K.right.is_number(F)){K=h(AST_Binary,K,{operator:"-",left:K.right,right:K.left.expression});break}case"*":C=F.option("unsafe_math");case"&":case"|":case"^":if(K.left.is_number(F)&&K.right.is_number(F)&&B()&&!(K.left instanceof AST_Binary&&K.left.operator!=K.operator&&PRECEDENCE[K.left.operator]>=PRECEDENCE[K.operator])){var E=h(AST_Binary,K,{operator:K.operator,left:K.right,right:K.left});if(K.right instanceof AST_Constant&&!(K.left instanceof AST_Constant)){K=p(F,E,K)}else{K=p(F,K,E)}}if(C&&K.is_number(F)){if(K.right instanceof AST_Binary&&K.right.operator==K.operator){K=h(AST_Binary,K,{operator:K.operator,left:h(AST_Binary,K.left,{operator:K.operator,left:K.left,right:K.right.left,start:K.left.start,end:K.right.left.end}),right:K.right.right})}if(K.right instanceof AST_Constant&&K.left instanceof AST_Binary&&K.left.operator==K.operator){if(K.left.left instanceof AST_Constant){K=h(AST_Binary,K,{operator:K.operator,left:h(AST_Binary,K.left,{operator:K.operator,left:K.left.left,right:K.right,start:K.left.left.start,end:K.right.end}),right:K.left.right})}else{if(K.left.right instanceof AST_Constant){K=h(AST_Binary,K,{operator:K.operator,left:h(AST_Binary,K.left,{operator:K.operator,left:K.left.right,right:K.right,start:K.left.right.start,end:K.right.end}),right:K.left.left})}}}if(K.left instanceof AST_Binary&&K.left.operator==K.operator&&K.left.right instanceof AST_Constant&&K.right instanceof AST_Binary&&K.right.operator==K.operator&&K.right.left instanceof AST_Constant){K=h(AST_Binary,K,{operator:K.operator,left:h(AST_Binary,K.left,{operator:K.operator,left:h(AST_Binary,K.left.left,{operator:K.operator,left:K.left.right,right:K.right.left,start:K.left.right.start,end:K.right.left.end}),right:K.left.left}),right:K.right.right})}}}}if(K.right instanceof AST_Binary&&K.right.operator==K.operator&&(K.operator=="&&"||K.operator=="||"||(K.operator=="+"&&(K.right.left.is_string(F)||(K.left.is_string(F)&&K.right.right.is_string(F)))))){K.left=h(AST_Binary,K.left,{operator:K.operator,left:K.left,right:K.right.left});K.right=K.right.right;return K.transform(F)}var H=K.evaluate(F);if(H!==K){H=a(H,K).optimize(F);return p(F,H,K)}return K});j(AST_SymbolRef,function(K,E){var C=K.resolve_defines(E);if(C){return C.optimize(E)}if(E.option("screw_ie8")&&K.undeclared()&&(!K.scope.uses_with||!E.find_parent(AST_With))){switch(K.name){case"undefined":return h(AST_Undefined,K).optimize(E);case"NaN":return h(AST_NaN,K).optimize(E);case"Infinity":return h(AST_Infinity,K).optimize(E)}}if(E.option("evaluate")&&E.option("reduce_vars")&&r(K,E.parent())!==K){var F=K.definition();var D=K.fixed_value();if(D){if(F.should_replace===undefined){var J=D.evaluate(E);if(J!==D&&(E.option("unsafe_regexp")||!(J instanceof RegExp))){J=a(J,D);var H=J.optimize(E).print_to_string().length;var G;if(A(D)){G=function(){var L=J.optimize(E);return L===J?L.clone(true):L}}else{H=Math.min(H,D.print_to_string().length);G=function(){var L=b(J.optimize(E),D);return L===J||L===D?L.clone(true):L}}var B=F.name.length;var I=0;if(E.option("unused")&&(!F.global||E.option("toplevel"))){I=(B+2+H)/F.references.length}F.should_replace=H<=B+I?G:false}else{F.should_replace=false}}if(F.should_replace){return F.should_replace()}}}return K;function A(M){var L;M.walk(new TreeWalker(function(N){if(N instanceof AST_SymbolRef){L=true}if(L){return true}}));return L}});function t(A,B){return A instanceof AST_SymbolRef||A.TYPE===B.TYPE}j(AST_Undefined,function(B,E){if(E.option("unsafe")){var C=f(E,"undefined");if(C){var D=h(AST_SymbolRef,B,{name:"undefined",scope:C.scope,thedef:C});D.is_undefined=true;return D}}var A=r(E.self(),E.parent());if(A&&t(A,B)){return B}return h(AST_UnaryPrefix,B,{operator:"void",expression:h(AST_Number,B,{value:0})})});j(AST_Infinity,function(B,C){var A=r(C.self(),C.parent());if(A&&t(A,B)){return B}if(C.option("keep_infinity")&&!(A&&!t(A,B))&&!f(C,"Infinity")){return B}return h(AST_Binary,B,{operator:"/",left:h(AST_Number,B,{value:1}),right:h(AST_Number,B,{value:0})})});j(AST_NaN,function(B,C){var A=r(C.self(),C.parent());if(A&&!t(A,B)||f(C,"NaN")){return h(AST_Binary,B,{operator:"/",left:h(AST_Number,B,{value:0}),right:h(AST_Number,B,{value:0})})}return B});var v=["+","-","/","*","%",">>","<<",">>>","|","^","&"];var g=["*","|","^","&"];j(AST_Assign,function(A,B){A=A.lift_sequences(B);if(A.operator=="="&&A.left instanceof AST_SymbolRef&&A.right instanceof AST_Binary){if(A.right.left instanceof AST_SymbolRef&&A.right.left.name==A.left.name&&member(A.right.operator,v)){A.operator=A.right.operator+"=";A.right=A.right.right}else{if(A.right.right instanceof AST_SymbolRef&&A.right.right.name==A.left.name&&member(A.right.operator,g)&&!A.right.left.has_side_effects(B)){A.operator=A.right.operator+"=";A.right=A.right.left}}}return A});j(AST_Conditional,function(K,E){if(!E.option("conditionals")){return K}if(K.condition instanceof AST_Seq){var J=K.condition.car;K.condition=K.condition.cdr;return AST_Seq.cons(J,K)}var H=K.condition.evaluate(E);if(H!==K.condition){if(H){E.warn("Condition always true [{file}:{line},{col}]",K.start);return s(E.parent(),K,K.consequent)}else{E.warn("Condition always false [{file}:{line},{col}]",K.start);return s(E.parent(),K,K.alternative)}}var A=H.negate(E,first_in_statement(E));if(p(E,H,A)===A){K=h(AST_Conditional,K,{condition:A,consequent:K.alternative,alternative:K.consequent})}var C=K.condition;var F=K.consequent;var B=K.alternative;if(C instanceof AST_SymbolRef&&F instanceof AST_SymbolRef&&C.definition()===F.definition()){return h(AST_Binary,K,{operator:"||",left:C,right:B})}if(F instanceof AST_Assign&&B instanceof AST_Assign&&F.operator==B.operator&&F.left.equivalent_to(B.left)&&(!K.condition.has_side_effects(E)||F.operator=="="&&!F.left.has_side_effects(E))){return h(AST_Assign,K,{operator:F.operator,left:F.left,right:h(AST_Conditional,K,{condition:K.condition,consequent:F.right,alternative:B.right})})}if(F instanceof AST_Call&&B.TYPE===F.TYPE&&F.args.length==1&&B.args.length==1&&F.expression.equivalent_to(B.expression)&&!F.expression.has_side_effects(E)){F.args[0]=h(AST_Conditional,K,{condition:K.condition,consequent:F.args[0],alternative:B.args[0]});return F}if(F instanceof AST_Conditional&&F.alternative.equivalent_to(B)){return h(AST_Conditional,K,{condition:h(AST_Binary,K,{left:K.condition,operator:"&&",right:F.condition}),consequent:F.consequent,alternative:B})}if(F.equivalent_to(B)){return h(AST_Seq,K,{car:K.condition,cdr:F}).optimize(E)}if(D(K.consequent)){if(G(K.alternative)){return I(K.condition)}return h(AST_Binary,K,{operator:"||",left:I(K.condition),right:K.alternative})}if(G(K.consequent)){if(D(K.alternative)){return I(K.condition.negate(E))}return h(AST_Binary,K,{operator:"&&",left:I(K.condition.negate(E)),right:K.alternative})}if(D(K.alternative)){return h(AST_Binary,K,{operator:"||",left:I(K.condition.negate(E)),right:K.consequent})}if(G(K.alternative)){return h(AST_Binary,K,{operator:"&&",left:I(K.condition),right:K.consequent})}return K;function I(L){if(L.is_boolean()){return L}return h(AST_UnaryPrefix,L,{operator:"!",expression:L.negate(E)})}function D(L){return L instanceof AST_True||(L instanceof AST_UnaryPrefix&&L.operator=="!"&&L.expression instanceof AST_Constant&&!L.expression.value)}function G(L){return L instanceof AST_False||(L instanceof AST_UnaryPrefix&&L.operator=="!"&&L.expression instanceof AST_Constant&&!!L.expression.value)}});j(AST_Boolean,function(A,C){if(C.option("booleans")){var B=C.parent();if(B instanceof AST_Binary&&(B.operator=="=="||B.operator=="!=")){C.warn("Non-strict equality against boolean: {operator} {value} [{file}:{line},{col}]",{operator:B.operator,value:A.value,file:B.start.file,line:B.start.line,col:B.start.col});return h(AST_Number,A,{value:+A.value})}return h(AST_UnaryPrefix,A,{operator:"!",expression:h(AST_Number,A,{value:1-A.value})})}return A});j(AST_Sub,function(B,E){var D=B.property;if(D instanceof AST_String&&E.option("properties")){D=D.getValue();if(RESERVED_WORDS(D)?E.option("screw_ie8"):is_identifier_string(D)){return h(AST_Dot,B,{expression:B.expression,property:D}).optimize(E)}var A=parseFloat(D);if(!isNaN(A)&&A.toString()==D){B.property=h(AST_Number,B.property,{value:A})}}var C=B.evaluate(E);if(C!==B){C=a(C,B).optimize(E);return p(E,C,B)}return B});j(AST_Dot,function(A,F){var C=A.resolve_defines(F);if(C){return C.optimize(F)}var E=A.property;if(RESERVED_WORDS(E)&&!F.option("screw_ie8")){return h(AST_Sub,A,{expression:A.expression,property:h(AST_String,A,{value:E})}).optimize(F)}if(F.option("unsafe_proto")&&A.expression instanceof AST_Dot&&A.expression.property=="prototype"){var D=A.expression.expression;if(D instanceof AST_SymbolRef&&D.undeclared()){switch(D.name){case"Array":A.expression=h(AST_Array,A.expression,{elements:[]});break;case"Object":A.expression=h(AST_Object,A.expression,{properties:[]});break;case"String":A.expression=h(AST_String,A.expression,{value:""});break}}}var B=A.evaluate(F);if(B!==A){B=a(B,A).optimize(F);return p(F,B,A)}return A});function n(A,B){if(B.option("booleans")&&B.in_boolean_context()){return p(B,A,h(AST_Seq,A,{car:A,cdr:h(AST_True,A)}).optimize(B))}return A}j(AST_Array,n);j(AST_Object,n);j(AST_RegExp,n);j(AST_Return,function(A,B){if(A.value&&u(A.value,B)){A.value=null}return A});j(AST_VarDef,function(A,C){var B=C.option("global_defs");if(B&&HOP(B,A.name.name)){C.warn("global_defs "+A.name.name+" redefined [{file}:{line},{col}]",A.start)}return A})})();