var Resolver=require("./Resolver");var SyncAsyncFileSystemDecorator=require("./SyncAsyncFileSystemDecorator");var ParsePlugin=require("./ParsePlugin");var DescriptionFilePlugin=require("./DescriptionFilePlugin");var NextPlugin=require("./NextPlugin");var TryNextPlugin=require("./TryNextPlugin");var ModuleKindPlugin=require("./ModuleKindPlugin");var FileKindPlugin=require("./FileKindPlugin");var JoinRequestPlugin=require("./JoinRequestPlugin");var ModulesInHierachicDirectoriesPlugin=require("./ModulesInHierachicDirectoriesPlugin");var ModulesInRootPlugin=require("./ModulesInRootPlugin");var AliasPlugin=require("./AliasPlugin");var AliasFieldPlugin=require("./AliasFieldPlugin");var ConcordExtensionsPlugin=require("./ConcordExtensionsPlugin");var ConcordMainPlugin=require("./ConcordMainPlugin");var ConcordModulesPlugin=require("./ConcordModulesPlugin");var DirectoryExistsPlugin=require("./DirectoryExistsPlugin");var FileExistsPlugin=require("./FileExistsPlugin");var SymlinkPlugin=require("./SymlinkPlugin");var MainFieldPlugin=require("./MainFieldPlugin");var UseFilePlugin=require("./UseFilePlugin");var AppendPlugin=require("./AppendPlugin");var ResultPlugin=require("./ResultPlugin");var ModuleAppendPlugin=require("./ModuleAppendPlugin");var UnsafeCachePlugin=require("./UnsafeCachePlugin");exports.createResolver=function(d){var r=d.modules||["node_modules"];var g=d.descriptionFiles||["package.json"];var m=(d.plugins&&d.plugins.slice())||[];var n=d.mainFields||["main"];var j=d.aliasFields||[];var b=d.mainFiles||["index"];var s=d.extensions||[".js",".json",".node"];var l=d.enforceExtension||false;var c=d.moduleExtensions||[];var q=d.enforceModuleExtension||false;var k=d.alias||[];var a=typeof d.symlinks!=="undefined"?d.symlinks:true;var o=d.resolveToContext||false;var f=d.unsafeCache||false;var e=typeof d.cacheWithContext!=="undefined"?d.cacheWithContext:true;var i=d.cachePredicate||function(){return true};var p=d.fileSystem;var t=d.useSyncFileSystemCalls;var h=d.resolver;if(!h){h=new Resolver(t?new SyncAsyncFileSystemDecorator(p):p)}s=[].concat(s);c=[].concat(c);r=mergeFilteredToArray([].concat(r),function(u){return !isAbsolutePath(u)});n=n.map(function(u){if(typeof u==="string"){u={name:u,forceRelative:true}}return u});if(typeof k==="object"&&!Array.isArray(k)){k=Object.keys(k).map(function(u){var w=false;var v=k[u];if(/\$$/.test(u)){w=true;u=u.substr(0,u.length-1)}if(typeof v==="string"){v={alias:v}}v=Object.assign({name:u,onlyModule:w},v);return v})}if(f&&typeof f!=="object"){f={}}if(f){m.push(new UnsafeCachePlugin("resolve",i,f,e,"new-resolve"));m.push(new ParsePlugin("new-resolve","parsed-resolve"))}else{m.push(new ParsePlugin("resolve","parsed-resolve"))}m.push(new DescriptionFilePlugin("parsed-resolve",g,"described-resolve"));m.push(new NextPlugin("after-parsed-resolve","described-resolve"));k.forEach(function(u){m.push(new AliasPlugin("described-resolve",u,"resolve"))});m.push(new ConcordModulesPlugin("described-resolve",{},"resolve"));j.forEach(function(u){m.push(new AliasFieldPlugin("described-resolve",u,"resolve"))});m.push(new ModuleKindPlugin("after-described-resolve","raw-module"));m.push(new JoinRequestPlugin("after-described-resolve","relative"));c.forEach(function(u){m.push(new ModuleAppendPlugin("raw-module",u,"module"))});if(!q){m.push(new TryNextPlugin("raw-module",null,"module"))}r.forEach(function(u){if(Array.isArray(u)){m.push(new ModulesInHierachicDirectoriesPlugin("module",u,"resolve"))}else{m.push(new ModulesInRootPlugin("module",u,"resolve"))}});m.push(new DescriptionFilePlugin("relative",g,"described-relative"));m.push(new NextPlugin("after-relative","described-relative"));m.push(new FileKindPlugin("described-relative","raw-file"));m.push(new TryNextPlugin("described-relative","as directory","directory"));m.push(new DirectoryExistsPlugin("directory","existing-directory"));if(o){m.push(new NextPlugin("existing-directory","resolved"))}else{m.push(new ConcordMainPlugin("existing-directory",{},"resolve"));n.forEach(function(u){m.push(new MainFieldPlugin("existing-directory",u,"resolve"))});b.forEach(function(u){m.push(new UseFilePlugin("existing-directory",u,"undescribed-raw-file"))});m.push(new DescriptionFilePlugin("undescribed-raw-file",g,"raw-file"));m.push(new NextPlugin("after-undescribed-raw-file","raw-file"));if(!l){m.push(new TryNextPlugin("raw-file","no extension","file"))}m.push(new ConcordExtensionsPlugin("raw-file",{},"file"));s.forEach(function(u){m.push(new AppendPlugin("raw-file",u,"file"))});k.forEach(function(u){m.push(new AliasPlugin("file",u,"resolve"))});m.push(new ConcordModulesPlugin("file",{},"resolve"));j.forEach(function(u){m.push(new AliasFieldPlugin("file",u,"resolve"))});if(a){m.push(new SymlinkPlugin("file","relative"))}m.push(new FileExistsPlugin("file","existing-file"));m.push(new NextPlugin("existing-file","resolved"))}m.push(new ResultPlugin("resolved"));m.forEach(function(u){h.apply(u)});return h};function mergeFilteredToArray(b,a){return b.reduce(function(e,c){if(a(c)){var d=e[e.length-1];if(Array.isArray(d)){d.push(c)}else{e.push([c])}return e}else{e.push(c);return e}},[])}function isAbsolutePath(a){return/^[A-Z]:|^\//.test(a)};