var Tapable=require("tapable");var createInnerCallback=require("./createInnerCallback");function Resolver(a){Tapable.call(this);this.fileSystem=a}module.exports=Resolver;Resolver.prototype=Object.create(Tapable.prototype);Resolver.prototype.constructor=Resolver;Resolver.prototype.resolveSync=function resolveSync(b,f,e){var d,a,c=false;this.resolve(b,f,e,function(h,g){d=h;a=g;c=true});if(!c){throw new Error("Cannot 'resolveSync' because the fileSystem is not sync. Use 'resolve'!")}if(d){throw d}return a};Resolver.prototype.resolve=function resolve(a,m,d,k){if(arguments.length===3){throw new Error("Signature changed: context parameter added")}var b=this;var f={context:a,path:m,request:d};var i;var e;var l="resolve '"+d+"' in '"+m+"'";function h(n){e.push(n)}function c(){return e.join("\n")}function g(q,n){if(k.log){for(var p=0;p<e.length;p++){k.log(e[p])}}if(q){return k(q)}var o=new Error("Can't "+l);o.details=c();o.missing=i;b.applyPlugins("no-resolve",f,o);return k(o)}function j(o,n){if(!o&&n){return k(null,n.path===false?false:n.path+(n.query||""),n)}i=[];e=[];return b.doResolve("resolve",f,l,createInnerCallback(g,{log:h,missing:i,stack:k.stack}))}j.missing=k.missing;j.stack=k.stack;return this.doResolve("resolve",f,l,j)};Resolver.prototype.doResolve=function doResolve(i,d,n,m){var c=this;var l=i+": ("+d.path+") "+(d.request||"")+(d.query||"")+(d.directory?" directory":"")+(d.module?" module":"");var b=[l];if(m.stack){b=m.stack.concat(b);if(m.stack.indexOf(l)>=0){var a=new Error("Recursion in resolving\nStack:\n  "+b.join("\n  "));a.recursion=true;if(m.log){m.log("abort resolving because of recursion")}return m(a)}}c.applyPlugins("resolve-step",i,d);var f="before-"+i;if(c.hasPlugins(f)){c.applyPluginsAsyncSeriesBailResult1(f,d,createInnerCallback(e,{log:m.log,missing:m.missing,stack:b},n&&("before "+n),true))}else{k()}function e(p,o){if(arguments.length>0){if(p){return m(p)}if(o){return m(null,o)}return m()}k()}function k(){if(c.hasPlugins(i)){return c.applyPluginsAsyncSeriesBailResult1(i,d,createInnerCallback(g,{log:m.log,missing:m.missing,stack:b},n))}else{h()}}function g(p,o){if(arguments.length>0){if(p){return m(p)}if(o){return m(null,o)}return m()}h()}function h(){var o="after-"+i;if(c.hasPlugins(o)){return c.applyPluginsAsyncSeriesBailResult1(o,d,createInnerCallback(j,{log:m.log,missing:m.missing,stack:b},n&&("after "+n),true))}else{m()}}function j(p,o){if(arguments.length>0){if(p){return m(p)}if(o){return m(null,o)}return m()}return m()}};Resolver.prototype.parse=function parse(b){if(b===""){return null}var a={request:"",query:"",module:false,directory:false,file:false};var c=b.indexOf("?");if(c===0){a.query=b}else{if(c>0){a.request=b.slice(0,c);a.query=b.slice(c)}else{a.request=b}}if(a.request){a.module=this.isModule(a.request);a.directory=this.isDirectory(a.request);if(a.directory){a.request=a.request.substr(0,a.request.length-1)}}return a};var notModuleRegExp=/^\.$|^\.[\\\/]|^\.\.$|^\.\.[\/\\]|^\/|^[A-Z]:[\\\/]/i;Resolver.prototype.isModule=function isModule(a){return !notModuleRegExp.test(a)};var directoryRegExp=/[\/\\]$/i;Resolver.prototype.isDirectory=function isDirectory(a){return directoryRegExp.test(a)};var memoryFsJoin=require("memory-fs/lib/join");var memoizedJoin=new Map();Resolver.prototype.join=function(b,a){var c;var d=memoizedJoin.get(b);if(typeof d==="undefined"){memoizedJoin.set(b,d=new Map())}else{c=d.get(a);if(typeof c!=="undefined"){return c}}c=memoryFsJoin(b,a);d.set(a,c);return c};Resolver.prototype.normalize=require("memory-fs/lib/normalize");