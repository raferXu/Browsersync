function globToRegExp(d){if(/^\(.+\)$/.test(d)){return new RegExp(d.substr(1,d.length-2))}var c=tokenize(d);var b=createRoot();var a=c.map(b).join("");return new RegExp("^"+a+"$")}var SIMPLE_TOKENS={"@(":"one","?(":"zero-one","+(":"one-many","*(":"zero-many","|":"segment-sep","/**/":"any-path-segments","**":"any-path","*":"any-path-segment","?":"any-char","{":"or","/":"path-sep",",":"comma",")":"closing-segment","}":"closing-or"};function tokenize(a){return a.split(/([@?+*]\(|\/\*\*\/|\*\*|[?*]|\[[\!\^]?(?:[^\]\\]|\\.)+\]|\{|,|\/|[|)}])/g).map(function(c){if(!c){return null}var b=SIMPLE_TOKENS[c];if(b){return{type:b}}if(c[0]==="["){if(c[1]==="^"||c[1]==="!"){return{type:"inverted-char-set",value:c.substr(2,c.length-3)}}else{return{type:"char-set",value:c.substr(1,c.length-2)}}}return{type:"string",value:c}}).filter(Boolean).concat({type:"end"})}function createRoot(){var b=[];var c=createSeqment();var a=true;return function(e){switch(e.type){case"or":b.push(a);return"(";case"comma":if(b.length){a=b[b.length-1];return"|"}else{return c({type:"string",value:","},a)}case"closing-or":if(b.length===0){throw new Error("Unmatched '}'")}b.pop();return")";case"end":if(b.length){throw new Error("Unmatched '{'")}return c(e,a);default:var d=c(e,a);a=false;return d}}}function createSeqment(){var a=[];var b=createSimple();return function(d,c){switch(d.type){case"one":case"one-many":case"zero-many":case"zero-one":a.push(d.type);return"(";case"segment-sep":if(a.length){return"|"}else{return b({type:"string",value:"|"},c)}case"closing-segment":var e=a.pop();switch(e){case"one":return")";case"one-many":return")+";case"zero-many":return")*";case"zero-one":return")?"}throw new Error("Unexcepted segment "+e);case"end":if(a.length>0){throw new Error("Unmatched segment, missing ')'")}return b(d,c);default:return b(d,c)}}}function createSimple(){return function(b,a){switch(b.type){case"path-sep":return"[\\\\/]+";case"any-path-segments":return"[\\\\/]+(?:(.+)[\\\\/]+)?";case"any-path":return"(.*)";case"any-path-segment":if(a){return"\\.[\\\\/]+(?:.*[\\\\/]+)?([^\\\\/]+)"}else{return"([^\\\\/]*)"}case"any-char":return"[^\\\\/]";case"inverted-char-set":return"[^"+b.value+"]";case"char-set":return"["+b.value+"]";case"string":return b.value.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&");case"end":return"";default:throw new Error("Unsupported token '"+b.type+"'")}}}exports.globToRegExp=globToRegExp;