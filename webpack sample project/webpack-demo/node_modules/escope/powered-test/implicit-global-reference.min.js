(function(){var b,a,c;c=require("chai").expect;b=require("..");a=require("esprima");describe("implicit global reference",function(){it("assignments global scope",function(){var d,e;d=a.parse("var x = 20;\nx = 300;");e=b.analyze(d).scopes;c(e.map(function(f){return f.variables.map(function(g){return g.defs.map(function(h){return h.type})})})).to.be.eql([[["Variable"]]]);return c(e[0].implicit.variables.map(function(f){return f.name})).to.be.eql([])});it("assignments global scope without definition",function(){var d,e;d=a.parse("x = 300;\nx = 300;");e=b.analyze(d).scopes;c(e.map(function(f){return f.variables.map(function(g){return g.defs.map(function(h){return h.type})})})).to.be.eql([[]]);return c(e[0].implicit.variables.map(function(f){return f.name})).to.be.eql(["x"])});it("assignments global scope without definition eval",function(){var d,e;d=a.parse("function inner() {\n    eval(str);\n    x = 300;\n}");e=b.analyze(d).scopes;c(e.map(function(f){return f.variables.map(function(g){return g.defs.map(function(h){return h.type})})})).to.be.eql([[["FunctionName"]],[[]]]);return c(e[0].implicit.variables.map(function(f){return f.name})).to.be.eql([])});it("assignment leaks",function(){var d,e;d=a.parse("function outer() {\n    x = 20;\n}");e=b.analyze(d).scopes;c(e.map(function(f){return f.variables.map(function(g){return g.name})})).to.be.eql([["outer"],["arguments"]]);return c(e[0].implicit.variables.map(function(f){return f.name})).to.be.eql(["x"])});it("assignment doesn't leak",function(){var d,e;d=a.parse("function outer() {\n    function inner() {\n        x = 20;\n    }\n    var x;\n}");e=b.analyze(d).scopes;c(e.map(function(f){return f.variables.map(function(g){return g.name})})).to.be.eql([["outer"],["arguments","inner","x"],["arguments"]]);return c(e[0].implicit.variables.map(function(f){return f.name})).to.be.eql([])});it("for-in-statement leaks",function(){var d,e;d=a.parse("function outer() {\n    for (x in y) { }\n}");e=b.analyze(d).scopes;c(e.map(function(f){return f.variables.map(function(g){return g.name})})).to.be.eql([["outer"],["arguments"]]);return c(e[0].implicit.variables.map(function(f){return f.name})).to.be.eql(["x"])});return it("for-in-statement doesn't leaks",function(){var d,e;d=a.parse("function outer() {\n    function inner() {\n        for (x in y) { }\n    }\n    var x;\n}");e=b.analyze(d).scopes;c(e.map(function(f){return f.variables.map(function(g){return g.name})})).to.be.eql([["outer"],["arguments","inner","x"],["arguments"]]);return c(e[0].implicit.variables.map(function(f){return f.name})).to.be.eql([])})})}).call(this);