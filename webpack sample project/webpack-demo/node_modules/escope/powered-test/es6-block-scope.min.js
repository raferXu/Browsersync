(function(){var b,c,a;c=require("chai").expect;a=require("../third_party/esprima");b=require("..");describe("ES6 block scope",function(){it("let is materialized in ES6 block scope#1",function(){var d,e,f;d=a.parse("{\n    let i = 20;\n    i;\n}");f=b.analyze(d,{ecmaVersion:6});c(f.scopes).to.have.length(2);e=f.scopes[0];c(e.type).to.be.equal("global");c(e.variables).to.have.length(0);e=f.scopes[1];c(e.type).to.be.equal("block");c(e.variables).to.have.length(1);c(e.variables[0].name).to.be.equal("i");c(e.references).to.have.length(2);c(e.references[0].identifier.name).to.be.equal("i");return c(e.references[1].identifier.name).to.be.equal("i")});it("let is materialized in ES6 block scope#2",function(){var d,e,f;d=a.parse("{\n    let i = 20;\n    var i = 20;\n    i;\n}");f=b.analyze(d,{ecmaVersion:6});c(f.scopes).to.have.length(2);e=f.scopes[0];c(e.type).to.be.equal("global");c(e.variables).to.have.length(1);c(e.variables[0].name).to.be.equal("i");e=f.scopes[1];c(e.type).to.be.equal("block");c(e.variables).to.have.length(1);c(e.variables[0].name).to.be.equal("i");c(e.references).to.have.length(3);c(e.references[0].identifier.name).to.be.equal("i");c(e.references[1].identifier.name).to.be.equal("i");return c(e.references[2].identifier.name).to.be.equal("i")});it("function delaration is materialized in ES6 block scope",function(){var d,e,f;d=a.parse("{\n    function test() {\n    }\n    test();\n}");f=b.analyze(d,{ecmaVersion:6});c(f.scopes).to.have.length(3);e=f.scopes[0];c(e.type).to.be.equal("global");c(e.variables).to.have.length(0);e=f.scopes[1];c(e.type).to.be.equal("block");c(e.variables).to.have.length(1);c(e.variables[0].name).to.be.equal("test");c(e.references).to.have.length(1);c(e.references[0].identifier.name).to.be.equal("test");e=f.scopes[2];c(e.type).to.be.equal("function");c(e.variables).to.have.length(1);c(e.variables[0].name).to.be.equal("arguments");return c(e.references).to.have.length(0)});it("let is not hoistable#1",function(){var d,e,f,g;d=a.parse("var i = 42; (1)\n{\n    i;  // (2) ReferenceError at runtime.\n    let i = 20;  // (2)\n    i;  // (2)\n}");g=b.analyze(d,{ecmaVersion:6});c(g.scopes).to.have.length(2);e=g.scopes[0];c(e.type).to.be.equal("global");c(e.variables).to.have.length(1);c(e.variables[0].name).to.be.equal("i");c(e.references).to.have.length(1);f=g.scopes[1];c(f.type).to.be.equal("block");c(f.variables).to.have.length(1);c(f.variables[0].name).to.be.equal("i");c(f.references).to.have.length(3);c(f.references[0].resolved).to.be.equal(f.variables[0]);c(f.references[1].resolved).to.be.equal(f.variables[0]);return c(f.references[2].resolved).to.be.equal(f.variables[0])});return it("let is not hoistable#2",function(){var d,e,f,j,i,h,g;d=a.parse("(function () {\n    var i = 42; // (1)\n    i;  // (1)\n    {\n        i;  // (3)\n        {\n            i;  // (2)\n            let i = 20;  // (2)\n            i;  // (2)\n        }\n        let i = 30;  // (3)\n        i;  // (3)\n    }\n    i;  // (1)\n}());");j=b.analyze(d,{ecmaVersion:6});c(j.scopes).to.have.length(4);e=j.scopes[0];c(e.type).to.be.equal("global");c(e.variables).to.have.length(0);c(e.references).to.have.length(0);f=j.scopes[1];c(f.type).to.be.equal("function");c(f.variables).to.have.length(2);c(f.variables[0].name).to.be.equal("arguments");c(f.variables[1].name).to.be.equal("i");i=f.variables[1];c(f.references).to.have.length(3);c(f.references[0].resolved).to.be.equal(i);c(f.references[1].resolved).to.be.equal(i);c(f.references[2].resolved).to.be.equal(i);f=j.scopes[2];c(f.type).to.be.equal("block");c(f.variables).to.have.length(1);c(f.variables[0].name).to.be.equal("i");g=f.variables[0];c(f.references).to.have.length(3);c(f.references[0].resolved).to.be.equal(g);c(f.references[1].resolved).to.be.equal(g);c(f.references[2].resolved).to.be.equal(g);f=j.scopes[3];c(f.type).to.be.equal("block");c(f.variables).to.have.length(1);c(f.variables[0].name).to.be.equal("i");h=f.variables[0];c(f.references).to.have.length(3);c(f.references[0].resolved).to.be.equal(h);c(f.references[1].resolved).to.be.equal(h);return c(f.references[2].resolved).to.be.equal(h)})})}).call(this);