<!--
    Task DOM for loading the Flickr Images
    It uses the class="skeleton" to identify the elements that belong to the
    task.
-->
<link rel="stylesheet" href="http://192.168.0.88:8000/style3.css"/>
<div class="row skeleton"> <!-- Start Skeleton Row-->
    <div class="col-md-6" style="display:none"><!-- Start of Question and Submission DIV (column) -->
        <h1 id="question"><span id="i18n_question">Do you see a human face in this photo?</span></h1> <!-- The question will be loaded here -->
        <div id="answer"> <!-- Start DIV for the submission buttons -->
            <!-- If the user clicks this button, the saved answer will be value="yes"-->
            <button class="btn btn-success btn-answer" value='Yes'><i class="icon icon-white icon-thumbs-up"></i> <span id="i18n_yes">Yes</span></button>
            <!-- If the user clicks this button, the saved answer will be value="no"-->
            <button class="btn btn-danger btn-answer" value='No'><i class="icon icon-white icon-thumbs-down"></i> No</button>
            <!-- If the user clicks this button, the saved answer will be value="NoPhoto"-->
            <button class="btn btn-answer" value='NoPhoto'><i class="icon icon-exclamation"></i> <span id="i18n_no_photo">No photo</span></button>
            <!-- If the user clicks this button, the saved answer will be value="NotKnown"-->
            <button class="btn btn-answer" value='NotKnown'><i class="icon icon-white icon-question-sign"></i> <span id="i18n_i_dont_know">I don't know</span></button>
        </div><!-- End of DIV for the submission buttons -->
        <!-- Feedback items for the user -->
        <p><span id="i18n_working_task">You are working now on task:</span> <span id="task-id" class="label label-warning">#</span></p>
        <p><span id="i18n_tasks_completed">You have completed:</span> <span id="done" class="label label-info"></span> <span id="i18n_tasks_from">tasks from</span>
            <!-- Progress progress-bar for the user -->
            <span id="total" class="label label-inverse"></span></p>
        <div class="progress progress-striped">
            <div id="progress" rel="tooltip" title="#" class="progress-bar" style="width: 0%;"></div>
        </div>
        <!--
            This project uses Disqus to allow users to provide some feedback.
            The next section includes a button that when a user clicks on it will
            load the comments, if any, for the given task
        -->
        <div id="disqus_show_btn" style="margin-top:5px;">
            <button class="btn btn-primary btn-lg btn-disqus" onclick="loadDisqus()"><i class="icon-comments"></i> <span id="i18n_show_comments">Show comments</span></button>
            <button class="btn btn-lg btn-disqus" onclick="loadDisqus()" style="display:none"><i class="icon-comments"></i> <span id="i18n_hide_comments">Hide comments</span></button>
        </div><!-- End of Disqus Button section -->
        <!-- Disqus thread for the given task -->
        <div id="disqus_thread" style="margin-top:5px;display:none"></div>
    </div><!-- End of Question and Submission DIV (column) -->
    <h4 class="labelTitle">标注</h4>
    <div class="outer"><!-- Start of Photo DIV (column) -->
        <!--<div id="photo-link" class="pinch-zoom">-->
        <div class="pinch-zoom">
            <div id="photo-link" class="pinchImgDiv" style="width:100%">
                <img id="photo" class="" src="http://i.imgur.com/GeHxzb7.png" style="max-width:100%;padding:0">
            </div>
        </div>
        <input type="button" class="cutMove" value="切换到截图" />
        <ul class="subImg" id="cutImgUl"></ul>
        <div class="cutImgLabel">
        </div>
        <br><br>
    </div><!-- End of Photo DIV (columnt) -->
</div><!-- End of Skeleton Row -->
<div class="lableSubmitOuter" style="margin-left:-15px">
    <input type="submit" class="submitLabel" id="submitLabel" value="提交标注" disabled="disabled">
</div>
<script src="http://192.168.0.88:8000/pinchzoom3.js"></script>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */

    /* * * DON'T EDIT BELOW THIS LINE * * */
    function loadDisqus() {
        $("#disqus_thread").toggle();
        $(".btn-disqus").toggle();
        var disqus_shortname = 'pybossa'; // required: replace example with your forum shortname
        //var disqus_identifier = taskId;
        var disqus_developer = 1;

        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    }

</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

<script type="text/javascript">
    (function() {
// Default language
        var userLocale = "en";
// Translations
        var messages = {"en": {
            "i18n_welldone": "Well done!",
            "i18n_welldone_text": "Your answer has been saved",
            "i18n_loading_next_task": "Loading next task...",
            "i18n_task_completed": "The task has been completed!",
            "i18n_thanks": "Thanks a lot!",
            "i18n_congratulations": "Congratulations",
            "i18n_congratulations_text": "You have participated in all available tasks!",
            "i18n_yes": "Yes",
            "i18n_no_photo": "No photo",
            "i18n_i_dont_know": "I don't know",
            "i18n_working_task": "You are working now on task:",
            "i18n_tasks_completed": "You have completed:",
            "i18n_tasks_from": "tasks from",
            "i18n_show_comments": "Show comments:",
            "i18n_hide_comments": "Hide comments:",
            "i18n_question": "Do you see a human face in this photo?",
        },
            "es": {
                "i18n_welldone": "Bien hecho!",
                "i18n_welldone_text": "Tu respuesta ha sido guardada",
                "i18n_loading_next_task": "Cargando la siguiente tarea...",
                "i18n_task_completed": "La tarea ha sido completadas!",
                "i18n_thanks": "Muchísimas gracias!",
                "i18n_congratulations": "Enhorabuena",
                "i18n_congratulations_text": "Has participado en todas las tareas disponibles!",
                "i18n_yes": "Sí",
                "i18n_no_photo": "No hay foto",
                "i18n_i_dont_know": "No lo sé",
                "i18n_working_task": "Estás trabajando en la tarea:",
                "i18n_tasks_completed": "Has completado:",
                "i18n_tasks_from": "tareas de",
                "i18n_show_comments": "Mostrar comentarios",
                "i18n_hide_comments": "Ocultar comentarios",
                "i18n_question": "¿Ves una cara humana en esta foto?",
            },
        };
// Update userLocale with server side information
        $(document).ready(function(){
            userLocale = document.getElementById('PYBOSSA_USER_LOCALE').textContent.trim();

        });

        function i18n_translate() {
            var ids = Object.keys(messages[userLocale])
            for (i=0; i<ids.length; i++) {
                console.log("Translating: " + ids[i]);
                if (document.getElementById(ids[i])) {
                    document.getElementById(ids[i]).innerHTML = messages[userLocale][ids[i]];
                }
            }
        }


        function loadUserProgress() {
            pybossa.userProgress('1219').done(function(data){
                var pct = Math.round((data.done*100)/data.total);
                $("#progress").css("width", pct.toString() +"%");
                $("#progress").attr("title", pct.toString() + "% completed!");
                $("#progress").tooltip({'placement': 'left'});
                $("#total").text(data.total);
                $("#done").text(data.done);
            });
        }

        pybossa.taskLoaded(function(task, deferred) {
            if ( !$.isEmptyObject(task) ) {
                // load image from flickr
                var img = $('<img />');
                img.load(function() {
                    // continue as soon as the image is loaded
                    deferred.resolve(task);
                    pybossaNotify("", false, "loading");
                });

                img.attr('src', task.info.url).css('background-color','#DDD');
                img.addClass('img-thumbnail');
                task.info.image = img;
            }
            else {
                deferred.resolve(task);
            }
        });

        pybossa.presentTask(function(task, deferred) {
            if ( !$.isEmptyObject(task) ) {
                loadUserProgress();
                i18n_translate();

                var limitImgH = 300;
                var limitImgW = $('html').width();
//                $('.pinchImgDiv').height(limitImgH).css('background','#DDD');
//                if(limitImgW/$('.pinchImgDiv img').width()*$('.pinchImgDiv img').height() < limitImgH){
//                    $('.pinchImgDiv img').width('100%');
//                    $('.pinchImgDiv img').css('padding-top',(limitImgH-$('.pinchImgDiv img').height())/2+'px');
//                }else{
//                    $('.pinchImgDiv img').height(limitImgH);
//                    $('.pinchImgDiv img').css('padding-left',(limitImgW-$('.pinchImgDiv img').width())/2+'px');
//                }
                $('.pinchImgDiv').height(limitImgH).css('background','#DDD');
                function myImgShow(image,limitImgH,limitImgW) {  //image必须是jq对象
                    var initW = image[0].width;
                    var initH = image[0].height;
                    var pt = (limitImgH-limitImgW/initW*initH)/2;
                    var pl = (limitImgW-limitImgH/initH*initW)/2;
                    if(limitImgW/initW*initH < limitImgH){
                        image.width('100%');
                        image.css('padding-top',pt+'px');
                    }else{
                        image.height(limitImgH);
                        image.css('padding-left',pl+'px');
                    }
                }
                myImgShow(task.info.image,limitImgH,limitImgW);
//                var initW = task.info.image[0].width;
//                var initH = task.info.image[0].height;
//                var pt = (limitImgH-limitImgW/initW*initH)/2;
//                var pl = (limitImgW-limitImgH/initH*initW)/2;
//                if(limitImgW/initW*initH < limitImgH){
//                    task.info.image.width('100%');
//                    task.info.image.css('padding-top',pt+'px');
//                }else{
//                    task.info.image.height(limitImgH);
//                    task.info.image.css('padding-left',pl+'px');
//                }
                $('#photo-link').html('').append(task.info.image);
                $("#photo-link").attr("href", task.info.link);
                $('#task-id').html(task.id);
                $('body').css('padding','0px');
                $(function () {
                    $('div.pinch-zoom').each(function () {
                        new RTP.PinchZoom($(this), {});
                    });
                });
                $('#submitLabel').off('click').on('click', function(evt) {
                    $('textarea.labelComment').each(function(i){
                        data.comment[i]=$(this).val();
                    });
                    var answer = get_data();
                    if (typeof answer != 'undefined') {
                        pybossa.saveTask(task.id, answer).done(function() {
                            pybossaNotify("Loading picture...", true, "loading");
                            deferred.resolve();
                        });
                        if ($("#disqus_thread").is(":visible")) {
                            $('#disqus_thread').toggle();
                            $('.btn-disqus').toggle();
                        }
                    }
                    else {
                        pybossaNotify("Oops... Something went wrong.", true, "error");
                    }
                    $('.subImg').html('');
                    $('.subImg').css('left',0);
                    $('.cutImgLabel').html('');
                    $('.rect').remove();
                    $('.cutMove').hide();
                    $('.pinch-zoom-container').css('height','auto');
                    $('.submitLabel').css({'position':'fixed','bottom':0})
                });
                pybossaNotify("Loading picture...", false, "loading");
            }
            else {
                $(".skeleton").hide();
                pybossaNotify("Loading picture...", false, "loading");
                pybossaNotify("Thanks! You have participated in all available tasks. Enjoy some of your time!", true, "info");
            }
        });

        pybossa.run('1219');
    })();
</script>
<!--<script type="text/javascript">-->
<!--$(function () {-->
<!--$('div.pinch-zoom').each(function () {-->
<!--new RTP.PinchZoom($(this), {});-->
<!--});-->
<!--})-->
<!--</script>-->