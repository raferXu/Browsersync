<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>尝试打开APP的DEMO</title>
  <link rel="stylesheet" href="1.css" type="text/css" />
  <style>
    body{
      padding:5%;
    }

    .remark{
      margin-top:1em;
      color:#ababab;
    }
  </style>
</head>
<body>
<h1>尝试打开APP的DEMO</h1>
<div class = "custom-border border-color">
  <a id = "tryOpenApp" href = "http://pages.book.qq.com/pages/qidian/qddown/qdreader.htm">尝试打开起点读书</a>
</div>
<div class = "remark">目前在阅文集团，就以起点读书为例吧</div>
<div class = "remark">如果安装了起点读书，那么打开，不然的话，会打开下载页</div>
<script type="text/javascript" src="../zhongbao3/h5/js/jquery.1.7.2.min.js"></script>
<script>
  $(function () {

    function _openAppUrl(appUrl){

      var ua = navigator.userAgent.toLocaleLowerCase(),
        openBrowser = null,
        deviceVersion = 0,
        matchVersion = null,
        openAppType = "",
        downLoadUrl = 'http://pages.book.qq.com/pages/qidian/qddown/qdreader.htm';

        openAppType = "newType";
        if(openAppType == "newType"){
          //使用新的方法，尝试打开APP
          //IOS>9,Android>5的版本
          _openAppUrl = function(url){
            var history = window.history,
              body = $("body").eq(0),
              ifr = $('<iframe class = "full-screen dn" style = "z-index:101;border:none;width:100%;height:100%;" src="'+downLoadUrl+'"></iframe>');

            body.append(ifr);
            $(window).on("popstate",function(e){
              alert('popstate');
              var state = history.state;

              if(!state){
                alert('!state');
                ifr.addClass("dn");
              }
            });

            function _show(){
              history.pushState({}, "下载APP链接页", "");
              ifr.removeClass("dn");
            }


            _openAppUrl = function(url){
              location.href = url;
              _show();
            };

            _openAppUrl(url);

          }
        }

      _openAppUrl(appUrl);

    }

    var appUrl = "QDReader://";

    $("#tryOpenApp").on("click",function(){
      _openAppUrl(appUrl);
      return false;
    });

  });
</script>
</body>
</html>
