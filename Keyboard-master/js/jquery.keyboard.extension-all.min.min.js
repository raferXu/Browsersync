/*! Copyright (c) 2011 Brandon Aaron (http://brandonaaron.net)
 * Licensed under the MIT License (LICENSE.txt).
 *
 * Thanks to: http://adomas.org/javascript-mouse-wheel/ for some pointers.
 * Thanks to: Mathias Bank(http://www.mathias-bank.de) for a scope bug fix.
 * Thanks to: Seamus Leahy for adding deltaX and deltaY
 *
 * Version: 3.0.6
 * 
 * Requires: 1.2.2+
 */
(function(g){var e=["DOMMouseScroll","mousewheel"];if(g.event.fixHooks){for(var f=e.length;f;){g.event.fixHooks[e[--f]]=g.event.mouseHooks}}g.event.special.mousewheel={setup:function(){if(this.addEventListener){for(var a=e.length;a;){this.addEventListener(e[--a],h,false)}}else{this.onmousewheel=h}},teardown:function(){if(this.removeEventListener){for(var a=e.length;a;){this.removeEventListener(e[--a],h,false)}}else{this.onmousewheel=null}}};g.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}});function h(b){var d=b||window.event,l=[].slice.call(arguments,1),a=0,c=true,m=0,n=0;b=g.event.fix(d);b.type="mousewheel";if(d.wheelDelta){a=d.wheelDelta/120}if(d.detail){a=-d.detail/3}n=a;if(d.axis!==undefined&&d.axis===d.HORIZONTAL_AXIS){n=0;m=-1*a}if(d.wheelDeltaY!==undefined){n=d.wheelDeltaY/120}if(d.wheelDeltaX!==undefined){m=-1*d.wheelDeltaX/120}l.unshift(b,a,m,n);return(g.event.dispatch||g.event.handle).apply(this,l)}})(jQuery);(function(b){b.fn.addAutocomplete=function(){return this.each(function(){var a=b(this).data("keyboard");if(!a){return}a.autocomplete_new_version=(function(d){d[0]=parseInt(d[0],10);return(d[0]>1)||(d[0]===1&&parseInt(d[1],10)>=9)})(b.ui.version.split("."));a.autocomplete_init=function(h,g,f){if(a.options.alwaysOpen&&a.isVisible()){a.autocomplete_setup()}a.$el.bind("visible.keyboard",function(){a.autocomplete_setup()}).bind("change.keyboard",function(){if(a.hasAutocomplete&&a.isVisible()){a.$el.val(a.$preview.val()).trigger("keydown.autocomplete")}}).bind("hidden.keyboard",function(c){a.$el.autocomplete("close")}).bind("autocompleteopen",function(c,d){if(a.hasAutocomplete){a.$autocomplete.menu.element.position({of:a.$keyboard,my:"right top",at:"left top",collision:"flip"})}}).bind("autocompleteselect",function(c,d){var e=d.item.value;if(a.hasAutocomplete&&e!==""){a.$preview.val(e).focus();a.lastCaret={start:e.length,end:e.length}}})};a.autocomplete_setup=function(){a.$autocomplete=a.$el.data("autocomplete")||a.$el.data("uiAutocomplete");a.hasAutocomplete=(typeof(a.$autocomplete)==="undefined")?false:(a.$autocomplete.options.disabled)?false:true;if(a.hasAutocomplete){a.$preview.bind("keydown",function(d){return a.autocomplete_input(d)});a.$allKeys.bind("mouseup mousedown mouseleave touchstart touchend touchcancel",function(d){a.autocomplete_input(d)})}};a.autocomplete_input=function(g){var h,f=b.ui.keyCode;switch(g.keyCode){case f.PAGE_UP:a.$autocomplete._move("previousPage",g);g.preventDefault();break;case f.PAGE_DOWN:a.$autocomplete._move("nextPage",g);g.preventDefault();break;case f.UP:a.$autocomplete._move("previous",g);g.preventDefault();break;case f.DOWN:a.$autocomplete._move("next",g);g.preventDefault();break;case f.ENTER:case f.NUMPAD_ENTER:h=a.$autocomplete.menu.element.find("#ui-active-menuitem,.ui-state-focus").text()||"";if(h!==""){a.$preview.val(h)}if(a.autocomplete_new_version){a.$autocomplete.menu.select(g)}break;default:clearTimeout(a.$autocomplete.searching);a.$autocomplete.searching=setTimeout(function(){if(a.$autocomplete.term!==a.$autocomplete.element.val()){a.$autocomplete.selectedItem=null;a.$autocomplete.search(null,g)}},a.$autocomplete.options.delay);break}};a.origEscClose=a.escClose;a.escClose=function(d){if(a.hasAutocomplete&&(d.target.id==="ui-active-menuitem"||b(d.target).closest("ul").hasClass("ui-autocomplete"))){return}a.origEscClose(d)};a.autocomplete_init()})}})(jQuery);(function(b){b.fn.addMobile=function(a){var e,f={container:{theme:"a"},buttonMarkup:{theme:"a",shadow:"true",corners:"true"},buttonHover:{theme:"c"},buttonAction:{theme:"b"},buttonActive:{theme:"e"}};return this.each(function(){var c=b(this).data("keyboard");if(!c||typeof(b.fn.textinput)==="undefined"){return}c.mobile_options=e=b.extend({},f,a);c.mobile_init=function(){b(".ui-keyboard-input").textinput();if(c.options.alwaysOpen&&c.isVisible){c.mobile_setup()}c.$el.on("beforeVisible.keyboard",function(){c.$keyboard.css("visibility","hidden")}).on("visible.keyboard",function(){c.mobile_setup();c.$keyboard.css("visibility","visible");c.$preview.focus()})};c.mobile_setup=function(){var d,h=b.extend({},e.buttonMarkup,e.buttonAction);c.$keyboard.addClass("ui-bar ui-bar-"+e.container.theme).removeClass("ui-widget ui-widget-content").find("button:not(."+c.options.css.buttonAction+")").addClass(c.modButton(e.buttonMarkup)).end().find("."+c.options.css.buttonAction).addClass(c.modButton(h)).end().find("button").removeClass("ui-corner-all ui-state-default").hover(function(){b(this).addClass("ui-btn-hover-"+e.buttonHover.theme)},function(){b(this).removeClass("ui-btn-hover-"+e.buttonHover.theme)});c.options.css.buttonAction="ui-btn-down-"+e.buttonActive.theme;if(c.msie&&c.$preview[0]!==c.el){c.$preview.hide();c.$keyboard.css("width","");c.width=c.$keyboard.outerWidth();c.$keyboard.width(c.width+parseInt(c.$preview.css("fontSize"),10));c.$preview.width(c.width);c.$preview.show()}d=c.options.position;d.of=d.of||c.$el.data("keyboardPosition")||c.$el;d.collision=(c.options.usePreview)?d.collision||"fit fit":"flip flip";c.$keyboard.position(d)};c.modButton=function(d){return"ui-btn ui-btn-up-"+d.theme+" ui-btn-"+d.theme+(d.shadow=="true"?" ui-shadow":"")+(d.corners=="true"?" ui-btn-corner-all":"")};c.mobile_init()})}})(jQuery);(function(b){b.keyboard=b.keyboard||{};b.keyboard.navigationKeys={toggle:112,enter:13,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,caretrt:45,caretlt:46};b.fn.addNavigation=function(a){return this.each(function(){var g,j,i=b(this).data("keyboard"),h={position:[0,0],toggleMode:false,focusClass:"hasFocus"};if(!i){return}i.navigation_options=g=b.extend({},h,a);i.navigation_keys=j=b.extend({},b.keyboard.navigationKeys);i.saveNav=[i.options.tabNavigation,i.options.enterNavigation];i.allNavKeys=b.map(j,function(d,c){return d});i.navigation_init=function(){i.$keyboard.toggleClass(g.focusClass,g.toggleMode).find(".ui-keyboard-keyset:visible").find('.ui-keyboard-button[data-pos="'+g.position[0]+","+g.position[1]+'"]').addClass("ui-state-hover");i.$preview.unbind("keydown.keyboardNav").bind("keydown.keyboardNav",function(c){return i.checkKeys(c.which)})};i.checkKeys=function(c,d){if(typeof(c)==="undefined"){return}var e=i.navigation_keys;if(c===e.toggle||d){g.toggleMode=(d)?false:!g.toggleMode;i.options.tabNavigation=(g.toggleMode)?false:i.saveNav[0];i.options.enterNavigation=(g.toggleMode)?false:i.saveNav[1]}i.$keyboard.toggleClass(g.focusClass,g.toggleMode);if(g.toggleMode&&c===e.enter){i.$keyboard.find(".ui-keyboard-keyset:visible").find('.ui-keyboard-button[data-pos="'+g.position[0]+","+g.position[1]+'"]').trigger("repeater.keyboard");return false}if(g.toggleMode&&b.inArray(c,i.allNavKeys)>=0){i.navigateKeys(c);return false}};i.navigateKeys=function(d,c,f){f=f||g.position[1];c=c||g.position[0];var s=i.$keyboard.find(".ui-keyboard-keyset:visible"),e=s.find(".ui-keyboard-button-endrow").length-1,k=s.find('.ui-keyboard-button[data-pos^="'+c+',"]').length-1,t=i.lastCaret,p=i.$preview.val().length,l=i.navigation_keys;switch(d){case l.pageup:c=0;break;case l.pagedown:c=e;break;case l.end:f=k;break;case l.home:f=0;break;case l.left:f+=(f>0)?-1:0;break;case l.up:c+=(c>0)?-1:0;break;case l.right:f+=1;break;case l.down:c+=(c+1>e)?0:1;break;case l.caretRt:t.start++;break;case l.caretLt:t.start--;break}if(d===l.caretRt||d===l.caretLt){t.start=t.start<0?0:t.start>p?p:t.start;t.end=t.start;i.lastCaret=t;i.$preview.focus().caret(t.start,t.start)}k=s.find('.ui-keyboard-button[data-pos^="'+c+',"]').length-1;if(f>k){f=k}s.find(".ui-state-hover").removeClass("ui-state-hover");s.find('.ui-keyboard-button[data-pos="'+c+","+f+'"]').addClass("ui-state-hover");g.position=[c,f]};if(i.options.alwaysOpen&&i.isVisible){i.$keyboard.find(".ui-state-hover").removeClass("ui-state-hover");i.navigation_init()}i.$el.bind("visible.keyboard",function(c){i.$keyboard.find(".ui-state-hover").removeClass("ui-state-hover");i.navigation_init()}).bind("inactive.keyboard hidden.keyboard",function(c){i.checkKeys(c.which,true)}).bind("navigate navigateTo",function(d,c,e){c=isNaN(c)?c.toLowerCase():c;if(i.navigation_keys.hasOwnProperty(c)){i.checkKeys(i.navigation_keys[c])}else{i.navigateKeys(null,c,e)}})})}})(jQuery);(function(b){b.keyboard=b.keyboard||{};b.fn.addScramble=function(a){var d={targetKeys:/[a-z\d]/i,byRow:true,randomizeOnce:true};return this.each(function(){var c,f=b(this).data("keyboard");if(!f){return}c=f.scramble_options=b.extend({},d,a);f.scramble_setup=function(u){var x,t,s,r,w,y,v,z,B,A,e;x=u.find(".ui-keyboard-keyset");if(u.length){for(t=0;t<x.length;t++){s=x.eq(t);v=0;e=[];B=[];z=[];A=[];s.children("button, span, br").each(function(){if(this.tagName==="BR"){if(c.byRow){e.push(this);B.push(false);A[v]=e;z[v]=B;e=[];B=[];v++}else{A[v]=this;z[v]=false;v++}}else{y=b(this).attr("data-value")||"";y=y.length===1&&c.targetKeys.test(y)?y:false;if(c.byRow){e.push(this);B.push(y)}else{A[v]=this;z[v]=y;v++}}});s.find(".ui-keyboard-button-endrow").remove();if(!c.byRow){e=f.shuffle(A,z);for(r=0;r<e.length;r++){s.append(e[r])}}else{for(w=0;w<A.length;w++){e=f.shuffle(A[w],z[w]);for(r=0;r<e.length;r++){s.append(e[r])}}}}return u}};f.shuffle=function(e,k){var l,m,n=e.length;while(n>0){m=Math.floor(Math.random()*n);if(k[n-1]===false){n--}if(k[n-1]!==false&&k[m]!==false){n--;l=e[n];e[n]=e[m];e[m]=l}}return e};f.options.create=function(){var e=f.options.layout;b.keyboard.builtLayouts[e]={mappedKeys:{},acceptedKeys:[],$keyboard:null};if(typeof b.keyboard.builtLayouts[f.orig_layout]==="undefined"){f.layout=f.options.layout=f.orig_layout;f.buildKeyboard();f.layout=f.options.layout=e}b.keyboard.builtLayouts[e]=b.extend({},b.keyboard.builtLayouts[f.orig_layout]);if(c.randomizeOnce){b.keyboard.builtLayouts[e].$keyboard=f.scramble_setup(b.keyboard.builtLayouts[f.orig_layout].$keyboard.clone())}f.$keyboard=b.keyboard.builtLayouts[e].$keyboard;if(!c.randomizeOnce){f.$el.bind("beforeVisible.keyboard",function(i,j){j.$keyboard=j.scramble_setup(j.$keyboard)})}};f.orig_layout=f.options.layout;f.options.layout="scrambled"+Math.round(Math.random()*10000)})}})(jQuery);(function(b){b.fn.addTyping=function(a){var d={showTyping:true,delay:250};return this.each(function(){var c=b(this).data("keyboard");if(!c){return}c.typing_options=b.extend({},d,a);c.typing_keymap={" ":"space",'"':"34","'":"39","&nbsp;":"space","\b":"bksp","\n":"Enter","\r":"Enter","\t":"tab"};c.typing_xref={8:"bksp",9:"tab",13:"enter",32:"space"};c.typing_event=false;c.typing_setup=function(){var f=(c.$preview)?c.$preview:c.$el;f.bind("keyup.keyboard",function(e){if(e.which>=37&&e.which<=40){return}if(e.which===16){c.shiftActive=false}if(e.which===18){c.altActive=false}if(e.which===16||e.which===18){c.showKeySet();setTimeout(function(){c.$preview.focus()},200);return}}).bind("keydown.keyboard",function(e){e.temp=false;if(e.which===16){e.temp=(c.shiftActive)?false:true;c.shiftActive=true}if(e.which===18){e.temp=(c.altActive)?false:true;c.altActive=true}if(e.temp){c.showKeySet();c.$preview.focus()}c.typing_event=true;if(e.which===8||e.which===9){c.typeIn("",c.typing_options.delay||250,function(){c.typing_event=false},e)}}).bind("keypress.keyboard",function(e){if(c.typing_event&&!c.options.lockInput){c.typeIn("",c.typing_options.delay||250,function(){c.typing_event=false},e)}})};c.typeIn=function(n,o,C,k){if(!c.isVisible()){c.typing_options.init=false;clearTimeout(c.typing_timer);return}var A=c.typing_options,m,y,z,x,D,e,B,F,E=b.keyboard.builtLayouts[c.layout].mappedKeys;if(c.typing_options.init!==true){A.init=true;A.text=n;A.len=n.length;A.delay=o||300;A.current=0;A.callback=C}n=A.text.substring(A.current,++A.current);e=c.$keyboard.find(".ui-keyboard-keyset");x=(c.typing_keymap.hasOwnProperty(n))?c.typing_keymap[n]:n;m='.ui-keyboard-button[data-value="'+x+'"]';if(c.typing_event&&k){if(c.typing_xref.hasOwnProperty(k.keyCode||k.which)){m=".ui-keyboard-"+c.typing_xref[k.keyCode||k.which]}else{y=String.fromCharCode(k.charCode||k.which);m=(E.hasOwnProperty(y))?'.ui-keyboard-button[data-value="'+E[y]+'"]':".ui-keyboard-"+(k.charCode||k.which)}}D=e.filter(":visible").find(m);if(D.length){c.typing_simulateKey(D,n)}else{if(c.typing_event){D=e.find(m)}else{z=(c.typing_keymap.hasOwnProperty(n))?c.typing_keymap[n]:n.charCodeAt(0);if(z==="bksp"){n=z}D=e.find(".ui-keyboard-"+z)}F=D.closest(".ui-keyboard-keyset");if(F.attr("name")){B=F.attr("name");c.shiftActive=/shift/.test(B);c.altActive=/alt/.test(B);c.metaActive=c.lastKeyset[2]=(B).match(/meta\d+/)||false;c.showKeySet({name:c.metaActive});c.typing_simulateKey(D,n)}else{if(!c.typing_event){c.insertText(n);c.checkCombos()}}}if(A.current<A.len){if(!c.isVisible()){return}setTimeout(function(){c.typeIn()},A.delay)}else{A.init=false;if(b.isFunction(A.callback)){setTimeout(function(){A.callback(c)},A.delay)}return}};c.typing_simulateKey=function(i,j){var e=i.length;if(e){i.filter(":visible").trigger("mouseenter.keyboard")}c.typing_timer=setTimeout(function(){if(e){setTimeout(function(){i.trigger("mouseleave.keyboard")},c.typing_options.delay/3)}if(!c.isVisible()){return}if(!c.typing_event){c.insertText(j);c.checkCombos()}},c.typing_options.delay/3)};if(c.typing_options.showTyping){if(c.options.alwaysOpen&&c.isVisible()){c.typing_setup()}c.$el.bind("visible.keyboard",function(){c.typing_setup()})}})}})(jQuery);