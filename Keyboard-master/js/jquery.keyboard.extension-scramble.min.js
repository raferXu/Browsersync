(function(a){a.keyboard=a.keyboard||{};a.fn.addScramble=function(b){var c={targetKeys:/[a-z\d]/i,byRow:true,randomizeOnce:true};return this.each(function(){var e,d=a(this).data("keyboard");if(!d){return}e=d.scramble_options=a.extend({},c,b);d.scramble_setup=function(m){var j,n,o,p,k,i,l,h,f,g,q;j=m.find(".ui-keyboard-keyset");if(m.length){for(n=0;n<j.length;n++){o=j.eq(n);l=0;q=[];f=[];h=[];g=[];o.children("button, span, br").each(function(){if(this.tagName==="BR"){if(e.byRow){q.push(this);f.push(false);g[l]=q;h[l]=f;q=[];f=[];l++}else{g[l]=this;h[l]=false;l++}}else{i=a(this).attr("data-value")||"";i=i.length===1&&e.targetKeys.test(i)?i:false;if(e.byRow){q.push(this);f.push(i)}else{g[l]=this;h[l]=i;l++}}});o.find(".ui-keyboard-button-endrow").remove();if(!e.byRow){q=d.shuffle(g,h);for(p=0;p<q.length;p++){o.append(q[p])}}else{for(k=0;k<g.length;k++){q=d.shuffle(g[k],h[k]);for(p=0;p<q.length;p++){o.append(q[p])}}}}return m}};d.shuffle=function(j,i){var h,g,f=j.length;while(f>0){g=Math.floor(Math.random()*f);if(i[f-1]===false){f--}if(i[f-1]!==false&&i[g]!==false){f--;h=j[f];j[f]=j[g];j[g]=h}}return j};d.options.create=function(){var f=d.options.layout;a.keyboard.builtLayouts[f]={mappedKeys:{},acceptedKeys:[],$keyboard:null};if(typeof a.keyboard.builtLayouts[d.orig_layout]==="undefined"){d.layout=d.options.layout=d.orig_layout;d.buildKeyboard();d.layout=d.options.layout=f}a.keyboard.builtLayouts[f]=a.extend({},a.keyboard.builtLayouts[d.orig_layout]);if(e.randomizeOnce){a.keyboard.builtLayouts[f].$keyboard=d.scramble_setup(a.keyboard.builtLayouts[d.orig_layout].$keyboard.clone())}d.$keyboard=a.keyboard.builtLayouts[f].$keyboard;if(!e.randomizeOnce){d.$el.bind("beforeVisible.keyboard",function(h,g){g.$keyboard=g.scramble_setup(g.$keyboard)})}};d.orig_layout=d.options.layout;d.options.layout="scrambled"+Math.round(Math.random()*10000)})}})(jQuery);