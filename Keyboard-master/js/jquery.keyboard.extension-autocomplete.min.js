(function(a){a.fn.addAutocomplete=function(){return this.each(function(){var b=a(this).data("keyboard");if(!b){return}b.autocomplete_new_version=(function(c){c[0]=parseInt(c[0],10);return(c[0]>1)||(c[0]===1&&parseInt(c[1],10)>=9)})(a.ui.version.split("."));b.autocomplete_init=function(c,d,e){if(b.options.alwaysOpen&&b.isVisible()){b.autocomplete_setup()}b.$el.bind("visible.keyboard",function(){b.autocomplete_setup()}).bind("change.keyboard",function(){if(b.hasAutocomplete&&b.isVisible()){b.$el.val(b.$preview.val()).trigger("keydown.autocomplete")}}).bind("hidden.keyboard",function(f){b.$el.autocomplete("close")}).bind("autocompleteopen",function(g,f){if(b.hasAutocomplete){b.$autocomplete.menu.element.position({of:b.$keyboard,my:"right top",at:"left top",collision:"flip"})}}).bind("autocompleteselect",function(h,g){var f=g.item.value;if(b.hasAutocomplete&&f!==""){b.$preview.val(f).focus();b.lastCaret={start:f.length,end:f.length}}})};b.autocomplete_setup=function(){b.$autocomplete=b.$el.data("autocomplete")||b.$el.data("uiAutocomplete");b.hasAutocomplete=(typeof(b.$autocomplete)==="undefined")?false:(b.$autocomplete.options.disabled)?false:true;if(b.hasAutocomplete){b.$preview.bind("keydown",function(c){return b.autocomplete_input(c)});b.$allKeys.bind("mouseup mousedown mouseleave touchstart touchend touchcancel",function(c){b.autocomplete_input(c)})}};b.autocomplete_input=function(d){var c,e=a.ui.keyCode;switch(d.keyCode){case e.PAGE_UP:b.$autocomplete._move("previousPage",d);d.preventDefault();break;case e.PAGE_DOWN:b.$autocomplete._move("nextPage",d);d.preventDefault();break;case e.UP:b.$autocomplete._move("previous",d);d.preventDefault();break;case e.DOWN:b.$autocomplete._move("next",d);d.preventDefault();break;case e.ENTER:case e.NUMPAD_ENTER:c=b.$autocomplete.menu.element.find("#ui-active-menuitem,.ui-state-focus").text()||"";if(c!==""){b.$preview.val(c)}if(b.autocomplete_new_version){b.$autocomplete.menu.select(d)}break;default:clearTimeout(b.$autocomplete.searching);b.$autocomplete.searching=setTimeout(function(){if(b.$autocomplete.term!==b.$autocomplete.element.val()){b.$autocomplete.selectedItem=null;b.$autocomplete.search(null,d)}},b.$autocomplete.options.delay);break}};b.origEscClose=b.escClose;b.escClose=function(c){if(b.hasAutocomplete&&(c.target.id==="ui-active-menuitem"||a(c.target).closest("ul").hasClass("ui-autocomplete"))){return}b.origEscClose(c)};b.autocomplete_init()})}})(jQuery);