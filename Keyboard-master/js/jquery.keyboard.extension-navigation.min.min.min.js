(function(a){a.keyboard=a.keyboard||{};a.keyboard.navigationKeys={toggle:112,enter:13,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,caretrt:45,caretlt:46};a.fn.addNavigation=function(b){return this.each(function(){var f,c,d=a(this).data("keyboard"),e={position:[0,0],toggleMode:false,focusClass:"hasFocus"};if(!d){return}d.navigation_options=f=a.extend({},e,b);d.navigation_keys=c=a.extend({},a.keyboard.navigationKeys);d.saveNav=[d.options.tabNavigation,d.options.enterNavigation];d.allNavKeys=a.map(c,function(g,h){return g});d.navigation_init=function(){d.$keyboard.toggleClass(f.focusClass,f.toggleMode).find(".ui-keyboard-keyset:visible").find('.ui-keyboard-button[data-pos="'+f.position[0]+","+f.position[1]+'"]').addClass("ui-state-hover");d.$preview.unbind("keydown.keyboardNav").bind("keydown.keyboardNav",function(g){return d.checkKeys(g.which)})};d.checkKeys=function(i,h){if(typeof(i)==="undefined"){return}var g=d.navigation_keys;if(i===g.toggle||h){f.toggleMode=(h)?false:!f.toggleMode;d.options.tabNavigation=(f.toggleMode)?false:d.saveNav[0];d.options.enterNavigation=(f.toggleMode)?false:d.saveNav[1]}d.$keyboard.toggleClass(f.focusClass,f.toggleMode);if(f.toggleMode&&i===g.enter){d.$keyboard.find(".ui-keyboard-keyset:visible").find('.ui-keyboard-button[data-pos="'+f.position[0]+","+f.position[1]+'"]').trigger("repeater.keyboard");return false}if(f.toggleMode&&a.inArray(i,d.allNavKeys)>=0){d.navigateKeys(i);return false}};d.navigateKeys=function(n,o,j){j=j||f.position[1];o=o||f.position[0];var r=d.$keyboard.find(".ui-keyboard-keyset:visible"),m=r.find(".ui-keyboard-button-endrow").length-1,i=r.find('.ui-keyboard-button[data-pos^="'+o+',"]').length-1,q=d.lastCaret,g=d.$preview.val().length,h=d.navigation_keys;switch(n){case h.pageup:o=0;break;case h.pagedown:o=m;break;case h.end:j=i;break;case h.home:j=0;break;case h.left:j+=(j>0)?-1:0;break;case h.up:o+=(o>0)?-1:0;break;case h.right:j+=1;break;case h.down:o+=(o+1>m)?0:1;break;case h.caretRt:q.start++;break;case h.caretLt:q.start--;break}if(n===h.caretRt||n===h.caretLt){q.start=q.start<0?0:q.start>g?g:q.start;q.end=q.start;d.lastCaret=q;d.$preview.focus().caret(q.start,q.start)}i=r.find('.ui-keyboard-button[data-pos^="'+o+',"]').length-1;if(j>i){j=i}r.find(".ui-state-hover").removeClass("ui-state-hover");r.find('.ui-keyboard-button[data-pos="'+o+","+j+'"]').addClass("ui-state-hover");f.position=[o,j]};if(d.options.alwaysOpen&&d.isVisible){d.$keyboard.find(".ui-state-hover").removeClass("ui-state-hover");d.navigation_init()}d.$el.bind("visible.keyboard",function(g){d.$keyboard.find(".ui-state-hover").removeClass("ui-state-hover");d.navigation_init()}).bind("inactive.keyboard hidden.keyboard",function(g){d.checkKeys(g.which,true)}).bind("navigate navigateTo",function(h,i,g){i=isNaN(i)?i.toLowerCase():i;if(d.navigation_keys.hasOwnProperty(i)){d.checkKeys(d.navigation_keys[i])}else{d.navigateKeys(null,i,g)}})})}})(jQuery);