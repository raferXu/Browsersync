(function(a){a.keyboard=a.keyboard||{};a.fn.addScramble=function(b){var c={targetKeys:/[a-z\d]/i,byRow:true,randomizeOnce:true};return this.each(function(){var e,d=a(this).data("keyboard");if(!d){return}e=d.scramble_options=a.extend({},c,b);d.scramble_setup=function(o){var l,p,q,f,m,k,n,j,g,h,i;l=o.find(".ui-keyboard-keyset");if(o.length){for(p=0;p<l.length;p++){q=l.eq(p);n=0;i=[];g=[];j=[];h=[];q.children("button, span, br").each(function(){if(this.tagName==="BR"){if(e.byRow){i.push(this);g.push(false);h[n]=i;j[n]=g;i=[];g=[];n++}else{h[n]=this;j[n]=false;n++}}else{k=a(this).attr("data-value")||"";k=k.length===1&&e.targetKeys.test(k)?k:false;if(e.byRow){i.push(this);g.push(k)}else{h[n]=this;j[n]=k;n++}}});q.find(".ui-keyboard-button-endrow").remove();if(!e.byRow){i=d.shuffle(h,j);for(f=0;f<i.length;f++){q.append(i[f])}}else{for(m=0;m<h.length;m++){i=d.shuffle(h[m],j[m]);for(f=0;f<i.length;f++){q.append(i[f])}}}}return o}};d.shuffle=function(i,h){var g,f,j=i.length;while(j>0){f=Math.floor(Math.random()*j);if(h[j-1]===false){j--}if(h[j-1]!==false&&h[f]!==false){j--;g=i[j];i[j]=i[f];i[f]=g}}return i};d.options.create=function(){var f=d.options.layout;a.keyboard.builtLayouts[f]={mappedKeys:{},acceptedKeys:[],$keyboard:null};if(typeof a.keyboard.builtLayouts[d.orig_layout]==="undefined"){d.layout=d.options.layout=d.orig_layout;d.buildKeyboard();d.layout=d.options.layout=f}a.keyboard.builtLayouts[f]=a.extend({},a.keyboard.builtLayouts[d.orig_layout]);if(e.randomizeOnce){a.keyboard.builtLayouts[f].$keyboard=d.scramble_setup(a.keyboard.builtLayouts[d.orig_layout].$keyboard.clone())}d.$keyboard=a.keyboard.builtLayouts[f].$keyboard;if(!e.randomizeOnce){d.$el.bind("beforeVisible.keyboard",function(h,g){g.$keyboard=g.scramble_setup(g.$keyboard)})}};d.orig_layout=d.options.layout;d.options.layout="scrambled"+Math.round(Math.random()*10000)})}})(jQuery);