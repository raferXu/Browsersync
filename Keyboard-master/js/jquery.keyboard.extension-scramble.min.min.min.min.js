(function(b){b.keyboard=b.keyboard||{};b.fn.addScramble=function(a){var d={targetKeys:/[a-z\d]/i,byRow:true,randomizeOnce:true};return this.each(function(){var c,f=b(this).data("keyboard");if(!f){return}c=f.scramble_options=b.extend({},d,a);f.scramble_setup=function(s){var v,r,e,B,u,w,t,x,A,z,y;v=s.find(".ui-keyboard-keyset");if(s.length){for(r=0;r<v.length;r++){e=v.eq(r);t=0;y=[];A=[];x=[];z=[];e.children("button, span, br").each(function(){if(this.tagName==="BR"){if(c.byRow){y.push(this);A.push(false);z[t]=y;x[t]=A;y=[];A=[];t++}else{z[t]=this;x[t]=false;t++}}else{w=b(this).attr("data-value")||"";w=w.length===1&&c.targetKeys.test(w)?w:false;if(c.byRow){y.push(this);A.push(w)}else{z[t]=this;x[t]=w;t++}}});e.find(".ui-keyboard-button-endrow").remove();if(!c.byRow){y=f.shuffle(z,x);for(B=0;B<y.length;B++){e.append(y[B])}}else{for(u=0;u<z.length;u++){y=f.shuffle(z[u],x[u]);for(B=0;B<y.length;B++){e.append(y[B])}}}}return s}};f.shuffle=function(k,l){var m,n,e=k.length;while(e>0){n=Math.floor(Math.random()*e);if(l[e-1]===false){e--}if(l[e-1]!==false&&l[n]!==false){e--;m=k[e];k[e]=k[n];k[n]=m}}return k};f.options.create=function(){var e=f.options.layout;b.keyboard.builtLayouts[e]={mappedKeys:{},acceptedKeys:[],$keyboard:null};if(typeof b.keyboard.builtLayouts[f.orig_layout]==="undefined"){f.layout=f.options.layout=f.orig_layout;f.buildKeyboard();f.layout=f.options.layout=e}b.keyboard.builtLayouts[e]=b.extend({},b.keyboard.builtLayouts[f.orig_layout]);if(c.randomizeOnce){b.keyboard.builtLayouts[e].$keyboard=f.scramble_setup(b.keyboard.builtLayouts[f.orig_layout].$keyboard.clone())}f.$keyboard=b.keyboard.builtLayouts[e].$keyboard;if(!c.randomizeOnce){f.$el.bind("beforeVisible.keyboard",function(i,j){j.$keyboard=j.scramble_setup(j.$keyboard)})}};f.orig_layout=f.options.layout;f.options.layout="scrambled"+Math.round(Math.random()*10000)})}})(jQuery);