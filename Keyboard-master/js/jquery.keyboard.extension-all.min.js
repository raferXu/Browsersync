/*! Copyright (c) 2011 Brandon Aaron (http://brandonaaron.net)
 * Licensed under the MIT License (LICENSE.txt).
 *
 * Thanks to: http://adomas.org/javascript-mouse-wheel/ for some pointers.
 * Thanks to: Mathias Bank(http://www.mathias-bank.de) for a scope bug fix.
 * Thanks to: Seamus Leahy for adding deltaX and deltaY
 *
 * Version: 3.0.6
 * 
 * Requires: 1.2.2+
 */
(function(d){var b=["DOMMouseScroll","mousewheel"];if(d.event.fixHooks){for(var a=b.length;a;){d.event.fixHooks[b[--a]]=d.event.mouseHooks}}d.event.special.mousewheel={setup:function(){if(this.addEventListener){for(var e=b.length;e;){this.addEventListener(b[--e],c,false)}}else{this.onmousewheel=c}},teardown:function(){if(this.removeEventListener){for(var e=b.length;e;){this.removeEventListener(b[--e],c,false)}}else{this.onmousewheel=null}}};d.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}});function c(j){var h=j||window.event,g=[].slice.call(arguments,1),k=0,i=true,f=0,e=0;j=d.event.fix(h);j.type="mousewheel";if(h.wheelDelta){k=h.wheelDelta/120}if(h.detail){k=-h.detail/3}e=k;if(h.axis!==undefined&&h.axis===h.HORIZONTAL_AXIS){e=0;f=-1*k}if(h.wheelDeltaY!==undefined){e=h.wheelDeltaY/120}if(h.wheelDeltaX!==undefined){f=-1*h.wheelDeltaX/120}g.unshift(j,k,f,e);return(d.event.dispatch||d.event.handle).apply(this,g)}})(jQuery);(function(a){a.fn.addAutocomplete=function(){return this.each(function(){var b=a(this).data("keyboard");if(!b){return}b.autocomplete_new_version=(function(c){c[0]=parseInt(c[0],10);return(c[0]>1)||(c[0]===1&&parseInt(c[1],10)>=9)})(a.ui.version.split("."));b.autocomplete_init=function(c,d,e){if(b.options.alwaysOpen&&b.isVisible()){b.autocomplete_setup()}b.$el.bind("visible.keyboard",function(){b.autocomplete_setup()}).bind("change.keyboard",function(){if(b.hasAutocomplete&&b.isVisible()){b.$el.val(b.$preview.val()).trigger("keydown.autocomplete")}}).bind("hidden.keyboard",function(f){b.$el.autocomplete("close")}).bind("autocompleteopen",function(g,f){if(b.hasAutocomplete){b.$autocomplete.menu.element.position({of:b.$keyboard,my:"right top",at:"left top",collision:"flip"})}}).bind("autocompleteselect",function(h,g){var f=g.item.value;if(b.hasAutocomplete&&f!==""){b.$preview.val(f).focus();b.lastCaret={start:f.length,end:f.length}}})};b.autocomplete_setup=function(){b.$autocomplete=b.$el.data("autocomplete")||b.$el.data("uiAutocomplete");b.hasAutocomplete=(typeof(b.$autocomplete)==="undefined")?false:(b.$autocomplete.options.disabled)?false:true;if(b.hasAutocomplete){b.$preview.bind("keydown",function(c){return b.autocomplete_input(c)});b.$allKeys.bind("mouseup mousedown mouseleave touchstart touchend touchcancel",function(c){b.autocomplete_input(c)})}};b.autocomplete_input=function(d){var c,e=a.ui.keyCode;switch(d.keyCode){case e.PAGE_UP:b.$autocomplete._move("previousPage",d);d.preventDefault();break;case e.PAGE_DOWN:b.$autocomplete._move("nextPage",d);d.preventDefault();break;case e.UP:b.$autocomplete._move("previous",d);d.preventDefault();break;case e.DOWN:b.$autocomplete._move("next",d);d.preventDefault();break;case e.ENTER:case e.NUMPAD_ENTER:c=b.$autocomplete.menu.element.find("#ui-active-menuitem,.ui-state-focus").text()||"";if(c!==""){b.$preview.val(c)}if(b.autocomplete_new_version){b.$autocomplete.menu.select(d)}break;default:clearTimeout(b.$autocomplete.searching);b.$autocomplete.searching=setTimeout(function(){if(b.$autocomplete.term!==b.$autocomplete.element.val()){b.$autocomplete.selectedItem=null;b.$autocomplete.search(null,d)}},b.$autocomplete.options.delay);break}};b.origEscClose=b.escClose;b.escClose=function(c){if(b.hasAutocomplete&&(c.target.id==="ui-active-menuitem"||a(c.target).closest("ul").hasClass("ui-autocomplete"))){return}b.origEscClose(c)};b.autocomplete_init()})}})(jQuery);(function(a){a.fn.addMobile=function(b){var d,c={container:{theme:"a"},buttonMarkup:{theme:"a",shadow:"true",corners:"true"},buttonHover:{theme:"c"},buttonAction:{theme:"b"},buttonActive:{theme:"e"}};return this.each(function(){var e=a(this).data("keyboard");if(!e||typeof(a.fn.textinput)==="undefined"){return}e.mobile_options=d=a.extend({},c,b);e.mobile_init=function(){a(".ui-keyboard-input").textinput();if(e.options.alwaysOpen&&e.isVisible){e.mobile_setup()}e.$el.on("beforeVisible.keyboard",function(){e.$keyboard.css("visibility","hidden")}).on("visible.keyboard",function(){e.mobile_setup();e.$keyboard.css("visibility","visible");e.$preview.focus()})};e.mobile_setup=function(){var g,f=a.extend({},d.buttonMarkup,d.buttonAction);e.$keyboard.addClass("ui-bar ui-bar-"+d.container.theme).removeClass("ui-widget ui-widget-content").find("button:not(."+e.options.css.buttonAction+")").addClass(e.modButton(d.buttonMarkup)).end().find("."+e.options.css.buttonAction).addClass(e.modButton(f)).end().find("button").removeClass("ui-corner-all ui-state-default").hover(function(){a(this).addClass("ui-btn-hover-"+d.buttonHover.theme)},function(){a(this).removeClass("ui-btn-hover-"+d.buttonHover.theme)});e.options.css.buttonAction="ui-btn-down-"+d.buttonActive.theme;if(e.msie&&e.$preview[0]!==e.el){e.$preview.hide();e.$keyboard.css("width","");e.width=e.$keyboard.outerWidth();e.$keyboard.width(e.width+parseInt(e.$preview.css("fontSize"),10));e.$preview.width(e.width);e.$preview.show()}g=e.options.position;g.of=g.of||e.$el.data("keyboardPosition")||e.$el;g.collision=(e.options.usePreview)?g.collision||"fit fit":"flip flip";e.$keyboard.position(g)};e.modButton=function(f){return"ui-btn ui-btn-up-"+f.theme+" ui-btn-"+f.theme+(f.shadow=="true"?" ui-shadow":"")+(f.corners=="true"?" ui-btn-corner-all":"")};e.mobile_init()})}})(jQuery);(function(a){a.keyboard=a.keyboard||{};a.keyboard.navigationKeys={toggle:112,enter:13,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,caretrt:45,caretlt:46};a.fn.addNavigation=function(b){return this.each(function(){var f,c,d=a(this).data("keyboard"),e={position:[0,0],toggleMode:false,focusClass:"hasFocus"};if(!d){return}d.navigation_options=f=a.extend({},e,b);d.navigation_keys=c=a.extend({},a.keyboard.navigationKeys);d.saveNav=[d.options.tabNavigation,d.options.enterNavigation];d.allNavKeys=a.map(c,function(g,h){return g});d.navigation_init=function(){d.$keyboard.toggleClass(f.focusClass,f.toggleMode).find(".ui-keyboard-keyset:visible").find('.ui-keyboard-button[data-pos="'+f.position[0]+","+f.position[1]+'"]').addClass("ui-state-hover");d.$preview.unbind("keydown.keyboardNav").bind("keydown.keyboardNav",function(g){return d.checkKeys(g.which)})};d.checkKeys=function(i,h){if(typeof(i)==="undefined"){return}var g=d.navigation_keys;if(i===g.toggle||h){f.toggleMode=(h)?false:!f.toggleMode;d.options.tabNavigation=(f.toggleMode)?false:d.saveNav[0];d.options.enterNavigation=(f.toggleMode)?false:d.saveNav[1]}d.$keyboard.toggleClass(f.focusClass,f.toggleMode);if(f.toggleMode&&i===g.enter){d.$keyboard.find(".ui-keyboard-keyset:visible").find('.ui-keyboard-button[data-pos="'+f.position[0]+","+f.position[1]+'"]').trigger("repeater.keyboard");return false}if(f.toggleMode&&a.inArray(i,d.allNavKeys)>=0){d.navigateKeys(i);return false}};d.navigateKeys=function(q,r,n){n=n||f.position[1];r=r||f.position[0];var h=d.$keyboard.find(".ui-keyboard-keyset:visible"),o=h.find(".ui-keyboard-button-endrow").length-1,m=h.find('.ui-keyboard-button[data-pos^="'+r+',"]').length-1,g=d.lastCaret,i=d.$preview.val().length,j=d.navigation_keys;switch(q){case j.pageup:r=0;break;case j.pagedown:r=o;break;case j.end:n=m;break;case j.home:n=0;break;case j.left:n+=(n>0)?-1:0;break;case j.up:r+=(r>0)?-1:0;break;case j.right:n+=1;break;case j.down:r+=(r+1>o)?0:1;break;case j.caretRt:g.start++;break;case j.caretLt:g.start--;break}if(q===j.caretRt||q===j.caretLt){g.start=g.start<0?0:g.start>i?i:g.start;g.end=g.start;d.lastCaret=g;d.$preview.focus().caret(g.start,g.start)}m=h.find('.ui-keyboard-button[data-pos^="'+r+',"]').length-1;if(n>m){n=m}h.find(".ui-state-hover").removeClass("ui-state-hover");h.find('.ui-keyboard-button[data-pos="'+r+","+n+'"]').addClass("ui-state-hover");f.position=[r,n]};if(d.options.alwaysOpen&&d.isVisible){d.$keyboard.find(".ui-state-hover").removeClass("ui-state-hover");d.navigation_init()}d.$el.bind("visible.keyboard",function(g){d.$keyboard.find(".ui-state-hover").removeClass("ui-state-hover");d.navigation_init()}).bind("inactive.keyboard hidden.keyboard",function(g){d.checkKeys(g.which,true)}).bind("navigate navigateTo",function(h,i,g){i=isNaN(i)?i.toLowerCase():i;if(d.navigation_keys.hasOwnProperty(i)){d.checkKeys(d.navigation_keys[i])}else{d.navigateKeys(null,i,g)}})})}})(jQuery);(function(a){a.keyboard=a.keyboard||{};a.fn.addScramble=function(b){var c={targetKeys:/[a-z\d]/i,byRow:true,randomizeOnce:true};return this.each(function(){var e,d=a(this).data("keyboard");if(!d){return}e=d.scramble_options=a.extend({},c,b);d.scramble_setup=function(m){var j,n,o,p,k,i,l,h,f,g,q;j=m.find(".ui-keyboard-keyset");if(m.length){for(n=0;n<j.length;n++){o=j.eq(n);l=0;q=[];f=[];h=[];g=[];o.children("button, span, br").each(function(){if(this.tagName==="BR"){if(e.byRow){q.push(this);f.push(false);g[l]=q;h[l]=f;q=[];f=[];l++}else{g[l]=this;h[l]=false;l++}}else{i=a(this).attr("data-value")||"";i=i.length===1&&e.targetKeys.test(i)?i:false;if(e.byRow){q.push(this);f.push(i)}else{g[l]=this;h[l]=i;l++}}});o.find(".ui-keyboard-button-endrow").remove();if(!e.byRow){q=d.shuffle(g,h);for(p=0;p<q.length;p++){o.append(q[p])}}else{for(k=0;k<g.length;k++){q=d.shuffle(g[k],h[k]);for(p=0;p<q.length;p++){o.append(q[p])}}}}return m}};d.shuffle=function(j,i){var h,g,f=j.length;while(f>0){g=Math.floor(Math.random()*f);if(i[f-1]===false){f--}if(i[f-1]!==false&&i[g]!==false){f--;h=j[f];j[f]=j[g];j[g]=h}}return j};d.options.create=function(){var f=d.options.layout;a.keyboard.builtLayouts[f]={mappedKeys:{},acceptedKeys:[],$keyboard:null};if(typeof a.keyboard.builtLayouts[d.orig_layout]==="undefined"){d.layout=d.options.layout=d.orig_layout;d.buildKeyboard();d.layout=d.options.layout=f}a.keyboard.builtLayouts[f]=a.extend({},a.keyboard.builtLayouts[d.orig_layout]);if(e.randomizeOnce){a.keyboard.builtLayouts[f].$keyboard=d.scramble_setup(a.keyboard.builtLayouts[d.orig_layout].$keyboard.clone())}d.$keyboard=a.keyboard.builtLayouts[f].$keyboard;if(!e.randomizeOnce){d.$el.bind("beforeVisible.keyboard",function(h,g){g.$keyboard=g.scramble_setup(g.$keyboard)})}};d.orig_layout=d.options.layout;d.options.layout="scrambled"+Math.round(Math.random()*10000)})}})(jQuery);(function(a){a.fn.addTyping=function(b){var c={showTyping:true,delay:250};return this.each(function(){var d=a(this).data("keyboard");if(!d){return}d.typing_options=a.extend({},c,b);d.typing_keymap={" ":"space",'"':"34","'":"39","&nbsp;":"space","\b":"bksp","\n":"Enter","\r":"Enter","\t":"tab"};d.typing_xref={8:"bksp",9:"tab",13:"enter",32:"space"};d.typing_event=false;d.typing_setup=function(){var e=(d.$preview)?d.$preview:d.$el;e.bind("keyup.keyboard",function(f){if(f.which>=37&&f.which<=40){return}if(f.which===16){d.shiftActive=false}if(f.which===18){d.altActive=false}if(f.which===16||f.which===18){d.showKeySet();setTimeout(function(){d.$preview.focus()},200);return}}).bind("keydown.keyboard",function(f){f.temp=false;if(f.which===16){f.temp=(d.shiftActive)?false:true;d.shiftActive=true}if(f.which===18){f.temp=(d.altActive)?false:true;d.altActive=true}if(f.temp){d.showKeySet();d.$preview.focus()}d.typing_event=true;if(f.which===8||f.which===9){d.typeIn("",d.typing_options.delay||250,function(){d.typing_event=false},f)}}).bind("keypress.keyboard",function(f){if(d.typing_event&&!d.options.lockInput){d.typeIn("",d.typing_options.delay||250,function(){d.typing_event=false},f)}})};d.typeIn=function(l,j,v,q){if(!d.isVisible()){d.typing_options.init=false;clearTimeout(d.typing_timer);return}var f=d.typing_options,p,h,g,i,u,r,w,s,t=a.keyboard.builtLayouts[d.layout].mappedKeys;if(d.typing_options.init!==true){f.init=true;f.text=l;f.len=l.length;f.delay=j||300;f.current=0;f.callback=v}l=f.text.substring(f.current,++f.current);r=d.$keyboard.find(".ui-keyboard-keyset");i=(d.typing_keymap.hasOwnProperty(l))?d.typing_keymap[l]:l;p='.ui-keyboard-button[data-value="'+i+'"]';if(d.typing_event&&q){if(d.typing_xref.hasOwnProperty(q.keyCode||q.which)){p=".ui-keyboard-"+d.typing_xref[q.keyCode||q.which]}else{h=String.fromCharCode(q.charCode||q.which);p=(t.hasOwnProperty(h))?'.ui-keyboard-button[data-value="'+t[h]+'"]':".ui-keyboard-"+(q.charCode||q.which)}}u=r.filter(":visible").find(p);if(u.length){d.typing_simulateKey(u,l)}else{if(d.typing_event){u=r.find(p)}else{g=(d.typing_keymap.hasOwnProperty(l))?d.typing_keymap[l]:l.charCodeAt(0);if(g==="bksp"){l=g}u=r.find(".ui-keyboard-"+g)}s=u.closest(".ui-keyboard-keyset");if(s.attr("name")){w=s.attr("name");d.shiftActive=/shift/.test(w);d.altActive=/alt/.test(w);d.metaActive=d.lastKeyset[2]=(w).match(/meta\d+/)||false;d.showKeySet({name:d.metaActive});d.typing_simulateKey(u,l)}else{if(!d.typing_event){d.insertText(l);d.checkCombos()}}}if(f.current<f.len){if(!d.isVisible()){return}setTimeout(function(){d.typeIn()},f.delay)}else{f.init=false;if(a.isFunction(f.callback)){setTimeout(function(){f.callback(d)},f.delay)}return}};d.typing_simulateKey=function(g,f){var h=g.length;if(h){g.filter(":visible").trigger("mouseenter.keyboard")}d.typing_timer=setTimeout(function(){if(h){setTimeout(function(){g.trigger("mouseleave.keyboard")},d.typing_options.delay/3)}if(!d.isVisible()){return}if(!d.typing_event){d.insertText(f);d.checkCombos()}},d.typing_options.delay/3)};if(d.typing_options.showTyping){if(d.options.alwaysOpen&&d.isVisible()){d.typing_setup()}d.$el.bind("visible.keyboard",function(){d.typing_setup()})}})}})(jQuery);