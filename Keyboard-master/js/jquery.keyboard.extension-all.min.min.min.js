/*! Copyright (c) 2011 Brandon Aaron (http://brandonaaron.net)
 * Licensed under the MIT License (LICENSE.txt).
 *
 * Thanks to: http://adomas.org/javascript-mouse-wheel/ for some pointers.
 * Thanks to: Mathias Bank(http://www.mathias-bank.de) for a scope bug fix.
 * Thanks to: Seamus Leahy for adding deltaX and deltaY
 *
 * Version: 3.0.6
 * 
 * Requires: 1.2.2+
 */
(function(b){var d=["DOMMouseScroll","mousewheel"];if(b.event.fixHooks){for(var c=d.length;c;){b.event.fixHooks[d[--c]]=b.event.mouseHooks}}b.event.special.mousewheel={setup:function(){if(this.addEventListener){for(var e=d.length;e;){this.addEventListener(d[--e],a,false)}}else{this.onmousewheel=a}},teardown:function(){if(this.removeEventListener){for(var e=d.length;e;){this.removeEventListener(d[--e],a,false)}}else{this.onmousewheel=null}}};b.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}});function a(f){var i=f||window.event,h=[].slice.call(arguments,1),g=0,k=true,e=0,j=0;f=b.event.fix(i);f.type="mousewheel";if(i.wheelDelta){g=i.wheelDelta/120}if(i.detail){g=-i.detail/3}j=g;if(i.axis!==undefined&&i.axis===i.HORIZONTAL_AXIS){j=0;e=-1*g}if(i.wheelDeltaY!==undefined){j=i.wheelDeltaY/120}if(i.wheelDeltaX!==undefined){e=-1*i.wheelDeltaX/120}h.unshift(f,g,e,j);return(b.event.dispatch||b.event.handle).apply(this,h)}})(jQuery);(function(a){a.fn.addAutocomplete=function(){return this.each(function(){var b=a(this).data("keyboard");if(!b){return}b.autocomplete_new_version=(function(c){c[0]=parseInt(c[0],10);return(c[0]>1)||(c[0]===1&&parseInt(c[1],10)>=9)})(a.ui.version.split("."));b.autocomplete_init=function(c,d,e){if(b.options.alwaysOpen&&b.isVisible()){b.autocomplete_setup()}b.$el.bind("visible.keyboard",function(){b.autocomplete_setup()}).bind("change.keyboard",function(){if(b.hasAutocomplete&&b.isVisible()){b.$el.val(b.$preview.val()).trigger("keydown.autocomplete")}}).bind("hidden.keyboard",function(f){b.$el.autocomplete("close")}).bind("autocompleteopen",function(g,f){if(b.hasAutocomplete){b.$autocomplete.menu.element.position({of:b.$keyboard,my:"right top",at:"left top",collision:"flip"})}}).bind("autocompleteselect",function(h,g){var f=g.item.value;if(b.hasAutocomplete&&f!==""){b.$preview.val(f).focus();b.lastCaret={start:f.length,end:f.length}}})};b.autocomplete_setup=function(){b.$autocomplete=b.$el.data("autocomplete")||b.$el.data("uiAutocomplete");b.hasAutocomplete=(typeof(b.$autocomplete)==="undefined")?false:(b.$autocomplete.options.disabled)?false:true;if(b.hasAutocomplete){b.$preview.bind("keydown",function(c){return b.autocomplete_input(c)});b.$allKeys.bind("mouseup mousedown mouseleave touchstart touchend touchcancel",function(c){b.autocomplete_input(c)})}};b.autocomplete_input=function(d){var c,e=a.ui.keyCode;switch(d.keyCode){case e.PAGE_UP:b.$autocomplete._move("previousPage",d);d.preventDefault();break;case e.PAGE_DOWN:b.$autocomplete._move("nextPage",d);d.preventDefault();break;case e.UP:b.$autocomplete._move("previous",d);d.preventDefault();break;case e.DOWN:b.$autocomplete._move("next",d);d.preventDefault();break;case e.ENTER:case e.NUMPAD_ENTER:c=b.$autocomplete.menu.element.find("#ui-active-menuitem,.ui-state-focus").text()||"";if(c!==""){b.$preview.val(c)}if(b.autocomplete_new_version){b.$autocomplete.menu.select(d)}break;default:clearTimeout(b.$autocomplete.searching);b.$autocomplete.searching=setTimeout(function(){if(b.$autocomplete.term!==b.$autocomplete.element.val()){b.$autocomplete.selectedItem=null;b.$autocomplete.search(null,d)}},b.$autocomplete.options.delay);break}};b.origEscClose=b.escClose;b.escClose=function(c){if(b.hasAutocomplete&&(c.target.id==="ui-active-menuitem"||a(c.target).closest("ul").hasClass("ui-autocomplete"))){return}b.origEscClose(c)};b.autocomplete_init()})}})(jQuery);(function(a){a.fn.addMobile=function(b){var d,c={container:{theme:"a"},buttonMarkup:{theme:"a",shadow:"true",corners:"true"},buttonHover:{theme:"c"},buttonAction:{theme:"b"},buttonActive:{theme:"e"}};return this.each(function(){var e=a(this).data("keyboard");if(!e||typeof(a.fn.textinput)==="undefined"){return}e.mobile_options=d=a.extend({},c,b);e.mobile_init=function(){a(".ui-keyboard-input").textinput();if(e.options.alwaysOpen&&e.isVisible){e.mobile_setup()}e.$el.on("beforeVisible.keyboard",function(){e.$keyboard.css("visibility","hidden")}).on("visible.keyboard",function(){e.mobile_setup();e.$keyboard.css("visibility","visible");e.$preview.focus()})};e.mobile_setup=function(){var g,f=a.extend({},d.buttonMarkup,d.buttonAction);e.$keyboard.addClass("ui-bar ui-bar-"+d.container.theme).removeClass("ui-widget ui-widget-content").find("button:not(."+e.options.css.buttonAction+")").addClass(e.modButton(d.buttonMarkup)).end().find("."+e.options.css.buttonAction).addClass(e.modButton(f)).end().find("button").removeClass("ui-corner-all ui-state-default").hover(function(){a(this).addClass("ui-btn-hover-"+d.buttonHover.theme)},function(){a(this).removeClass("ui-btn-hover-"+d.buttonHover.theme)});e.options.css.buttonAction="ui-btn-down-"+d.buttonActive.theme;if(e.msie&&e.$preview[0]!==e.el){e.$preview.hide();e.$keyboard.css("width","");e.width=e.$keyboard.outerWidth();e.$keyboard.width(e.width+parseInt(e.$preview.css("fontSize"),10));e.$preview.width(e.width);e.$preview.show()}g=e.options.position;g.of=g.of||e.$el.data("keyboardPosition")||e.$el;g.collision=(e.options.usePreview)?g.collision||"fit fit":"flip flip";e.$keyboard.position(g)};e.modButton=function(f){return"ui-btn ui-btn-up-"+f.theme+" ui-btn-"+f.theme+(f.shadow=="true"?" ui-shadow":"")+(f.corners=="true"?" ui-btn-corner-all":"")};e.mobile_init()})}})(jQuery);(function(a){a.keyboard=a.keyboard||{};a.keyboard.navigationKeys={toggle:112,enter:13,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,caretrt:45,caretlt:46};a.fn.addNavigation=function(b){return this.each(function(){var f,c,d=a(this).data("keyboard"),e={position:[0,0],toggleMode:false,focusClass:"hasFocus"};if(!d){return}d.navigation_options=f=a.extend({},e,b);d.navigation_keys=c=a.extend({},a.keyboard.navigationKeys);d.saveNav=[d.options.tabNavigation,d.options.enterNavigation];d.allNavKeys=a.map(c,function(g,h){return g});d.navigation_init=function(){d.$keyboard.toggleClass(f.focusClass,f.toggleMode).find(".ui-keyboard-keyset:visible").find('.ui-keyboard-button[data-pos="'+f.position[0]+","+f.position[1]+'"]').addClass("ui-state-hover");d.$preview.unbind("keydown.keyboardNav").bind("keydown.keyboardNav",function(g){return d.checkKeys(g.which)})};d.checkKeys=function(i,h){if(typeof(i)==="undefined"){return}var g=d.navigation_keys;if(i===g.toggle||h){f.toggleMode=(h)?false:!f.toggleMode;d.options.tabNavigation=(f.toggleMode)?false:d.saveNav[0];d.options.enterNavigation=(f.toggleMode)?false:d.saveNav[1]}d.$keyboard.toggleClass(f.focusClass,f.toggleMode);if(f.toggleMode&&i===g.enter){d.$keyboard.find(".ui-keyboard-keyset:visible").find('.ui-keyboard-button[data-pos="'+f.position[0]+","+f.position[1]+'"]').trigger("repeater.keyboard");return false}if(f.toggleMode&&a.inArray(i,d.allNavKeys)>=0){d.navigateKeys(i);return false}};d.navigateKeys=function(n,o,j){j=j||f.position[1];o=o||f.position[0];var r=d.$keyboard.find(".ui-keyboard-keyset:visible"),m=r.find(".ui-keyboard-button-endrow").length-1,i=r.find('.ui-keyboard-button[data-pos^="'+o+',"]').length-1,q=d.lastCaret,g=d.$preview.val().length,h=d.navigation_keys;switch(n){case h.pageup:o=0;break;case h.pagedown:o=m;break;case h.end:j=i;break;case h.home:j=0;break;case h.left:j+=(j>0)?-1:0;break;case h.up:o+=(o>0)?-1:0;break;case h.right:j+=1;break;case h.down:o+=(o+1>m)?0:1;break;case h.caretRt:q.start++;break;case h.caretLt:q.start--;break}if(n===h.caretRt||n===h.caretLt){q.start=q.start<0?0:q.start>g?g:q.start;q.end=q.start;d.lastCaret=q;d.$preview.focus().caret(q.start,q.start)}i=r.find('.ui-keyboard-button[data-pos^="'+o+',"]').length-1;if(j>i){j=i}r.find(".ui-state-hover").removeClass("ui-state-hover");r.find('.ui-keyboard-button[data-pos="'+o+","+j+'"]').addClass("ui-state-hover");f.position=[o,j]};if(d.options.alwaysOpen&&d.isVisible){d.$keyboard.find(".ui-state-hover").removeClass("ui-state-hover");d.navigation_init()}d.$el.bind("visible.keyboard",function(g){d.$keyboard.find(".ui-state-hover").removeClass("ui-state-hover");d.navigation_init()}).bind("inactive.keyboard hidden.keyboard",function(g){d.checkKeys(g.which,true)}).bind("navigate navigateTo",function(h,i,g){i=isNaN(i)?i.toLowerCase():i;if(d.navigation_keys.hasOwnProperty(i)){d.checkKeys(d.navigation_keys[i])}else{d.navigateKeys(null,i,g)}})})}})(jQuery);(function(a){a.keyboard=a.keyboard||{};a.fn.addScramble=function(b){var c={targetKeys:/[a-z\d]/i,byRow:true,randomizeOnce:true};return this.each(function(){var e,d=a(this).data("keyboard");if(!d){return}e=d.scramble_options=a.extend({},c,b);d.scramble_setup=function(o){var l,p,q,f,m,k,n,j,g,h,i;l=o.find(".ui-keyboard-keyset");if(o.length){for(p=0;p<l.length;p++){q=l.eq(p);n=0;i=[];g=[];j=[];h=[];q.children("button, span, br").each(function(){if(this.tagName==="BR"){if(e.byRow){i.push(this);g.push(false);h[n]=i;j[n]=g;i=[];g=[];n++}else{h[n]=this;j[n]=false;n++}}else{k=a(this).attr("data-value")||"";k=k.length===1&&e.targetKeys.test(k)?k:false;if(e.byRow){i.push(this);g.push(k)}else{h[n]=this;j[n]=k;n++}}});q.find(".ui-keyboard-button-endrow").remove();if(!e.byRow){i=d.shuffle(h,j);for(f=0;f<i.length;f++){q.append(i[f])}}else{for(m=0;m<h.length;m++){i=d.shuffle(h[m],j[m]);for(f=0;f<i.length;f++){q.append(i[f])}}}}return o}};d.shuffle=function(i,h){var g,f,j=i.length;while(j>0){f=Math.floor(Math.random()*j);if(h[j-1]===false){j--}if(h[j-1]!==false&&h[f]!==false){j--;g=i[j];i[j]=i[f];i[f]=g}}return i};d.options.create=function(){var f=d.options.layout;a.keyboard.builtLayouts[f]={mappedKeys:{},acceptedKeys:[],$keyboard:null};if(typeof a.keyboard.builtLayouts[d.orig_layout]==="undefined"){d.layout=d.options.layout=d.orig_layout;d.buildKeyboard();d.layout=d.options.layout=f}a.keyboard.builtLayouts[f]=a.extend({},a.keyboard.builtLayouts[d.orig_layout]);if(e.randomizeOnce){a.keyboard.builtLayouts[f].$keyboard=d.scramble_setup(a.keyboard.builtLayouts[d.orig_layout].$keyboard.clone())}d.$keyboard=a.keyboard.builtLayouts[f].$keyboard;if(!e.randomizeOnce){d.$el.bind("beforeVisible.keyboard",function(h,g){g.$keyboard=g.scramble_setup(g.$keyboard)})}};d.orig_layout=d.options.layout;d.options.layout="scrambled"+Math.round(Math.random()*10000)})}})(jQuery);(function(a){a.fn.addTyping=function(b){var c={showTyping:true,delay:250};return this.each(function(){var d=a(this).data("keyboard");if(!d){return}d.typing_options=a.extend({},c,b);d.typing_keymap={" ":"space",'"':"34","'":"39","&nbsp;":"space","\b":"bksp","\n":"Enter","\r":"Enter","\t":"tab"};d.typing_xref={8:"bksp",9:"tab",13:"enter",32:"space"};d.typing_event=false;d.typing_setup=function(){var e=(d.$preview)?d.$preview:d.$el;e.bind("keyup.keyboard",function(f){if(f.which>=37&&f.which<=40){return}if(f.which===16){d.shiftActive=false}if(f.which===18){d.altActive=false}if(f.which===16||f.which===18){d.showKeySet();setTimeout(function(){d.$preview.focus()},200);return}}).bind("keydown.keyboard",function(f){f.temp=false;if(f.which===16){f.temp=(d.shiftActive)?false:true;d.shiftActive=true}if(f.which===18){f.temp=(d.altActive)?false:true;d.altActive=true}if(f.temp){d.showKeySet();d.$preview.focus()}d.typing_event=true;if(f.which===8||f.which===9){d.typeIn("",d.typing_options.delay||250,function(){d.typing_event=false},f)}}).bind("keypress.keyboard",function(f){if(d.typing_event&&!d.options.lockInput){d.typeIn("",d.typing_options.delay||250,function(){d.typing_event=false},f)}})};d.typeIn=function(l,i,g,q){if(!d.isVisible()){d.typing_options.init=false;clearTimeout(d.typing_timer);return}var j=d.typing_options,p,t,s,u,f,r,h,v,w=a.keyboard.builtLayouts[d.layout].mappedKeys;if(d.typing_options.init!==true){j.init=true;j.text=l;j.len=l.length;j.delay=i||300;j.current=0;j.callback=g}l=j.text.substring(j.current,++j.current);r=d.$keyboard.find(".ui-keyboard-keyset");u=(d.typing_keymap.hasOwnProperty(l))?d.typing_keymap[l]:l;p='.ui-keyboard-button[data-value="'+u+'"]';if(d.typing_event&&q){if(d.typing_xref.hasOwnProperty(q.keyCode||q.which)){p=".ui-keyboard-"+d.typing_xref[q.keyCode||q.which]}else{t=String.fromCharCode(q.charCode||q.which);p=(w.hasOwnProperty(t))?'.ui-keyboard-button[data-value="'+w[t]+'"]':".ui-keyboard-"+(q.charCode||q.which)}}f=r.filter(":visible").find(p);if(f.length){d.typing_simulateKey(f,l)}else{if(d.typing_event){f=r.find(p)}else{s=(d.typing_keymap.hasOwnProperty(l))?d.typing_keymap[l]:l.charCodeAt(0);if(s==="bksp"){l=s}f=r.find(".ui-keyboard-"+s)}v=f.closest(".ui-keyboard-keyset");if(v.attr("name")){h=v.attr("name");d.shiftActive=/shift/.test(h);d.altActive=/alt/.test(h);d.metaActive=d.lastKeyset[2]=(h).match(/meta\d+/)||false;d.showKeySet({name:d.metaActive});d.typing_simulateKey(f,l)}else{if(!d.typing_event){d.insertText(l);d.checkCombos()}}}if(j.current<j.len){if(!d.isVisible()){return}setTimeout(function(){d.typeIn()},j.delay)}else{j.init=false;if(a.isFunction(j.callback)){setTimeout(function(){j.callback(d)},j.delay)}return}};d.typing_simulateKey=function(g,f){var h=g.length;if(h){g.filter(":visible").trigger("mouseenter.keyboard")}d.typing_timer=setTimeout(function(){if(h){setTimeout(function(){g.trigger("mouseleave.keyboard")},d.typing_options.delay/3)}if(!d.isVisible()){return}if(!d.typing_event){d.insertText(f);d.checkCombos()}},d.typing_options.delay/3)};if(d.typing_options.showTyping){if(d.options.alwaysOpen&&d.isVisible()){d.typing_setup()}d.$el.bind("visible.keyboard",function(){d.typing_setup()})}})}})(jQuery);