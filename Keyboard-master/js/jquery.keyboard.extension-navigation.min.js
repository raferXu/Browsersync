(function(a){a.keyboard=a.keyboard||{};a.keyboard.navigationKeys={toggle:112,enter:13,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,caretrt:45,caretlt:46};a.fn.addNavigation=function(b){return this.each(function(){var f,c,d=a(this).data("keyboard"),e={position:[0,0],toggleMode:false,focusClass:"hasFocus"};if(!d){return}d.navigation_options=f=a.extend({},e,b);d.navigation_keys=c=a.extend({},a.keyboard.navigationKeys);d.saveNav=[d.options.tabNavigation,d.options.enterNavigation];d.allNavKeys=a.map(c,function(g,h){return g});d.navigation_init=function(){d.$keyboard.toggleClass(f.focusClass,f.toggleMode).find(".ui-keyboard-keyset:visible").find('.ui-keyboard-button[data-pos="'+f.position[0]+","+f.position[1]+'"]').addClass("ui-state-hover");d.$preview.unbind("keydown.keyboardNav").bind("keydown.keyboardNav",function(g){return d.checkKeys(g.which)})};d.checkKeys=function(i,h){if(typeof(i)==="undefined"){return}var g=d.navigation_keys;if(i===g.toggle||h){f.toggleMode=(h)?false:!f.toggleMode;d.options.tabNavigation=(f.toggleMode)?false:d.saveNav[0];d.options.enterNavigation=(f.toggleMode)?false:d.saveNav[1]}d.$keyboard.toggleClass(f.focusClass,f.toggleMode);if(f.toggleMode&&i===g.enter){d.$keyboard.find(".ui-keyboard-keyset:visible").find('.ui-keyboard-button[data-pos="'+f.position[0]+","+f.position[1]+'"]').trigger("repeater.keyboard");return false}if(f.toggleMode&&a.inArray(i,d.allNavKeys)>=0){d.navigateKeys(i);return false}};d.navigateKeys=function(q,r,n){n=n||f.position[1];r=r||f.position[0];var h=d.$keyboard.find(".ui-keyboard-keyset:visible"),o=h.find(".ui-keyboard-button-endrow").length-1,m=h.find('.ui-keyboard-button[data-pos^="'+r+',"]').length-1,g=d.lastCaret,i=d.$preview.val().length,j=d.navigation_keys;switch(q){case j.pageup:r=0;break;case j.pagedown:r=o;break;case j.end:n=m;break;case j.home:n=0;break;case j.left:n+=(n>0)?-1:0;break;case j.up:r+=(r>0)?-1:0;break;case j.right:n+=1;break;case j.down:r+=(r+1>o)?0:1;break;case j.caretRt:g.start++;break;case j.caretLt:g.start--;break}if(q===j.caretRt||q===j.caretLt){g.start=g.start<0?0:g.start>i?i:g.start;g.end=g.start;d.lastCaret=g;d.$preview.focus().caret(g.start,g.start)}m=h.find('.ui-keyboard-button[data-pos^="'+r+',"]').length-1;if(n>m){n=m}h.find(".ui-state-hover").removeClass("ui-state-hover");h.find('.ui-keyboard-button[data-pos="'+r+","+n+'"]').addClass("ui-state-hover");f.position=[r,n]};if(d.options.alwaysOpen&&d.isVisible){d.$keyboard.find(".ui-state-hover").removeClass("ui-state-hover");d.navigation_init()}d.$el.bind("visible.keyboard",function(g){d.$keyboard.find(".ui-state-hover").removeClass("ui-state-hover");d.navigation_init()}).bind("inactive.keyboard hidden.keyboard",function(g){d.checkKeys(g.which,true)}).bind("navigate navigateTo",function(h,i,g){i=isNaN(i)?i.toLowerCase():i;if(d.navigation_keys.hasOwnProperty(i)){d.checkKeys(d.navigation_keys[i])}else{d.navigateKeys(null,i,g)}})})}})(jQuery);