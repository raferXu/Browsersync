(function(b){b.fn.addAutocomplete=function(){return this.each(function(){var a=b(this).data("keyboard");if(!a){return}a.autocomplete_new_version=(function(d){d[0]=parseInt(d[0],10);return(d[0]>1)||(d[0]===1&&parseInt(d[1],10)>=9)})(b.ui.version.split("."));a.autocomplete_init=function(h,g,f){if(a.options.alwaysOpen&&a.isVisible()){a.autocomplete_setup()}a.$el.bind("visible.keyboard",function(){a.autocomplete_setup()}).bind("change.keyboard",function(){if(a.hasAutocomplete&&a.isVisible()){a.$el.val(a.$preview.val()).trigger("keydown.autocomplete")}}).bind("hidden.keyboard",function(c){a.$el.autocomplete("close")}).bind("autocompleteopen",function(c,d){if(a.hasAutocomplete){a.$autocomplete.menu.element.position({of:a.$keyboard,my:"right top",at:"left top",collision:"flip"})}}).bind("autocompleteselect",function(c,d){var e=d.item.value;if(a.hasAutocomplete&&e!==""){a.$preview.val(e).focus();a.lastCaret={start:e.length,end:e.length}}})};a.autocomplete_setup=function(){a.$autocomplete=a.$el.data("autocomplete")||a.$el.data("uiAutocomplete");a.hasAutocomplete=(typeof(a.$autocomplete)==="undefined")?false:(a.$autocomplete.options.disabled)?false:true;if(a.hasAutocomplete){a.$preview.bind("keydown",function(d){return a.autocomplete_input(d)});a.$allKeys.bind("mouseup mousedown mouseleave touchstart touchend touchcancel",function(d){a.autocomplete_input(d)})}};a.autocomplete_input=function(g){var h,f=b.ui.keyCode;switch(g.keyCode){case f.PAGE_UP:a.$autocomplete._move("previousPage",g);g.preventDefault();break;case f.PAGE_DOWN:a.$autocomplete._move("nextPage",g);g.preventDefault();break;case f.UP:a.$autocomplete._move("previous",g);g.preventDefault();break;case f.DOWN:a.$autocomplete._move("next",g);g.preventDefault();break;case f.ENTER:case f.NUMPAD_ENTER:h=a.$autocomplete.menu.element.find("#ui-active-menuitem,.ui-state-focus").text()||"";if(h!==""){a.$preview.val(h)}if(a.autocomplete_new_version){a.$autocomplete.menu.select(g)}break;default:clearTimeout(a.$autocomplete.searching);a.$autocomplete.searching=setTimeout(function(){if(a.$autocomplete.term!==a.$autocomplete.element.val()){a.$autocomplete.selectedItem=null;a.$autocomplete.search(null,g)}},a.$autocomplete.options.delay);break}};a.origEscClose=a.escClose;a.escClose=function(d){if(a.hasAutocomplete&&(d.target.id==="ui-active-menuitem"||b(d.target).closest("ul").hasClass("ui-autocomplete"))){return}a.origEscClose(d)};a.autocomplete_init()})}})(jQuery);