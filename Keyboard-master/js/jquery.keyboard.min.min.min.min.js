/*!
jQuery UI Virtual Keyboard
Version 1.18.2

Author: Jeremy Satterfield
Modified: Rob Garrison (Mottie on github)
-----------------------------------------
Licensed under the MIT License

Caret code modified from jquery.caret.1.02.js
Licensed under the MIT License:
http://www.opensource.org/licenses/mit-license.php
-----------------------------------------

An on-screen virtual keyboard embedded within the browser window which
will popup when a specified entry field is focused. The user can then
type and preview their input before Accepting or Canceling.

As a plugin to jQuery UI styling and theme will automatically
match that used by jQuery UI with the exception of the required CSS.

Requires:
	jQuery
	jQuery UI (position utility only) & CSS theme

Setup/Usage:
	Please refer to https://github.com/Mottie/Keyboard/wiki
*/
;(function(b){b.keyboard=function(h,a){var g=this,f;g.$el=b(h);g.el=h;g.$el.data("keyboard",g);g.init=function(){g.options=f=b.extend(true,{},b.keyboard.defaultOptions,a);g.shiftActive=g.altActive=g.metaActive=g.sets=g.capsLock=false;g.lastKeyset=[false,false,false];g.rows=["","-shift","-alt","-alt-shift"];b('<!--[if lte IE 8]><script>jQuery("body").addClass("oldie");<\/script><![endif]--><!--[if IE]><script>jQuery("body").addClass("ie");<\/script><![endif]-->').appendTo("body").remove();g.msie=b("body").hasClass("oldie");g.allie=b("body").hasClass("ie");g.inPlaceholder=g.$el.attr("placeholder")||"";g.watermark=(typeof(document.createElement("input").placeholder)!=="undefined"&&g.inPlaceholder!=="");g.regex=b.keyboard.comboRegex;g.decimal=(/^\./.test(f.display.dec))?true:false;g.repeatTime=1000/(f.repeatRate||20);f.preventDoubleEventTime=f.preventDoubleEventTime||100;g.isOpen=false;g.wheel=b.isFunction(b.fn.mousewheel);g.alwaysAllowed=[20,33,34,35,36,37,38,39,40,45,46];g.$keyboard=[];g.temp=b('<input style="position:absolute;left:-9999em;top:-9999em;" type="text" value="testing">').appendTo("body").caret(3,3);g.checkCaret=(f.lockInput||g.temp.hide().show().caret().start!==3)?true:false;g.temp.remove();g.lastCaret={start:0,end:0};g.temp=["",0,0];b.each("initialized beforeVisible visible hidden canceled accepted beforeClose".split(" "),function(d,c){if(b.isFunction(f[c])){g.$el.bind(c+".keyboard",f[c])}});if(f.alwaysOpen){f.stayOpen=true}b(document).bind("mousedown keyup touchstart checkkeyboard".split(" ").join(".keyboard "),function(c){if(g.opening){return}g.escClose(c);if(c.target&&b(c.target).hasClass("ui-keyboard-input")){var d=b(c.target).data("keyboard");if(d===g&&d.options.openOn){d.focusOn()}}});g.$el.addClass("ui-keyboard-input "+f.css.input).attr({"aria-haspopup":"true",role:"textbox"});if(g.$el.is(":disabled")||(g.$el.attr("readonly")&&!g.$el.hasClass("ui-keyboard-lockedinput"))){g.$el.addClass("ui-keyboard-nokeyboard")}if(f.openOn){g.$el.bind(f.openOn+".keyboard",function(){g.focusOn()})}if(!g.watermark&&g.$el.val()===""&&g.inPlaceholder!==""&&g.$el.attr("placeholder")!==""){g.$el.addClass("ui-keyboard-placeholder").val(g.inPlaceholder)}g.$el.trigger("initialized.keyboard",[g,g.el]);if(f.alwaysOpen){g.reveal()}};g.setCurrent=function(){b(".ui-keyboard-has-focus").removeClass("ui-keyboard-has-focus");b(".ui-keyboard-input-current").removeClass("ui-keyboard-input-current");g.$el.addClass("ui-keyboard-input-current");g.$keyboard.addClass("ui-keyboard-has-focus");g.isCurrent(true);g.isOpen=true};g.isCurrent=function(c){var d=b.keyboard.currentKeyboard||false;if(c){d=b.keyboard.currentKeyboard=g.el}else{if(c===false&&d===g.el){d=b.keyboard.currentKeyboard=""}}return d===g.el};g.isVisible=function(){if(!g.$keyboard.length){return false}return g.$keyboard.is(":visible")};g.focusOn=function(){if(g.$el.is(":visible")){setTimeout(function(){g.lastCaret=g.$el.caret()},20)}if(!g.isVisible()){clearTimeout(g.timer);g.reveal()}if(f.alwaysOpen){g.setCurrent()}};g.reveal=function(){g.opening=true;b(".ui-keyboard").not(".ui-keyboard-always-open").remove();if(g.$el.is(":disabled")||(g.$el.attr("readonly")&&!g.$el.hasClass("ui-keyboard-lockedinput"))){g.$el.addClass("ui-keyboard-nokeyboard");return}else{g.$el.removeClass("ui-keyboard-nokeyboard")}if(f.openOn){g.$el.unbind(f.openOn+".keyboard")}if(!g.$keyboard.length||b.contains(document.body,g.$keyboard[0])){g.startup()}if(!g.watermark&&g.el.value===g.inPlaceholder){g.$el.removeClass("ui-keyboard-placeholder").val("")}g.originalContent=g.$el.val();g.$preview.val(g.originalContent);if(f.acceptValid){g.checkValid()}var c,d;g.position=f.position;g.position.of=g.position.of||g.$el.data("keyboardPosition")||g.$el;g.position.collision=g.position.collision||(f.usePreview?"fit fit":"flip flip");if(f.resetDefault){g.shiftActive=g.altActive=g.metaActive=false;g.showKeySet()}g.$keyboard.css({position:"absolute",left:0,top:0});g.$el.trigger("beforeVisible.keyboard",[g,g.el]);g.setCurrent();g.$keyboard.show();if(f.usePreview&&g.msie){if(typeof g.width==="undefined"){g.$preview.hide();g.width=Math.ceil(g.$keyboard.width());g.$preview.show()}g.$preview.width(g.width)}if(b.ui.position){g.$keyboard.position(g.position)}g.checkDecimal();g.lineHeight=parseInt(g.$preview.css("lineHeight"),10)||parseInt(g.$preview.css("font-size"),10)+4;if(f.caretToEnd){d=g.originalContent.length;g.lastCaret={start:d,end:d}}if(g.allie){d=g.lastCaret.start||g.originalContent.length;c={start:d,end:d};if(!g.lastCaret){g.lastCaret=c}if(g.lastCaret.end===0&&g.lastCaret.start>0){g.lastCaret.end=g.lastCaret.start}if(g.lastCaret.start<0){g.lastCaret=c}}setTimeout(function(){g.opening=false;if(f.initialFocus){g.$preview.focus().caret(g.lastCaret)}g.$el.trigger("visible.keyboard",[g,g.el])},10);return g};g.startup=function(){if(!g.$keyboard.length){if(f.layout==="custom"){f.layoutHash="custom"+g.customHash()}g.layout=f.layout==="custom"?f.layoutHash:f.layout;if(typeof b.keyboard.builtLayouts[g.layout]==="undefined"){if(b.isFunction(f.create)){f.create(g)}if(!g.$keyboard.length){g.buildKeyboard()}}g.$keyboard=b.keyboard.builtLayouts[g.layout].$keyboard.clone();if(f.usePreview){g.$preview=g.$el.clone(false).removeAttr("id").removeClass("ui-keyboard-placeholder ui-keyboard-input").addClass("ui-keyboard-preview "+f.css.input).attr("tabindex","-1").show();b("<div />").addClass("ui-keyboard-preview-wrapper").append(g.$preview).prependTo(g.$keyboard)}else{g.$preview=g.$el;f.position.at=f.position.at2}}g.preview=g.$preview[0];g.$decBtn=g.$keyboard.find(".ui-keyboard-dec");if(f.enterNavigation||g.el.tagName==="TEXTAREA"){g.alwaysAllowed.push(13)}if(f.lockInput){g.$preview.addClass("ui-keyboard-lockedinput").attr({readonly:"readonly"})}g.bindKeyboard();if(f.appendLocally){g.$el.after(g.$keyboard)}else{g.$keyboard.appendTo("body")}g.bindKeys();b(window).bind("resize.keyboard",function(){if(g.isVisible()){g.$keyboard.position(g.position)}})};g.bindKeyboard=function(){var c=b.keyboard.builtLayouts[g.layout];g.$preview.unbind("keypress keyup keydown mouseup touchend ".split(" ").join(".keyboard ")).bind("keypress.keyboard",function(d){var e=g.lastKey=String.fromCharCode(d.charCode||d.which);g.$lastKey=[];if(g.checkCaret){g.lastCaret=g.$preview.caret()}g.capsLock=(((e>=65&&e<=90)&&!d.shiftKey)||((e>=97&&e<=122)&&d.shiftKey))?true:false;if(f.restrictInput){if((d.which===8||d.which===0)&&b.inArray(d.keyCode,g.alwaysAllowed)){return}if(b.inArray(e,c.acceptedKeys)===-1){d.preventDefault()}}else{if((d.ctrlKey||d.metaKey)&&(d.which===97||d.which===99||d.which===118||(d.which>=120&&d.which<=122))){return}}if(c.hasMappedKeys){if(c.mappedKeys.hasOwnProperty(e)){g.lastKey=c.mappedKeys[e];g.insertText(g.lastKey);d.preventDefault()}}g.checkMaxLength()}).bind("keyup.keyboard",function(d){switch(d.which){case 9:if(g.tab&&f.tabNavigation&&!f.lockInput){g.shiftActive=d.shiftKey;var e=b.keyboard.keyaction.tab(g);g.tab=false;if(!e){return false}}else{d.preventDefault()}break;case 27:g.close();return false}clearTimeout(g.throttled);g.throttled=setTimeout(function(){if(g.isVisible()){g.checkCombos()}},100);g.checkMaxLength();if(b.isFunction(f.change)){f.change(b.Event("change"),g,g.el)}g.$el.trigger("change.keyboard",[g,g.el])}).bind("keydown.keyboard",function(d){switch(d.which){case 9:if(f.tabNavigation){g.tab=true;return false}else{g.tab=true;return false}break;case 13:b.keyboard.keyaction.enter(g,null,d);break;case 20:g.shiftActive=g.capsLock=!g.capsLock;g.showKeySet(this);break;case 86:if(d.ctrlKey||d.metaKey){if(f.preventPaste){d.preventDefault();return}g.checkCombos()}break}}).bind("mouseup.keyboard touchend.keyboard",function(){if(g.checkCaret){g.lastCaret=g.$preview.caret()}});g.$keyboard.bind("mousedown.keyboard click.keyboard touchstart.keyboard",function(d){d.stopPropagation();if(!g.isCurrent()){g.reveal();b(document).trigger("checkkeyboard.keyboard")}});if(f.preventPaste){g.$preview.bind("contextmenu.keyboard",function(d){d.preventDefault()});g.$el.bind("contextmenu.keyboard",function(d){d.preventDefault()})}};g.bindKeys=function(){var c=(f.keyBinding+" repeater mouseenter mouseleave touchstart mousewheel mouseup click ").split(" ").join(".keyboard ")+("mouseleave mousedown touchstart touchend touchmove touchcancel ").split(" ").join(".kb ");g.$allKeys=g.$keyboard.find("button.ui-keyboard-button").unbind(c).bind(f.keyBinding.split(" ").join(".keyboard ")+".keyboard repeater.keyboard",function(l){if(!g.$keyboard.is(":visible")){return false}var d,m=b(this),n=m.attr("data-action").split(":")[0],e=new Date().getTime();if(e-(g.lastEventTime||0)<f.preventDoubleEventTime){return}g.lastEventTime=e;g.$preview.focus();g.$lastKey=m;g.lastKey=m.attr("data-curtxt");if(g.checkCaret){g.$preview.caret(g.lastCaret)}if(n.match("meta")){n="meta"}if(b.keyboard.keyaction.hasOwnProperty(n)&&b(this).hasClass("ui-keyboard-actionkey")){if(b.keyboard.keyaction[n](g,this,l)===false){return false}}else{if(typeof n!=="undefined"){d=g.lastKey=(g.wheel&&!b(this).hasClass("ui-keyboard-actionkey"))?g.lastKey:n;g.insertText(d);if(!g.capsLock&&!f.stickyShift&&!l.shiftKey){g.shiftActive=false;g.showKeySet(this)}}}g.$preview.focus().caret(g.lastCaret);g.checkCombos();g.checkMaxLength();if(b.isFunction(f.change)){f.change(b.Event("change"),g,g.el)}g.$el.trigger("change.keyboard",[g,g.el]);l.preventDefault()}).bind("mouseenter.keyboard mouseleave.keyboard touchstart.keyboard",function(d){if(!g.isCurrent()){return}var e=b(this),j=e.data("layers")||g.getLayers(e);e.data("layers",j=b.grep(j,function(i,k){return b.inArray(i,j)===k}));if((d.type==="mouseenter"||d.type==="touchstart")&&g.el.type!=="password"&&!e.hasClass(f.css.buttonDisabled)){e.addClass(f.css.buttonHover).attr("title",function(i,l){return(g.wheel&&l===""&&g.sets&&j.length>1&&d.type!=="touchstart")?f.wheelMessage:l})}if(d.type==="mouseleave"){e.data({curtxt:e.data("original"),curnum:0});e.removeClass((g.el.type==="password")?"":f.css.buttonHover).attr("title",function(i,l){return(l===f.wheelMessage)?"":l}).find("span").text(e.data("original"))}}).bind("mousewheel.keyboard",function(m,e){if(g.wheel){var l,d,n=b(this);d=n.data("layers")||g.getLayers(n);if(d.length>1){l=n.data("curnum")+(e>0)?-1:1;if(l>d.length-1){l=0}if(l<0){l=d.length-1}}else{l=0}n.data({curnum:l,layers:d,curtxt:d[l]});n.find("span").text(d[l]);return false}}).bind("mouseup.keyboard mouseleave.kb touchend.kb touchmove.kb touchcancel.kb",function(d){if(/(mouseleave|touchend|touchcancel)/.test(d.type)){b(this).removeClass(f.css.buttonHover)}else{if(g.isVisible()&&g.isCurrent()){g.$preview.focus()}if(g.checkCaret){g.$preview.caret(g.lastCaret)}}g.mouseRepeat=[false,""];clearTimeout(g.repeater);return false}).bind("click.keyboard",function(){return false}).not(".ui-keyboard-actionkey").add(".ui-keyboard-tab, .ui-keyboard-bksp, .ui-keyboard-space, .ui-keyboard-enter",g.$keyboard).bind("mousedown.kb touchstart.kb",function(){if(f.repeatRate!==0){var d=b(this);g.mouseRepeat=[true,d];setTimeout(function(){if(g.mouseRepeat[0]&&g.mouseRepeat[1]===d){g.repeatKey(d)}},f.repeatDelay)}return false})};g.insertText=function(c){var p,o,t,e=g.$preview.val(),q=g.$preview.caret(),r=g.$preview.scrollLeft(),d=g.$preview.scrollTop(),s=e.length;if(q.end<q.start){q.end=q.start}if(q.start>s){q.end=q.start=s}if(g.preview.tagName==="TEXTAREA"){if(g.msie&&e.substr(q.start,1)==="\n"){q.start+=1;q.end+=1}t=(e.split("\n").length-1);g.preview.scrollTop=(t>0)?g.lineHeight*t:d}p=(c==="bksp"&&q.start===q.end)?true:false;c=(c==="bksp")?"":c;o=q.start+(p?-1:c.length);r+=parseInt(g.$preview.css("fontSize"),10)*(c==="bksp"?-1:1);g.$preview.val(g.$preview.val().substr(0,q.start-(p?1:0))+c+g.$preview.val().substr(q.end)).caret(o,o).scrollLeft(r);g.lastCaret={start:o,end:o}};g.checkMaxLength=function(){var d,c=g.$preview.val();if(f.maxLength!==false&&c.length>f.maxLength){d=Math.min(g.$preview.caret().start,f.maxLength);g.$preview.val(c.substring(0,f.maxLength));g.$preview.caret(d,d);g.lastCaret={start:d,end:d}}if(g.$decBtn.length){g.checkDecimal()}};g.repeatKey=function(c){c.trigger("repeater.keyboard");if(g.mouseRepeat[0]){g.repeater=setTimeout(function(){g.repeatKey(c)},g.repeatTime)}};g.showKeySet=function(c){var d="",e=(g.shiftActive?1:0)+(g.altActive?2:0);if(!g.shiftActive){g.capsLock=false}if(g.metaActive){d=(c&&c.name&&/meta/.test(c.name))?c.name:"";if(d===""){d=(g.metaActive===true)?"":g.metaActive}else{g.metaActive=d}if((!f.stickyShift&&g.lastKeyset[2]!==g.metaActive)||((g.shiftActive||g.altActive)&&!g.$keyboard.find(".ui-keyboard-keyset-"+d+g.rows[e]).length)){g.shiftActive=g.altActive=false}}else{if(!f.stickyShift&&g.lastKeyset[2]!==g.metaActive&&g.shiftActive){g.shiftActive=g.altActive=false}}e=(g.shiftActive?1:0)+(g.altActive?2:0);d=(e===0&&!g.metaActive)?"-default":(d==="")?"":"-"+d;if(!g.$keyboard.find(".ui-keyboard-keyset"+d+g.rows[e]).length){g.shiftActive=g.lastKeyset[0];g.altActive=g.lastKeyset[1];g.metaActive=g.lastKeyset[2];return}g.$keyboard.find(".ui-keyboard-alt, .ui-keyboard-shift, .ui-keyboard-actionkey[class*=meta]").removeClass(f.css.buttonAction).end().find(".ui-keyboard-alt")[(g.altActive)?"addClass":"removeClass"](f.css.buttonAction).end().find(".ui-keyboard-shift")[(g.shiftActive)?"addClass":"removeClass"](f.css.buttonAction).end().find(".ui-keyboard-lock")[(g.capsLock)?"addClass":"removeClass"](f.css.buttonAction).end().find(".ui-keyboard-keyset").hide().end().find(".ui-keyboard-keyset"+d+g.rows[e]).show().end().find(".ui-keyboard-actionkey.ui-keyboard"+d).addClass(f.css.buttonAction);g.lastKeyset=[g.shiftActive,g.altActive,g.metaActive]};g.checkCombos=function(){if(!g.isVisible()){return g.$preview.val()}var c,d,e,q,r=g.$preview.val(),p=g.$preview.caret(),i=b.keyboard.builtLayouts[g.layout],o=r.length;if(p.end<p.start){p.end=p.start}if(p.start>o){p.end=p.start=o}if(g.msie&&r.substr(p.start,1)==="\n"){p.start+=1;p.end+=1}if(f.useCombos){if(g.msie){r=r.replace(g.regex,function(j,k,l){return(f.combos.hasOwnProperty(k))?f.combos[k][l]||j:j})}else{if(g.$preview.length){e=p.start-(p.start-2>=0?2:0);g.$preview.caret(e,p.end);q=(g.$preview.caret().text||"").replace(g.regex,function(j,k,l){return(f.combos.hasOwnProperty(k))?f.combos[k][l]||j:j});g.$preview.val(g.$preview.caret().replace(q));r=g.$preview.val()}}}if(f.restrictInput&&r!==""){e=r;d=i.acceptedKeys.length;for(c=0;c<d;c++){if(e===""){continue}q=i.acceptedKeys[c];if(r.indexOf(q)>=0){if(/[\[|\]|\\|\^|\$|\.|\||\?|\*|\+|\(|\)|\{|\}]/g.test(q)){q="\\"+q}e=e.replace((new RegExp(q,"g")),"")}}if(e!==""){r=r.replace(e,"")}}p.start+=r.length-o;p.end+=r.length-o;g.$preview.val(r);g.$preview.caret(p.start,p.end);g.preview.scrollTop=g.lineHeight*(r.substring(0,p.start).split("\n").length-1);g.lastCaret={start:p.start,end:p.end};if(f.acceptValid){g.checkValid()}return r};g.checkValid=function(){var c=true;if(f.validate&&typeof f.validate==="function"){c=f.validate(g,g.$preview.val(),false)}g.$keyboard.find(".ui-keyboard-accept")[c?"removeClass":"addClass"]("ui-keyboard-invalid-input")[c?"addClass":"removeClass"]("ui-keyboard-valid-input")};g.checkDecimal=function(){if((g.decimal&&/\./g.test(g.preview.value))||(!g.decimal&&/\,/g.test(g.preview.value))){g.$decBtn.attr({disabled:"disabled","aria-disabled":"true"}).removeClass(f.css.buttonDefault+" "+f.css.buttonHover).addClass(f.css.buttonDisabled)}else{g.$decBtn.removeAttr("disabled").attr({"aria-disabled":"false"}).addClass(f.css.buttonDefault).removeClass(f.css.buttonDisabled)}};g.getLayers=function(d){var e,c;e=d.attr("data-pos");c=d.closest(".ui-keyboard").find('button[data-pos="'+e+'"]').map(function(){return b(this).find("> span").text()}).get();return c};g.switchInput=function(c,e){if(typeof f.switchInput==="function"){f.switchInput(g,c,e)}else{g.$keyboard.hide();var m,d=false,n=b("button, input, textarea, a").filter(":visible"),l=n.index(g.$el)+(c?1:-1);g.$keyboard.show();if(l>n.length-1){d=f.stopAtEnd;l=0}if(l<0){d=f.stopAtEnd;l=n.length-1}if(!d){g.close(e);m=n.eq(l).data("keyboard");if(m&&m.options.openOn.length){m.focusOn()}else{n.eq(l).focus()}}}return false};g.close=function(c){if(g.isOpen){clearTimeout(g.throttled);var d=(c)?g.checkCombos():g.originalContent;if(c&&f.validate&&typeof(f.validate)==="function"&&!f.validate(g,d,true)){d=g.originalContent;c=false;if(f.cancelClose){return}}g.isCurrent(false);g.isOpen=false;g.$el.removeClass("ui-keyboard-input-current ui-keyboard-autoaccepted").addClass((c||false)?c===true?"":"ui-keyboard-autoaccepted":"").trigger((f.alwaysOpen)?"":"beforeClose.keyboard",[g,g.el,(c||false)]).val(d).scrollTop(g.el.scrollHeight).trigger(((c||false)?"accepted.keyboard":"canceled.keyboard"),[g,g.el]).trigger((f.alwaysOpen)?"inactive.keyboard":"hidden.keyboard",[g,g.el]).blur();g.$preview.val(d);if(f.openOn){g.timer=setTimeout(function(){g.$el.bind(f.openOn+".keyboard",function(){g.focusOn()});if(b(":focus")[0]===g.el){g.$el.blur()}},500)}if(!f.alwaysOpen&&g.$keyboard){g.$keyboard.remove();g.$keyboard=[]}if(!g.watermark&&g.el.value===""&&g.inPlaceholder!==""){g.$el.addClass("ui-keyboard-placeholder").val(g.inPlaceholder)}g.$el.trigger("change")}return !!c};g.accept=function(){return g.close(true)};g.escClose=function(c){if(c&&c.type==="keyup"){return(c.which===27)?g.close():""}if(!g.isOpen){return}if(!g.isCurrent()&&g.isOpen||g.isOpen&&c.target!==g.el&&!f.stayOpen){if(g.allie){c.preventDefault()}g.close(f.autoAccept?"true":false)}};g.keyBtn=b("<button />").attr({role:"button",type:"button","aria-disabled":"false",tabindex:"-1"}).addClass("ui-keyboard-button");g.addKey=function(t,e,c){var s,u,v,m,n,d=(c===true)?t:f.display[e]||t,r=(c===true)?t.charCodeAt(0):t;if(/\(.+\)/.test(d)){m=d.replace(/\(([^()]+)\)/,"");v=d.match(/\(([^()]+)\)/)[1];d=m;n=m.split(":");m=(n[0]!==""&&n.length>1)?n[0]:m;b.keyboard.builtLayouts[g.layout].mappedKeys[v]=m}n=d.split(":");if(n[0]===""&&n[1]===""){d=":"}d=(n[0]!==""&&n.length>1)?b.trim(n[0]):d;s=(n.length>1)?b.trim(n[1]).replace(/_/g," ")||"":"";u=(d.length>1)?" ui-keyboard-widekey":"";u+=(c)?"":" ui-keyboard-actionkey";return g.keyBtn.clone().attr({"data-value":d,name:r,"data-pos":g.temp[1]+","+g.temp[2],title:s,"data-action":t,"data-original":d,"data-curtxt":d,"data-curnum":0}).addClass("ui-keyboard-"+r+u+" "+f.css.buttonDefault).html("<span>"+d+"</span>").appendTo(g.temp[0])};g.customHash=function(){var e,c,i,n,d=f.customLayout,p=[],o=[];for(c in d){if(d.hasOwnProperty(c)){p.push(d[c])}}o=o.concat.apply(o,p).join(" ");if(Array.prototype.reduce){return o.split("").reduce(function(j,k){j=((j<<5)-j)+k.charCodeAt(0);return j&j},0)}i=0;if(o.length===0){return i}for(e=0;e<o.length;e++){n=o.charCodeAt(e);i=((i<<5)-i)+n;i=i&i}return i};g.buildKeyboard=function(){var z,w,x,s,y,t,d,c,A,u=0,v=b.keyboard.builtLayouts[g.layout]={mappedKeys:{},acceptedKeys:[]},e=v.acceptedKeys=[],B=b("<div />").addClass("ui-keyboard "+f.css.container+(f.alwaysOpen?" ui-keyboard-always-open":"")).attr({role:"textbox"}).hide();if(f.layout==="custom"||!b.keyboard.layouts.hasOwnProperty(f.layout)){f.layout="custom";b.keyboard.layouts.custom=f.customLayout||{"default":["{cancel}"]}}b.each(b.keyboard.layouts[f.layout],function(i,j){if(i!==""){u++;s=b("<div />").attr("name",i).addClass("ui-keyboard-keyset ui-keyboard-keyset-"+i).appendTo(B)[(i==="default")?"show":"hide"]();for(x=0;x<j.length;x++){t=b.trim(j[x]).replace(/\{(\.?)[\s+]?:[\s+]?(\.?)\}/g,"{$1:$2}");c=t.split(/\s+/);for(d=0;d<c.length;d++){g.temp=[s,x,d];y=false;if(c[d].length===0){continue}if(/^\{\S+\}$/.test(c[d])){w=c[d].match(/^\{(\S+)\}$/)[1].toLowerCase();if(/\!\!/.test(w)){w=w.replace("!!","");y=true}if(/^sp:((\d+)?([\.|,]\d+)?)(em|px)?$/.test(w)){A=parseFloat(w.replace(/,/,".").match(/^sp:((\d+)?([\.|,]\d+)?)(em|px)?$/)[1]||0);b("<span>&nbsp;</span>").width((w.match("px")?A+"px":(A*2)+"em")).addClass("ui-keyboard-button ui-keyboard-spacer").appendTo(s)}if(/^meta\d+\:?(\w+)?/.test(w)){g.addKey(w,w);continue}switch(w){case"a":case"accept":g.addKey("accept",w).addClass(f.css.buttonAction);break;case"alt":case"altgr":g.addKey("alt","alt");break;case"b":case"bksp":g.addKey("bksp",w);break;case"c":case"cancel":g.addKey("cancel",w).addClass(f.css.buttonAction);break;case"combo":g.addKey("combo","combo").addClass(f.css.buttonAction);break;case"dec":e.push((g.decimal)?".":",");g.addKey("dec","dec");break;case"e":case"enter":g.addKey("enter",w).addClass(f.css.buttonAction);break;case"empty":g.addKey(""," ").addClass(f.css.buttonDisabled).attr("aria-disabled",true);break;case"s":case"shift":g.addKey("shift",w);break;case"sign":e.push("-");g.addKey("sign","sign");break;case"space":e.push(" ");g.addKey("space","space");break;case"t":case"tab":g.addKey("tab",w);break;default:if(b.keyboard.keyaction.hasOwnProperty(w)){g.addKey(w,w)[y?"addClass":"removeClass"](f.css.buttonAction)}}}else{z=c[d];e.push(z===":"?z:z.split(":")[0]);g.addKey(z,z,true)}}s.find(".ui-keyboard-button:last").after('<br class="ui-keyboard-button-endrow">')}}});if(u>1){g.sets=true}v.hasMappedKeys=!(b.isEmptyObject(v.mappedKeys));v.$keyboard=B;return B};g.destroy=function(){b(document).unbind("mousedown.keyboard keyup.keyboard touchstart.keyboard");if(g.$keyboard){g.$keyboard.remove()}var c=b.trim(f.openOn+" accepted beforeClose canceled change contextmenu hidden initialized keydown keypress keyup visible").split(" ").join(".keyboard ");g.$el.removeClass("ui-keyboard-input ui-keyboard-lockedinput ui-keyboard-placeholder ui-keyboard-notallowed ui-keyboard-always-open "+f.css.input).removeAttr("aria-haspopup").removeAttr("role").unbind(c+".keyboard").removeData("keyboard")};g.init()};b.keyboard.keyaction={accept:function(a){a.close(true);return false},alt:function(d,a){d.altActive=!d.altActive;d.showKeySet(a)},bksp:function(a){a.insertText("bksp")},cancel:function(a){a.close();return false},clear:function(a){a.$preview.val("")},combo:function(a){var c=!a.options.useCombos;a.options.useCombos=c;a.$keyboard.find(".ui-keyboard-combo").toggleClass(a.options.css.buttonAction,c);if(c){a.checkCombos()}return false},dec:function(a){a.insertText((a.decimal)?".":",")},"default":function(d,a){d.shiftActive=d.altActive=d.metaActive=false;d.showKeySet(a)},enter:function(i,j,h){var a=i.el.tagName,e=i.options;if(h.shiftKey){return(e.enterNavigation)?i.switchInput(!h[e.enterMod],true):i.close(true)}if(e.enterNavigation&&(a!=="TEXTAREA"||h[e.enterMod])){return i.switchInput(!h[e.enterMod],e.autoAccept?"true":false)}if(a==="TEXTAREA"&&b(h.target).closest("button").length){i.insertText(" \n")}},lock:function(d,a){d.lastKeyset[0]=d.shiftActive=d.capsLock=!d.capsLock;d.showKeySet(a)},left:function(a){var d=a.$preview.caret();if(d.start-1>=0){a.lastCaret={start:d.start-1,end:d.start-1}}},meta:function(d,a){d.metaActive=(b(a).hasClass(d.options.css.buttonAction))?false:true;d.showKeySet(a)},next:function(a){a.switchInput(true,a.options.autoAccept);return false},prev:function(a){a.switchInput(false,a.options.autoAccept);return false},right:function(a){var d=a.$preview.caret();if(d.start+1<=a.$preview.val().length){a.lastCaret={start:d.start+1,end:d.start+1}}},shift:function(d,a){d.lastKeyset[0]=d.shiftActive=!d.shiftActive;d.showKeySet(a)},sign:function(a){if(/^\-?\d*\.?\d*$/.test(a.$preview.val())){a.$preview.val((a.$preview.val()*-1))}},space:function(a){a.insertText(" ")},tab:function(f){var a=f.el.tagName,e=f.options;if(a==="INPUT"){if(e.tabNavigation){return f.switchInput(!f.shiftActive,true)}else{return false}}f.insertText("\t")}};b.keyboard.builtLayouts={};b.keyboard.layouts={alpha:{"default":["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","{tab} a b c d e f g h i j [ ] \\","k l m n o p q r s ; ' {enter}","{shift} t u v w x y z , . / {shift}","{accept} {space} {cancel}"],shift:["~ ! @ # $ % ^ & * ( ) _ + {bksp}","{tab} A B C D E F G H I J { } |",'K L M N O P Q R S : " {enter}',"{shift} T U V W X Y Z < > ? {shift}","{accept} {space} {cancel}"]},qwerty:{"default":["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","{tab} q w e r t y u i o p [ ] \\","a s d f g h j k l ; ' {enter}","{shift} z x c v b n m , . / {shift}","{accept} {space} {cancel}"],shift:["~ ! @ # $ % ^ & * ( ) _ + {bksp}","{tab} Q W E R T Y U I O P { } |",'A S D F G H J K L : " {enter}',"{shift} Z X C V B N M < > ? {shift}","{accept} {space} {cancel}"]},international:{"default":["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","{tab} q w e r t y u i o p [ ] \\","a s d f g h j k l ; ' {enter}","{shift} z x c v b n m , . / {shift}","{accept} {alt} {space} {alt} {cancel}"],shift:["~ ! @ # $ % ^ & * ( ) _ + {bksp}","{tab} Q W E R T Y U I O P { } |",'A S D F G H J K L : " {enter}',"{shift} Z X C V B N M < > ? {shift}","{accept} {alt} {space} {alt} {cancel}"],alt:["~ \u00a1 \u00b2 \u00b3 \u00a4 \u20ac \u00bc \u00bd \u00be \u2018 \u2019 \u00a5 \u00d7 {bksp}","{tab} \u00e4 \u00e5 \u00e9 \u00ae \u00fe \u00fc \u00fa \u00ed \u00f3 \u00f6 \u00ab \u00bb \u00ac","\u00e1 \u00df \u00f0 f g h j k \u00f8 \u00b6 \u00b4 {enter}","{shift} \u00e6 x \u00a9 v b \u00f1 \u00b5 \u00e7 > \u00bf {shift}","{accept} {alt} {space} {alt} {cancel}"],"alt-shift":["~ \u00b9 \u00b2 \u00b3 \u00a3 \u20ac \u00bc \u00bd \u00be \u2018 \u2019 \u00a5 \u00f7 {bksp}","{tab} \u00c4 \u00c5 \u00c9 \u00ae \u00de \u00dc \u00da \u00cd \u00d3 \u00d6 \u00ab \u00bb \u00a6","\u00c4 \u00a7 \u00d0 F G H J K \u00d8 \u00b0 \u00a8 {enter}","{shift} \u00c6 X \u00a2 V B \u00d1 \u00b5 \u00c7 . \u00bf {shift}","{accept} {alt} {space} {alt} {cancel}"]},dvorak:{"default":["` 1 2 3 4 5 6 7 8 9 0 [ ] {bksp}","{tab} ' , . p y f g c r l / = \\","a o e u i d h t n s - {enter}","{shift} ; q j k x b m w v z {shift}","{accept} {space} {cancel}"],shift:["~ ! @ # $ % ^ & * ( ) { } {bksp}",'{tab} " < > P Y F G C R L ? + |',"A O E U I D H T N S _ {enter}","{shift} : Q J K X B M W V Z {shift}","{accept} {space} {cancel}"]},num:{"default":["= ( ) {b}","{clear} / * -","7 8 9 +","4 5 6 {sign}","1 2 3 %","0 . {a} {c}"]}};b.keyboard.defaultOptions={layout:"qwerty",customLayout:null,position:{of:null,my:"center top",at:"center top",at2:"center bottom"},usePreview:true,alwaysOpen:false,initialFocus:true,stayOpen:false,display:{a:"\u2714:Accept (Shift-Enter)",accept:"Accept:Accept (Shift-Enter)",alt:"Alt:\u2325 AltGr",b:"\u232b:Backspace",bksp:"Bksp:Backspace",c:"\u2716:Cancel (Esc)",cancel:"Cancel:Cancel (Esc)",clear:"C:Clear",combo:"\u00f6:Toggle Combo Keys",dec:".:Decimal",e:"\u23ce:Enter",empty:"\u00a0",enter:"Enter:Enter \u23ce",left:"\u2190",lock:"Lock:\u21ea Caps Lock",next:"Next \u21e8",prev:"\u21e6 Prev",right:"\u2192",s:"\u21e7:Shift",shift:"Shift:Shift",sign:"\u00b1:Change Sign",space:"&nbsp;:Space",t:"\u21e5:Tab",tab:"\u21e5 Tab:Tab"},wheelMessage:"Use mousewheel to see other keys",css:{input:"ui-widget-content ui-corner-all",container:"ui-widget-content ui-widget ui-corner-all ui-helper-clearfix",buttonDefault:"ui-state-default ui-corner-all",buttonHover:"ui-state-hover",buttonAction:"ui-state-active",buttonDisabled:"ui-state-disabled"},autoAccept:false,lockInput:false,restrictInput:false,acceptValid:false,cancelClose:true,tabNavigation:false,enterNavigation:false,enterMod:"altKey",stopAtEnd:true,appendLocally:false,stickyShift:true,preventPaste:false,caretToEnd:false,maxLength:false,repeatDelay:500,repeatRate:20,resetDefault:false,openOn:"focus",keyBinding:"mousedown touchstart",useCombos:true,combos:{"`":{a:"\u00e0",A:"\u00c0",e:"\u00e8",E:"\u00c8",i:"\u00ec",I:"\u00cc",o:"\u00f2",O:"\u00d2",u:"\u00f9",U:"\u00d9",y:"\u1ef3",Y:"\u1ef2"},"'":{a:"\u00e1",A:"\u00c1",e:"\u00e9",E:"\u00c9",i:"\u00ed",I:"\u00cd",o:"\u00f3",O:"\u00d3",u:"\u00fa",U:"\u00da",y:"\u00fd",Y:"\u00dd"},'"':{a:"\u00e4",A:"\u00c4",e:"\u00eb",E:"\u00cb",i:"\u00ef",I:"\u00cf",o:"\u00f6",O:"\u00d6",u:"\u00fc",U:"\u00dc",y:"\u00ff",Y:"\u0178"},"^":{a:"\u00e2",A:"\u00c2",e:"\u00ea",E:"\u00ca",i:"\u00ee",I:"\u00ce",o:"\u00f4",O:"\u00d4",u:"\u00fb",U:"\u00db",y:"\u0177",Y:"\u0176"},"~":{a:"\u00e3",A:"\u00c3",e:"\u1ebd",E:"\u1ebc",i:"\u0129",I:"\u0128",o:"\u00f5",O:"\u00d5",u:"\u0169",U:"\u0168",y:"\u1ef9",Y:"\u1ef8",n:"\u00f1",N:"\u00d1"}},validate:function(a,f,e){return true}};b.keyboard.comboRegex=/([`\'~\^\"ao])([a-z])/mig;b.keyboard.currentKeyboard="";b.fn.keyboard=function(a){return this.each(function(){if(!b(this).data("keyboard")){(new b.keyboard(this,a))}})};b.fn.getkeyboard=function(){return this.data("keyboard")}})(jQuery);(function(f,h,g,e){f.fn.caret=function(C,w){if(typeof this[0]==="undefined"||this.is(":hidden")||this.css("visibility")==="hidden"){return this}var D,A,b,t,c,d,B,x,z,y=document.selection,v=this[0],a=v.scrollTop,s=typeof v.selectionStart!=="undefined";if(typeof C==="object"&&C.start&&C.end){A=C.start;t=C.end}else{if(typeof C==="number"&&typeof w==="number"){A=C;t=w}}if(typeof A!=="undefined"){if(s){v.selectionStart=A;v.selectionEnd=t}else{c=v.createTextRange();c.collapse(true);c.moveStart("character",A);c.moveEnd("character",t-A);c.select()}if(this.is(":visible")||this.css("visibility")!=="hidden"){this.focus()}v.scrollTop=a;return this}else{if(s){D=v.selectionStart;b=v.selectionEnd}else{if(v.tagName==="TEXTAREA"){z=this.val();d=y[g]();B=d[e]();B.moveToElementText(v);B.setEndPoint("EndToEnd",d);D=B.text.replace(/\r/g,"\n")[h];b=D+d.text.replace(/\r/g,"\n")[h]}else{z=this.val().replace(/\r/g,"\n");d=y[g]()[e]();d.moveEnd("character",z[h]);D=(d.text===""?z[h]:z.lastIndexOf(d.text));d=y[g]()[e]();d.moveStart("character",-z[h]);b=d.text[h]}}x=(v.value||"").substring(D,b);return{start:D,end:b,text:x,replace:function(i){return v.value.substring(0,D)+i+v.value.substring(b,v.value[h])}}}}})(jQuery,"length","createRange","duplicate");