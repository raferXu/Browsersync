/*!
jQuery UI Virtual Keyboard
Version 1.18.2

Author: Jeremy Satterfield
Modified: Rob Garrison (Mottie on github)
-----------------------------------------
Licensed under the MIT License

Caret code modified from jquery.caret.1.02.js
Licensed under the MIT License:
http://www.opensource.org/licenses/mit-license.php
-----------------------------------------

An on-screen virtual keyboard embedded within the browser window which
will popup when a specified entry field is focused. The user can then
type and preview their input before Accepting or Canceling.

As a plugin to jQuery UI styling and theme will automatically
match that used by jQuery UI with the exception of the required CSS.

Requires:
	jQuery
	jQuery UI (position utility only) & CSS theme

Setup/Usage:
	Please refer to https://github.com/Mottie/Keyboard/wiki
*/
;(function(a){a.keyboard=function(c,b){var d=this,e;d.$el=a(c);d.el=c;d.$el.data("keyboard",d);d.init=function(){d.options=e=a.extend(true,{},a.keyboard.defaultOptions,b);d.shiftActive=d.altActive=d.metaActive=d.sets=d.capsLock=false;d.lastKeyset=[false,false,false];d.rows=["","-shift","-alt","-alt-shift"];a('<!--[if lte IE 8]><script>jQuery("body").addClass("oldie");<\/script><![endif]--><!--[if IE]><script>jQuery("body").addClass("ie");<\/script><![endif]-->').appendTo("body").remove();d.msie=a("body").hasClass("oldie");d.allie=a("body").hasClass("ie");d.inPlaceholder=d.$el.attr("placeholder")||"";d.watermark=(typeof(document.createElement("input").placeholder)!=="undefined"&&d.inPlaceholder!=="");d.regex=a.keyboard.comboRegex;d.decimal=(/^\./.test(e.display.dec))?true:false;d.repeatTime=1000/(e.repeatRate||20);e.preventDoubleEventTime=e.preventDoubleEventTime||100;d.isOpen=false;d.wheel=a.isFunction(a.fn.mousewheel);d.alwaysAllowed=[20,33,34,35,36,37,38,39,40,45,46];d.$keyboard=[];d.temp=a('<input style="position:absolute;left:-9999em;top:-9999em;" type="text" value="testing">').appendTo("body").caret(3,3);d.checkCaret=(e.lockInput||d.temp.hide().show().caret().start!==3)?true:false;d.temp.remove();d.lastCaret={start:0,end:0};d.temp=["",0,0];a.each("initialized beforeVisible visible hidden canceled accepted beforeClose".split(" "),function(g,h){if(a.isFunction(e[h])){d.$el.bind(h+".keyboard",e[h])}});if(e.alwaysOpen){e.stayOpen=true}a(document).bind("mousedown keyup touchstart checkkeyboard".split(" ").join(".keyboard "),function(g){if(d.opening){return}d.escClose(g);if(g.target&&a(g.target).hasClass("ui-keyboard-input")){var f=a(g.target).data("keyboard");if(f===d&&f.options.openOn){f.focusOn()}}});d.$el.addClass("ui-keyboard-input "+e.css.input).attr({"aria-haspopup":"true",role:"textbox"});if(d.$el.is(":disabled")||(d.$el.attr("readonly")&&!d.$el.hasClass("ui-keyboard-lockedinput"))){d.$el.addClass("ui-keyboard-nokeyboard")}if(e.openOn){d.$el.bind(e.openOn+".keyboard",function(){d.focusOn()})}if(!d.watermark&&d.$el.val()===""&&d.inPlaceholder!==""&&d.$el.attr("placeholder")!==""){d.$el.addClass("ui-keyboard-placeholder").val(d.inPlaceholder)}d.$el.trigger("initialized.keyboard",[d,d.el]);if(e.alwaysOpen){d.reveal()}};d.setCurrent=function(){a(".ui-keyboard-has-focus").removeClass("ui-keyboard-has-focus");a(".ui-keyboard-input-current").removeClass("ui-keyboard-input-current");d.$el.addClass("ui-keyboard-input-current");d.$keyboard.addClass("ui-keyboard-has-focus");d.isCurrent(true);d.isOpen=true};d.isCurrent=function(g){var f=a.keyboard.currentKeyboard||false;if(g){f=a.keyboard.currentKeyboard=d.el}else{if(g===false&&f===d.el){f=a.keyboard.currentKeyboard=""}}return f===d.el};d.isVisible=function(){if(!d.$keyboard.length){return false}return d.$keyboard.is(":visible")};d.focusOn=function(){if(d.$el.is(":visible")){setTimeout(function(){d.lastCaret=d.$el.caret()},20)}if(!d.isVisible()){clearTimeout(d.timer);d.reveal()}if(e.alwaysOpen){d.setCurrent()}};d.reveal=function(){d.opening=true;a(".ui-keyboard").not(".ui-keyboard-always-open").remove();if(d.$el.is(":disabled")||(d.$el.attr("readonly")&&!d.$el.hasClass("ui-keyboard-lockedinput"))){d.$el.addClass("ui-keyboard-nokeyboard");return}else{d.$el.removeClass("ui-keyboard-nokeyboard")}if(e.openOn){d.$el.unbind(e.openOn+".keyboard")}if(!d.$keyboard.length||a.contains(document.body,d.$keyboard[0])){d.startup()}if(!d.watermark&&d.el.value===d.inPlaceholder){d.$el.removeClass("ui-keyboard-placeholder").val("")}d.originalContent=d.$el.val();d.$preview.val(d.originalContent);if(e.acceptValid){d.checkValid()}var g,f;d.position=e.position;d.position.of=d.position.of||d.$el.data("keyboardPosition")||d.$el;d.position.collision=d.position.collision||(e.usePreview?"fit fit":"flip flip");if(e.resetDefault){d.shiftActive=d.altActive=d.metaActive=false;d.showKeySet()}d.$keyboard.css({position:"absolute",left:0,top:0});d.$el.trigger("beforeVisible.keyboard",[d,d.el]);d.setCurrent();d.$keyboard.show();if(e.usePreview&&d.msie){if(typeof d.width==="undefined"){d.$preview.hide();d.width=Math.ceil(d.$keyboard.width());d.$preview.show()}d.$preview.width(d.width)}if(a.ui.position){d.$keyboard.position(d.position)}d.checkDecimal();d.lineHeight=parseInt(d.$preview.css("lineHeight"),10)||parseInt(d.$preview.css("font-size"),10)+4;if(e.caretToEnd){f=d.originalContent.length;d.lastCaret={start:f,end:f}}if(d.allie){f=d.lastCaret.start||d.originalContent.length;g={start:f,end:f};if(!d.lastCaret){d.lastCaret=g}if(d.lastCaret.end===0&&d.lastCaret.start>0){d.lastCaret.end=d.lastCaret.start}if(d.lastCaret.start<0){d.lastCaret=g}}setTimeout(function(){d.opening=false;if(e.initialFocus){d.$preview.focus().caret(d.lastCaret)}d.$el.trigger("visible.keyboard",[d,d.el])},10);return d};d.startup=function(){if(!d.$keyboard.length){if(e.layout==="custom"){e.layoutHash="custom"+d.customHash()}d.layout=e.layout==="custom"?e.layoutHash:e.layout;if(typeof a.keyboard.builtLayouts[d.layout]==="undefined"){if(a.isFunction(e.create)){e.create(d)}if(!d.$keyboard.length){d.buildKeyboard()}}d.$keyboard=a.keyboard.builtLayouts[d.layout].$keyboard.clone();if(e.usePreview){d.$preview=d.$el.clone(false).removeAttr("id").removeClass("ui-keyboard-placeholder ui-keyboard-input").addClass("ui-keyboard-preview "+e.css.input).attr("tabindex","-1").show();a("<div />").addClass("ui-keyboard-preview-wrapper").append(d.$preview).prependTo(d.$keyboard)}else{d.$preview=d.$el;e.position.at=e.position.at2}}d.preview=d.$preview[0];d.$decBtn=d.$keyboard.find(".ui-keyboard-dec");if(e.enterNavigation||d.el.tagName==="TEXTAREA"){d.alwaysAllowed.push(13)}if(e.lockInput){d.$preview.addClass("ui-keyboard-lockedinput").attr({readonly:"readonly"})}d.bindKeyboard();if(e.appendLocally){d.$el.after(d.$keyboard)}else{d.$keyboard.appendTo("body")}d.bindKeys();a(window).bind("resize.keyboard",function(){if(d.isVisible()){d.$keyboard.position(d.position)}})};d.bindKeyboard=function(){var f=a.keyboard.builtLayouts[d.layout];d.$preview.unbind("keypress keyup keydown mouseup touchend ".split(" ").join(".keyboard ")).bind("keypress.keyboard",function(h){var g=d.lastKey=String.fromCharCode(h.charCode||h.which);d.$lastKey=[];if(d.checkCaret){d.lastCaret=d.$preview.caret()}d.capsLock=(((g>=65&&g<=90)&&!h.shiftKey)||((g>=97&&g<=122)&&h.shiftKey))?true:false;if(e.restrictInput){if((h.which===8||h.which===0)&&a.inArray(h.keyCode,d.alwaysAllowed)){return}if(a.inArray(g,f.acceptedKeys)===-1){h.preventDefault()}}else{if((h.ctrlKey||h.metaKey)&&(h.which===97||h.which===99||h.which===118||(h.which>=120&&h.which<=122))){return}}if(f.hasMappedKeys){if(f.mappedKeys.hasOwnProperty(g)){d.lastKey=f.mappedKeys[g];d.insertText(d.lastKey);h.preventDefault()}}d.checkMaxLength()}).bind("keyup.keyboard",function(h){switch(h.which){case 9:if(d.tab&&e.tabNavigation&&!e.lockInput){d.shiftActive=h.shiftKey;var g=a.keyboard.keyaction.tab(d);d.tab=false;if(!g){return false}}else{h.preventDefault()}break;case 27:d.close();return false}clearTimeout(d.throttled);d.throttled=setTimeout(function(){if(d.isVisible()){d.checkCombos()}},100);d.checkMaxLength();if(a.isFunction(e.change)){e.change(a.Event("change"),d,d.el)}d.$el.trigger("change.keyboard",[d,d.el])}).bind("keydown.keyboard",function(g){switch(g.which){case 9:if(e.tabNavigation){d.tab=true;return false}else{d.tab=true;return false}break;case 13:a.keyboard.keyaction.enter(d,null,g);break;case 20:d.shiftActive=d.capsLock=!d.capsLock;d.showKeySet(this);break;case 86:if(g.ctrlKey||g.metaKey){if(e.preventPaste){g.preventDefault();return}d.checkCombos()}break}}).bind("mouseup.keyboard touchend.keyboard",function(){if(d.checkCaret){d.lastCaret=d.$preview.caret()}});d.$keyboard.bind("mousedown.keyboard click.keyboard touchstart.keyboard",function(g){g.stopPropagation();if(!d.isCurrent()){d.reveal();a(document).trigger("checkkeyboard.keyboard")}});if(e.preventPaste){d.$preview.bind("contextmenu.keyboard",function(g){g.preventDefault()});d.$el.bind("contextmenu.keyboard",function(g){g.preventDefault()})}};d.bindKeys=function(){var f=(e.keyBinding+" repeater mouseenter mouseleave touchstart mousewheel mouseup click ").split(" ").join(".keyboard ")+("mouseleave mousedown touchstart touchend touchmove touchcancel ").split(" ").join(".kb ");d.$allKeys=d.$keyboard.find("button.ui-keyboard-button").unbind(f).bind(e.keyBinding.split(" ").join(".keyboard ")+".keyboard repeater.keyboard",function(j){if(!d.$keyboard.is(":visible")){return false}var g,i=a(this),h=i.attr("data-action").split(":")[0],k=new Date().getTime();if(k-(d.lastEventTime||0)<e.preventDoubleEventTime){return}d.lastEventTime=k;d.$preview.focus();d.$lastKey=i;d.lastKey=i.attr("data-curtxt");if(d.checkCaret){d.$preview.caret(d.lastCaret)}if(h.match("meta")){h="meta"}if(a.keyboard.keyaction.hasOwnProperty(h)&&a(this).hasClass("ui-keyboard-actionkey")){if(a.keyboard.keyaction[h](d,this,j)===false){return false}}else{if(typeof h!=="undefined"){g=d.lastKey=(d.wheel&&!a(this).hasClass("ui-keyboard-actionkey"))?d.lastKey:h;d.insertText(g);if(!d.capsLock&&!e.stickyShift&&!j.shiftKey){d.shiftActive=false;d.showKeySet(this)}}}d.$preview.focus().caret(d.lastCaret);d.checkCombos();d.checkMaxLength();if(a.isFunction(e.change)){e.change(a.Event("change"),d,d.el)}d.$el.trigger("change.keyboard",[d,d.el]);j.preventDefault()}).bind("mouseenter.keyboard mouseleave.keyboard touchstart.keyboard",function(i){if(!d.isCurrent()){return}var h=a(this),g=h.data("layers")||d.getLayers(h);h.data("layers",g=a.grep(g,function(l,j){return a.inArray(l,g)===j}));if((i.type==="mouseenter"||i.type==="touchstart")&&d.el.type!=="password"&&!h.hasClass(e.css.buttonDisabled)){h.addClass(e.css.buttonHover).attr("title",function(k,j){return(d.wheel&&j===""&&d.sets&&g.length>1&&i.type!=="touchstart")?e.wheelMessage:j})}if(i.type==="mouseleave"){h.data({curtxt:h.data("original"),curnum:0});h.removeClass((d.el.type==="password")?"":e.css.buttonHover).attr("title",function(k,j){return(j===e.wheelMessage)?"":j}).find("span").text(h.data("original"))}}).bind("mousewheel.keyboard",function(i,k){if(d.wheel){var j,g,h=a(this);g=h.data("layers")||d.getLayers(h);if(g.length>1){j=h.data("curnum")+(k>0)?-1:1;if(j>g.length-1){j=0}if(j<0){j=g.length-1}}else{j=0}h.data({curnum:j,layers:g,curtxt:g[j]});h.find("span").text(g[j]);return false}}).bind("mouseup.keyboard mouseleave.kb touchend.kb touchmove.kb touchcancel.kb",function(g){if(/(mouseleave|touchend|touchcancel)/.test(g.type)){a(this).removeClass(e.css.buttonHover)}else{if(d.isVisible()&&d.isCurrent()){d.$preview.focus()}if(d.checkCaret){d.$preview.caret(d.lastCaret)}}d.mouseRepeat=[false,""];clearTimeout(d.repeater);return false}).bind("click.keyboard",function(){return false}).not(".ui-keyboard-actionkey").add(".ui-keyboard-tab, .ui-keyboard-bksp, .ui-keyboard-space, .ui-keyboard-enter",d.$keyboard).bind("mousedown.kb touchstart.kb",function(){if(e.repeatRate!==0){var g=a(this);d.mouseRepeat=[true,g];setTimeout(function(){if(d.mouseRepeat[0]&&d.mouseRepeat[1]===g){d.repeatKey(g)}},e.repeatDelay)}return false})};d.insertText=function(i){var n,o,j,f=d.$preview.val(),m=d.$preview.caret(),l=d.$preview.scrollLeft(),g=d.$preview.scrollTop(),k=f.length;if(m.end<m.start){m.end=m.start}if(m.start>k){m.end=m.start=k}if(d.preview.tagName==="TEXTAREA"){if(d.msie&&f.substr(m.start,1)==="\n"){m.start+=1;m.end+=1}j=(f.split("\n").length-1);d.preview.scrollTop=(j>0)?d.lineHeight*j:g}n=(i==="bksp"&&m.start===m.end)?true:false;i=(i==="bksp")?"":i;o=m.start+(n?-1:i.length);l+=parseInt(d.$preview.css("fontSize"),10)*(i==="bksp"?-1:1);d.$preview.val(d.$preview.val().substr(0,m.start-(n?1:0))+i+d.$preview.val().substr(m.end)).caret(o,o).scrollLeft(l);d.lastCaret={start:o,end:o}};d.checkMaxLength=function(){var f,g=d.$preview.val();if(e.maxLength!==false&&g.length>e.maxLength){f=Math.min(d.$preview.caret().start,e.maxLength);d.$preview.val(g.substring(0,e.maxLength));d.$preview.caret(f,f);d.lastCaret={start:f,end:f}}if(d.$decBtn.length){d.checkDecimal()}};d.repeatKey=function(f){f.trigger("repeater.keyboard");if(d.mouseRepeat[0]){d.repeater=setTimeout(function(){d.repeatKey(f)},d.repeatTime)}};d.showKeySet=function(h){var g="",f=(d.shiftActive?1:0)+(d.altActive?2:0);if(!d.shiftActive){d.capsLock=false}if(d.metaActive){g=(h&&h.name&&/meta/.test(h.name))?h.name:"";if(g===""){g=(d.metaActive===true)?"":d.metaActive}else{d.metaActive=g}if((!e.stickyShift&&d.lastKeyset[2]!==d.metaActive)||((d.shiftActive||d.altActive)&&!d.$keyboard.find(".ui-keyboard-keyset-"+g+d.rows[f]).length)){d.shiftActive=d.altActive=false}}else{if(!e.stickyShift&&d.lastKeyset[2]!==d.metaActive&&d.shiftActive){d.shiftActive=d.altActive=false}}f=(d.shiftActive?1:0)+(d.altActive?2:0);g=(f===0&&!d.metaActive)?"-default":(g==="")?"":"-"+g;if(!d.$keyboard.find(".ui-keyboard-keyset"+g+d.rows[f]).length){d.shiftActive=d.lastKeyset[0];d.altActive=d.lastKeyset[1];d.metaActive=d.lastKeyset[2];return}d.$keyboard.find(".ui-keyboard-alt, .ui-keyboard-shift, .ui-keyboard-actionkey[class*=meta]").removeClass(e.css.buttonAction).end().find(".ui-keyboard-alt")[(d.altActive)?"addClass":"removeClass"](e.css.buttonAction).end().find(".ui-keyboard-shift")[(d.shiftActive)?"addClass":"removeClass"](e.css.buttonAction).end().find(".ui-keyboard-lock")[(d.capsLock)?"addClass":"removeClass"](e.css.buttonAction).end().find(".ui-keyboard-keyset").hide().end().find(".ui-keyboard-keyset"+g+d.rows[f]).show().end().find(".ui-keyboard-actionkey.ui-keyboard"+g).addClass(e.css.buttonAction);d.lastKeyset=[d.shiftActive,d.altActive,d.metaActive]};d.checkCombos=function(){if(!d.isVisible()){return d.$preview.val()}var h,l,g,j,m=d.$preview.val(),n=d.$preview.caret(),k=a.keyboard.builtLayouts[d.layout],f=m.length;if(n.end<n.start){n.end=n.start}if(n.start>f){n.end=n.start=f}if(d.msie&&m.substr(n.start,1)==="\n"){n.start+=1;n.end+=1}if(e.useCombos){if(d.msie){m=m.replace(d.regex,function(o,i,p){return(e.combos.hasOwnProperty(i))?e.combos[i][p]||o:o})}else{if(d.$preview.length){g=n.start-(n.start-2>=0?2:0);d.$preview.caret(g,n.end);j=(d.$preview.caret().text||"").replace(d.regex,function(o,i,p){return(e.combos.hasOwnProperty(i))?e.combos[i][p]||o:o});d.$preview.val(d.$preview.caret().replace(j));m=d.$preview.val()}}}if(e.restrictInput&&m!==""){g=m;l=k.acceptedKeys.length;for(h=0;h<l;h++){if(g===""){continue}j=k.acceptedKeys[h];if(m.indexOf(j)>=0){if(/[\[|\]|\\|\^|\$|\.|\||\?|\*|\+|\(|\)|\{|\}]/g.test(j)){j="\\"+j}g=g.replace((new RegExp(j,"g")),"")}}if(g!==""){m=m.replace(g,"")}}n.start+=m.length-f;n.end+=m.length-f;d.$preview.val(m);d.$preview.caret(n.start,n.end);d.preview.scrollTop=d.lineHeight*(m.substring(0,n.start).split("\n").length-1);d.lastCaret={start:n.start,end:n.end};if(e.acceptValid){d.checkValid()}return m};d.checkValid=function(){var f=true;if(e.validate&&typeof e.validate==="function"){f=e.validate(d,d.$preview.val(),false)}d.$keyboard.find(".ui-keyboard-accept")[f?"removeClass":"addClass"]("ui-keyboard-invalid-input")[f?"addClass":"removeClass"]("ui-keyboard-valid-input")};d.checkDecimal=function(){if((d.decimal&&/\./g.test(d.preview.value))||(!d.decimal&&/\,/g.test(d.preview.value))){d.$decBtn.attr({disabled:"disabled","aria-disabled":"true"}).removeClass(e.css.buttonDefault+" "+e.css.buttonHover).addClass(e.css.buttonDisabled)}else{d.$decBtn.removeAttr("disabled").attr({"aria-disabled":"false"}).addClass(e.css.buttonDefault).removeClass(e.css.buttonDisabled)}};d.getLayers=function(g){var f,h;f=g.attr("data-pos");h=g.closest(".ui-keyboard").find('button[data-pos="'+f+'"]').map(function(){return a(this).find("> span").text()}).get();return h};d.switchInput=function(f,j){if(typeof e.switchInput==="function"){e.switchInput(d,f,j)}else{d.$keyboard.hide();var h,k=false,g=a("button, input, textarea, a").filter(":visible"),i=g.index(d.$el)+(f?1:-1);d.$keyboard.show();if(i>g.length-1){k=e.stopAtEnd;i=0}if(i<0){k=e.stopAtEnd;i=g.length-1}if(!k){d.close(j);h=g.eq(i).data("keyboard");if(h&&h.options.openOn.length){h.focusOn()}else{g.eq(i).focus()}}}return false};d.close=function(g){if(d.isOpen){clearTimeout(d.throttled);var f=(g)?d.checkCombos():d.originalContent;if(g&&e.validate&&typeof(e.validate)==="function"&&!e.validate(d,f,true)){f=d.originalContent;g=false;if(e.cancelClose){return}}d.isCurrent(false);d.isOpen=false;d.$el.removeClass("ui-keyboard-input-current ui-keyboard-autoaccepted").addClass((g||false)?g===true?"":"ui-keyboard-autoaccepted":"").trigger((e.alwaysOpen)?"":"beforeClose.keyboard",[d,d.el,(g||false)]).val(f).scrollTop(d.el.scrollHeight).trigger(((g||false)?"accepted.keyboard":"canceled.keyboard"),[d,d.el]).trigger((e.alwaysOpen)?"inactive.keyboard":"hidden.keyboard",[d,d.el]).blur();d.$preview.val(f);if(e.openOn){d.timer=setTimeout(function(){d.$el.bind(e.openOn+".keyboard",function(){d.focusOn()});if(a(":focus")[0]===d.el){d.$el.blur()}},500)}if(!e.alwaysOpen&&d.$keyboard){d.$keyboard.remove();d.$keyboard=[]}if(!d.watermark&&d.el.value===""&&d.inPlaceholder!==""){d.$el.addClass("ui-keyboard-placeholder").val(d.inPlaceholder)}d.$el.trigger("change")}return !!g};d.accept=function(){return d.close(true)};d.escClose=function(f){if(f&&f.type==="keyup"){return(f.which===27)?d.close():""}if(!d.isOpen){return}if(!d.isCurrent()&&d.isOpen||d.isOpen&&f.target!==d.el&&!e.stayOpen){if(d.allie){f.preventDefault()}d.close(e.autoAccept?"true":false)}};d.keyBtn=a("<button />").attr({role:"button",type:"button","aria-disabled":"false",tabindex:"-1"}).addClass("ui-keyboard-button");d.addKey=function(l,g,i){var o,k,j,f,q,h=(i===true)?l:e.display[g]||l,p=(i===true)?l.charCodeAt(0):l;if(/\(.+\)/.test(h)){f=h.replace(/\(([^()]+)\)/,"");j=h.match(/\(([^()]+)\)/)[1];h=f;q=f.split(":");f=(q[0]!==""&&q.length>1)?q[0]:f;a.keyboard.builtLayouts[d.layout].mappedKeys[j]=f}q=h.split(":");if(q[0]===""&&q[1]===""){h=":"}h=(q[0]!==""&&q.length>1)?a.trim(q[0]):h;o=(q.length>1)?a.trim(q[1]).replace(/_/g," ")||"":"";k=(h.length>1)?" ui-keyboard-widekey":"";k+=(i)?"":" ui-keyboard-actionkey";return d.keyBtn.clone().attr({"data-value":h,name:p,"data-pos":d.temp[1]+","+d.temp[2],title:o,"data-action":l,"data-original":h,"data-curtxt":h,"data-curnum":0}).addClass("ui-keyboard-"+p+k+" "+e.css.buttonDefault).html("<span>"+h+"</span>").appendTo(d.temp[0])};d.customHash=function(){var g,m,l,k,h=e.customLayout,j=[],f=[];for(m in h){if(h.hasOwnProperty(m)){j.push(h[m])}}f=f.concat.apply(f,j).join(" ");if(Array.prototype.reduce){return f.split("").reduce(function(n,i){n=((n<<5)-n)+i.charCodeAt(0);return n&n},0)}l=0;if(f.length===0){return l}for(g=0;g<f.length;g++){k=f.charCodeAt(g);l=((l<<5)-l)+k;l=l&l}return l};d.buildKeyboard=function(){var p,h,r,l,q,k,n,o,g,j=0,i=a.keyboard.builtLayouts[d.layout]={mappedKeys:{},acceptedKeys:[]},m=i.acceptedKeys=[],f=a("<div />").addClass("ui-keyboard "+e.css.container+(e.alwaysOpen?" ui-keyboard-always-open":"")).attr({role:"textbox"}).hide();if(e.layout==="custom"||!a.keyboard.layouts.hasOwnProperty(e.layout)){e.layout="custom";a.keyboard.layouts.custom=e.customLayout||{"default":["{cancel}"]}}a.each(a.keyboard.layouts[e.layout],function(t,s){if(t!==""){j++;l=a("<div />").attr("name",t).addClass("ui-keyboard-keyset ui-keyboard-keyset-"+t).appendTo(f)[(t==="default")?"show":"hide"]();for(r=0;r<s.length;r++){k=a.trim(s[r]).replace(/\{(\.?)[\s+]?:[\s+]?(\.?)\}/g,"{$1:$2}");o=k.split(/\s+/);for(n=0;n<o.length;n++){d.temp=[l,r,n];q=false;if(o[n].length===0){continue}if(/^\{\S+\}$/.test(o[n])){h=o[n].match(/^\{(\S+)\}$/)[1].toLowerCase();if(/\!\!/.test(h)){h=h.replace("!!","");q=true}if(/^sp:((\d+)?([\.|,]\d+)?)(em|px)?$/.test(h)){g=parseFloat(h.replace(/,/,".").match(/^sp:((\d+)?([\.|,]\d+)?)(em|px)?$/)[1]||0);a("<span>&nbsp;</span>").width((h.match("px")?g+"px":(g*2)+"em")).addClass("ui-keyboard-button ui-keyboard-spacer").appendTo(l)}if(/^meta\d+\:?(\w+)?/.test(h)){d.addKey(h,h);continue}switch(h){case"a":case"accept":d.addKey("accept",h).addClass(e.css.buttonAction);break;case"alt":case"altgr":d.addKey("alt","alt");break;case"b":case"bksp":d.addKey("bksp",h);break;case"c":case"cancel":d.addKey("cancel",h).addClass(e.css.buttonAction);break;case"combo":d.addKey("combo","combo").addClass(e.css.buttonAction);break;case"dec":m.push((d.decimal)?".":",");d.addKey("dec","dec");break;case"e":case"enter":d.addKey("enter",h).addClass(e.css.buttonAction);break;case"empty":d.addKey(""," ").addClass(e.css.buttonDisabled).attr("aria-disabled",true);break;case"s":case"shift":d.addKey("shift",h);break;case"sign":m.push("-");d.addKey("sign","sign");break;case"space":m.push(" ");d.addKey("space","space");break;case"t":case"tab":d.addKey("tab",h);break;default:if(a.keyboard.keyaction.hasOwnProperty(h)){d.addKey(h,h)[q?"addClass":"removeClass"](e.css.buttonAction)}}}else{p=o[n];m.push(p===":"?p:p.split(":")[0]);d.addKey(p,p,true)}}l.find(".ui-keyboard-button:last").after('<br class="ui-keyboard-button-endrow">')}}});if(j>1){d.sets=true}i.hasMappedKeys=!(a.isEmptyObject(i.mappedKeys));i.$keyboard=f;return f};d.destroy=function(){a(document).unbind("mousedown.keyboard keyup.keyboard touchstart.keyboard");if(d.$keyboard){d.$keyboard.remove()}var f=a.trim(e.openOn+" accepted beforeClose canceled change contextmenu hidden initialized keydown keypress keyup visible").split(" ").join(".keyboard ");d.$el.removeClass("ui-keyboard-input ui-keyboard-lockedinput ui-keyboard-placeholder ui-keyboard-notallowed ui-keyboard-always-open "+e.css.input).removeAttr("aria-haspopup").removeAttr("role").unbind(f+".keyboard").removeData("keyboard")};d.init()};a.keyboard.keyaction={accept:function(b){b.close(true);return false},alt:function(c,b){c.altActive=!c.altActive;c.showKeySet(b)},bksp:function(b){b.insertText("bksp")},cancel:function(b){b.close();return false},clear:function(b){b.$preview.val("")},combo:function(b){var d=!b.options.useCombos;b.options.useCombos=d;b.$keyboard.find(".ui-keyboard-combo").toggleClass(b.options.css.buttonAction,d);if(d){b.checkCombos()}return false},dec:function(b){b.insertText((b.decimal)?".":",")},"default":function(c,b){c.shiftActive=c.altActive=c.metaActive=false;c.showKeySet(b)},enter:function(d,c,f){var b=d.el.tagName,g=d.options;if(f.shiftKey){return(g.enterNavigation)?d.switchInput(!f[g.enterMod],true):d.close(true)}if(g.enterNavigation&&(b!=="TEXTAREA"||f[g.enterMod])){return d.switchInput(!f[g.enterMod],g.autoAccept?"true":false)}if(b==="TEXTAREA"&&a(f.target).closest("button").length){d.insertText(" \n")}},lock:function(c,b){c.lastKeyset[0]=c.shiftActive=c.capsLock=!c.capsLock;c.showKeySet(b)},left:function(b){var c=b.$preview.caret();if(c.start-1>=0){b.lastCaret={start:c.start-1,end:c.start-1}}},meta:function(c,b){c.metaActive=(a(b).hasClass(c.options.css.buttonAction))?false:true;c.showKeySet(b)},next:function(b){b.switchInput(true,b.options.autoAccept);return false},prev:function(b){b.switchInput(false,b.options.autoAccept);return false},right:function(b){var c=b.$preview.caret();if(c.start+1<=b.$preview.val().length){b.lastCaret={start:c.start+1,end:c.start+1}}},shift:function(c,b){c.lastKeyset[0]=c.shiftActive=!c.shiftActive;c.showKeySet(b)},sign:function(b){if(/^\-?\d*\.?\d*$/.test(b.$preview.val())){b.$preview.val((b.$preview.val()*-1))}},space:function(b){b.insertText(" ")},tab:function(c){var b=c.el.tagName,d=c.options;if(b==="INPUT"){if(d.tabNavigation){return c.switchInput(!c.shiftActive,true)}else{return false}}c.insertText("\t")}};a.keyboard.builtLayouts={};a.keyboard.layouts={alpha:{"default":["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","{tab} a b c d e f g h i j [ ] \\","k l m n o p q r s ; ' {enter}","{shift} t u v w x y z , . / {shift}","{accept} {space} {cancel}"],shift:["~ ! @ # $ % ^ & * ( ) _ + {bksp}","{tab} A B C D E F G H I J { } |",'K L M N O P Q R S : " {enter}',"{shift} T U V W X Y Z < > ? {shift}","{accept} {space} {cancel}"]},qwerty:{"default":["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","{tab} q w e r t y u i o p [ ] \\","a s d f g h j k l ; ' {enter}","{shift} z x c v b n m , . / {shift}","{accept} {space} {cancel}"],shift:["~ ! @ # $ % ^ & * ( ) _ + {bksp}","{tab} Q W E R T Y U I O P { } |",'A S D F G H J K L : " {enter}',"{shift} Z X C V B N M < > ? {shift}","{accept} {space} {cancel}"]},international:{"default":["` 1 2 3 4 5 6 7 8 9 0 - = {bksp}","{tab} q w e r t y u i o p [ ] \\","a s d f g h j k l ; ' {enter}","{shift} z x c v b n m , . / {shift}","{accept} {alt} {space} {alt} {cancel}"],shift:["~ ! @ # $ % ^ & * ( ) _ + {bksp}","{tab} Q W E R T Y U I O P { } |",'A S D F G H J K L : " {enter}',"{shift} Z X C V B N M < > ? {shift}","{accept} {alt} {space} {alt} {cancel}"],alt:["~ \u00a1 \u00b2 \u00b3 \u00a4 \u20ac \u00bc \u00bd \u00be \u2018 \u2019 \u00a5 \u00d7 {bksp}","{tab} \u00e4 \u00e5 \u00e9 \u00ae \u00fe \u00fc \u00fa \u00ed \u00f3 \u00f6 \u00ab \u00bb \u00ac","\u00e1 \u00df \u00f0 f g h j k \u00f8 \u00b6 \u00b4 {enter}","{shift} \u00e6 x \u00a9 v b \u00f1 \u00b5 \u00e7 > \u00bf {shift}","{accept} {alt} {space} {alt} {cancel}"],"alt-shift":["~ \u00b9 \u00b2 \u00b3 \u00a3 \u20ac \u00bc \u00bd \u00be \u2018 \u2019 \u00a5 \u00f7 {bksp}","{tab} \u00c4 \u00c5 \u00c9 \u00ae \u00de \u00dc \u00da \u00cd \u00d3 \u00d6 \u00ab \u00bb \u00a6","\u00c4 \u00a7 \u00d0 F G H J K \u00d8 \u00b0 \u00a8 {enter}","{shift} \u00c6 X \u00a2 V B \u00d1 \u00b5 \u00c7 . \u00bf {shift}","{accept} {alt} {space} {alt} {cancel}"]},dvorak:{"default":["` 1 2 3 4 5 6 7 8 9 0 [ ] {bksp}","{tab} ' , . p y f g c r l / = \\","a o e u i d h t n s - {enter}","{shift} ; q j k x b m w v z {shift}","{accept} {space} {cancel}"],shift:["~ ! @ # $ % ^ & * ( ) { } {bksp}",'{tab} " < > P Y F G C R L ? + |',"A O E U I D H T N S _ {enter}","{shift} : Q J K X B M W V Z {shift}","{accept} {space} {cancel}"]},num:{"default":["= ( ) {b}","{clear} / * -","7 8 9 +","4 5 6 {sign}","1 2 3 %","0 . {a} {c}"]}};a.keyboard.defaultOptions={layout:"qwerty",customLayout:null,position:{of:null,my:"center top",at:"center top",at2:"center bottom"},usePreview:true,alwaysOpen:false,initialFocus:true,stayOpen:false,display:{a:"\u2714:Accept (Shift-Enter)",accept:"Accept:Accept (Shift-Enter)",alt:"Alt:\u2325 AltGr",b:"\u232b:Backspace",bksp:"Bksp:Backspace",c:"\u2716:Cancel (Esc)",cancel:"Cancel:Cancel (Esc)",clear:"C:Clear",combo:"\u00f6:Toggle Combo Keys",dec:".:Decimal",e:"\u23ce:Enter",empty:"\u00a0",enter:"Enter:Enter \u23ce",left:"\u2190",lock:"Lock:\u21ea Caps Lock",next:"Next \u21e8",prev:"\u21e6 Prev",right:"\u2192",s:"\u21e7:Shift",shift:"Shift:Shift",sign:"\u00b1:Change Sign",space:"&nbsp;:Space",t:"\u21e5:Tab",tab:"\u21e5 Tab:Tab"},wheelMessage:"Use mousewheel to see other keys",css:{input:"ui-widget-content ui-corner-all",container:"ui-widget-content ui-widget ui-corner-all ui-helper-clearfix",buttonDefault:"ui-state-default ui-corner-all",buttonHover:"ui-state-hover",buttonAction:"ui-state-active",buttonDisabled:"ui-state-disabled"},autoAccept:false,lockInput:false,restrictInput:false,acceptValid:false,cancelClose:true,tabNavigation:false,enterNavigation:false,enterMod:"altKey",stopAtEnd:true,appendLocally:false,stickyShift:true,preventPaste:false,caretToEnd:false,maxLength:false,repeatDelay:500,repeatRate:20,resetDefault:false,openOn:"focus",keyBinding:"mousedown touchstart",useCombos:true,combos:{"`":{a:"\u00e0",A:"\u00c0",e:"\u00e8",E:"\u00c8",i:"\u00ec",I:"\u00cc",o:"\u00f2",O:"\u00d2",u:"\u00f9",U:"\u00d9",y:"\u1ef3",Y:"\u1ef2"},"'":{a:"\u00e1",A:"\u00c1",e:"\u00e9",E:"\u00c9",i:"\u00ed",I:"\u00cd",o:"\u00f3",O:"\u00d3",u:"\u00fa",U:"\u00da",y:"\u00fd",Y:"\u00dd"},'"':{a:"\u00e4",A:"\u00c4",e:"\u00eb",E:"\u00cb",i:"\u00ef",I:"\u00cf",o:"\u00f6",O:"\u00d6",u:"\u00fc",U:"\u00dc",y:"\u00ff",Y:"\u0178"},"^":{a:"\u00e2",A:"\u00c2",e:"\u00ea",E:"\u00ca",i:"\u00ee",I:"\u00ce",o:"\u00f4",O:"\u00d4",u:"\u00fb",U:"\u00db",y:"\u0177",Y:"\u0176"},"~":{a:"\u00e3",A:"\u00c3",e:"\u1ebd",E:"\u1ebc",i:"\u0129",I:"\u0128",o:"\u00f5",O:"\u00d5",u:"\u0169",U:"\u0168",y:"\u1ef9",Y:"\u1ef8",n:"\u00f1",N:"\u00d1"}},validate:function(b,c,d){return true}};a.keyboard.comboRegex=/([`\'~\^\"ao])([a-z])/mig;a.keyboard.currentKeyboard="";a.fn.keyboard=function(b){return this.each(function(){if(!a(this).data("keyboard")){(new a.keyboard(this,b))}})};a.fn.getkeyboard=function(){return this.data("keyboard")}})(jQuery);(function(c,a,b,d){c.fn.caret=function(v,p){if(typeof this[0]==="undefined"||this.is(":hidden")||this.css("visibility")==="hidden"){return this}var u,g,m,j,l,k,f,i,h,o=document.selection,q=this[0],n=q.scrollTop,r=typeof q.selectionStart!=="undefined";if(typeof v==="object"&&v.start&&v.end){g=v.start;j=v.end}else{if(typeof v==="number"&&typeof p==="number"){g=v;j=p}}if(typeof g!=="undefined"){if(r){q.selectionStart=g;q.selectionEnd=j}else{l=q.createTextRange();l.collapse(true);l.moveStart("character",g);l.moveEnd("character",j-g);l.select()}if(this.is(":visible")||this.css("visibility")!=="hidden"){this.focus()}q.scrollTop=n;return this}else{if(r){u=q.selectionStart;m=q.selectionEnd}else{if(q.tagName==="TEXTAREA"){h=this.val();k=o[b]();f=k[d]();f.moveToElementText(q);f.setEndPoint("EndToEnd",k);u=f.text.replace(/\r/g,"\n")[a];m=u+k.text.replace(/\r/g,"\n")[a]}else{h=this.val().replace(/\r/g,"\n");k=o[b]()[d]();k.moveEnd("character",h[a]);u=(k.text===""?h[a]:h.lastIndexOf(k.text));k=o[b]()[d]();k.moveStart("character",-h[a]);m=k.text[a]}}i=(q.value||"").substring(u,m);return{start:u,end:m,text:i,replace:function(e){return q.value.substring(0,u)+e+q.value.substring(m,q.value[a])}}}}})(jQuery,"length","createRange","duplicate");