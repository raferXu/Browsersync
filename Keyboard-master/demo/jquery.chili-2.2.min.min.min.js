(function(a){ChiliBook={version:"2.2",automatic:true,automaticSelector:"code",lineNumbers:!true,codeLanguage:function(b){var c=a(b).attr("class");return c?c:""},recipeLoading:true,recipeFolder:"",replaceSpace:"&#160;",replaceTab:"&#160;&#160;&#160;&#160;",replaceNewLine:"&#160;<br/>",selectionStyle:["position:absolute; z-index:3000; overflow:scroll;","width:16em;","height:9em;","border:1px solid gray;","padding:15px;","background-color:yellow;"].join(" "),defaultReplacement:'<span class="$0">$$</span>',recipes:{},queue:{},unique:function(){return(new Date()).valueOf()}};a.fn.chili=function(h){var k=a.extend({},ChiliBook,h||{});function f(p,t,v){function D(K,J){var I=[];for(var H in K[J]){I.push(u(K,J,H))}return I}function u(L,I,H){var J=L[I][H];var K=(typeof J._match=="string")?J._match:J._match.source;return{recipe:L,blockName:I,stepName:H,exp:"("+K+")",length:1+(K.replace(/\\./g,"%").replace(/\[.*?\]/g,"%").match(/\((?!\?)/g)||[]).length,replacement:J._replace?J._replace:k.defaultReplacement}}function C(L){var O=1;var K=[];for(var N=0;N<L.length;N++){var I=L[N].exp;I=I.replace(/\\\\|\\(\d+)/g,function(P,Q){return !Q?P:"\\"+(O+1+parseInt(Q,10))});K.push(I);O+=L[N].length}var M="((?:\\s|\\S)*?)";var J="((?:\\s|\\S)+)";var H="(?:"+K.join("|")+")";H=M+H+"|"+J;return new RegExp(H,t._case?"g":"gi")}function s(H){return H.replace(/&/g,"&amp;").replace(/</g,"&lt;")}function w(H){return H.replace(/ +/g,function(I){return I.replace(/ /g,B)})}function F(H){H=s(H);if(B){H=w(H)}return H}function r(I,H){return f(I,H)}function q(J,H,I){return f(J,H,I)}function z(O,I,N,J){var M=k.replaceSpace;var H=u(I,N,J);var L=[H];var K=O.replace(C(L),function(){return G.apply({steps:L},arguments)});return K}function o(T,N,L){if(!N){return F(T)}var J=N.split("/");var S="";var H="";var K="";switch(J.length){case 1:S=J[0];break;case 2:S=J[0];H=J[1];break;case 3:S=J[0];H=J[1];K=J[2];break;default:return F(T)}function P(W){var U=e(W);var V=k.recipes[U];if(!V){throw {msg:"recipe not available"}}return V}try{var I;if(""==K){if(""==H){if(""==S){}else{I=P(S);return r(T,I)}}else{if(""==S){I=L.recipe}else{I=P(S)}if(!(H in I)){return F(T)}return q(T,I,H)}}else{if(""==S){I=L.recipe}else{I=P(S)}if(""==H){H=L.blockName}if(!(H in I)){return F(T)}if(!(K in I[H])){return F(T)}return z(T,I,H,K)}}catch(R){if(R.msg&&R.msg=="recipe not available"){var Q="chili_"+k.unique();if(k.recipeLoading){var M=e(S);if(!k.queue[M]){try{k.queue[M]=[{cue:Q,subject:T,module:N,context:L}];a.getJSON(M,function(W){k.recipes[M]=W;var U=k.queue[M];for(var X=0,V=U.length;X<V;X++){var Y=o(U[X].subject,U[X].module,U[X].context);if(k.replaceTab){Y=Y.replace(/\t/g,k.replaceTab)}if(k.replaceNewLine){Y=Y.replace(/\n/g,k.replaceNewLine)}a("#"+U[X].cue).replaceWith(Y)}})}catch(O){alert("the recipe for '"+S+"' was not found in '"+M+"'")}}else{k.queue[M].push({cue:Q,subject:T,module:N,context:L})}return'<span id="'+Q+'">'+F(T)+"</span>"}return F(T)}else{return F(T)}}}function E(H,J){var I=J.replace(/(<span\s+class\s*=\s*(["']))((?:(?!__)\w)+\2\s*>)/ig,"$1"+H+"__$3");return I}function G(){if(!arguments[0]){return""}var I=this.steps;var R=0;var Q=2;var K=arguments[1];var O=arguments[arguments.length-3];if(!O){var M;while(M=I[R++]){var L=arguments;if(L[Q]){var N="";if(a.isFunction(M.replacement)){var H=[];for(var P=0,J=M.length;P<J;P++){H.push(L[Q+P])}H.push(L[L.length-2]);H.push(L[L.length-1]);N=M.replacement.apply({x:function(){var U=arguments[0];var T=arguments[1];var S={recipe:M.recipe,blockName:M.blockName};return o(U,T,S)}},H)}else{N=M.replacement.replace(/(\\\$)|(?:\$\$)|(?:\$(\d+))/g,function(S,U,T){if(U){return"$"}else{if(!T){return F(L[Q])}else{if(T=="0"){return M.stepName}else{return F(L[Q+parseInt(T,10)])}}}})}N=E(M.recipe._name,N);return F(K)+N}else{Q+=M.length}}}else{return F(O)}}if(!v){v="_main";l(t)}if(!(v in t)){return F(p)}var B=k.replaceSpace;var A=D(t,v);var x=C(A);var y=p.replace(x,function(){return G.apply({steps:A},arguments)});return y}function g(p){if(document.createElement){var q=document.createElement("style");q.type="text/css";if(q.styleSheet){q.styleSheet.cssText=p}else{var o=document.createTextNode(p);q.appendChild(o)}document.getElementsByTagName("head")[0].appendChild(q)}}function l(t){var p=t._name;if(!k.queue[p]){var s=["/* Chili -- "+p+" */"];for(var o in t){if(o.search(/^_(?!main\b)/)<0){for(var u in t[o]){var r=t[o][u];if("_style" in r){if(r._style.constructor==String){s.push("."+p+"__"+u+" { "+r._style+" }")}else{for(var q in r._style){s.push("."+p+"__"+q+" { "+r._style[q]+" }")}}}}}}s=s.join("\n");g(s);k.queue[p]=true}}function i(o){var r=k.codeLanguage(o);if(""!=r){var q=e(r);if(k.recipeLoading){if(!k.queue[q]){try{k.queue[q]=[o];a.getJSON(q,function(s){k.recipes[q]=s;var u=k.queue[q];for(var t=0,v=u.length;t<v;t++){b(u[t],q)}})}catch(p){alert("the recipe for '"+r+"' was not found in '"+q+"'")}}else{k.queue[q].push(o)}b(o,q)}else{b(o,q)}}}function b(x,q){var u=k.recipes[q];if(!u){return}var v=a(x);var p=v.text();if(!p){return}p=p.replace(/\r\n?/g,"\n");if(v.parent().is("pre")){if(!a.browser.safari){p=p.replace(/^\n/g,"")}}var y=f(p,u);if(k.replaceTab){y=y.replace(/\t/g,k.replaceTab)}if(k.replaceNewLine){y=y.replace(/\n/g,k.replaceNewLine)}x.innerHTML=y;if(a.browser.msie||a.browser.mozilla){j(x)}var o=v.parent();var z=o.attr("class");var r=/ln-(\d+)-([\w][\w\-]*)|ln-(\d+)|ln-/.exec(z);if(r){c(x);var w=0;if(r[1]){w=parseInt(r[1],10);var t=a(".ln-"+r[1]+"-"+r[2]);var s=t.index(o[0]);t.slice(0,s).each(function(){w+=a(this).find("li").length})}else{if(r[3]){w=parseInt(r[3],10)}else{w=1}}v.find("ol")[0].start=w;a("body").width(a("body").width()-1).width(a("body").width()+1)}else{if(k.lineNumbers){c(x)}}}function j(p){var o=null;a(p).parents().filter("pre").bind("mousedown",function(){o=this;if(a.browser.msie){document.selection.empty()}else{window.getSelection().removeAllRanges()}}).bind("mouseup",function(v){if(o&&(o==this)){o=null;var t="";if(a.browser.msie){t=document.selection.createRange().htmlText;if(""==t){return}t=d(t);var r='<textarea style="STYLE">'}else{t=window.getSelection().toString();if(""==t){return}t=t.replace(/\r/g,"").replace(/^# ?/g,"").replace(/\n# ?/g,"\n");var r='<pre style="STYLE">'}var q=a(r.replace(/\bSTYLE\b/,ChiliBook.selectionStyle)).appendTo("body").text(t).attr("id","chili_selection").click(function(){a(this).remove()});var x=v.pageY-Math.round(q.height()/2)+"px";var w=v.pageX-Math.round(q.width()/2)+"px";q.css({top:x,left:w});if(a.browser.msie){q[0].focus();q[0].select()}else{var s=window.getSelection();s.removeAllRanges();var u=document.createRange();u.selectNodeContents(q[0]);s.addRange(u)}}})}function e(o){return k.recipeFolder+o+".js"}function m(){var o="";if(a.browser.msie){o=document.selection.createRange().htmlText}else{o=window.getSelection().toString()}return o}function d(o){do{var q=ChiliBook.unique()}while(o.indexOf(q)>-1);var r="";if(/<br/i.test(o)||/<li/i.test(o)){if(/<br/i.test(o)){o=o.replace(/\<br[^>]*?\>/ig,q)}else{if(/<li/i.test(o)){o=o.replace(/<ol[^>]*?>|<\/ol>|<li[^>]*?>/ig,"").replace(/<\/li>/ig,q)}}var p=a("<pre>").appendTo("body").hide()[0];p.innerHTML=o;r=a(p).text().replace(new RegExp(q,"g"),"\r\n");a(p).remove()}return r}function c(t){function s(w,A,z,x){var y=x?"</span>":"";var v="";if(w){v="<li>"+x+A+y+"</li>"}else{if(z){v="<li>"+x+z+y+"</li>"}}return v}function r(x,z,y,v){var w="";if(v){w=v}else{w=s(x,z,y,"")}return w}var q=a(t).html();var p=/<br>/.test(q)?"<br>":"<BR>";var u="<li>"+k.replaceSpace+"</li>";var o=q.replace(/(<span [^>]+>)((?:(?:&nbsp;|\xA0)<br>)+)(.*?)(<\/span>)/ig,"$2$1$3$4").replace(/(.*?)(<span .*?>)(.*?)(?:<\/span>(?:&nbsp;|\xA0)<br>|<\/span>)/ig,function(z,A,x,y){if(/<br>/i.test(y)){var B=A.split(p);var w=B.pop();A=B.join(p);var v=(A?A+p:"")+(w+y).replace(/((.*?)(?:&nbsp;|\xA0)<br>)|(.*)/ig,function(F,D,C,G){var E=s(D,C,G,x);return E});return v}else{return z}}).replace(/(<li>.*?<\/li>)|((.*?)(?:&nbsp;|\xA0)<br>)|(.+)/ig,function(x,y,v,A,z){var w=r(v,A,z,y);return w}).replace(/<li><\/li>/ig,u);t.innerHTML="<ol>"+o+"</ol>"}function n(o){return a.map(o.split(""),function(q,p){return" "+q+" "+q.charCodeAt(0)+" "}).join(" ")}this.each(function(){var o=a(this);o.trigger("chili.before_coloring");i(this);o.trigger("chili.after_coloring")});return this};a(function(){if(ChiliBook.automatic){a(ChiliBook.automaticSelector).chili()}})})(jQuery);