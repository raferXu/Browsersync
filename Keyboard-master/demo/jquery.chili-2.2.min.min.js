(function(b){ChiliBook={version:"2.2",automatic:true,automaticSelector:"code",lineNumbers:!true,codeLanguage:function(a){var d=b(a).attr("class");return d?d:""},recipeLoading:true,recipeFolder:"",replaceSpace:"&#160;",replaceTab:"&#160;&#160;&#160;&#160;",replaceNewLine:"&#160;<br/>",selectionStyle:["position:absolute; z-index:3000; overflow:scroll;","width:16em;","height:9em;","border:1px solid gray;","padding:15px;","background-color:yellow;"].join(" "),defaultReplacement:'<span class="$0">$$</span>',recipes:{},queue:{},unique:function(){return(new Date()).valueOf()}};b.fn.chili=function(a){var v=b.extend({},ChiliBook,a||{});function z(M,I,n){function f(B,C){var D=[];for(var A in B[C]){D.push(H(B,C,A))}return D}function H(B,E,A){var D=B[E][A];var C=(typeof D._match=="string")?D._match:D._match.source;return{recipe:B,blockName:E,stepName:A,exp:"("+C+")",length:1+(C.replace(/\\./g,"%").replace(/\[.*?\]/g,"%").match(/\((?!\?)/g)||[]).length,replacement:D._replace?D._replace:v.defaultReplacement}}function g(E){var B=1;var P=[];for(var C=0;C<E.length;C++){var G=E[C].exp;G=G.replace(/\\\\|\\(\d+)/g,function(R,O){return !O?R:"\\"+(B+1+parseInt(O,10))});P.push(G);B+=E[C].length}var D="((?:\\s|\\S)*?)";var F="((?:\\s|\\S)+)";var A="(?:"+P.join("|")+")";A=D+A+"|"+F;return new RegExp(A,I._case?"g":"gi")}function J(A){return A.replace(/&/g,"&amp;").replace(/</g,"&lt;")}function m(A){return A.replace(/ +/g,function(B){return B.replace(/ /g,h)})}function d(A){A=J(A);if(h){A=m(A)}return A}function K(B,A){return z(B,A)}function L(B,A,C){return z(B,A,C)}function j(B,G,C,F){var D=v.replaceSpace;var A=H(G,C,F);var E=[A];var P=B.replace(g(E),function(){return c.apply({steps:E},arguments)});return P}function N(E,X,Y){if(!X){return d(E)}var Z=X.split("/");var F="";var D="";var B="";switch(Z.length){case 1:F=Z[0];break;case 2:F=Z[0];D=Z[1];break;case 3:F=Z[0];D=Z[1];B=Z[2];break;default:return d(E)}function V(O){var Q=o(O);var P=v.recipes[Q];if(!P){throw {msg:"recipe not available"}}return P}try{var C;if(""==B){if(""==D){if(""==F){}else{C=V(F);return K(E,C)}}else{if(""==F){C=Y.recipe}else{C=V(F)}if(!(D in C)){return d(E)}return L(E,C,D)}}else{if(""==F){C=Y.recipe}else{C=V(F)}if(""==D){D=Y.blockName}if(!(D in C)){return d(E)}if(!(B in C[D])){return d(E)}return j(E,C,D,B)}}catch(G){if(G.msg&&G.msg=="recipe not available"){var U="chili_"+v.unique();if(v.recipeLoading){var A=o(F);if(!v.queue[A]){try{v.queue[A]=[{cue:U,subject:E,module:X,context:Y}];b.getJSON(A,function(Q){v.recipes[A]=Q;var S=v.queue[A];for(var P=0,R=S.length;P<R;P++){var O=N(S[P].subject,S[P].module,S[P].context);if(v.replaceTab){O=O.replace(/\t/g,v.replaceTab)}if(v.replaceNewLine){O=O.replace(/\n/g,v.replaceNewLine)}b("#"+S[P].cue).replaceWith(O)}})}catch(W){alert("the recipe for '"+F+"' was not found in '"+A+"'")}}else{v.queue[A].push({cue:U,subject:E,module:X,context:Y})}return'<span id="'+U+'">'+d(E)+"</span>"}return d(E)}else{return d(E)}}}function e(A,B){var C=B.replace(/(<span\s+class\s*=\s*(["']))((?:(?!__)\w)+\2\s*>)/ig,"$1"+A+"__$3");return C}function c(){if(!arguments[0]){return""}var C=this.steps;var E=0;var F=2;var A=arguments[1];var S=arguments[arguments.length-3];if(!S){var U;while(U=C[E++]){var V=arguments;if(V[F]){var T="";if(b.isFunction(U.replacement)){var D=[];for(var G=0,B=U.length;G<B;G++){D.push(V[F+G])}D.push(V[V.length-2]);D.push(V[V.length-1]);T=U.replacement.apply({x:function(){var O=arguments[0];var P=arguments[1];var Q={recipe:U.recipe,blockName:U.blockName};return N(O,P,Q)}},D)}else{T=U.replacement.replace(/(\\\$)|(?:\$\$)|(?:\$(\d+))/g,function(Q,O,P){if(O){return"$"}else{if(!P){return d(V[F])}else{if(P=="0"){return U.stepName}else{return d(V[F+parseInt(P,10)])}}}})}T=e(U.recipe._name,T);return d(A)+T}else{F+=U.length}}}else{return d(S)}}if(!n){n="_main";u(I)}if(!(n in I)){return d(M)}var h=v.replaceSpace;var i=f(I,n);var l=g(i);var k=M.replace(l,function(){return c.apply({steps:i},arguments)});return k}function y(d){if(document.createElement){var c=document.createElement("style");c.type="text/css";if(c.styleSheet){c.styleSheet.cssText=d}else{var e=document.createTextNode(d);c.appendChild(e)}document.getElementsByTagName("head")[0].appendChild(c)}}function u(d){var h=d._name;if(!v.queue[h]){var e=["/* Chili -- "+h+" */"];for(var i in d){if(i.search(/^_(?!main\b)/)<0){for(var c in d[i]){var f=d[i][c];if("_style" in f){if(f._style.constructor==String){e.push("."+h+"__"+c+" { "+f._style+" }")}else{for(var g in f._style){e.push("."+h+"__"+g+" { "+f._style[g]+" }")}}}}}}e=e.join("\n");y(e);v.queue[h]=true}}function x(f){var c=v.codeLanguage(f);if(""!=c){var d=o(c);if(v.recipeLoading){if(!v.queue[d]){try{v.queue[d]=[f];b.getJSON(d,function(j){v.recipes[d]=j;var h=v.queue[d];for(var i=0,g=h.length;i<g;i++){r(h[i],d)}})}catch(e){alert("the recipe for '"+c+"' was not found in '"+d+"'")}}else{v.queue[d].push(f)}r(f,d)}else{r(f,d)}}}function r(e,l){var h=v.recipes[l];if(!h){return}var g=b(e);var m=g.text();if(!m){return}m=m.replace(/\r\n?/g,"\n");if(g.parent().is("pre")){if(!b.browser.safari){m=m.replace(/^\n/g,"")}}var d=z(m,h);if(v.replaceTab){d=d.replace(/\t/g,v.replaceTab)}if(v.replaceNewLine){d=d.replace(/\n/g,v.replaceNewLine)}e.innerHTML=d;if(b.browser.msie||b.browser.mozilla){w(e)}var n=g.parent();var c=n.attr("class");var k=/ln-(\d+)-([\w][\w\-]*)|ln-(\d+)|ln-/.exec(c);if(k){q(e);var f=0;if(k[1]){f=parseInt(k[1],10);var i=b(".ln-"+k[1]+"-"+k[2]);var j=i.index(n[0]);i.slice(0,j).each(function(){f+=b(this).find("li").length})}else{if(k[3]){f=parseInt(k[3],10)}else{f=1}}g.find("ol")[0].start=f;b("body").width(b("body").width()-1).width(b("body").width()+1)}else{if(v.lineNumbers){q(e)}}}function w(c){var d=null;b(c).parents().filter("pre").bind("mousedown",function(){d=this;if(b.browser.msie){document.selection.empty()}else{window.getSelection().removeAllRanges()}}).bind("mouseup",function(g){if(d&&(d==this)){d=null;var i="";if(b.browser.msie){i=document.selection.createRange().htmlText;if(""==i){return}i=p(i);var k='<textarea style="STYLE">'}else{i=window.getSelection().toString();if(""==i){return}i=i.replace(/\r/g,"").replace(/^# ?/g,"").replace(/\n# ?/g,"\n");var k='<pre style="STYLE">'}var l=b(k.replace(/\bSTYLE\b/,ChiliBook.selectionStyle)).appendTo("body").text(i).attr("id","chili_selection").click(function(){b(this).remove()});var e=g.pageY-Math.round(l.height()/2)+"px";var f=g.pageX-Math.round(l.width()/2)+"px";l.css({top:e,left:f});if(b.browser.msie){l[0].focus();l[0].select()}else{var j=window.getSelection();j.removeAllRanges();var h=document.createRange();h.selectNodeContents(l[0]);j.addRange(h)}}})}function o(c){return v.recipeFolder+c+".js"}function t(){var c="";if(b.browser.msie){c=document.selection.createRange().htmlText}else{c=window.getSelection().toString()}return c}function p(f){do{var d=ChiliBook.unique()}while(f.indexOf(d)>-1);var c="";if(/<br/i.test(f)||/<li/i.test(f)){if(/<br/i.test(f)){f=f.replace(/\<br[^>]*?\>/ig,d)}else{if(/<li/i.test(f)){f=f.replace(/<ol[^>]*?>|<\/ol>|<li[^>]*?>/ig,"").replace(/<\/li>/ig,d)}}var e=b("<pre>").appendTo("body").hide()[0];e.innerHTML=f;c=b(e).text().replace(new RegExp(d,"g"),"\r\n");b(e).remove()}return c}function q(d){function e(l,n,B,k){var j=k?"</span>":"";var m="";if(l){m="<li>"+k+n+j+"</li>"}else{if(B){m="<li>"+k+B+j+"</li>"}}return m}function f(k,n,j,m){var l="";if(m){l=m}else{l=e(k,n,j,"")}return l}var g=b(d).html();var h=/<br>/.test(g)?"<br>":"<BR>";var c="<li>"+v.replaceSpace+"</li>";var i=g.replace(/(<span [^>]+>)((?:(?:&nbsp;|\xA0)<br>)+)(.*?)(<\/span>)/ig,"$2$1$3$4").replace(/(.*?)(<span .*?>)(.*?)(?:<\/span>(?:&nbsp;|\xA0)<br>|<\/span>)/ig,function(D,C,k,j){if(/<br>/i.test(j)){var n=C.split(h);var l=n.pop();C=n.join(h);var m=(C?C+h:"")+(l+j).replace(/((.*?)(?:&nbsp;|\xA0)<br>)|(.*)/ig,function(H,J,A,B){var I=e(J,A,B,k);return I});return m}else{return D}}).replace(/(<li>.*?<\/li>)|((.*?)(?:&nbsp;|\xA0)<br>)|(.+)/ig,function(k,j,m,n,B){var l=f(m,n,B,j);return l}).replace(/<li><\/li>/ig,c);d.innerHTML="<ol>"+i+"</ol>"}function s(c){return b.map(c.split(""),function(d,e){return" "+d+" "+d.charCodeAt(0)+" "}).join(" ")}this.each(function(){var c=b(this);c.trigger("chili.before_coloring");x(this);c.trigger("chili.after_coloring")});return this};b(function(){if(ChiliBook.automatic){b(ChiliBook.automaticSelector).chili()}})})(jQuery);