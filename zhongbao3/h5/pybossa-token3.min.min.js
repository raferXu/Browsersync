(function(y,s,u){var t="";var x="/";var n={id:""};var p=function(a,b){b.resolve(a)};var o=function(a,b){b.resolve(a)};function v(a){return s.ajax({url:x+"token/project",beforeSend:function(b){if(t===""){return}else{b.setRequestHeader("Authorization",t)}},success:function(b){console.log("url + 'token/project' success");console.log(b)},error:function(b){console.log("url + 'token/project' error");console.log(b)},data:"all=1&short_name="+a,dataType:"json"})}function w(b,a){console.log("_fetchNewTask函数第一参数projectId: "+b+", 第二参数offset: "+a);console.log(b);console.log(a);a=a||0;return s.ajax({url:x+"token/project/"+b+"/newtask",beforeSend:function(c){if(t===""){return}else{c.setRequestHeader("Authorization",t)}},success:function(c){console.log("url + 'token/project/' + projectId + '/newtask' success");console.log(c);if(!c.id){jumpProjectFlag=true}},error:function(c){console.log("url + 'token/project/' + projectId + '/newtask' error");console.log(c)},data:"offset="+a,cache:false,dataType:"json"})}function q(a){return s.ajax({type:"POST",url:x+"token/taskrun",beforeSend:function(b){if(t===""){return}else{b.setRequestHeader("Authorization",t)}},success:function(b){console.log("url + 'token/taskrun' success");console.log(b)},error:function(b){console.log("url + 'token/taskrun' error");console.log(b)},dataType:"json",contentType:"application/json",data:a})}function z(b,c){var a=s.Deferred();p(b,a);a.done(function(d){c.resolve(d)})}function r(b,a){a=a||window;v(b).done(function(c){c=c[0];function d(f,h){f=f||0;var i=s.Deferred(),k=s.Deferred();var j=n.id;var g=w(c.id,f);g.done(function(l){if(h&&l.id===h.id){i.resolve(l)}else{z(l,i);i.done(function(){o(l,k)})}if(l.id){n.id=l.id}});k.done(e)}function e(f){d(0,f)}d(0,u)})}y.saveTask=function(c,a){var b={project_id:c.project_id,task_id:c.id,info:a};return q(JSON.stringify(b))};y.run=function(b,a){t=s("#token").data("token");r(b,a)};y.taskLoaded=function(a){p=a};y.presentTask=function(a){o=a}}(window.pybossa=window.pybossa||{},jQuery));