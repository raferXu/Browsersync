(function(){var b=function(i){var g=function(c,d){this.el=i(c);this.lastScale=3;this.options=i.extend({},this.defaults,d);this.setupMarkup();this.bindEvents();this.update();this.enable()},a=function(c,d){return c+d},h=function(c,d){return c>d-0.01&&c<d+0.01};g.prototype={defaults:{zoomFactor:3,offset:{x:0,y:0},tapZoomFactor:2.8,zoomOutFactor:1,animationDuration:300,maxZoom:6,minZoom:0.5,lockDragAxis:false,use2d:true,zoomStartEventName:"pz_zoomstart",zoomEndEventName:"pz_zoomend",dragStartEventName:"pz_dragstart",dragEndEventName:"pz_dragend",doubleTapEventName:"pz_doubletap"},handleDragStart:function(c){this.el.trigger(this.options.dragStartEventName);this.stopAnimation();this.lastDragPosition=false;this.hasInteraction=true;this.handleDrag(c)},handleDrag:function(d){if(this.options.zoomFactor>1){var c=this.getTouches(d)[0];this.drag(c,this.lastDragPosition);this.options.offset=this.sanitizeOffset(this.options.offset);this.lastDragPosition=c}},handleDragEnd:function(){this.el.trigger(this.options.dragEndEventName);this.end()},handleZoomStart:function(c){this.el.trigger(this.options.zoomStartEventName);this.stopAnimation();this.lastScale=1;this.nthZoom=0;this.lastZoomCenter=false;this.hasInteraction=true},handleZoom:function(e,c){var f=this.getTouchCenter(this.getTouches(e)),d=c/this.lastScale;this.lastScale=c;this.nthZoom+=1;if(this.nthZoom>3){this.scale(d,f);this.drag(f,this.lastZoomCenter)}this.lastZoomCenter=f},handleZoomEnd:function(){this.el.trigger(this.options.zoomEndEventName);this.end()},handleDoubleTap:function(e){var l=this.getTouches(e)[0],f=this.options.zoomFactor!=2.8?2.8:this.options.tapZoomFactor,d=this.options.zoomFactor,c=(function(k){this.scaleTo(d+k*(f-d),l)}).bind(this);if(this.hasInteraction){return}if(d>f){l=this.getCurrentZoomCenter()}this.animate(this.options.animationDuration,c,this.swing);this.el.trigger(this.options.doubleTapEventName)},sanitizeOffset:function(c){var d=(this.options.zoomFactor-1)*this.getContainerX(),e=(this.options.zoomFactor-1)*this.getContainerY(),f=Math.max(d,0),n=Math.max(e,0),o=Math.min(d,0),p=Math.min(e,0);return{x:Math.min(Math.max(c.x,o),f),y:Math.min(Math.max(c.y,p),n)}},scaleTo:function(c,d){this.scale(c/this.options.zoomFactor,d)},scale:function(c,d){c=this.scaleZoomFactor(c);this.addOffset({x:(c-1)*(d.x+this.options.offset.x),y:(c-1)*(d.y+this.options.offset.y)})},scaleZoomFactor:function(d){var c=this.options.zoomFactor;this.options.zoomFactor*=d;this.options.zoomFactor=Math.min(this.options.maxZoom,Math.max(this.options.zoomFactor,this.options.minZoom));return this.options.zoomFactor/c},drag:function(d,c){if(c){if(this.options.lockDragAxis){if(Math.abs(d.x-c.x)>Math.abs(d.y-c.y)){this.addOffset({x:-(d.x-c.x),y:0})}else{this.addOffset({y:-(d.y-c.y),x:0})}}else{this.addOffset({y:-(d.y-c.y),x:-(d.x-c.x)})}}},getTouchCenter:function(c){return this.getVectorAvg(c)},getVectorAvg:function(c){return{x:c.map(function(d){return d.x}).reduce(a)/c.length,y:c.map(function(d){return d.y}).reduce(a)/c.length}},addOffset:function(t){var d=this.options.offset.x;var q=this.options.offset.y;var e=i(window).width();var f=parseInt(i(".billImg").css("marginTop"));var c=parseInt(i(".billImg").width());var u=i(".billImgBox").innerWidth();var s=parseInt(i(".billImg").height());var r=i(".imgWrap").height();if(this.options.zoomFactor<3){if(c*this.options.zoomFactor<d){d=c*this.options.zoomFactor}else{if(u*this.options.zoomFactor*(2/3)-e>d){d=u*this.options.zoomFactor*(2/3)-e}}if(q>this.options.zoomFactor*f){q=this.options.zoomFactor*f}else{if(q<(f+s)*this.options.zoomFactor-r){q=(f+s)*this.options.zoomFactor-r}}}else{if(c*this.options.zoomFactor>d){d=c*this.options.zoomFactor}if(u*this.options.zoomFactor*(2/3)-e<d){d=u*this.options.zoomFactor*(2/3)-e}if(q>this.options.zoomFactor*f){q=this.options.zoomFactor*f}if(q<(f+s)*this.options.zoomFactor-r){q=(f+s)*this.options.zoomFactor-r}}this.options.offset={x:d+t.x,y:q+t.y}},sanitize:function(){if(this.options.zoomFactor<this.options.zoomOutFactor){this.zoomOutAnimation()}else{if(this.isInsaneOffset(this.options.offset)){this.sanitizeOffsetAnimation()}}},isInsaneOffset:function(c){var d=this.sanitizeOffset(c);return d.x!==c.x||d.y!==c.y},sanitizeOffsetAnimation:function(){var d=this.sanitizeOffset(this.options.offset),e={x:this.options.offset.x,y:this.options.offset.y},c=(function(f){this.options.offset.x=e.x+f*(d.x-e.x);this.options.offset.y=e.y+f*(d.y-e.y);this.update()}).bind(this);this.animate(this.options.animationDuration,c,this.swing)},zoomOutAnimation:function(){var d=this.options.zoomFactor,e=3,f=this.getCurrentZoomCenter(),c=(function(l){this.scaleTo(d+l*(e-d),f)}).bind(this);this.animate(this.options.animationDuration,c,this.swing)},updateAspectRatio:function(){this.setContainerY(this.getContainerX()/this.getAspectRatio())},getInitialZoomFactor:function(){return this.container[0].offsetWidth/this.el[0].offsetWidth},getAspectRatio:function(){return this.el[0].offsetWidth/this.el[0].offsetHeight},getCurrentZoomCenter:function(){var v=this.container[0].offsetWidth*this.options.zoomFactor,t=this.options.offset.x,q=v-t-this.container[0].offsetWidth,d=t/q,f=d*this.container[0].offsetWidth/(d+1),c=this.container[0].offsetHeight*this.options.zoomFactor,u=this.options.offset.y,s=c-u-this.container[0].offsetHeight,e=u/s,r=e*this.container[0].offsetHeight/(e+1);if(q===0){f=this.container[0].offsetWidth}if(s===0){r=this.container[0].offsetHeight}console.log("缩放后宽度: "+v);console.log("原始宽度: "+this.container[0].offsetWidth);console.log("缩放比: "+this.options.zoomFactor);console.log("左边距: "+t);console.log("右边距: "+q);console.log("左右边距比: "+d);console.log("centerX: "+f);return{x:f,y:r}},canDrag:function(){return !h(this.options.zoomFactor,3)},getTouches:function(c){var d=this.container.offset();return Array.prototype.slice.call(c.touches).map(function(e){return{x:e.pageX-d.left,y:e.pageY-d.top}})},animate:function(m,c,d,e){var n=new Date().getTime(),f=(function(){if(!this.inAnimation){return}var l=new Date().getTime()-n,k=l/m;if(l>=m){c(1);if(e){e()}this.update();this.stopAnimation();this.update()}else{if(d){k=d(k)}c(k);this.update();requestAnimationFrame(f)}}).bind(this);this.inAnimation=true;requestAnimationFrame(f)},stopAnimation:function(){this.inAnimation=false},swing:function(c){return -Math.cos(c*Math.PI)/2+0.5},getContainerX:function(){return this.container[0].offsetWidth},getContainerY:function(){return this.container[0].offsetHeight},setContainerY:function(c){return this.container.height(c)},setupMarkup:function(){this.container=i('<div class="pinch-zoom-container"></div>');this.el.before(this.container);this.container.append(this.el);this.container.css({overflow:"hidden",position:"relative"});this.el.css({"-webkit-transform-origin":"0% 0%","-moz-transform-origin":"0% 0%","-ms-transform-origin":"0% 0%","-o-transform-origin":"0% 0%","transform-origin":"0% 0%",position:"absolute"})},end:function(){this.hasInteraction=false;this.sanitize();this.update()},bindEvents:function(){j(this.container.get(0),this);i(window).on("resize",this.update.bind(this));i(this.el).find("img").on("load",this.update.bind(this))},update:function(){if(this.updatePlaned){return}this.updatePlaned=true;setTimeout((function(){this.updatePlaned=false;this.updateAspectRatio();var d=this.getInitialZoomFactor()*this.options.zoomFactor,m=-this.options.offset.x/d,c=-this.options.offset.y/d,e="scale3d("+d+", "+d+",1) translate3d("+m+"px,"+c+"px,0px)",n="scale("+d+", "+d+") translate("+m+"px,"+c+"px)",f=(function(){if(this.clone){this.clone.remove();delete this.clone}}).bind(this);if(!this.options.use2d||this.hasInteraction||this.inAnimation){this.is3d=true;f();this.el.css({"-webkit-transform":e,"-o-transform":n,"-ms-transform":n,"-moz-transform":n,transform:e})}else{if(this.is3d){this.clone=this.el.clone();this.clone.css("pointer-events","none");this.clone.appendTo(this.container);setTimeout(f,200)}this.el.css({"-webkit-transform":n,"-o-transform":n,"-ms-transform":n,"-moz-transform":n,transform:n});this.is3d=false}}).bind(this),0)},enable:function(){this.enabled=true},disable:function(){this.enabled=false}};var j=function(A,e){var c=null,x=0,z=null,C=null,u=function(l,k){if(c!==l){if(c&&!l){switch(c){case"zoom":e.handleZoomEnd(k);break;case"drag":e.handleDragEnd(k);break}}switch(l){case"zoom":e.handleZoomStart(k);break;case"drag":e.handleDragStart(k);break}}c=l},v=function(k){if(x===2){u("zoom")}else{if(x===1&&e.canDrag()){u("drag",k)}else{u(null,k)}}},d=function(k){return Array.prototype.slice.call(k).map(function(l){return{x:l.pageX,y:l.pageY}})},w=function(k,l){var m,n;m=k.x-l.x;n=k.y-l.y;return Math.sqrt(m*m+n*n)},y=function(k,l){var n=w(k[0],k[1]),m=w(l[0],l[1]);return m/n},f=function(k){k.stopPropagation();k.preventDefault()},D=function(l){var k=(new Date()).getTime();if(x>1){z=null}if(k-z<300){f(l);e.handleDoubleTap(l);switch(c){case"zoom":e.handleZoomEnd(l);break;case"drag":e.handleDragEnd(l);break}}if(x===1){z=k}},B=true;A.addEventListener("touchstart",function(k){if(e.enabled){B=true;x=k.touches.length;D(k)}});A.addEventListener("touchmove",function(l){var k=l.changedTouches[0].pageY;if(e.enabled){if(B){v(l);if(c){f(l)}C=d(l.touches)}else{switch(c){case"zoom":e.handleZoom(l,y(C,d(l.touches)));break;case"drag":e.handleDrag(l);break}if(c){f(l);e.update()}}B=false}});A.addEventListener("touchend",function(k){if(e.enabled){x=k.touches.length;v(k)}})};return g};if(typeof define!=="undefined"&&define.amd){define(["jquery"],function(a){return b(a)})}else{window.RTP=window.RTP||{};window.RTP.PinchZoom=b(window.$)}}).call(this);