<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
  <title>平安众包</title>
  <script>
    function htmlFontSize(){
      var html = document.querySelector("html");
      var width = html.getBoundingClientRect().width;
      html.style.fontSize = width / 3.75 + "px";
    }
    htmlFontSize();
    window.addEventListener("resize",function(){
      htmlFontSize();
    },false);
  </script>
  <style>
    html, body{width:100%;height:100%;overflow:hidden;}
    body,p{margin: 0;}
    img{vertical-align: top;}

    .fzB{font-size: 18px;}
    .fzS{font-size: 14px;}
    .fzN{font-size: 16px;}
    .blackL{color: #c8c8c8;}
    .blackN{color: #969696;}
    .blackW{color: #323232;}
    .tc{text-align: center;}

    .wrap{box-sizing:border-box;width:100%;height:100%;overflow:auto;font-size: 14px;color: #323232;}
    .bg{width:3.75rem;height:6.03rem;background: url("img/bg.png") no-repeat;background-size: 100%;}
    header,footer{
      padding-top: .3rem;
      color: #fff;
      line-height: 1.6;
    }
    section{
      width: 3.75rem;
      height: 10.65rem;
      background: url("./img/bodyBg.png") no-repeat;
      background-size: 100% 100%;
    }
    .btnG{
      padding-top: 7.64rem;
    }
    .join{
      padding: .5rem 0 .2rem;
    }
    .score{
      color: #ff6000;
      font-size: 30px;
      line-height: 1;
    }
    .tel{
      width: 2.77rem;
      height: .45rem;
      line-height: .45rem;
      text-align: center;
      outline: none;
      margin: .66rem 0 .2rem;
      border: 1px solid #c8c8c8;
      border-radius: 5px;
    }
    .btn{width: 3.05rem;}
    .get{margin-bottom: .05rem;}
    .try{margin-bottom: .1rem;position: relative;left: -1px;}

    .maskBg{position: absolute;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,.7);font-size: 14px;}
    .box{box-sizing:border-box;position:absolute;width:2.4rem;left:50%;top:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);height:auto;z-index:100;background-color:#f5f5f5;border:1px #ddd solid;padding:.3rem .15rem .15rem;border-radius: .15rem;color:#828282;}

    .user-btn{
      width: 100%;
      height: .44rem;
      border: 1px solid #c3c3c3;
      background: #f5f5f5;
      margin-top: .3rem;
      color: #ff6000;
      outline: none;
      border-radius: .05rem;
      font-size: 14px;
    }

    input::-webkit-input-placeholder, textarea::-webkit-input-placeholder {
      color: #c8c8c8;
      font-size: 16px;
    }

  </style>
</head>
<body>
<div class="wrap">
  <div class="bg tc">
    <section>
      <div class="btnG">
        <input id="tel" type="text" class="tel fzN" placeholder="请输入手机号即可一键领取"> <br>
        <img id="getBtn" src="img/getBtn.png" alt="getBtn" class="get btn"> <br>
        <img id="tryBtn" src="img/tryBtn.png" alt="tryBtn" class="try btn">
      </div>
    </section>
  </div>
</div>

<div id="regular-user" class="maskBg" style="display:none">
  <div class="box">
    <p>您已经是老用户了，请把机会留给新用户呗～</p>
    <input class="user-btn" id="regular-user-btn" type="button" value="确 认">
  </div>
</div>
<div id="new-user" class="maskBg" style="display:none">
  <div class="box">
    <p>您已经成功领取500积分，登录APP即可使用～</p>
    <input class="user-btn" id="new-user-btn" type="button" value="一键下载并使用">
  </div>
</div>
<div id="telErr" class="maskBg" style="display:none">
  <div class="box">
    <p class="tc">请输入正确的手机号。</p>
    <input class="user-btn" id="tel-btn" type="button" value="确定">
  </div>
</div>

<script src="../js/jquery.1.7.2.min.js"></script>
<script>



  function getUrlParam(url) {

    var search = url.split('?')[1].split("&");
    var searchJSON = {};
    var searchL = search.length;
    for(var i=0;i<searchL;i++){
      var searchName = search[i].split('=')[0];
      var searchVal = search[i].split('=')[1];
      searchJSON[searchName] = searchVal;
    }
    return searchJSON||'';

  }

  console.log(getUrlParam(location.href)['username']);
  var inviter = getUrlParam(location.href)['username'];
  var inviterTel = getUrlParam(location.href)['tel'];
  $('#inviter').html(inviter);

  $('#getBtn').click(function () {

    var sMobile = $('#tel').val();
    var isTel = (/^1[3|4|5|8][0-9]\d{4,8}$/.test(sMobile));


    if(isTel){

      var data = {
        invitee : sMobile,    //String 新用户手机号
        inviter : inviterTel    //String 老用户手机号
      };

      $.ajax({
        url: location.origin + "/token/invitation/trial",
        type: "POST",
        data: data
      }).then(function (data) {
//        {"body": {"result": 1}, "message": "operate successfully", "code": 200}
//        601: 老用户不存在
//        602: 新用户使用的号码已被注册
//        200: 成功
        var code = data.code;
        switch (code){
          case 200:
            $('#new-user').fadeIn(400);
            break;
          case 601:
            console.log('返回的data.code为: '+601);
            break;
          case 602:
            $('#regular-user').fadeIn(400);
            break;
          default:
            console.log('返回的data.code: '+code);
        }
      },function (err) {
        console.log('/token/invitation/trial error');
        console.log(err);
      });
    }else{
      $('#telErr').fadeIn();
    }

  });

  $('#tryBtn').click(function () {
    localStorage.setItem('inviterTel',inviterTel);
    location.href = 'doTask1sn.html';
  });

  $('#tel-btn').click(function () {
    $('#telErr').fadeOut();
  });

  $('#regular-user-btn').click(function () {
    $('#regular-user').fadeOut(400);
  });

  $('#new-user-btn').click(function () {
    var url = location.origin+'/token/qr/lead_to_download_url';
    window.location.href=url;
  });

</script>
</body>
</html>