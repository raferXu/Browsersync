<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
  <title>平安众包</title>
  <script>
    function htmlFontSize(){
      var html = document.querySelector("html");
      var width = html.getBoundingClientRect().width;
      html.style.fontSize = width / 3.75 + "px";
    }
    htmlFontSize();
    window.addEventListener("resize",function(){
      htmlFontSize();
    },false);
  </script>
  <style>
    html, body{width:100%;height:100%;overflow:hidden;}
    body,p{margin: 0;}
    img{vertical-align: top;}

    .fzB{font-size: .18rem;}
    .fzS{font-size: .14rem;}
    .fzN{font-size: .16rem;}
    .blackL{color: #c8c8c8;}
    .blackN{color: #969696;}
    .blackW{color: #323232;}
    .tc{text-align: center;}

    .wrap{box-sizing:border-box;width:100%;height:100%;overflow:auto;font-size: .14rem;color: #323232;}
    .bg{width:3.75rem;height:6.03rem;background: url("img/bg.png") no-repeat;background-size: 100%;}
    header,footer{
      padding-top: .3rem;
      color: #fff;
      line-height: 1.6;
    }
    .join{
      padding: .5rem 0 .2rem;
    }
    .score{
      color: #ff6000;
      font-size: .30rem;
      line-height: 1;
    }
    .tel{
      width: 2.77rem;
      height: .25rem;
      padding: .1rem 0;
      line-height: .25rem;
      text-align: center;
      outline: none;
      margin: .66rem 0 .2rem;
      border: 1px solid #c8c8c8;
      border-radius: 5px;
    }
    .btn{width: 3.05rem;}
    .get{
      margin-bottom: .05rem;
      position: relative;
      left: -.05rem;
    }
    .try{margin-bottom: .1rem;position: relative;left: -.02rem;}

    .maskBg{position: absolute;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,.7);font-size: .14rem;}
    .box{box-sizing:border-box;position:absolute;width:2.4rem;left:50%;top:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);height:auto;z-index:100;background-color:#f5f5f5;border:1px #ddd solid;padding:.3rem .15rem .15rem;border-radius: .15rem;color:#828282;}

    .user-btn{
      width: 100%;
      height: .44rem;
      border: 1px solid #c3c3c3;
      background: #f5f5f5;
      margin-top: .3rem;
      color: #ff6000;
      outline: none;
      border-radius: .05rem;
      font-size: .14rem;
    }

    input::-webkit-input-placeholder, textarea::-webkit-input-placeholder {
      color: #c8c8c8;
      font-size: .16rem;
    }

    input, button { cursor: pointer; -webkit-appearance: none; }
    input {
      color: red !important;
      text-shadow: 0px 0px 0px #495057;
      -webkit-text-fill-color: transparent;
    }

  </style>
</head>
<body>
<div class="wrap">
  <div class="bg tc">
    <header>
      你的好友<span id="inviter"></span>正在平安众包躺着赚钱 <br>TA邀请你也一起来哟!
    </header>
    <section>
      <p class="join fzB blackW">即刻加入平安众包，新用户可获得</p>
      <p class="score">500积分</p>
      <div class="btnG">
        <input id="tel" type="text" class="tel fzS" placeholder="请输入手机号"> <br>
        <div id="getBtn" style="position:relative;width:3rem;margin:0 auto;">
          <img src="img/getBtn0.jpg" alt="getBtn" class="get btn">
          <span style="position:absolute;top:.16rem;left:0;right:0;font-size:.18rem;color:#fff;">一键下载</span>
        </div>
        <img id="tryBtn" src="img/tryBtn.png" alt="tryBtn" class="try btn">
      </div>
    </section>
    <footer>
      <p class="fzB blackW">看图点一点 即可赚钱</p>
      <p class="fzN blackN">平安众包 撑爆你的钱包</p>
    </footer>
  </div>
</div>

<!--<div id="regular-user" class="maskBg" style="display:none">-->
  <!--<div class="box">-->
    <!--<p>您已经是老用户了，请把机会留给新用户呗～</p>-->
    <!--<input class="user-btn" id="regular-user-btn" type="button" value="确 认">-->
  <!--</div>-->
<!--</div>-->
<!--<div id="new-user" class="maskBg" style="display:none">-->
  <!--<div class="box">-->
    <!--<p>您已经成功领取500积分，登录APP即可使用～</p>-->
    <!--<input class="user-btn" id="new-user-btn" type="button" value="一键下载并使用">-->
  <!--</div>-->
<!--</div>-->
<div id="telErr" class="maskBg" style="display:none">
  <div class="box">
    <p class="tc">请输入正确的手机号。</p>
    <input class="user-btn" id="tel-btn" type="button" value="确定">
  </div>
</div>
<div id="weixin" class="maskBg" style="display:none">
  <div class="box">
    <p class="tc">请用浏览器打开。</p>
    <input class="user-btn" id="wx-btn" type="button" value="确定">
  </div>
</div>

<script src="../js/jquery.1.7.2.min.js"></script>
<script>

  function isAndroidFn() {
    var u = navigator.userAgent,
      app = navigator.appVersion;
    var isAndroid = u.indexOf('Android') > -1 || u.indexOf('Linux') > -1; //android终端或者uc浏览器
    var isiOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端
    return isAndroid;
  }

  function is_weixin(){
    var ua = navigator.userAgent.toLowerCase();
    if(ua.match(/MicroMessenger/i)=="micromessenger") {
      return true;
    } else {
      return false;
    }
  }
  var android = isAndroidFn();
  var isweixin = is_weixin();
  if(isweixin){
    $('#weixin').fadeIn();
  }
  $('#wx-btn').click(function () {
    $('#weixin').fadeOut();
  });



  function getUrlParam(url) {

    var search = url.split('?')[1].split("&");
    var searchJSON = {};
    var searchL = search.length;
    for(var i=0;i<searchL;i++){
      var searchName = search[i].split('=')[0];
      var searchVal = search[i].split('=')[1];
      searchJSON[searchName] = searchVal;
    }
    return searchJSON||'';

  }

  console.log(getUrlParam(location.href)['username']);
  var inviter = getUrlParam(location.href)['username'];
  var inviterTel = getUrlParam(location.href)['tel'];
  $('#inviter').html(inviter);

  $('#getBtn').click(function () {

    var sMobile = $('#tel').val();
    var isTel = (/^1[3|4|5|7|8][0-9]\d{8}$/.test(sMobile));


    if(isTel){

      var data = {
        invitee : sMobile,    //String 新用户手机号
        inviter : inviterTel    //String 老用户手机号
      };

      $.ajax({
        url: location.origin + "/token/invitation/trial",
        type: "POST",
        data: data
      });

      var url = location.origin+'/token/qr/lead_to_download_url';
      window.location.href=url;

    }else{
      $('#telErr').fadeIn();
    }

  });

  $('#tryBtn').click(function () {
    localStorage.setItem('inviterTel',inviterTel);
    location.href = 'doTask1sn.html';
  });

  $('#tel-btn').click(function () {
    $('#telErr').fadeOut();
  });
//
//  $('#regular-user-btn').click(function () {
//    $('#regular-user').fadeOut(400);
//  });
//
//  $('#new-user-btn').click(function () {
//    var url = location.origin+'/token/qr/lead_to_download_url';
//    window.location.href=url;
//  });

</script>
</body>
</html>