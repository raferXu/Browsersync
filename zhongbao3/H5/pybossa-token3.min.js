(function(b,h,f){var g="";var c="/";var m={id:""};var k=function(o,n){n.resolve(o)};var l=function(o,n){n.resolve(o)};function e(n){return h.ajax({url:c+"token/project",beforeSend:function(o){if(g===""){return}else{o.setRequestHeader("Authorization",g)}},success:function(o){console.log("url + 'token/project' success");console.log(o)},error:function(o){console.log("url + 'token/project' error");console.log(o)},data:"all=1&short_name="+n,dataType:"json"})}function d(n,o){console.log("_fetchNewTask函数第一参数projectId: "+n+", 第二参数offset: "+o);console.log(n);console.log(o);o=o||0;return h.ajax({url:c+"token/project/"+n+"/newtask",beforeSend:function(p){if(g===""){return}else{p.setRequestHeader("Authorization",g)}},success:function(p){console.log("url + 'token/project/' + projectId + '/newtask' success");console.log(p);if(!p.id){jumpProjectFlag=true}},error:function(p){console.log("url + 'token/project/' + projectId + '/newtask' error");console.log(p)},data:"offset="+o,cache:false,dataType:"json"})}function j(n){return h.ajax({type:"POST",url:c+"token/taskrun",beforeSend:function(o){if(g===""){return}else{o.setRequestHeader("Authorization",g)}},success:function(o){console.log("url + 'token/taskrun' success");console.log(o)},error:function(o){console.log("url + 'token/taskrun' error");console.log(o)},dataType:"json",contentType:"application/json",data:n})}function a(o,n){var p=h.Deferred();k(o,p);p.done(function(q){n.resolve(q)})}function i(n,o){o=o||window;e(n).done(function(r){r=r[0];function q(x,v){x=x||0;var u=h.Deferred(),s=h.Deferred();var t=m.id;var w=d(r.id,x);w.done(function(y){if(v&&y.id===v.id){u.resolve(y)}else{a(y,u);u.done(function(){l(y,s)})}if(y.id){m.id=y.id}});s.done(p)}function p(s){q(0,s)}q(0,f)})}b.saveTask=function(n,p){var o={project_id:n.project_id,task_id:n.id,info:p};return j(JSON.stringify(o))};b.run=function(n,o){g=h("#token").data("token");i(n,o)};b.taskLoaded=function(n){k=n};b.presentTask=function(n){l=n}}(window.pybossa=window.pybossa||{},jQuery));