var jumpProjectFlag=false;(function(b,h,f){var g="";var c="/";var m={id:""};var k=function(o,n){n.resolve(o)};var l=function(o,n){n.resolve(o)};function e(n){return h.ajax({url:c+"token/project",beforeSend:function(o){if(g===""){return}else{o.setRequestHeader("Authorization",g)}},success:function(o){console.log("url + 'token/project' success");console.log(o)},error:function(o){console.log("url + 'token/project' error");console.log(o)},data:"all=1&short_name="+n,dataType:"json"})}function d(n,o){console.log("_fetchNewTask函数第一参数projectId: "+n+", 第二参数offset: "+o);console.log(n);console.log(o);o=o||0;return h.ajax({url:c+"token/project/"+n+"/newtask",beforeSend:function(p){if(g===""){return}else{p.setRequestHeader("Authorization",g)}},success:function(p){console.log("url + 'token/project/' + projectId + '/newtask' success");console.log(p);if(!p.id){jumpProjectFlag=true}},error:function(p){console.log("url + 'token/project/' + projectId + '/newtask' error");console.log(p)},data:"offset="+o,cache:false,dataType:"json"})}function j(n){return h.ajax({type:"POST",url:c+"token/taskrun",beforeSend:function(o){if(g===""){return}else{o.setRequestHeader("Authorization",g)}},success:function(o){console.log("url + 'token/taskrun' success");console.log(o)},error:function(o){console.log("url + 'token/taskrun' error");console.log(o)},dataType:"json",contentType:"application/json",data:n})}function a(o,n){var p=h.Deferred();k(o,p);p.done(function(q){n.resolve(q)})}function i(n,o){o=o||window;e(n).done(function(r){r=r[0];function q(w,u){w=w||0;var t=h.Deferred();var s=m.id;var v=d(r.id,w);v.done(function(x){if(u&&x.id===u.id){t.resolve(x)}else{a(x,t)}});return t.promise()}function p(t){var u=q(1,t),s=h.Deferred();if(t.id){m.id=t.id}l(t,s);h.when(u,s).done(p)}q(0,f).done(p)})}b.saveTask=function(n,p){var o={project_id:n.project_id,task_id:n.id,info:p};return j(JSON.stringify(o))};b.run=function(n,o){g=h("#token").data("token");i(n,o)};b.taskLoaded=function(n){k=n};b.presentTask=function(n){l=n}}(window.pybossa=window.pybossa||{},jQuery));